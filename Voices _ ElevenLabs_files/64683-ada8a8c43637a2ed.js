try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="6ff4c934-af76-4926-b3a6-cdd1bbef2b63",e._sentryDebugIdIdentifier="sentry-dbid-6ff4c934-af76-4926-b3a6-cdd1bbef2b63")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[64683],{70108:function(e,t,a){a.d(t,{GU:function(){return l},J5:function(){return r},S9:function(){return d},Xw:function(){return u},ij:function(){return o}});var i=a(17024),s=a(96162),n=a(54389);class r{static fromDB(e){return new r(e.pronunciation_dictionary_id,e.version_id)}constructor(e,t){(0,i._)(this,"pronunciationDictionaryId",void 0),(0,i._)(this,"versionId",void 0),this.pronunciationDictionaryId=e,this.versionId=t}}class o{static fromAddDictionaryResponse(e){var t;return new o(e.id,e.version_id,e.version_rules_num,e.name,null!==(t=e.description)&&void 0!==t?t:null,e.permission_on_resource,e.created_by,e.creation_time_unix)}static fromDictionaryVersionResponse(e){return new o(e.pronunciation_dictionary_id,e.version_id,e.version_rules_num,e.dictionary_name,null,e.permission_on_resource,e.created_by,e.creation_time_unix)}getLocator(){return new r(this.id,this.versionId)}toAddDictionaryResponseModel(){var e;return{id:this.id,name:this.name,created_by:this.created_by,creation_time_unix:this.creation_time_unix,version_id:this.versionId,version_rules_num:this.versionRulesNum,description:null!==(e=this.description)&&void 0!==e?e:void 0,permission_on_resource:this.permission_on_resource}}constructor(e,t,a,s,n,r,o,l){(0,i._)(this,"id",void 0),(0,i._)(this,"versionId",void 0),(0,i._)(this,"versionRulesNum",void 0),(0,i._)(this,"name",void 0),(0,i._)(this,"description",void 0),(0,i._)(this,"permission_on_resource",void 0),(0,i._)(this,"created_by",void 0),(0,i._)(this,"creation_time_unix",void 0),this.id=e,this.versionId=t,this.versionRulesNum=a,this.name=s,this.description=n,this.permission_on_resource=r,this.created_by=o,this.creation_time_unix=l}}let l=async e=>{let{name:t,inputFile:a,onSuccess:i=null,onError:n=null,workspace_access:r=null}=e,l=await (0,s.hP)(),c=new FormData;c.append("name",t),c.append("file",a),r&&c.append("workspace_access",r);let d=await fetch("".concat(s.LB,"/v1/pronunciation-dictionaries/add-from-file"),{method:"POST",body:c,headers:{Authorization:"Bearer ".concat(l)}});if(200==d.status){if(null!==i){let e=await d.json();i(o.fromAddDictionaryResponse(e),e),window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"add_pronunciation_dictionary",eventProps:{form:c}})}}else null!==n&&d.json().then(e=>{n(e.detail.message)})},c=async e=>{let{dictionaryId:t,versionId:a}=e,i="".concat(s.LB,"/v1/pronunciation-dictionaries/").concat(t,"/").concat(a,"/download"),n=await (0,s.hP)();return await fetch(i,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)}})},d=async e=>{let t=await c({dictionaryId:e.id,versionId:e.versionId});if(200!==t.status)throw Error((await t.json()).detail.message);let a=await t.blob(),i=URL.createObjectURL(a),r=t.headers.get("content-type");if(!(r&&r in s.W$))throw Error("Invalid response type received: '".concat(r,"' is not supported."));(0,n.downloadFromBlobUrl)(i,e.name.replace(/\.[^.]+$/,"")+".pls")},u=async e=>{var t;let{pronunciationDictionaryIds:a,onSuccess:i=null,onError:n=null}=e,r=null===s.EA||void 0===s.EA?void 0:null===(t=s.EA.value)||void 0===t?void 0:t.uid,l=await (0,s.hP)();if(null==r)throw Error("Can't determine userId");let c=[];for(let e of a){let t=await fetch("".concat(s.LB,"/v1/pronunciation-dictionaries/").concat(e.pronunciationDictionaryId,"/"),{method:"GET",headers:{Authorization:"Bearer ".concat(l)}});if(200!==t.status)n&&n("Unable to retrieve pronunciation dictionary with id: ".concat(e.pronunciationDictionaryId));else try{let a=await t.json();c.push(new o(a.id,e.versionId,a.latest_version_rules_num,a.name,a.description||null,a.permission_on_resource,a.created_by,a.creation_time_unix))}catch(e){n&&n("Error while fetching pronunciation dictionary metadata")}}i&&i(c)}},79306:function(e,t,a){var i=a(68088),s=a(23586),n=a(9506),r=a(69881);t.Z=e=>{let{children:t}=e,a=(0,n.useRef)(null),o=(0,s.U8)(e=>e.value);return(0,n.useEffect)(()=>{var e,t;null===(t=a.current)||void 0===t||null===(e=t.querySelector("[aria-selected='true']"))||void 0===e||e.focus()},[o]),(0,i.jsx)(r.e8,{ref:a,children:t})}},26542:function(e,t,a){a.d(t,{Bw:function(){return l},GV:function(){return d},k1:function(){return u},oe:function(){return c}});var i=a(17024),s=a(5479),n=a(9506),r=a(60350);class o{setRoute(e){Object.assign(this.route,e)}setOpen(e){this.open=e}selectLocator(e){this.selectedLocator=e}setContext(e){Object.assign(this.context,e)}setQueryOptions(e){Object.assign(this.queryOptions,e)}reset(){this.queryOptions={},this.route={path:"dictionaries"},this.selectedLocator=null,this.context={}}constructor(){(0,i._)(this,"queryOptions",{}),(0,i._)(this,"open",!1),(0,i._)(this,"route",{path:"dictionaries"}),(0,i._)(this,"context",{}),(0,i._)(this,"selectedLocator",null),(0,s.ky)(this)}}let l=new o,c=()=>{let e=(0,r.c)({enabled:l.open&&"dictionaries"===l.route.path,options:l.queryOptions});return(0,n.useMemo)(()=>({observable:l,query:e}),[l,e])},d=()=>{let e=(0,n.useContext)(u);if(!e)throw Error("usePronunciationStoreContext must be used within PronunciationStoreContext");return e},u=(0,n.createContext)(void 0)},5558:function(e,t,a){a.d(t,{B:function(){return s}});var i=a(1851);let s=e=>{var t;return!!(null===(t=i.workspaceData.value)||void 0===t?void 0:t.pronunciation_dictionary_locators.some(t=>t.pronunciation_dictionary_id===e))}},90610:function(e,t,a){a.d(t,{X1:function(){return o},ap:function(){return l},y:function(){return r}});var i=a(9506),s=a(1851),n=a(15750);let r=e=>{let t=o();return(0,i.useMemo)(()=>t.find(t=>t.voice_id===e),[e,t])},o=()=>{var e,t;let a=null!==(t=null===(e=s.voices.value)||void 0===e?void 0:e.length)&&void 0!==t?t:0;return(0,i.useMemo)(()=>s.voices.value?s.voices.value.filter(e=>!n.Ad.includes(e.voice_id)):[],[s.voices.value,a])},l=e=>{let t=c();return(0,i.useMemo)(()=>t.find(t=>t.model_id===e),[e,t])},c=()=>(0,i.useMemo)(()=>{var e,t;return null!==(t=null===(e=s.models.value)||void 0===e?void 0:e.filter(e=>{let{can_do_text_to_speech:t,requires_alpha_access:a}=e;return!0===t&&!1===a}))&&void 0!==t?t:[]},[])},60350:function(e,t,a){a.d(t,{L:function(){return u},c:function(){return c}});var i=a(84909),s=a(17083),n=a(1227),r=a.n(n),o=a(9506),l=a(30487);let c=e=>{let{enabled:t,options:a}=e,[n,r]=(0,o.useState)({}),c=(0,i.useQueryClient)(),p=(0,s.useInfiniteQuery)({queryKey:d(a),enabled:t,queryFn:async e=>{let{pageParam:t}=e,a={page_size:100};return t&&(a.cursor=t),await (0,l.w9Y)({queryParams:a})},getNextPageParam:e=>e.has_more&&e.next_cursor,keepPreviousData:!0,refetchOnWindowFocus:!1}),m=(0,o.useCallback)(()=>{c.invalidateQueries({queryKey:d(a)})},[a]),f=(0,o.useCallback)(e=>{c.invalidateQueries({queryKey:u(e)}),c.invalidateQueries({queryKey:h(e)})},[]),g=(0,o.useCallback)(e=>{c.setQueryData(d(a),t=>{if(!t||!t.pages.length)return m(),t;let a=!1,i=t.pages.map(t=>({...t,pronunciation_dictionaries:t.pronunciation_dictionaries.map(t=>t.id!==e.id?t:(a=!0,f({pronunciation_dictionary_id:t.id,version_id:t.latest_version_id}),{...t,...e}))}));return a||i[0].pronunciation_dictionaries.unshift(e),{...t,pages:i}})},[c,a]);return(0,o.useEffect)(()=>{p.data&&r(e=>{let t={...e};for(let e of p.data.pages)for(let a of e.pronunciation_dictionaries)t[a.id]=a;return t})},[p.data]),(0,o.useMemo)(()=>({...p,cache:n,pronunciationsSet:g,pronunciationsInvalidate:m,pronunciationsDictionaryInvalidate:f}),[p,n,g,m,f])},d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{sort:t}=p(e);return["infinite-pronunciations",null==t?void 0:t.property,null==t?void 0:t.direction]},u=e=>["pronunciation-dictionary",e.pronunciation_dictionary_id],h=e=>["pronunciation-dictionary",e.pronunciation_dictionary_id,"version",e.version_id],p=e=>r()({sort:{property:"creation_time_unix",direction:"descending"}},e)},50267:function(e,t,a){a.d(t,{Z:function(){return o}});var i=a(68088),s=a(9506),n=a(23636),r=a(70140);function o(e){let{accept:t,onChange:a,children:o,errorText:l=null,multiple:c=!1,className:d,disabled:u=!1,fileSizeLimit:h}=e,[p,m]=(0,s.useState)(!1),f=(0,s.useRef)(null);function g(e){if(void 0!==h){let t=0;for(let a=0;a<e.length;a++)t+=e[a].size;if(t>h){(0,n.default)("Files are too big.");return}}a(e)}return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("label",{htmlFor:"file-upload",className:(0,r.A)("flex justify-center rounded-md border-gray-300 border-2 px-6 pt-5 pb-6",!u&&"cursor-pointer hover:border-gray-500 border-dashed",p&&"border-gray-500 bg-gray-50",d),onDragEnter:u?void 0:e=>m(!0),onDragLeave:u?void 0:e=>m(!1),onDragOver:u?void 0:e=>e.preventDefault(),onDrop:u?void 0:e=>{e.preventDefault(),m(!1),null!==e.dataTransfer&&g(e.dataTransfer.files)},onClick:u?void 0:()=>{null!==f.current&&f.current.click()},children:o}),(0,i.jsx)("input",{ref:f,name:"file-upload",type:"file",className:"sr-only",accept:u?void 0:t,multiple:c,onChange:u?void 0:e=>{g(e.target.files)}}),l&&(0,i.jsx)("div",{className:"mt-1 text-sm text-red-600",children:l})]})}},16843:function(e,t,a){a.d(t,{$Z:function(){return J},C1:function(){return W},Nf:function(){return Q},gX:function(){return G},i2:function(){return ea},qd:function(){return V},sd:function(){return F}});var i=a(17024),s=a(68088),n=a(24038),r=a(61702),o=a(3540),l=a(18743),c=a(40534),d=a(63869),u=a.n(d),h=a(1227),p=a.n(h),m=a(72794),f=a(73998),g=a(20147),y=a(20828),v=a(30395),_=a(47607),x=a(5479),b=a(81999),w=a(9506),j=a(82374),N=a(74508),k=a(79306),C=a(1851),S=a(8120),I=a(7275),P=a(60189),D=a(97204),E=a(88462),L=a(4735),O=a(69881),R=a(74346),z=a(3030),A=a(44463),M=a(46547),T=a(64755),q=a(82528),Z=a(91105),B=a(11521),U=a(25933);let F=(0,b.Pi)((0,w.forwardRef)((e,t)=>{let{initialValue:a,metadata:i,className:n,onPlay:r,onPause:o,playerButtonProps:l={}}=e,[c]=(0,w.useState)(()=>a instanceof ea?a:new ea(a,i));es(c,i);let d=[{value:"alias",label:"Alias",shortLabel:"Alias",data:{type:"alias"}},{value:"ipa",label:"IPA Phoneme",shortLabel:"IPA",data:{type:"phoneme",alphabet:"ipa"}},{value:"cmu",label:"CMU Phoneme",shortLabel:"CMU",data:{type:"phoneme",alphabet:"cmu-arpabet"}}],u=d.find(e=>"phoneme"===c.data.type?"phoneme"===e.data.type&&e.data.alphabet===c.data.alphabet:c.data.type===e.data.type),h=!ei(c.metadata);return(0,s.jsx)("div",{ref:t,className:(0,P.cn)("w-full flex items-center gap-1.5",n),children:(0,s.jsxs)("div",{className:"grid grid-cols-3 w-full items-center gap-1.5",children:[(0,s.jsx)(M.I,{placeholder:"Input",className:"flex-1 px-2 h-9",value:c.data.string_to_replace,onChange:e=>c.setData({string_to_replace:e.target.value}),disabled:h}),(0,s.jsxs)(Z.Select,{value:null==u?void 0:u.value,onValueChange:e=>{let t=d.find(t=>t.value===e);if(t){let e="alias"===c.data.type?c.data.alias:c.data.phoneme;c.setData({...t.data,alias:e,phoneme:e})}},children:[(0,s.jsx)(Z.SelectTrigger,{className:"flex-1 h-9",disabled:h,children:(0,s.jsx)("span",{className:"truncate",children:(null==u?void 0:u.shortLabel)||"Select"})}),(0,s.jsx)(Z.SelectContent,{children:d.map(e=>(0,s.jsx)(Z.SelectItem,{value:e.value,children:e.label},e.value))})]}),(0,s.jsxs)("div",{className:"relative w-full",children:[(0,s.jsx)(M.I,{disabled:h,className:"flex-1 px-2 h-9 pr-8",placeholder:"Output",value:"alias"===c.data.type?c.data.alias:c.data.phoneme,onChange:e=>{c.setData({alias:e.target.value,phoneme:e.target.value})}}),(0,s.jsx)("div",{className:"absolute top-0 right-2 h-full flex items-center justify-center",children:(0,s.jsx)(H,{size:"2xs",variant:"primary",audioObservable:c,onPlayAudio:()=>null==r?void 0:r(c),onPauseAudio:()=>null==o?void 0:o(c),...l})})]})]})})})),W=(0,b.Pi)(e=>{let{store:t}=K(e);return(0,s.jsx)(Y.Provider,{value:t,children:e.children})}),J=(0,b.Pi)(e=>{let{className:t,children:a,...i}=e,{dictionary:n}=X(),r=(0,j.Nr)(n.state.input,200);(0,w.useEffect)(()=>{if(r){let e=r.toLocaleLowerCase(),t=n.rules.filter(t=>{let a=t.data.string_to_replace,i="alias"===t.data.type?t.data.alias:t.data.phoneme;return"".concat(a," ").concat(i).toLocaleLowerCase().includes(e)});n.setState({searched:!0,results:t})}else n.setState({searched:!1,results:[]})},[r]);let o=n.state.input&&n.state.searched?n.state.results:n.rules,l=o.length.toLocaleString();return(0,s.jsxs)("div",{...i,className:(0,P.cn)("flex justify-between items-center gap-2 pr-3",t),children:[(0,s.jsx)(M.I,{placeholder:"Search ".concat(l," ").concat(1===o.length?"rule":"rules","..."),className:"flex-1 px-4 py-4 h-auto focus-visible:ring-0 border-0 w-full",value:n.state.input,onChange:e=>{n.setState({input:e.target.value,offset:0})}}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[a,ei(n.metadata)&&(0,s.jsx)(L.Button,{variant:"primary",className:"h-8",onClick:()=>{n.createRule({type:"alias",string_to_replace:"",alias:""})},children:"Add rule"})]})]})}),Q=(0,b.Pi)(e=>{var t;let{className:a,...i}=e,{dictionary:n}=X(),r=(null===(t=C.workspaceData.value)||void 0===t?void 0:t.storing_shared_files_on_user)===!1,o=n.metadata.baseModelId?D.P0[n.metadata.baseModelId]:null;return(0,s.jsxs)("div",{...i,className:(0,P.cn)("flex justify-between items-center gap-2",a),children:[(0,s.jsx)(M.I,{placeholder:"Untitled",className:"flex-1 px-4 pt-4 pb-2 h-auto focus-visible:ring-0 border-0 w-full font-semibold",value:n.data.dictionary_name,onChange:e=>n.setData({dictionary_name:e.target.value})}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[r&&(0,s.jsx)(U.Tooltip,{label:en[n.metadata.role],children:(0,s.jsx)(E.Z,{color:"green",children:u()(n.metadata.role)})}),o&&(0,s.jsx)(U.Tooltip,{placement:"top",label:o.name,children:(0,s.jsx)("span",{children:(0,s.jsx)(o.Icon,{})})})]})]})}),V=(0,b.Pi)(e=>{let{className:t,...a}=e,{dictionary:i}=X(),n=i.state.input&&i.state.searched?i.state.results:i.rules,r=(0,w.useRef)(null),l=(0,o.MG)({count:n.length,getScrollElement:()=>r.current,estimateSize:()=>35,overscan:10}),{measureElement:c,scrollToIndex:d}=l;(0,w.useEffect)(()=>{let e=setTimeout(()=>{if(n[i.state.offset]){let e=n.length-1,t=r.current;t&&0===i.state.offset?t.scrollTop=0:t&&i.state.offset===e?t.scrollTop=t.scrollHeight:d(i.state.offset,{align:i.state.offset<=1?"end":"auto"})}else 0!==i.state.offset&&i.setState({offset:0})},100);return()=>clearTimeout(e)},[i.state.offset,i.state.offsetChangeId]);let u=l.getVirtualItems();return(0,s.jsx)("div",{className:(0,P.cn)("flex flex-col h-full w-full overflow-hidden",t),children:(0,s.jsx)("div",{...a,ref:r,className:"overflow-y-auto h-full w-full px-3 py-2",children:u.length?(0,s.jsx)("div",{style:{height:"".concat(l.getTotalSize(),"px"),transitionProperty:"height",transition:"100ms ease",position:"relative",overflow:"hidden"},children:(0,s.jsx)("ul",{style:{position:"absolute",top:0,left:0,width:"100%",transform:"translateY(".concat(u[0].start,"px)")},children:u.map(e=>{let{key:t,index:a}=e,r=n[a];if(!r)return null;let o=i.state.offset===a;return(0,s.jsx)("li",{ref:c,"data-index":a,"aria-labelledby":r.data.string_to_replace,"aria-selected":o,className:(0,P.cn)("flex items-center gap-0.5",!o&&"[&_.hoverable-icon-button]:opacity-0 [&:hover_.hoverable-icon-button]:opacity-100"),onPointerDown:()=>i.setState({offset:a}),children:(0,s.jsx)($,{rule:r},r.key)},t)})})}):i.state.input?(0,s.jsxs)(A.rJ,{className:"border-0 bg-transparent h-full items-center justify-center grow",children:[(0,s.jsx)(A.FL,{children:(0,s.jsx)(m.Z,{})}),(0,s.jsx)(A.ed,{children:"No results"}),(0,s.jsx)(A.U5,{children:"No rules were found with the current search filter."}),(0,s.jsx)(A.aT,{children:(0,s.jsx)(L.Button,{variant:"primary",onClick:()=>{i.setState({input:"",offset:0})},children:"Clear search"})})]}):(0,s.jsxs)(A.rJ,{className:"border-0 bg-transparent h-full items-center justify-center grow",children:[(0,s.jsx)(A.FL,{children:(0,s.jsx)(f.Z,{})}),(0,s.jsx)(A.ed,{children:"No rules"}),(0,s.jsx)(A.U5,{children:"Lexicon rules apply pronunciation replacements in your projects."}),(0,s.jsx)(A.aT,{children:(0,s.jsx)(L.Button,{variant:"primary",onClick:()=>{i.createRule({type:"alias",string_to_replace:"",alias:""})},children:"Add a new rule"})})]})})})}),$=(0,b.Pi)(e=>{let{rule:t}=e,{dictionary:a,actions:i}=X(),n="error"===t.alert.type||"warning"===t.alert.type;return(0,s.jsxs)(w.Fragment,{children:[(0,s.jsxs)(T.J2,{children:[(0,s.jsx)(T.xo,{asChild:!0,children:(0,s.jsx)(z.h,{variant:"ghost",size:"md","aria-label":"Pronunciation rule options",className:"hoverable-icon-button transition-opacity duration-150 flex-shrink-0",children:(0,s.jsx)(g.Z,{})})}),(0,s.jsx)(T.i9,{children:(0,s.jsx)(T.yk,{className:"p-1 w-[160px]",asChild:!0,children:(0,s.jsx)(O.mY,{children:(0,s.jsx)(k.Z,{children:(0,s.jsx)(O.di,{tabIndex:1,onSelect:()=>a.deleteRule(t.key),children:"Delete rule"})})})})})]}),(0,s.jsx)(F,{className:(0,P.cn)("py-1"),initialValue:t,metadata:a.metadata,onPlay:()=>i.onRulePlay(a,t),onPause:()=>i.onRulePause(a,t),playerButtonProps:{className:n?er[t.alert.type]:""}})]})}),G=(0,b.Pi)(e=>{let{disabled:t,loading:a,className:i,...n}=e,{dictionary:r,actions:o}=X(),[l,c]=(0,w.useState)(!1),d=r.alerts,u=d.error.length?"error":d.warning.length?"warning":d.change.length?"change":"static",h="static"===u?d.static:[...d.error,...d.warning,...d.change],p=t||!ei(r.metadata)||!!(d.error.length||!d.change.length);return(0,s.jsxs)("div",{...n,className:(0,P.cn)("flex items-center justify-end gap-2",i),children:[(0,s.jsxs)(T.J2,{open:l,onOpenChange:c,children:[(0,s.jsx)(U.Tooltip,{placement:"top",label:"Click to inspect dictionary changes",children:(0,s.jsx)(T.xo,{asChild:!0,children:(0,s.jsx)(z.h,{variant:"outline",size:"xs","aria-label":"Inspect dictionary changes",className:(0,P.cn)("flex-shrink-0 rounded-full border-[1.5px]",er[u]),children:(0,s.jsx)(ee,{className:"h-3 w-3",type:u})})})}),(0,s.jsx)(T.i9,{children:(0,s.jsx)(T.yk,{side:"top",className:"px-0 py-0.5 w-[340px] border-0 shadow-natural-md",onWheel:e=>e.stopPropagation(),children:(0,s.jsxs)(q.l$,{className:"w-full max-h-52 overflow-y-auto",children:[h.map((e,t)=>{let a=e.offset;return(0,s.jsxs)("div",{className:(0,P.cn)("flex items-center px-2 w-full gap-1.5 h-8",0!==t?"border-t":""),children:[(0,s.jsx)(ee,{className:"h-4 w-4 flex-shrink-0",type:e.type}),(0,s.jsxs)("div",{className:"flex flex-1 items-baseline justify-between gap-1 overflow-hidden",children:[(0,s.jsx)(B.x,{className:"truncate text-xm",title:e.message,children:e.message}),e.title&&(0,s.jsx)(B.x,{className:"truncate",size:"xs",title:e.title,color:"subtle",children:e.title})]}),void 0!==a?(0,s.jsx)(z.h,{variant:"ghost",size:"sm","aria-label":"Navigate to rule",className:"flex-shrink-0",disabled:void 0===a,onClick:()=>{c(!1),r.setState({input:"",offset:a})},children:(0,s.jsx)(y.Z,{className:"h-4 w-4"})}):null]},e.key)}),(0,s.jsx)(q.RA,{})]})})})]}),(0,s.jsx)(L.Button,{disabled:p,loading:a,size:"md",variant:"primary",onClick:()=>{o.onValueCommit(r)},children:"Save changes"})]})}),Y=(0,w.createContext)(void 0),K=e=>{let{initialValue:t,metadata:a}=e,[i]=(0,w.useState)(()=>t instanceof et?t:new et(t,a));es(i,a);let s=(0,I.W)(e.onValueCommit),n=(0,I.W)(e.onRulePlay),r=(0,I.W)(e.onRulePause);return{store:(0,w.useMemo)(()=>({dictionary:i,actions:{onValueCommit:s,onRulePlay:n,onRulePause:r}}),[])}},X=()=>{let e=(0,w.useContext)(Y);if(!e)throw Error("useDictionaryEditor must be used within DictionaryEditorContext");return e},H=(0,b.Pi)((0,w.forwardRef)((e,t)=>{let{audioObservable:a,onPlayAudio:i,onPauseAudio:o,className:d,size:u,disabled:h,...p}=e,{alert:m,state:f}=a,g="error"===m.type||"warning"===m.type;return(0,s.jsx)(z.h,{ref:t,type:"button","aria-label":"playing"===f.audioStatus?"Pause":"Play",onClick:()=>{"playing"===f.audioStatus?null==o||o():null==i||i()},className:(0,P.cn)("rounded-full",d),size:u,disabled:"loading"===f.audioStatus||"error"===m.type||h,tooltip:g?m.message:void 0,...p,children:(0,s.jsx)(l.M,{initial:!1,children:(0,s.jsx)(c.E.div,{className:"absolute",initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.5,opacity:0},transition:{duration:.15},children:"loading"===f.audioStatus?(0,s.jsx)(R.Z,{color:"inherit",size:u,children:(0,s.jsx)(S.Z,{iconClassName:"fill-foreground"})}):"playing"===f.audioStatus?(0,s.jsx)(R.Z,{color:"inherit",size:u,children:(0,s.jsx)(n.Z,{className:"ml-[0px]"})}):(0,s.jsx)(R.Z,{color:"inherit",size:u,children:(0,s.jsx)(r.Z,{className:"translate-x-[7.5%]"})})},f.audioStatus)})})})),ee=e=>{let{type:t,className:a,...i}=e;switch(t){case"error":return(0,s.jsx)(v.Z,{className:(0,P.cn)("text-red-600",a),...i});case"warning":return(0,s.jsx)("span",{className:(0,P.cn)("inline-flex items-center justify-center text-yellow-600",a),...i,children:"!"});case"change":return(0,s.jsx)(_.Z,{strokeWidth:3.5,className:(0,P.cn)("text-green-600",a),...i});case"static":return(0,s.jsx)(_.Z,{strokeWidth:3.5,className:(0,P.cn)("text-gray-300",a),...i})}};class et{commit(e){for(let t of(this.data.version_id=e.versionId,this.previous={...this.data},this.state.creations.clear(),this.state.deletions.clear(),this.rules))t.commit()}get alerts(){let e=new Map,t={error:[],warning:[],change:[],static:[]};return t[this.alert.type].push(this.alert),this.rules.forEach(t=>{let a=e.get(t.data.string_to_replace);a?a.push(t):e.set(t.data.string_to_replace,[t])}),this.rules.forEach((a,i)=>{let s=e.get(a.data.string_to_replace)||[];"error"!==a.alert.type&&s.length>1?t.warning.push({key:a.key,type:"warning",title:"".concat(a.data.string_to_replace,":").concat(i+1),message:"Rule is already defined",offset:i}):"static"!==a.alert.type&&t[a.alert.type].push({...a.alert,offset:i})}),t}get alert(){var e,t;let a=[{message:null===(e=this.errors[0])||void 0===e?void 0:e.message,type:"error"},{message:null===(t=this.warnings[0])||void 0===t?void 0:t.message,type:"warning"},{message:this.changes.length?"Changed dictionary ".concat(this.changes.map(e=>e.keyword).join(", ")):"",type:"change"}].find(e=>e.message);return{key:this.data.pronunciation_dictionary_id,type:a?a.type:"static",title:this.data.dictionary_name,message:a?a.message:"No changes"}}get errors(){let e=[];return this.data.dictionary_name||e.push({message:"Dictionary name is required"}),e}get warnings(){let e=[];return ei(this.metadata)||e.push({message:"Editor role required for saving changes"}),e}get changes(){let e=[];return this.previous.dictionary_name!==this.data.dictionary_name&&e.push({keyword:"name",message:"Changed dictionary name"}),(this.state.creations.size||this.state.deletions.size)&&e.push({keyword:"size",message:"Changed dictionary size"}),e}deleteRule(e){let t=this.rules.findIndex(t=>t.key===e);if(-1!==t&&(this.rules.splice(t,1),this.state.creations.has(e)?this.state.creations.delete(e):this.state.deletions.add(e),this.state.offset>=t)){let e=0;this.rules[t]?e=t:this.rules[t-1]&&(e=t-1),this.state.offset=e}}createRule(e){let t=new ea(e,this.metadata);this.rules.push(t),this.state.creations.add(t.key),this.state.input="",this.state.offset=this.rules.length-1}setData(e){Object.assign(this.data,e)}setMetadata(e){Object.assign(this.metadata,e)}setState(e){Object.assign(this.state,e),"number"==typeof e.offset&&this.state.offsetChangeId++}toJSON(){return{...this.data,rules:this.rules.map(e=>e.toJSON())}}constructor(e,t){(0,i._)(this,"rules",void 0),(0,i._)(this,"data",void 0),(0,i._)(this,"metadata",void 0),(0,i._)(this,"state",{creations:new Set,deletions:new Set,offset:0,offsetChangeId:0,input:"",searched:!1,results:[],expandedRule:null}),(0,i._)(this,"previous",void 0),(0,x.ky)(this),this.previous={...e},this.data=e,this.metadata=t,this.rules=e.rules.map(e=>new ea(e,t))}}class ea{commit(){this.previous={...this.data}}get alert(){var e,t;let a=[{message:null===(e=this.errors[0])||void 0===e?void 0:e.message,type:"error"},{message:null===(t=this.warnings[0])||void 0===t?void 0:t.message,type:"warning"},{message:this.changes.length?"Changed rule ".concat(this.changes.map(e=>e.keyword).join(", ")):"",type:"change"}].find(e=>e.message);return{key:this.key,type:a?a.type:"static",title:this.data.string_to_replace,message:a?a.message:"No changes"}}get errors(){let{data:e}=this,t=[];return(e.string_to_replace||t.push({message:"Input is required"}),e.string_to_replace.length>50&&t.push({message:"Input is too long"}),"phoneme"===e.type)?(e.phoneme||t.push({message:"Output is required"}),e.phoneme.length>100&&t.push({message:"Output is too long"}),"ipa"!==e.alphabet||/^\/.*\/$/.test(e.phoneme)||t.push({message:"Output must start and end with /"})):(e.alias||t.push({message:"Output is required"}),e.alias.length>100&&t.push({message:"Output is too long"})),t}get warnings(){let e=[];return"phoneme"===this.data.type&&this.metadata.baseModelId&&!D.fd.has(this.metadata.baseModelId)&&e.push({message:"Phonemes require an english-only model"}),this.changes.length&&!ei(this.metadata)&&e.push({message:"Editor role required for saving changes"}),e}get changes(){let{data:e,previous:t}=this,a=[],[i,s]="alias"===t.type?[t.string_to_replace,t.alias]:[t.string_to_replace,t.phoneme],[n,r]="alias"===e.type?[e.string_to_replace,e.alias]:[e.string_to_replace,e.phoneme];return n!==i&&a.push({keyword:"input",message:"Changed rule input"}),e.type!==t.type&&a.push({keyword:"type",message:"Changed rule type"}),r!==s&&a.push({keyword:"output",message:"Changed rule output"}),a}setData(e){Object.assign(this.data,e)}setMetadata(e){Object.assign(this.metadata,e)}setState(e){Object.assign(this.state,e)}toJSON(){return"phoneme"===this.data.type?{type:"phoneme",alphabet:this.data.alphabet,string_to_replace:this.data.string_to_replace,phoneme:this.data.phoneme}:{type:"alias",string_to_replace:this.data.string_to_replace,alias:this.data.alias}}constructor(e,t){(0,i._)(this,"key",(0,N.k$)()),(0,i._)(this,"data",void 0),(0,i._)(this,"metadata",void 0),(0,i._)(this,"state",{audioStatus:"paused"}),(0,i._)(this,"previous",void 0),(0,x.ky)(this),this.previous={...e},this.data=p()({alias:"",string_to_replace:"",type:"alias"},{alphabet:"ipa",phoneme:""},e),this.metadata=t}}let ei=e=>"editor"===e.role||"admin"===e.role,es=(e,t)=>{(0,w.useEffect)(()=>{e.setMetadata(t)},[t.baseModelId])},en={admin:"You have admin permissions on this resource.",editor:"You have editor permissions on this resource.",viewer:"Workspace viewers cannot save changes to pronunciation dictionaries. Please contact a workspace admin."},er={error:"border-red-600",warning:"border-yellow-500",change:"border-green-600",static:"border-gray-alpha-200"}},14076:function(e,t,a){a.d(t,{z:function(){return r}});var i=a(17024),s=a(9506);class n{notifyListeners(){this.listeners.forEach(e=>e(this.state))}setState(e){this.state={...this.state,...e},this.notifyListeners()}constructor(){(0,i._)(this,"audio",new Audio),(0,i._)(this,"state",{isPlaying:!1}),(0,i._)(this,"listeners",new Set),(0,i._)(this,"addListener",e=>(this.listeners.add(e),()=>this.listeners.delete(e))),(0,i._)(this,"getState",()=>this.state),(0,i._)(this,"play",()=>{this.audio&&(this.audio.play(),this.setState({isPlaying:!0}))}),(0,i._)(this,"kill",()=>{this.audio&&(this.audio.src="",this.audio.currentTime=0,this.setState({isPlaying:!1}))}),this.audio&&this.audio.addEventListener("ended",()=>{this.setState({isPlaying:!1})})}}let r=()=>{let[e]=(0,s.useState)(()=>new n),t=(0,s.useSyncExternalStore)(t=>e.addListener(t),()=>e.getState());return{player:e,state:t}}},7275:function(e,t,a){a.d(t,{E:function(){return n},W:function(){return s}});var i=a(9506);function s(e){let t=(0,i.useRef)(e);return(0,i.useEffect)(()=>{t.current=e}),(0,i.useMemo)(()=>function(){for(var e,a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return null===(e=t.current)||void 0===e?void 0:e.call(t,...i)},[])}let n=e=>{let t=(0,i.useRef)(e);return t.current=e,t}},90675:function(e,t,a){a.d(t,{w:function(){return s}});var i=a(9506);let s=e=>{let[t,a]=(0,i.useState)(e);return[t,(0,i.useCallback)(e=>{a(t=>({...t,...n(e)?e(t):e}))},[]),a]},n=e=>"function"==typeof e}}]);