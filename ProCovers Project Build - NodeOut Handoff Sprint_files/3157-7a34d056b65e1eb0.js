try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="e54a1c6e-0397-4608-942b-8789582c826d",e._sentryDebugIdIdentifier="sentry-dbid-e54a1c6e-0397-4608-942b-8789582c826d")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3157,9315],{33338:(e,t,s)=>{s.d(t,{Vm:()=>n,jo:()=>i,zN:()=>a});let i=e=>{window.parent.postMessage({type:"redirect",redirectUrl:"".concat("https://onlineapp.pro","/paywall/auth/start?").concat(e)},"*")};function n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#000";if(e.startsWith("#"))return r(e);let t=window&&window.CSS&&window.CSS.supports("color: ".concat(e))?window.CSS.supports("color: ".concat(e),"color"):null;return!!t&&r(t)}function r(e){3===(e=e.replace("#","")).length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]);let t=parseInt(e.substring(0,2),16),s=parseInt(e.substring(2,4),16);return(299*t+587*s+114*parseInt(e.substring(4,6),16))/1e3/255<.6}let a=(e,t,s)=>{s?console.log("[PAYWALL #".concat(t,"]"),e,s):console.log("[PAYWALL #".concat(t,"]"),e)}},37520:(e,t,s)=>{s.d(t,{w:()=>i});let i={refreshTimer:null,refreshInterval:36e5,changeListeners:new Set,port:null,portMessageHandler:null,cache:new Map,cacheInitialized:!1,initConnection(){if(!window.chrome||!window.chrome.runtime){console.warn("Chrome API is not available for connection, please check your background script and manifest.json following the documentation.");return}if(!window.paywallExtensionId){console.warn("Chrome API is available, but Paywall Extension ID is not set, please edit paywall settings.");return}try{this.port=window.chrome.runtime.connect(window.paywallExtensionId,{name:"supabase-auth-adapter"}),this.portMessageHandler=e=>{if(e&&"storage_update"===e.type){let{action:t,key:s,value:i,timestamp:n}=e;s&&t&&("set"===t&&void 0!==i?this.cache.set(s,i):"remove"===t&&this.cache.delete(s),this.notifyChange("set"===t?"set":"remove",s,i,n))}},this.port.onMessage.addListener(this.portMessageHandler),this.port.onDisconnect.addListener(()=>{this.port=null,setTimeout(()=>this.initConnection(),5e3)})}catch(e){console.error("Error connecting to extension:",e),this.port=null,setTimeout(()=>this.initConnection(),5e3)}},onChanged(e){0!==this.changeListeners.size||this.port||this.initConnection(),this.changeListeners.add(e)},offChanged(e){this.changeListeners.delete(e),0===this.changeListeners.size&&this.port&&(this.port.disconnect(),this.port=null)},notifyChange(e,t,s,i){let n={type:e,key:t,value:s,timestamp:i};this.changeListeners.forEach(e=>{try{e(n)}catch(e){console.error("Error in onChanged handler:",e)}})},sendMessage:async(e,t)=>new Promise((s,i)=>{let n=window.chrome;if(void 0===n||!n.runtime){i(Error("Chrome API is not available"));return}try{n.runtime.sendMessage(window.paywallExtensionId,{action:e,data:t,source:"supabase-auth-adapter"},t=>{if(n.runtime.lastError){i(Error(String(n.runtime.lastError.message||"Unknown Chrome error")));return}if(t&&"error"===t.status){i(Error(String(t.message)||"Unknown error"));return}"getItem"===e?s((null==t?void 0:t.value)||null):s(t)})}catch(e){i(e)}}),async broadcast(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.sendMessage("broadcast",{type:"broadcast",message:e,timestamp:Date.now(),...t})},async initCache(){if(!this.cacheInitialized)try{let e=await this.sendMessage("getItem",{key:"access_token"});null!==e&&this.cache.set("access_token",String(e));let t=await this.sendMessage("getItem",{key:"refresh_token"});null!==t&&this.cache.set("refresh_token",String(t)),this.cacheInitialized=!0,t&&this.startSessionRefresh()}catch(e){console.error("Error initializing cache:",e)}},async getItem(e){if(this.cacheInitialized&&this.cache.has(e))return this.cache.get(e)||null;try{let t=await this.sendMessage("getItem",{key:e});return null!==t?this.cache.set(e,String(t)):this.cache.delete(e),null!==t?String(t):null}catch(e){return console.error("Error during getting data from extension: 1. Please check your background script following paywall install instructions. 2. Please double check extension ID specified in paywall settings match ID in chrome://extensions/ tab: ",e),null}},getItemSync(e){return this.cacheInitialized||console.warn("Cache not initialized, getItemSync may return incorrect results"),this.cache.has(e)&&this.cache.get(e)||null},setItem:(e,t)=>{i.cache.set(e,t),i.sendMessage("setItem",{key:e,value:t}).catch(e=>{console.error("Error during saving data to extension:",e)})},removeItem:e=>{i.cache.delete(e),i.sendMessage("removeItem",{key:e}).catch(e=>{console.error("Error during removing data from extension:",e)})},async saveAllTokens(e){try{for(let[t,s]of Object.entries(e))this.cache.set(t,s);for(let[t,s]of Object.entries(e))await this.sendMessage("setItem",{key:t,value:s});console.log("All tokens successfully saved in extension")}catch(e){console.error("Error during saving all tokens:",e)}},startSessionRefresh(){this.refreshTimer&&clearInterval(this.refreshTimer),this.refreshTimer=setInterval(()=>{this.refreshSession().catch(e=>{console.error("Error during scheduled session refresh:",e)})},this.refreshInterval),console.log("Session refresh scheduled every ".concat(this.refreshInterval/6e4," minutes"))},stopSessionRefresh(){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null,console.log("Session refresh stopped"))},async refreshSession(){try{let e=await this.getItem("refresh_token");if(!e)return console.error("Refresh token not found"),!1;let{createClient:t}=await Promise.all([s.e(6547),s.e(9315)]).then(s.bind(s,99315)),i=t(),{data:n,error:r}=await i.auth.refreshSession({refresh_token:e});if(r)return console.error("Error refreshing session:",r),!1;if(!(null==n?void 0:n.session))return console.error("No session returned after refresh"),!1;return await this.saveAllTokens({access_token:n.session.access_token,refresh_token:n.session.refresh_token}),console.log("Session successfully refreshed"),!0}catch(e){return console.error("Error during session refresh:",e),!1}},async getTokens(){return{access_token:await this.getItem("access_token")||void 0,refresh_token:await this.getItem("refresh_token")||void 0}},async clearTokens(){this.removeItem("access_token"),this.removeItem("refresh_token"),this.stopSessionRefresh()},async ping(){try{let e=await this.sendMessage("ping",{});if(e&&"object"==typeof e&&"status"in e&&"ok"===e.status)return!this.port&&this.changeListeners.size>0&&this.initConnection(),this.cacheInitialized||this.initCache().catch(e=>{console.error("Error initializing cache during ping:",e)}),!0;return!1}catch(e){return console.error("Extension ping failed:",e),!1}}}},44541:(e,t,s)=>{s.d(t,{A:()=>c,R:()=>a});var i=s(33338);let n=e=>{if(e)return{id:e.id,email:e.email,name:e.user_metadata.name,avatar:e.user_metadata.avatar_url,created_at:e.created_at}},r={paywallId:null,state:{},init:()=>{Object.assign(r.state,{auth_status:"init",purchase_status:"init",visibility_status:"init",visibility_status_reason:void 0}),o(r.state)},detectOpeningsTrial:()=>{Object.assign(r.state,{visibility_status:"invisible",visibility_status_reason:"openings-trial"}),o(r.state),a()},detectTimeTrial:()=>{Object.assign(r.state,{visibility_status:"invisible",visibility_status_reason:"time-trial"}),o(r.state),a()},detectVisible:e=>{let t={visibility_status:"visible",visibility_status_reason:void 0};e&&(t.visibility_status_reason="tokenization-sign-in"),Object.assign(r.state,t),o(r.state)},detectInvisible:e=>{r.state.visibility_status="invisible",e.countryIsOk?(r.state.user={country:e.country},r.state.visibility_status_reason="visibility-turned-off"):r.state.visibility_status_reason="country-not-match",o(r.state),a()},detectActivePurchase:e=>{r.state.purchase_status="paid",r.state.visibility_status="invisible",(null==e?void 0:e.status)==="paid-now"?(r.state.purchase_status_reason="success-payment",r.state.visibility_status_reason="success-payment"):(null==e?void 0:e.status)==="restored"&&(r.state.purchase_status_reason="restored",r.state.visibility_status_reason="active-payment-found"),r.state.subscription=e.purchase,r.state.payment=e.purchase,o(r.state)},detectPurchaseFail:()=>{r.state.purchase_status="failed",o(r.state)},detectSignIn:(e,t)=>{r.state.user=n(e),r.state.auth_status="signed-in",r.state.visibility_status_reason=void 0,t&&(r.state.visibility_status_reason="tokenization-sign-in"),setTimeout(()=>{o(r.state)})},detectSignOut:()=>{r.state.auth_status="signed-out",r.state.user=null,r.state.visibility_status_reason=void 0,o(r.state)},detectCloseByUser:()=>{r.state.visibility_status="invisible",r.state.visibility_status_reason="closed-by-user",o(r.state),a()},detectCustom:e=>{r.state={...r.state,...e},o(r.state)}},a=()=>{try{(()=>{let e=document.querySelector("#overlay"),t=document.querySelector("#modal");e&&t&&(t.style.transform="translateY(50px)",setTimeout(()=>{e.style.opacity=0}))})(),setTimeout(()=>{var e;null===(e=window.parent)||void 0===e||e.postMessage({type:"change-styles",style:{display:"none"}},"*")},300)}catch(e){}},o=e=>{try{var t;(0,i.zN)("Sending state message",r.paywallId,e),null===(t=window.parent)||void 0===t||t.postMessage({type:"state",paywallId:r.paywallId,state:e},"*")}catch(e){}},c=r},61250:(e,t,s)=>{s.d(t,{A:()=>i});let i=(0,s(81749).createContext)(null)},99315:(e,t,s)=>{s.d(t,{createClient:()=>o});var i=s(36547),n=s(37520),r=s(64128);let a=()=>(0,r.UU)("https://api.captain.software","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1uaG9wcHdhanJxYmZod3R5aXZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTI3MzQ5MjQsImV4cCI6MjAyODMxMDkyNH0.-_70PEJOVst49q8oYxFOj3hgCegbCaYewmGa1umuOU0",{auth:{storage:n.w,flowType:"pkce"}}),o=()=>{var e,t,s;return(null===(e=window)||void 0===e?void 0:e.paywallExtensionId)&&(null===(s=window)||void 0===s?void 0:null===(t=s.chrome)||void 0===t?void 0:t.runtime)?a():(0,i.createBrowserClient)("https://api.captain.software","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1uaG9wcHdhanJxYmZod3R5aXZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTI3MzQ5MjQsImV4cCI6MjAyODMxMDkyNH0.-_70PEJOVst49q8oYxFOj3hgCegbCaYewmGa1umuOU0",{cookieOptions:{sameSite:"none",secure:!0}})}}}]);