try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="3ccdff40-5b37-4d8f-9983-800c31e8a1df",e._sentryDebugIdIdentifier="sentry-dbid-3ccdff40-5b37-4d8f-9983-800c31e8a1df")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[91038],{70108:function(e,t,i){i.d(t,{GU:function(){return o},J5:function(){return n},S9:function(){return d},Xw:function(){return u},ij:function(){return l}});var s=i(17024),a=i(96162),r=i(54389);class n{static fromDB(e){return new n(e.pronunciation_dictionary_id,e.version_id)}constructor(e,t){(0,s._)(this,"pronunciationDictionaryId",void 0),(0,s._)(this,"versionId",void 0),this.pronunciationDictionaryId=e,this.versionId=t}}class l{static fromAddDictionaryResponse(e){var t;return new l(e.id,e.version_id,e.version_rules_num,e.name,null!==(t=e.description)&&void 0!==t?t:null,e.permission_on_resource,e.created_by,e.creation_time_unix)}static fromDictionaryVersionResponse(e){return new l(e.pronunciation_dictionary_id,e.version_id,e.version_rules_num,e.dictionary_name,null,e.permission_on_resource,e.created_by,e.creation_time_unix)}getLocator(){return new n(this.id,this.versionId)}toAddDictionaryResponseModel(){var e;return{id:this.id,name:this.name,created_by:this.created_by,creation_time_unix:this.creation_time_unix,version_id:this.versionId,version_rules_num:this.versionRulesNum,description:null!==(e=this.description)&&void 0!==e?e:void 0,permission_on_resource:this.permission_on_resource}}constructor(e,t,i,a,r,n,l,o){(0,s._)(this,"id",void 0),(0,s._)(this,"versionId",void 0),(0,s._)(this,"versionRulesNum",void 0),(0,s._)(this,"name",void 0),(0,s._)(this,"description",void 0),(0,s._)(this,"permission_on_resource",void 0),(0,s._)(this,"created_by",void 0),(0,s._)(this,"creation_time_unix",void 0),this.id=e,this.versionId=t,this.versionRulesNum=i,this.name=a,this.description=r,this.permission_on_resource=n,this.created_by=l,this.creation_time_unix=o}}let o=async e=>{let{name:t,inputFile:i,onSuccess:s=null,onError:r=null,workspace_access:n=null}=e,o=await (0,a.hP)(),c=new FormData;c.append("name",t),c.append("file",i),n&&c.append("workspace_access",n);let d=await fetch("".concat(a.LB,"/v1/pronunciation-dictionaries/add-from-file"),{method:"POST",body:c,headers:{Authorization:"Bearer ".concat(o)}});if(200==d.status){if(null!==s){let e=await d.json();s(l.fromAddDictionaryResponse(e),e),window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"add_pronunciation_dictionary",eventProps:{form:c}})}}else null!==r&&d.json().then(e=>{r(e.detail.message)})},c=async e=>{let{dictionaryId:t,versionId:i}=e,s="".concat(a.LB,"/v1/pronunciation-dictionaries/").concat(t,"/").concat(i,"/download"),r=await (0,a.hP)();return await fetch(s,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)}})},d=async e=>{let t=await c({dictionaryId:e.id,versionId:e.versionId});if(200!==t.status)throw Error((await t.json()).detail.message);let i=await t.blob(),s=URL.createObjectURL(i),n=t.headers.get("content-type");if(!(n&&n in a.W$))throw Error("Invalid response type received: '".concat(n,"' is not supported."));(0,r.downloadFromBlobUrl)(s,e.name.replace(/\.[^.]+$/,"")+".pls")},u=async e=>{var t;let{pronunciationDictionaryIds:i,onSuccess:s=null,onError:r=null}=e,n=null===a.EA||void 0===a.EA?void 0:null===(t=a.EA.value)||void 0===t?void 0:t.uid,o=await (0,a.hP)();if(null==n)throw Error("Can't determine userId");let c=[];for(let e of i){let t=await fetch("".concat(a.LB,"/v1/pronunciation-dictionaries/").concat(e.pronunciationDictionaryId,"/"),{method:"GET",headers:{Authorization:"Bearer ".concat(o)}});if(200!==t.status)r&&r("Unable to retrieve pronunciation dictionary with id: ".concat(e.pronunciationDictionaryId));else try{let i=await t.json();c.push(new l(i.id,e.versionId,i.latest_version_rules_num,i.name,i.description||null,i.permission_on_resource,i.created_by,i.creation_time_unix))}catch(e){r&&r("Error while fetching pronunciation dictionary metadata")}}s&&s(c)}},78328:function(e,t,i){i.d(t,{g:function(){return o}});var s=i(68088),a=i(9506),r=i(4735),n=i(12567),l=i(11521);let o=e=>{let{checklist:t,onConfirm:i,onGoBack:o,disabled:c=!1,textSize:d="sm"}=e,[u,h]=(0,a.useState)(Array(t.length).fill(!1)),p=(e,t)=>{h(i=>{let s=[...i];return s[e]=t,s})},m=u.every(Boolean);return(0,s.jsxs)("div",{className:"stack",children:[(0,s.jsx)("div",{className:"stack gap-3",children:t.map((e,t)=>(0,s.jsxs)("div",{className:"hstack gap-2",children:[(0,s.jsx)(n.X,{checked:u[t],onCheckedChange:e=>p(t,e)}),(0,s.jsxs)("div",{children:[(0,s.jsx)(l.x,{size:d,color:"foreground",children:e.title}),(0,s.jsx)(l.x,{size:d,color:"subtle",children:e.description})]})]},t))}),(0,s.jsxs)("div",{className:"h-16 flex justify-end w-full items-center sticky bottom-0 gap-3 mt-4",children:[(0,s.jsx)(r.Button,{variant:"ghost",onClick:o,disabled:c||void 0===o,children:"Go back"}),(0,s.jsx)(r.Button,{variant:"primary",disabled:!m||c,onClick:i,children:"Confirm Submission"})]})]})}},23784:function(e,t,i){let s;i.d(t,{Z:function(){return rc},P:function(){return a9}});var a,r,n,l,o,c,d,u=i(68088),h=i(46641),p=i(91),m=i(164),v=i(14106),g=i(6991),f=i(84909),x=i(97918),b=i(40534),A=i(97934),y=i(75895),j=i(25798),_=i.n(j),k=i(93900),S=i.n(k),w=i(30395),C=i(47607),N=i(5479),T=i(81999),I=i(73862),V=i(23431),P=i(75269),E=i(9506),O=i(52548),D=i(74508),B=i(17024),F=i(85961),M=i.n(F),L=i(14078),R=i.n(L),z=i(13670),U=i(21113),J=i(77491);function Z(e,t,i){for(let s=0;s<i.length;s++)e.setUint8(t+s,i.charCodeAt(s))}class W{}class X extends W{}class G extends W{}class H extends W{}(a=l||(l={})).Voice="voice",a.Clip="clip";class K{copy(e){if(this.project.selection.latest){var t;this.setData(null===(t=this.project.selection.latest)||void 0===t?void 0:t.getClipboardData(e))}}paste(){var e;(null===(e=this.data)||void 0===e?void 0:e.type)=="clip"?(this.project.placeNewClip(),this.project.setMode(G)):this.project.selection.clips.forEach(e=>{e.applyClipboardData(this.data)})}setData(e){this.data=R()((0,N.ZN)(e))}constructor(e){(0,B._)(this,"data",null),(0,B._)(this,"project",void 0),this.project=e,(0,N.rC)(this,{data:N.LO.ref,setData:N.aD,copy:N.aD,paste:N.aD})}}var Q=i(76366),q=i(13648);class Y{get activeItem(){return this.stack[this.activeIndex]}push(e){JSON.stringify(e)!==JSON.stringify(this.activeItem)&&(this.stack.length===this.limit?(this.stack.shift(),this.stack.push(e)):(this.activeIndex+=1,this.stack.splice(this.activeIndex,this.stack.length),this.stack[this.activeIndex]=e,this.notifyListeners("push")))}replace(e){JSON.stringify(e)!==JSON.stringify(this.activeItem)&&(this.stack.splice(this.activeIndex,this.stack.length),this.stack[this.activeIndex]=e,this.notifyListeners("replace"))}undo(){this.activeIndex=Math.max(this.activeIndex-1,0),this.notifyListeners("undo")}redo(){this.activeIndex=Math.min(this.activeIndex+1,this.stack.length-1),this.notifyListeners("redo")}notifyListeners(e){this.events.emit("change",{action:e,item:this.activeItem,index:this.activeIndex})}onChange(e){return this.events.on("change",e),()=>{this.events.off("change",e)}}constructor(e=[],t=50){(0,B._)(this,"stack",void 0),(0,B._)(this,"activeIndex",void 0),(0,B._)(this,"limit",void 0),(0,B._)(this,"events",void 0),this.stack=e,this.activeIndex=e.length-1,this.limit=t,this.events=new q.Z}}function $(){class e{static create(e,t){return this._collection.instances[e.id]?this._collection.instances[e.id].loadJSON(e):(0,N.z)(()=>{this._collection.instances[e.id]=new this(e,t)}),this._collection.instances[e.id]}static getById(e){let t=this._collection.instances[e];if(null==t?void 0:t.isDeleted)return null;for(let i of this._children)if(t=i.getById(e))break;return t}static getAll(){let e=(0,N.VO)(this._collection.instances).filter(e=>!e.isDeleted);return this._children.forEach(t=>{e=e.concat(t.getAll())}),e}static get _children(){return this._store.models.filter(e=>Object.getPrototypeOf(e)===this)}get store(){return this.constructor._store}delete(){this.deletedAt=Date.now()}clone(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.constructor.create({...JSON.parse(JSON.stringify(this.toJSON())),id:(0,Q.Z)(),...e})}get isDeleted(){return null!=this.deletedAt}toJSON(){return{id:this.id,deleted_at:this.deletedAt}}loadJSON(e){var t;this.id=e.id,this.deletedAt=null!==(t=e.deleted_at)&&void 0!==t?t:null}constructor(e){var t;(0,B._)(this,"id",void 0),(0,B._)(this,"deletedAt",void 0),this.id=e.id,this.deletedAt=null!==(t=e.deleted_at)&&void 0!==t?t:null,(0,N.rC)(this,{deletedAt:N.LO.ref,isDeleted:N.Fl,delete:N.aD,loadJSON:N.aD})}}return(0,B._)(e,"_store",void 0),(0,B._)(e,"_collection",void 0),(0,B._)(e,"collectionName",void 0),e}class ee{constructor(e){(0,B._)(this,"model",void 0),(0,B._)(this,"instances",void 0),this.model=e.model,this.instances={},(0,N.rC)(this,{instances:N.LO.shallow})}}class et{toJSON(){let e={schema_version:this.schemaVersion};return this.models.forEach(t=>{Object.hasOwn(t,"collectionName")&&(e[t.collectionName]=t._collection.instances)}),e}loadJSON(e){if(e.schema_version!==this.schemaVersion)throw Error("Schema verison mismatch");this.models.forEach(t=>{Object.hasOwn(t,"collectionName")&&e[t.collectionName]&&(Object.values(e[t.collectionName]).forEach(e=>{t.create(e)}),(0,N.XP)(t._collection.instances).forEach(i=>{if(!e[t.collectionName][i]){let e=t._collection.instances[i];null!=e.cleanup&&e.cleanup(),delete t._collection.instances[i]}}))})}constructor(e){(0,B._)(this,"models",void 0),(0,B._)(this,"schemaVersion",void 0),(0,B._)(this,"_history",new Y),(0,B._)(this,"history",{_instance:this,commit(){let{replace:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e?this._instance._history.replace(JSON.parse(JSON.stringify(this._instance.toJSON()))):this._instance._history.push(JSON.parse(JSON.stringify(this._instance.toJSON())))},undo(){this._instance._history.undo()},redo(){this._instance._history.redo()},get activeItem(){return this._instance._history.activeItem}}),this.models=e.models,this.models.forEach(e=>{e._store=this,e._collection=new ee({model:e})}),this.schemaVersion=e.schemaVersion,(0,N.rC)(this,{loadJSON:N.aD}),this._history.onChange(e=>{("undo"===e.action||"redo"===e.action)&&this.loadJSON(e.item)})}}let ei=(0,U.Z)("file:///app/src/app/(v1)/v1/dubbing/state/media.ts"),es={};z.pZ.__load=z.pZ.load,z.pZ.load=async e=>(es[e]||(es[e]=z.pZ.__load(e)),es[e]);class ea{setLoading(e){this.loading=e}load(e){this.stop(),this.setLoading(!0),this._buffer.load(e).finally(()=>{this.setLoading(!1)})}get waveform(){return this.loaded?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(0===e.length)return[];let i=0,s=e.map(e=>{let t=Math.abs(e.value);return t>i&&(i=t),{time:e.time,value:t}});if(0===i)return s;let a=t/i;return s.map(e=>({time:e.time,value:e.value*a}))}((function(e,t,i){if(50>=t)throw Error("Target sample rate should be less than the original sample rate");let s=Math.floor(t/i),a=[];if(1===s)for(let i=0;i<e.length;i++)a.push({value:e[i],time:i/t});else for(let i=0;i<e.length;i+=s){let r=0,n=Math.min(s,e.length-i);for(let t=0;t<n;t++)r+=e[i+t];let l=r/n;a.push({value:l,time:i/t})}return a})(this._buffer.getChannelData(0),this._buffer.sampleRate,50).map(e=>({time:e.time/this.speed,value:e.value})),90):null}get state(){return this._player.state}get loaded(){return!this.loading&&!this.error}setSpeed(e){this.speed=e}start(e,t){try{this._player.start(z.zO(),e*this.speed,t*this.speed)}catch(e){ei.error(e)}}stop(){if("started"===this._player.state)try{this._player.stop()}catch(e){ei.error(e)}}seek(e){this._player.seek(e*this.speed),this._player.stop(z.zO())}constructor(e){(0,B._)(this,"_player",void 0),(0,B._)(this,"_buffer",void 0),(0,B._)(this,"speed",void 0),(0,B._)(this,"loading",void 0),(0,B._)(this,"error",void 0),this.loading=!0,this.error=null,this.speed=1,this._buffer=new z.pZ,this._player=new z.J5(this._buffer).toDestination(),this.load(e),(0,N.rC)(this,{loading:N.LO.ref,error:N.LO.ref,speed:N.LO.ref,load:N.aD,setSpeed:N.aD,setLoading:N.aD,loaded:N.Fl,waveform:(0,N.Fl)({keepAlive:!0})}),(0,N.EH)(()=>{this._player.playbackRate=this.speed})}}var er=i(16714),en=i(70108),el=i(1851),eo=i(84106),ec=i(11931);function ed(e){return e*parseFloat(getComputedStyle(document.documentElement).fontSize)}class eu{start(){this.active||(this.startTime=Date.now(),this.frameCount=0,this.active=!0,this.loop())}stop(){this.active&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null,this.active=!1)}reset(){this.startTime=Date.now(),this.frameCount=0,this.active||this.start()}getAverageFps(){if(!this.active||0===this.frameCount)return 0;let e=Date.now()-this.startTime;return e>0?this.frameCount/e*1e3:0}getExpectedFps(){let e=this.getAverageFps();return e<31?30:e<61?60:e<76?75:e<121?120:240}getStats(){return{averageFps:this.getAverageFps(),expectedFps:this.getExpectedFps()}}constructor(){(0,B._)(this,"frameCount",void 0),(0,B._)(this,"startTime",void 0),(0,B._)(this,"animationFrameId",void 0),(0,B._)(this,"active",void 0),(0,B._)(this,"loop",()=>{this.active&&(this.frameCount++,this.animationFrameId=requestAnimationFrame(this.loop))}),this.frameCount=0,this.startTime=0,this.active=!1,this.animationFrameId=null}}let eh=()=>{let[e]=(0,E.useState)(()=>new eu);return(0,E.useEffect)(()=>(e.start(),()=>e.stop()),[e]),e};var ep=i(64108);class em{setStatus(e){this.status=e}get isPending(){return"pending"===this.status}get isFulfilled(){return"fulfilled"===this.status}get isRejected(){return"rejected"===this.status}constructor(e){var t=this;(0,B._)(this,"status","idle"),(0,B._)(this,"executionCount",0),(0,B._)(this,"asyncFunction",void 0),(0,B._)(this,"execute",async function(){for(var e=arguments.length,i=Array(e),s=0;s<e;s++)i[s]=arguments[s];let a=t.executionCount+1;t.executionCount=a,t.setStatus("pending");try{let e=await t.asyncFunction(...i);if(t.executionCount===a)return t.setStatus("fulfilled"),e;return Promise.reject(Error("A newer call has been made"))}catch(e){return t.setStatus("rejected"),Promise.reject(e)}}),(0,N.rC)(this,{status:N.LO.ref,setStatus:N.aD}),this.asyncFunction=e}}let ev={stability:.65,similarity_boost:.9,style:.66,use_speaker_boost:!0,model_id:null,mimic_original_emotion:!1},eg={stability:.5,similarity_boost:.75,style:0,use_speaker_boost:!0,model_id:null};class ef{setId(e){this.id=e}setStale(e){this.stale=e,e&&(this.skipUpdate=!1)}setSkipUpdate(e){this.skipUpdate=e}loadJSON(e){this.id=e.id,this.stale=this.stale,this.skipUpdate=e.skip_update}toJSON(){return{id:this.id,stale:this.stale,skip_update:this.skipUpdate}}constructor(e){(0,B._)(this,"id",void 0),(0,B._)(this,"stale",void 0),(0,B._)(this,"skipUpdate",void 0),this.id=e.id,this.stale=e.stale,this.skipUpdate=e.skip_update,(0,N.rC)(this,{id:N.LO.ref,stale:N.LO.ref,skipUpdate:N.LO.ref,setId:N.aD,setStale:N.aD,setSkipUpdate:N.aD})}}class ex extends(o=$()){setName(e){this.name=e}get project(){return e7.getById(this.projectId)}delete(){super.delete()}loadJSON(e){super.loadJSON(e),this.projectId=e.project_id,this.name=e.name,this.voiceId=e.voice_id,this.clipIds=e.clip_ids,this.createdAt=e.created_at}toJSON(){return{id:this.id,project_id:this.projectId,name:this.name,voice_id:this.voiceId,clip_ids:this.clipIds,created_at:this.createdAt,deleted_at:this.deletedAt}}constructor(e){super(e),(0,B._)(this,"name",void 0),(0,B._)(this,"projectId",void 0),(0,B._)(this,"voiceId",void 0),(0,B._)(this,"clipIds",void 0),(0,B._)(this,"createdAt",void 0),this.loadJSON(e),(0,N.rC)(this,{name:N.LO.ref,setName:N.aD})}}(0,B._)(ex,"collectionName","multiclip_voices");let eb=["pink","indigo","red","orange","blue","purple","slate","emerald","teal","green"];class eA extends $(){get index(){return this.project.speakers.findIndex(e=>this.id===e.id)}get color(){return eb[this.index]||"pink"}get project(){return e7.getById(this.projectId)}setName(e){this.name=e}delete(){this.project.sourceBlueprint.utterances.forEach(e=>{e.speakerId===this.id&&e.delete()}),this.project.targetBlueprints.forEach(e=>{e.tracks.forEach(e=>{e.speakerId===this.id&&e.delete()})}),this.project.sourceBlueprint.tracks.forEach(e=>{e.speakerId===this.id&&e.delete()}),super.delete()}loadJSON(e){super.loadJSON(e),this.name=e.name,this.projectId=e.project_id}toJSON(){return{...super.toJSON(),name:this.name,project_id:this.projectId}}constructor(e){super(e),(0,B._)(this,"name",void 0),(0,B._)(this,"projectId",void 0),this.loadJSON(e),(0,N.rC)(this,{name:N.LO.ref,index:N.Fl,setName:N.aD})}}class ey extends eA{}(0,B._)(ey,"collectionName","narration_speakers");class ej extends eA{}(0,B._)(ej,"collectionName","sfx_speakers");class e_ extends eA{async recomputeVoice(){let e=ez.getAll().find(e=>e.speakerId===this.id),t=await (0,ec.eG)({dubbing_id:this.project.dubbingId,clips:e.clips.map(e=>e.toJSON())});this.voice.setId(t.voice_uid),this.voice.setStale(!1),this.project.invalidateDubQuery()}loadJSON(e){super.loadJSON(e),this.media=e.media||null}toJSON(){return{id:this.id,name:this.name,project_id:this.projectId,voice:this.voice.toJSON(),media:this.media,deleted_at:this.deletedAt}}constructor(e){super(e),(0,B._)(this,"media",void 0),(0,B._)(this,"voice",void 0),this.voice=new ef(e.voice),this.loadJSON(e),this.voice.loadJSON(e.voice),(0,N.rC)(this,{voice:N.LO})}}(0,B._)(e_,"collectionName","speakers");var ek=i(754),eS=i(87069);let ew=(0,U.Z)("file:///app/src/app/(v1)/v1/dubbing/state/utterances.ts");class eC extends $(){get generateUtteranceDisabled(){if(!this.isUtteranceTypeGenerated)return!0;{let e=this.generate.isPending;return null==this.text||""==this.text||e}}setText(e){this.text=e}setClipId(e){this.clipId=e}loadJSON(e){super.loadJSON(e),this.clipId=e.clip_id,this.language=e.language,this.speakerId=e.speaker_id,this.blueprintId=e.blueprint_id,this.text=e.text}toJSON(){return{...super.toJSON(),clip_id:this.clipId,language:this.language,speaker_id:this.speakerId,blueprint_id:this.blueprintId,text:this.text}}constructor(e){super(e),(0,B._)(this,"clipId",void 0),(0,B._)(this,"language",void 0),(0,B._)(this,"speakerId",void 0),(0,B._)(this,"text",void 0),(0,B._)(this,"blueprintId",void 0),(0,B._)(this,"shouldFocusIfTextEmpty",!1),this.loadJSON(e),(0,N.rC)(this,{language:N.LO.ref,speakerId:N.LO.ref,clipId:N.LO.ref,text:N.LO.ref,speaker:N.Fl,setText:N.aD,setClipId:N.aD,track:N.Fl,isUtteranceTypeGenerated:N.Fl,generateUtteranceDisabled:N.Fl})}}class eN extends eC{setSpeakerId(e){let t=this.speakerId;this.speakerId=e,this.track.clips.some(e=>e!==this.clip&&e.intersects(this.clip))?this.speakerId=t:this.targets.forEach(t=>{t.setSpeakerId(e)})}get blueprint(){return e0.getById(this.blueprintId)}merge(e){let t=this.clip.endTime+e.clip.duration,i=e.text,s=this.targets,a=e.targets;for(let e in this.setText(this.text+" "+i),s){let t=s[e],i=a[e],r=t.clip.startTime,n=t.clip.endTime+i.clip.duration,l=i.text;i.delete(),t.setText(t.text+" "+l),t.clip.loadJSON({...t.clip.toJSON(),media:null,media_offset:r,media_duration:n-r,trim:{start:0,end:1},audio_stale:!0,history:[]})}e.delete(),this.clip.trimEndTo(t)}split(e){this.targets.forEach(e=>{e.clip.setStartPinned(!1),e.clip.setEndPinned(!1)});let t=this.clip.startTime,i=this.clip.endTime;this.clip.trimEndTo(e);let s=this.clip.clone(),a=this.clone({clip_id:s.id});s.trimStartTo(e),s.trimEndTo(i),this.targets.forEach(s=>{let r=s.clip.startTime,n=s.clip.endTime;if(e>=n){let t=s.clip.clone({media:null,media_offset:e,media_duration:.5}),r=s.clone({source_id:a.id,clip_id:t.id,text:""});t.stretchEndTo(i),s.clip.setAudioStale(!1),r.clip.setAudioStale(!0)}else if(e<=r){let i=s.clip.clone({media:null,media_offset:t,media_duration:.5});s.clone({source_id:a.id}),s.setClipId(i.id),i.stretchEndTo(e),s.setText(""),s.clip.setAudioStale(!0)}else{var l;s.clip.trimEndTo(e,{minDuration:.5});let t=s.clip.clone(),i=s.clone({source_id:a.id,clip_id:t.id,text:s.text});t.trimEndTo(n,{minDuration:.5}),t.trimStartTo(e,{minDuration:.5}),(null===(l=this.activeTarget)||void 0===l?void 0:l.id)==s.id?(s.clip.setAudioStale(!1),i.clip.setAudioStale(!1)):(s.clip.setAudioStale(!0),i.clip.setAudioStale(!0))}})}get track(){return this.blueprint.getTrackBySpeakerId(this.speakerId)||null}get activeTarget(){return this.targets.find(e=>e.language===this.blueprint.project.selectedLanaguage)||null}delete(){this.targets.forEach(e=>{e.delete()}),this.deletedAt=Date.now(),this.clip.deletedAt=Date.now()}constructor(e){super(e),this.loadJSON(e),(0,N.rC)(this,{targets:(0,N.Fl)({keepAlive:!0}),activeTarget:N.Fl,merge:N.aD,split:N.aD,setSpeakerId:N.aD})}}class eT extends eN{get speaker(){return e_.getById(this.speakerId)}get clip(){return tt.getById(this.clipId)}async recomputeVoice(){let e=await (0,ec.eG)({dubbing_id:this.blueprint.project.dubbingId,clips:[this.clip.toJSON()]});this.voice.setId(e.voice_uid),this.voice.setStale(!1),this.blueprint.project.invalidateDubQuery()}get targets(){return eD.getAll().filter(e=>e.sourceId===this.id)}get isUtteranceTypeGenerated(){return!1}loadJSON(e){var t;super.loadJSON(e),null===(t=this.voice)||void 0===t||t.loadJSON(e.voice)}toJSON(){return{...super.toJSON(),voice:this.voice.toJSON()}}constructor(e){super(e),(0,B._)(this,"voice",void 0),(0,B._)(this,"retranscribe",new em(async()=>{try{let e=await (0,ec.KR)({dubbing_id:this.blueprint.project.dubbingId,clip:this.clip.toJSON(),language:this.language});this.setText(e.text),this.blueprint.project.invalidateDubQuery()}catch(e){eo.toast.error("Transcription failed.")}})),this.voice=new ef(e.voice),this.loadJSON(e)}}(0,B._)(eT,"collectionName","source_utterances");class eI extends eN{get speaker(){return ey.getById(this.speakerId)}get clip(){return ts.getById(this.clipId)}get targets(){return eB.getAll().filter(e=>e.sourceId===this.id)}get isUtteranceTypeGenerated(){return!0}constructor(...e){var t;super(...e),t=this,(0,B._)(this,"shouldFocusIfTextEmpty",!0),(0,B._)(this,"generate",new em(async function(){var e,i,s,a,r,n,l,o;let{dictation:c,strictTiming:d=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let s=c?await (0,ec.M4)({dubbing_id:t.blueprint.project.dubbingId,voice_uid:t.clip.activeVoiceId,voice_settings:{stability:t.clip.voiceSpecificationWithFallback.stability,similarity_boost:t.clip.voiceSpecificationWithFallback.similarity_boost,style:t.clip.voiceSpecificationWithFallback.style,use_speaker_boost:t.clip.voiceSpecificationWithFallback.use_speaker_boost},language:t.language,audio:c}):await (0,ec.gW)({dubbing_id:t.blueprint.project.dubbingId,pronunciation_dictionary_locators:t.blueprint.project.pronunciationDictionaries.map(e=>eS.d1.fromLocator(new en.J5(e.id,e.versionId))),text:t.text,voice_uid:t.clip.activeVoiceId,model_id:t.clip.voiceSpecificationWithFallback.model_id,voice_settings:{stability:t.clip.voiceSpecificationWithFallback.stability,similarity_boost:t.clip.voiceSpecificationWithFallback.similarity_boost,style:t.clip.voiceSpecificationWithFallback.style,use_speaker_boost:t.clip.voiceSpecificationWithFallback.use_speaker_boost},language:t.language,minimum_duration:d?t.clip.duration-.05:null,maximum_duration:d?t.clip.duration-.05:null}),a=t.clip.duration+t.clip.trailingGap;if(t.clip.updateHistoryForCurrentClip(),t.clip.loadJSON({...t.clip.toJSON(),media:s,media_offset:t.clip.startTime,media_duration:s.duration_secs,trim:{start:0,end:1},audio_stale:!1,generation_time:(0,J.K9)()}),s.duration_secs>a){if(!t.track)throw Error("Cannot generate a detached clip");t.clip.trimEndTo((null===(e=t.clip.next)||void 0===e?void 0:e.startTime)?null===(i=t.clip.next)||void 0===i?void 0:i.startTime:t.track.blueprint.project.maximumDurationOfProject),s.duration_secs>a+1&&eo.toast.warning("Generated audio too long to fit in the available space. The clip has been trimmed.")}let r=t.clip.toHistoryClip();t.clip.history.push(r),t.targets.forEach(e=>{e.clip.endPinned&&e.clip.stretchEndTo(t.clip.startTime+s.duration_secs)}),t.blueprint.project.invalidateDubQuery()}catch(e){(null==e?void 0:null===(s=e.detail)||void 0===s?void 0:s.status)==="invalid_duration"?eo.toast.error("Failed to generate clip because it exceeds the 25 second limit for 'Fixed Duration' generation. Try 'Dynamic Duration' generation instead using the right click menu."):(null==e?void 0:null===(a=e.detail)||void 0===a?void 0:a.status)==="voice_not_found"?(ew.error("Voice ".concat(t.clip.activeVoiceId," not in library"),e),eo.toast.error("Failed to generate clip because the voice (".concat(t.clip.activeVoiceId,") is not in your library."))):(null==e?void 0:null===(r=e.detail)||void 0===r?void 0:r.status)==="invalid_text_length"&&d?eo.toast.error("Failed to generate clip because it exceeds the 300 character limit  for 'Fixed Duration' generation. Try 'Dynamic Duration' generation instead using the right click menu."):(null==e?void 0:null===(n=e.detail)||void 0===n?void 0:n.status)!=="invalid_text_length"||d?(null==e?void 0:null===(l=e.detail)||void 0===l?void 0:l.status)==="quota_exceeded"?eo.toast.error("Failed to generate clip because you don't have enough characters left."):(null==e?void 0:null===(o=e.detail)||void 0===o?void 0:o.status)==="ivc_not_permitted"?eo.toast.error("Failed to generate clip because you don't have permission to use instantly cloned voices."):eo.toast.error("Failed to generate clip."):eo.toast.error("Failed to generate clip because it exceeds the 1500 character limit.")}}))}}(0,B._)(eI,"collectionName","narration_source_utterances");class eV extends eN{get speaker(){return ej.getById(this.speakerId)}get clip(){return tr.getById(this.clipId)}get targets(){return eO.getAll().filter(e=>e.sourceId===this.id)}get isUtteranceTypeGenerated(){return!0}constructor(...e){var t;super(...e),t=this,(0,B._)(this,"shouldFocusIfTextEmpty",!0),(0,B._)(this,"generate",new em(async function(){let{strictTiming:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(e&&t.clip.duration-.05>22){eo.toast.error("Failed to generate clip because it exceeds the 22 second limit.");return}let i=await (0,ec.bL)({dubbing_id:t.blueprint.project.dubbingId,text:t.text,desired_clip_length_seconds:e?Math.max(t.clip.duration-.05,.5):void 0});t.clip.updateHistoryForCurrentClip(),t.clip.loadJSON({...t.clip.toJSON(),media:i,media_offset:t.clip.startTime,media_duration:i.duration_secs,trim:{start:0,end:1},audio_stale:!1,generation_time:(0,J.K9)()});let s=t.clip.toHistoryClip();t.clip.history.push(s),t.targets.forEach(e=>{e.clip.loadJSON({...e.clip.toJSON(),media:i,media_offset:t.clip.startTime,media_duration:i.duration_secs,trim:{start:0,end:1},audio_stale:!1,generation_time:(0,J.K9)()}),e.clip.endPinned&&e.clip.stretchEndTo(t.clip.startTime+i.duration_secs)}),t.blueprint.project.invalidateDubQuery()}catch(e){var i;(null==e?void 0:null===(i=e.detail)||void 0===i?void 0:i.status)==="invalid_text_length"?eo.toast.error("Failed to generate clip because it exceeds the 450 character limit."):eo.toast.error("Failed to generate clip.")}}))}}(0,B._)(eV,"collectionName","sfx_source_utterances");class eP extends eC{get isUtteranceTypeGenerated(){return!0}get blueprint(){return e1.getById(this.blueprintId)}get track(){return this.blueprint.getTrackBySpeakerId(this.speakerId)||null}setSpeakerId(e){this.clip.setStartPinned(!0),this.clip.setEndPinned(!0),this.speakerId=e}delete(){this.clip.delete(),this.deletedAt=Date.now()}merge(e){let t=this.clip.duration,i=e.clip.duration;this.clip.loadJSON({...this.clip.toJSON(),trim:{start:0,end:1},media:null,media_duration:t+i,media_offset:this.clip.startTime,audio_stale:!0}),e.delete()}loadJSON(e){super.loadJSON(e),this.sourceId=e.source_id}toJSON(){return{...super.toJSON(),source_id:this.sourceId}}constructor(e){super(e),(0,B._)(this,"sourceId",void 0),(0,B._)(this,"retranslate",new em(async()=>{try{var e;let{text:t}=await (0,ec.Iu)({dubbing_id:this.blueprint.project.dubbingId,text:this.source.text,source_language:this.source.language,target_language:this.language});this.setText(t),null===(e=this.clip)||void 0===e||e.setAudioStale(!0),this.blueprint.project.invalidateDubQuery()}catch(e){eo.toast.error("Translation failed.")}})),this.loadJSON(e),(0,N.rC)(this,{sourceId:N.LO.ref,blueprint:N.Fl,clip:N.Fl,source:N.Fl,merge:N.aD})}}class eE extends eP{async maybeRecomputeVoiceForMimicOriginalEmotion(){let e=this.source;e.voice.id?e.voice.stale&&!e.voice.skipUpdate&&((await ek.y.request({title:"Recompute Voice Clone?",description:"The voice clone associated with this clip is stale, would you like to recompute it before generating the audio?",confirmText:"Recompute",cancelText:"Skip"})).confirmed?await e.recomputeVoice():e.voice.setSkipUpdate(!0)):await e.recomputeVoice()}merge(e){if(!(e instanceof eE)){eo.toast.error("Failed to merge clips as they're different types.");return}let t=e.text;this.setText(this.text+" "+t),super.merge(e)}constructor(...e){var t;super(...e),t=this,(0,B._)(this,"redubTTSCall",new em(async function(){var e,i,s,a,r,n,l,o;let{dictation:c,strictTiming:d=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let a;(null===(e=t.clip.voiceSpecificationWithFallback)||void 0===e?void 0:e.mimic_original_emotion)?(await t.maybeRecomputeVoiceForMimicOriginalEmotion(),a=await (0,ec.$K)({dubbing_id:t.blueprint.project.dubbingId,tts_voice_uid:t.source.voice.id,tts_voice_settings:{stability:ev.stability,similarity_boost:ev.similarity_boost,style:ev.style,use_speaker_boost:ev.use_speaker_boost},sts_voice_uid:t.clip.activeVoiceId,sts_voice_settings:{stability:t.clip.voiceSpecificationWithFallback.stability,similarity_boost:t.clip.voiceSpecificationWithFallback.similarity_boost,style:t.clip.voiceSpecificationWithFallback.style,use_speaker_boost:t.clip.voiceSpecificationWithFallback.use_speaker_boost},language:t.language,minimum_duration:d?t.clip.duration-.05:null,maximum_duration:d?t.clip.duration-.05:null,text:t.text})):a=c?await (0,ec.M4)({dubbing_id:t.blueprint.project.dubbingId,voice_uid:t.clip.activeVoiceId,voice_settings:{stability:t.clip.voiceSpecificationWithFallback.stability,similarity_boost:t.clip.voiceSpecificationWithFallback.similarity_boost,style:t.clip.voiceSpecificationWithFallback.style,use_speaker_boost:t.clip.voiceSpecificationWithFallback.use_speaker_boost},language:t.language,audio:c}):await (0,ec.gW)({dubbing_id:t.blueprint.project.dubbingId,pronunciation_dictionary_locators:t.blueprint.project.pronunciationDictionaries.map(e=>eS.d1.fromLocator(new en.J5(e.id,e.versionId))),text:t.text,voice_uid:t.clip.activeVoiceId,model_id:t.clip.voiceSpecificationWithFallback.model_id,voice_settings:{stability:t.clip.voiceSpecificationWithFallback.stability,similarity_boost:t.clip.voiceSpecificationWithFallback.similarity_boost,style:t.clip.voiceSpecificationWithFallback.style,use_speaker_boost:t.clip.voiceSpecificationWithFallback.use_speaker_boost},language:t.language,minimum_duration:d?t.clip.duration-.05:null,maximum_duration:d?t.clip.duration-.05:null});let r=t.clip.duration+t.clip.trailingGap;if(t.clip.updateHistoryForCurrentClip(),t.clip.loadJSON({...t.clip.toJSON(),media:a,media_offset:t.clip.startTime,media_duration:a.duration_secs,trim:{start:0,end:1},audio_stale:!1,generation_time:(0,J.K9)()}),a.duration_secs>r){if(!t.track)throw Error("Cannot generate a detached clip");t.clip.trimEndTo((null===(i=t.clip.next)||void 0===i?void 0:i.startTime)?null===(s=t.clip.next)||void 0===s?void 0:s.startTime:t.track.blueprint.project.maximumDurationOfProject),a.duration_secs>r+1&&eo.toast.warning("The generated audio is too long to fit in the available space. The clip has been trimmed to ensure it fits. This can be undone with the trim tool.")}let n=t.clip.toHistoryClip();t.clip.history.push(n),t.blueprint.project.invalidateDubQuery()}catch(e){(null==e?void 0:null===(a=e.detail)||void 0===a?void 0:a.status)==="invalid_duration"?eo.toast.error("Failed to generate clip because it exceeds the 25 second limit for 'Fixed Duration' generation. Try 'Dynamic Duration' generation instead using the right click menu."):(null==e?void 0:null===(r=e.detail)||void 0===r?void 0:r.status)==="voice_not_found"?(ew.error("Voice ".concat(t.clip.activeVoiceId," not in library"),e),eo.toast.error("Failed to generate clip because the voice (".concat(t.clip.activeVoiceId,") is not in your library."))):(null==e?void 0:null===(n=e.detail)||void 0===n?void 0:n.status)==="invalid_text_length"&&d?eo.toast.error("Failed to generate clip because it exceeds the 300 character limit  for 'Fixed Duration' generation. Try 'Dynamic Duration' generation instead using the right click menu."):(null==e?void 0:null===(l=e.detail)||void 0===l?void 0:l.status)!=="invalid_text_length"||d?(null==e?void 0:null===(o=e.detail)||void 0===o?void 0:o.status)==="quota_exceeded"?eo.toast.error("Failed to generate clip because you don't have enough characters left."):eo.toast.error("Failed to generate clip."):eo.toast.error("Failed to generate clip because it exceeds the 1500 character limit.")}})),(0,B._)(this,"generate",this.redubTTSCall)}}class eO extends eP{get speaker(){return ej.getById(this.speakerId)}get clip(){return to.getById(this.clipId)}get source(){return eV.getById(this.sourceId)}constructor(...e){var t;super(...e),t=this,(0,B._)(this,"retranslate",new em(async()=>{this.setText(this.source.text)})),(0,B._)(this,"generate",new em(async function(){let{strictTiming:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(e&&t.clip.duration-.05>22){eo.toast.error("Failed to generate clip because it exceeds the 22 second limit.");return}let i=await (0,ec.bL)({dubbing_id:t.blueprint.project.dubbingId,text:t.text,desired_clip_length_seconds:e?Math.max(t.clip.duration-.05,.5):void 0});t.clip.updateHistoryForCurrentClip(),t.clip.loadJSON({...t.clip.toJSON(),media:i,media_offset:t.clip.startTime,media_duration:i.duration_secs,trim:{start:0,end:1},audio_stale:!1,generation_time:(0,J.K9)()});let s=t.clip.toHistoryClip();t.clip.history.push(s),t.blueprint.project.invalidateDubQuery()}catch(e){var i;(null==e?void 0:null===(i=e.detail)||void 0===i?void 0:i.status)==="invalid_text_length"?eo.toast.error("Failed to generate clip because it exceeds the 450 character limit."):eo.toast.error("Failed to generate clip.")}}))}}(0,B._)(eO,"collectionName","sfx_target_utterances");class eD extends eE{get speaker(){return e_.getById(this.speakerId)}get clip(){return tl.getById(this.clipId)}get source(){return eT.getById(this.sourceId)}async maybeComputeVoice(){"clip-clone"===this.clip.voiceSpecificationWithFallback.mode?this.source.voice.id?this.source.voice.stale&&!this.source.voice.skipUpdate&&((await ek.y.request({title:"Recompute Voice Clone?",description:"The voice clone associated with this clip is stale, would you like to recompute it before generating the audio?",confirmText:"Recompute",cancelText:"Skip"})).confirmed?await this.source.recomputeVoice():this.source.voice.setSkipUpdate(!0)):await this.source.recomputeVoice():"track-clone"===this.clip.voiceSpecificationWithFallback.mode&&(this.speaker.voice.id?this.speaker.voice.stale&&!this.speaker.voice.skipUpdate&&((await ek.y.request({title:"Recompute Voice Clone?",description:"The voice clone associated with this track is stale, would you like to recompute it before generating the audio?",confirmText:"Recompute",cancelText:"Skip"})).confirmed?await this.speaker.recomputeVoice():this.speaker.voice.setSkipUpdate(!0)):await this.speaker.recomputeVoice())}constructor(...e){var t;super(...e),t=this,(0,B._)(this,"generate",new em(async function(){let{dictation:e,strictTiming:i=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};await t.maybeComputeVoice(),await t.redubTTSCall.execute({dictation:e,strictTiming:i})}))}}(0,B._)(eD,"collectionName","target_utterances");class eB extends eE{get speaker(){return ey.getById(this.speakerId)}get clip(){return tc.getById(this.clipId)}get source(){return eI.getById(this.sourceId)}}(0,B._)(eB,"collectionName","narration_target_utterances");let eF=(0,U.Z)("file:///app/src/app/(v1)/v1/dubbing/state/tracks.ts");class eM extends $(){isRangeValidForPlacement(e,t){return this.clips.some(i=>i.intersects({startTime:e,endTime:t}))?{valid:!1,reason:"Clip cannot be placed here because doing so would cause multiple clips to occupy the same space."}:t>this.duration||e<0?{valid:!1,reason:"Clip cannot be placed here because it would overrun the track you're trying to place it in."}:{valid:!0,reason:null}}setSoloed(e){this.isSoloed=e}addBlankClip(e,t){}addClipByDuplicatingExisting(e,t){}get duration(){return this.blueprint.project.duration}get endTimeOfLastClip(){return Math.max(...this.clips.map(e=>e.endTime),0)}loadJSON(e){super.loadJSON(e),this.isSoloed=e.soloed||!1,this.blueprintId=e.blueprint_id}toJSON(){return{...super.toJSON(),soloed:this.isSoloed,blueprint_id:this.blueprintId}}constructor(e){super(e),(0,B._)(this,"blueprintId",void 0),(0,B._)(this,"height",4),(0,B._)(this,"isSoloed",void 0),(0,B._)(this,"canAddNewClipsInAllEditorModes",!1),this.loadJSON(e),(0,N.rC)(this,{blueprintId:N.LO,duration:N.Fl,endTimeOfLastClip:(0,N.Fl)({keepAlive:!0}),addBlankClip:N.aD,isSoloed:N.LO,setSoloed:N.aD})}}let eL="Clip cannot be placed here because doing so would cause multiple clips to occupy the same space in one of your dubbed language targets.";class eR extends eM{isRangeValidForPlacement(e,t){return super.isRangeValidForPlacement(e,t).valid?this.clips.some(i=>{var s;return null===(s=i.utterance)||void 0===s?void 0:s.targets.some(i=>i.clip.intersects({startTime:e,endTime:t}))})?{valid:!1,reason:eL}:{valid:!0,reason:null}:super.isRangeValidForPlacement(e,t)}get isMuted(){return this.blueprint.project.activeTracks.some(e=>e.isSoloed)?!this.isSoloed:null!=this.blueprint.project.selectedLanaguage&&"target"===this.blueprint.project.listeningMode}get blueprint(){return e0.getById(this.blueprintId)}get clips(){return this.blueprint.utterances.filter(e=>e.speakerId===this.speakerId).map(e=>e.clip)}loadJSON(e){super.loadJSON(e),this.blueprintId=e.blueprint_id,this.speakerId=e.speaker_id}toJSON(){return{...super.toJSON(),blueprint_id:this.blueprintId,speaker_id:this.speakerId}}constructor(e){super(e),(0,B._)(this,"speakerId",void 0),this.loadJSON(e),(0,N.rC)(this,{speakerId:N.LO.ref,blueprint:N.Fl,clips:N.Fl,isMuted:N.Fl})}}class ez extends eR{addBlankClip(e,t){if(!this.media)return;let i=tt.create({id:(0,Q.Z)(),media_offset:0,media_duration:this.media.duration_secs,media:{...this.media},trim:{start:e/this.media.duration_secs,end:(e+t)/this.media.duration_secs}}),s=eT.create({id:(0,Q.Z)(),blueprint_id:this.blueprintId,speaker_id:this.speakerId,text:"",language:this.blueprint.language,clip_id:i.id,voice:{id:"",stale:!0,skip_update:!1}});return this.blueprint.project.targetBlueprints.forEach(e=>{let t=tl.create({id:(0,Q.Z)(),media:null,media_offset:i.startTime,media_duration:i.duration,trim:{start:0,end:1},volume:0,start_pinned:!0,end_pinned:!0,audio_stale:!0,voice_specification:null});eD.create({id:(0,Q.Z)(),blueprint_id:e.id,source_id:s.id,speaker_id:this.speakerId,text:"",language:e.language,clip_id:t.id})}),this.blueprint.project.selection.set(i),i}get media(){var e;return this.speaker.media||(null===(e=this.clips[0])||void 0===e?void 0:e.media)}get speaker(){return e_.getById(this.speakerId)}isRangeValidForPlacement(e,t){var i,s,a;return(null===(i=this.media)||void 0===i?void 0:i.duration_secs)&&(e>=(null===(s=this.media)||void 0===s?void 0:s.duration_secs)||t>=(null===(a=this.media)||void 0===a?void 0:a.duration_secs))?{valid:!1,reason:"Clip cannot be placed here as it is at a time later than the duration of the original media you're dubbing."}:super.isRangeValidForPlacement(e,t)}isClipRightTypeForTrack(e){return e instanceof tt}}(0,B._)(ez,"collectionName","source_tracks");class eU extends eR{setVoiceSpecification(e){this.voiceSpecification=e,this.clips.forEach(e=>{e.voiceSpecificationWithFallback===this.voiceSpecification&&e.setAudioStale(!0)})}loadJSON(e){super.loadJSON(e),this.voiceSpecification=e.voice_specification}toJSON(){return{...super.toJSON(),voice_specification:this.voiceSpecification}}addBlankClip(e,t){let i=ts.create({id:(0,Q.Z)(),media_offset:e,media_duration:t,media:null,trim:{start:0,end:1},audio_stale:!1}),s=eI.create({id:(0,Q.Z)(),blueprint_id:this.blueprintId,speaker_id:this.speakerId,text:"",language:this.blueprint.language,clip_id:i.id});return this.blueprint.project.targetBlueprints.forEach(e=>{let t=tc.create({id:(0,Q.Z)(),media:null,media_offset:i.startTime,media_duration:i.duration,trim:{start:0,end:1},volume:0,start_pinned:!0,end_pinned:!0,audio_stale:!0,voice_specification:null});eB.create({id:(0,Q.Z)(),blueprint_id:e.id,source_id:s.id,speaker_id:this.speakerId,text:"",language:e.language,clip_id:t.id})}),this.blueprint.project.selection.set(i),i}addClipByDuplicatingExisting(e,t){var i,s,a,r,n;this.isClipRightTypeForTrack(t)||eo.toast.warning("Can't copy clip to this track as it's the wrong type.");let l=ts.create({id:(0,Q.Z)(),media_offset:e,media_duration:t.duration,media:t.media,trim:{...t.trim},voice_specification:t.voiceSpecification?{...t.voiceSpecification}:this.id==(null===(i=t.track)||void 0===i?void 0:i.id)?null:{...null===(s=t.track)||void 0===s?void 0:s.voiceSpecification},volume:t.volume}),o=eI.create({id:(0,Q.Z)(),blueprint_id:this.blueprintId,speaker_id:this.speakerId,text:null!==(n=null===(a=t.utterance)||void 0===a?void 0:a.text)&&void 0!==n?n:"",language:this.blueprint.language,clip_id:l.id});this.blueprint.project.targetBlueprints.forEach(e=>{var i,s,a,r;let n=null===(i=t.utterance)||void 0===i?void 0:i.targets.find(t=>t.blueprintId==e.id),c=null==n?void 0:n.clip;if(c){let i=tc.create({id:(0,Q.Z)(),media:c.media,media_offset:l.startTime,media_duration:l.duration,trim:{start:0,end:1},volume:c.volume,start_pinned:!0,end_pinned:!0,audio_stale:!1,voice_specification:c.voiceSpecification?{...c.voiceSpecification}:this.id==(null===(s=t.track)||void 0===s?void 0:s.id)?null:{...null===(a=c.track)||void 0===a?void 0:a.voiceSpecification}});eB.create({id:(0,Q.Z)(),blueprint_id:e.id,source_id:o.id,speaker_id:this.speakerId,text:n.text,language:e.language,clip_id:i.id})}}),this.blueprint.project.selection.set(l)}get speaker(){return ey.getById(this.speakerId)}isClipRightTypeForTrack(e){return e instanceof ts}constructor(e){super(e),(0,B._)(this,"voiceSpecification",void 0),(0,B._)(this,"defaultVoiceSpecification",eg),(0,B._)(this,"canAddNewClipsInAllEditorModes",!0),this.loadJSON(e),(0,N.rC)(this,{voiceSpecification:N.LO,setVoiceSpecification:N.aD})}}(0,B._)(eU,"collectionName","narration_source_tracks");class eJ extends eR{addBlankClip(e,t){let i=tr.create({id:(0,Q.Z)(),media_offset:e,media_duration:t,media:null,trim:{start:0,end:1}}),s=eV.create({id:(0,Q.Z)(),blueprint_id:this.blueprintId,speaker_id:this.speakerId,text:"",language:this.blueprint.language,clip_id:i.id});return this.blueprint.project.targetBlueprints.forEach(e=>{let t=to.create({id:(0,Q.Z)(),media:null,media_offset:i.startTime,media_duration:i.duration,trim:{start:0,end:1},volume:0,start_pinned:!0,end_pinned:!0,audio_stale:!0});eO.create({id:(0,Q.Z)(),blueprint_id:e.id,source_id:s.id,speaker_id:this.speakerId,text:"",language:e.language,clip_id:t.id})}),this.blueprint.project.selection.set(i),i}addClipByDuplicatingExisting(e,t){var i,s;this.isClipRightTypeForTrack(t)||eo.toast.warning("Can't copy clip to this track as it's the wrong type.");let a=tr.create({id:(0,Q.Z)(),media_offset:e,media_duration:t.duration,media:t.media,trim:{...t.trim},volume:t.volume}),r=eV.create({id:(0,Q.Z)(),blueprint_id:this.blueprintId,speaker_id:this.speakerId,text:null!==(s=null===(i=t.utterance)||void 0===i?void 0:i.text)&&void 0!==s?s:"",language:this.blueprint.language,clip_id:a.id});this.blueprint.project.targetBlueprints.forEach(e=>{var i;let s=null===(i=t.utterance)||void 0===i?void 0:i.targets.find(t=>t.blueprintId==e.id),n=null==s?void 0:s.clip;if(n){let t=to.create({id:(0,Q.Z)(),media:n.media,media_offset:a.startTime,media_duration:a.duration,trim:{start:0,end:1},volume:n.volume,start_pinned:!0,end_pinned:!0,audio_stale:!1});eO.create({id:(0,Q.Z)(),blueprint_id:e.id,source_id:r.id,speaker_id:this.speakerId,text:s.text,language:e.language,clip_id:t.id})}}),this.blueprint.project.selection.set(a)}get speaker(){return ej.getById(this.speakerId)}isClipRightTypeForTrack(e){return e instanceof tr}constructor(...e){super(...e),(0,B._)(this,"canAddNewClipsInAllEditorModes",!0)}}(0,B._)(eJ,"collectionName","sfx_source_tracks");class eZ extends eM{get isMuted(){return this.blueprint.project.selectedLanaguage!==this.blueprint.language||(this.blueprint.project.activeTracks.some(e=>e.isSoloed)?!this.isSoloed:"source"===this.blueprint.project.listeningMode)}get blueprint(){return e1.getById(this.blueprintId)}get clips(){return this.blueprint.utterances.filter(e=>e.speakerId===this.speakerId).map(e=>e.clip).sort((e,t)=>e.startTime-t.startTime)}loadJSON(e){super.loadJSON(e),this.blueprintId=e.blueprint_id,this.speakerId=e.speaker_id}toJSON(){return{...super.toJSON(),blueprint_id:this.blueprintId,speaker_id:this.speakerId}}constructor(e){super(e),(0,B._)(this,"speakerId",void 0),this.loadJSON(e),(0,N.rC)(this,{speakerId:N.LO.ref,blueprint:N.Fl,clips:N.Fl,isMuted:N.Fl})}}class eW extends eZ{setVoiceSpecification(e){this.voiceSpecification=e,this.clips.forEach(e=>{e.voiceSpecificationWithFallback===this.voiceSpecification&&e.setAudioStale(!0)})}isClipRightTypeForTrack(e){return e instanceof tn}loadJSON(e){super.loadJSON(e),this.voiceSpecification=e.voice_specification}toJSON(){return{...super.toJSON(),voice_specification:this.voiceSpecification}}constructor(e){super(e),(0,B._)(this,"voiceSpecification",void 0),(0,B._)(this,"defaultVoiceSpecification",eg),this.loadJSON(e),(0,N.rC)(this,{voiceSpecification:N.LO,setVoiceSpecification:N.aD})}}class eX extends eW{get speaker(){return e_.getById(this.speakerId)}constructor(...e){super(...e),(0,B._)(this,"defaultVoiceSpecification",ev)}}(0,B._)(eX,"collectionName","target_tracks");class eG extends eW{get speaker(){return ey.getById(this.speakerId)}}(0,B._)(eG,"collectionName","narration_target_tracks");class eH extends eZ{get speaker(){return ej.getById(this.speakerId)}isClipRightTypeForTrack(e){return e instanceof to}}(0,B._)(eH,"collectionName","sfx_target_tracks");class eK extends eM{get isMuted(){return!!this.blueprint.project.activeTracks.some(e=>e.isSoloed)&&!this.isSoloed}get blueprint(){return e0.getById(this.blueprintId)}get clips(){return td.getAll().filter(e=>e.trackId===this.id).sort((e,t)=>e.startTime-t.startTime)}addBlankClip(e,t){let i=this.blueprint.project.background,s=td.create({id:(0,Q.Z)(),media_offset:0,media_duration:i.duration_secs,media:{...i},trim:{start:e/i.duration_secs,end:(e+t)/i.duration_secs},track_id:this.id});return this.blueprint.project.selection.set(s),s}addClipByDuplicatingExisting(e,t){this.isClipRightTypeForTrack(t)||eo.toast.warning("Can't copy clip to this track as it's the wrong type.");let i=td.create({id:(0,Q.Z)(),media_offset:e,media_duration:t.mediaDuration,media:{...t.media},trim:{...t.trim},track_id:this.id,volume:t.volume});this.blueprint.project.selection.set(i)}isRangeValidForPlacement(e,t){return this.blueprint.project.background.duration_secs&&(e>=this.blueprint.project.background.duration_secs||t>=this.blueprint.project.background.duration_secs)?{valid:!1,reason:"Clip cannot be placed here as it is at a time later than the duration of the original media you're dubbing."}:super.isRangeValidForPlacement(e,t)}isClipRightTypeForTrack(e){return e instanceof td}loadJSON(e){super.loadJSON(e),this.blueprintId=e.blueprint_id}toJSON(){return{...super.toJSON(),blueprint_id:this.blueprintId}}constructor(e){super(e),(0,B._)(this,"height",2.5),this.loadJSON(e),(0,N.rC)(this,{blueprint:N.Fl,clips:N.Fl,isMuted:N.Fl})}}(0,B._)(eK,"collectionName","background_tracks");class eQ extends eM{get isMuted(){return!!this.blueprint.project.activeTracks.some(e=>e.isSoloed)&&!this.isSoloed}get blueprint(){return e0.getById(this.blueprintId)}get clips(){return tu.getAll().filter(e=>e.trackId===this.id).sort((e,t)=>e.startTime-t.startTime)}addBlankClip(e,t){let i=this.blueprint.project.foreground,s=tu.create({id:(0,Q.Z)(),media_offset:0,media_duration:i.duration_secs,media:{...i},trim:{start:e/i.duration_secs,end:(e+t)/i.duration_secs},track_id:this.id});return this.blueprint.project.selection.set(s),s}addClipByDuplicatingExisting(e,t){this.isClipRightTypeForTrack(t)||eo.toast.warning("Can't copy clip to this track as it's the wrong type.");let i=td.create({id:(0,Q.Z)(),media_offset:e,media_duration:t.mediaDuration,media:{...t.media},trim:{...t.trim},track_id:this.id,volume:t.volume});this.blueprint.project.selection.set(i)}isRangeValidForPlacement(e,t){return this.blueprint.project.foreground.duration_secs&&(e>=this.blueprint.project.foreground.duration_secs||t>=this.blueprint.project.foreground.duration_secs)?{valid:!1,reason:"Clip cannot be placed here as it is at a time later than the duration of the original media you're dubbing."}:super.isRangeValidForPlacement(e,t)}isClipRightTypeForTrack(e){return e instanceof tu}loadJSON(e){super.loadJSON(e),this.blueprintId=e.blueprint_id}toJSON(){return{...super.toJSON(),blueprint_id:this.blueprintId}}constructor(e){super(e),(0,B._)(this,"height",2.5),(0,B._)(this,"canAddNewClipsInAllEditorModes",!0),this.loadJSON(e),(0,N.rC)(this,{blueprint:N.Fl,clips:N.Fl,isMuted:N.Fl})}}(0,B._)(eQ,"collectionName","foreground_tracks");class eq extends eM{get isMuted(){return!!this.blueprint.project.activeTracks.some(e=>e.isSoloed)&&!this.isSoloed}get blueprint(){return e0.getById(this.blueprintId)}get clips(){return th.getAll().filter(e=>e.trackId===this.id).sort((e,t)=>e.startTime-t.startTime)}addBlankClip(e,t){eF.error("Can't create blank imported media clip")}setName(e){this.name=e}addClipFromImportedMedia(e,t,i){let s=th.create({id:(0,Q.Z)(),media_offset:null!=i?i:0,media_duration:t.duration_secs,media:t,trim:{start:0,end:1},imported_file_name:e,track_id:this.id});t.duration_secs>this.blueprint.project.maximumDurationOfProject&&(eo.toast.warning("Imported audio too long to fit in the available space. The clip has been trimmed."),s.trimEndTo((null!=i?i:0)+t.duration_secs))}addClipByDuplicatingExisting(e,t){this.isClipRightTypeForTrack(t)||eo.toast.warning("Can't copy clip to this track as it's the wrong type.");let i=th.create({id:(0,Q.Z)(),media_offset:e,media_duration:t.mediaDuration,media:{...t.media},trim:{...t.trim},track_id:this.id,volume:t.volume,imported_file_name:t.importedFilename});this.blueprint.project.selection.set(i)}isClipRightTypeForTrack(e){return e instanceof th}loadJSON(e){super.loadJSON(e),this.blueprintId=e.blueprint_id,this.name=e.name}toJSON(){return{...super.toJSON(),blueprint_id:this.blueprintId,name:this.name}}constructor(e){super(e),(0,B._)(this,"height",2.5),(0,B._)(this,"name",void 0),this.loadJSON(e),(0,N.rC)(this,{name:N.LO.ref,blueprint:N.Fl,clips:N.Fl,isMuted:N.Fl})}}(0,B._)(eq,"collectionName","imported_audio_tracks");let eY=(0,U.Z)("file:///app/src/app/(v1)/v1/dubbing/state/blueprints.ts");class e$ extends $(){get project(){return e7.getById(this.projectId)}loadJSON(e){super.loadJSON(e),this.projectId=e.project_id}toJSON(){return{...super.toJSON(),project_id:this.projectId}}constructor(e){super(e),(0,B._)(this,"projectId",void 0),this.projectId=e.project_id}}class e0 extends e${get language(){return(0,ep.iJ)(this.utterances.map(e=>e.language))||"en"}get utterances(){return eN.getAll().sort((e,t)=>e.clip.startTime-t.clip.startTime).filter(e=>e.blueprintId===this.id)}get tracks(){return eR.getAll().filter(e=>e.blueprintId===this.id)}get project(){return e7.getById(this.projectId)}get backgroundTrack(){return eK.getAll().find(e=>e.blueprintId===this.id)}get foregroundTrack(){return eQ.getAll().find(e=>e.blueprintId===this.id)}get importedAudioTracks(){return eq.getAll().filter(e=>e.blueprintId===this.id)}getTrackBySpeakerId(e){return this.tracks.find(t=>t.speakerId===e)}constructor(e){super(e),(0,N.rC)(this,{tracks:N.Fl,utterances:N.Fl,project:N.Fl,backgroundTrack:(0,N.Fl)({keepAlive:!0}),foregroundTrack:(0,N.Fl)({keepAlive:!0}),importedAudioTracks:N.Fl})}}(0,B._)(e0,"collectionName","source_blueprints");class e1 extends e${get utterances(){return eP.getAll().filter(e=>e.blueprintId===this.id)}get tracks(){return eZ.getAll().filter(e=>e.blueprintId===this.id)}get project(){return e7.getById(this.projectId)}getTrackBySpeakerId(e){return this.tracks.find(t=>t.speakerId===e)}loadJSON(e){super.loadJSON(e),this.language=e.language}toJSON(){return{...super.toJSON(),language:this.language}}constructor(e){super(e),(0,B._)(this,"projectId",void 0),(0,B._)(this,"language",void 0),(0,B._)(this,"translateAll",new em(()=>Promise.all(this.utterances.map(e=>e.retranslate.execute().catch(eY.warn))))),this.projectId=e.project_id,this.language=e.language,(0,N.rC)(this,{tracks:N.Fl,utterances:N.Fl,project:N.Fl})}}(0,B._)(e1,"collectionName","target_blueprints");class e2{get seconds(){return this.milliseconds/1e3}seek(e){this.setMilliseconds(1e3*e),this.events.emit("seek")}setMilliseconds(e){this.milliseconds=Math.max(e,0)}constructor(){(0,B._)(this,"milliseconds",void 0),(0,B._)(this,"playing",void 0),(0,B._)(this,"lastTimestamp",void 0),(0,B._)(this,"rafId",void 0),(0,B._)(this,"events",void 0),(0,B._)(this,"pause",()=>{this.playing=!1,null!==this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.events.emit("pause")}),(0,B._)(this,"onPause",e=>(this.events.on("pause",e),()=>this.events.off("pause",e))),(0,B._)(this,"resume",()=>{var e;this.setMilliseconds(null!==(e=this.milliseconds)&&void 0!==e?e:0),this.playing=!0,null===this.rafId&&(this.lastTimestamp=performance.now(),this.rafId=requestAnimationFrame(this.loop)),this.events.emit("resume")}),(0,B._)(this,"onResume",e=>(this.events.on("resume",e),()=>this.events.off("resume",e))),(0,B._)(this,"onTimeChange",e=>(0,N.U5)(()=>this.milliseconds,()=>{e()})),(0,B._)(this,"onSeek",e=>(this.events.on("seek",e),()=>this.events.off("seek",e))),(0,B._)(this,"onTick",e=>(this.events.on("tick",e),()=>this.events.off("tick",e))),(0,B._)(this,"loop",e=>{if(!this.playing)return;let t=e-this.lastTimestamp;this.lastTimestamp=e,this.setMilliseconds(this.milliseconds+t),this.events.emit("tick"),this.rafId=requestAnimationFrame(this.loop)}),this.milliseconds=0,this.lastTimestamp=null,this.rafId=null,this.playing=!1,this.events=new q.v,(0,N.rC)(this,{milliseconds:N.LO,playing:N.LO,setMilliseconds:N.aD,pause:N.aD,resume:N.aD})}}var e5=i(56204);let e4=(0,U.Z)("file:///app/src/app/(v1)/v1/dubbing/state/selection.ts");class e3{has(e){return this.clipIds.includes(e.id)}add(e){this.has(e)||this.clipIds.push(e.id)}remove(e){this.clipIds.remove(e.id)}toggle(e){this.has(e)?this.remove(e):this.add(e)}set(e){this.clear(),this.clipIds.push(e.id)}clear(){this.clipIds.clear()}selectUntil(e){let t=this.latest;if(this.clear(),e.track&&(null==t?void 0:t.track)&&e.track===t.track){if(t){if(t.index<e.index){let i=e.index;for(;i>t.index-1;)this.add(e.track.clips[i]),i--}else if(t.index>e.index){let i=e.index;for(;i<t.index+1;)this.add(e.track.clips[i]),i++}}else this.add(e)}else this.add(e)}allOfType(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.clips.every(e=>t.some(t=>e instanceof t))}get isEmpty(){return 0===this.clips.length}get clips(){return this.clipIds.map(e=>te.getById(e)).filter(e=>null!=e)}get sourceClips(){return this.clips.filter(e=>e instanceof ts||e instanceof tt||e instanceof tr)}get targetClips(){return this.clips.filter(e=>e instanceof tn||e instanceof to)}get generatedClips(){return this.clips.filter(e=>e.clipTypeCanBeGenerated)}get backgroundClips(){return this.clips.filter(e=>e instanceof td)}get latest(){return this.clips.at(-1)||null}loadJSON(e){this.clipIds.replace(e.clip_ids)}toJSON(){return{clip_ids:this.clipIds}}constructor(e,t){(0,B._)(this,"clipIds",void 0),(0,B._)(this,"store",void 0),(0,B._)(this,"multiclip",(0,N.ky)({selection:this,delete(){this.selection.clips.forEach(e=>{e instanceof tt||e instanceof ts||e instanceof td||e instanceof tr||e instanceof tu||e instanceof th?e.delete():(e instanceof tn||e instanceof to)&&(e.setMedia(null),e.setAudioStale(!0))})},setVolume(e){this.selection.clips.forEach(t=>{t.setVolume(e)})},setInheritVoiceSettings(e){this.selection.generatedClips.forEach(t=>{e?t.setVoiceSpecification(null):t.setVoiceSpecification({...t.voiceSpecificationWithFallback})})},setModel(e){this.selection.generatedClips.forEach(t=>{t.setVoiceSpecification({...t.voiceSpecificationWithFallback,model_id:e})})},setVoiceMode(e){let{mode:t,voice_library_id:i}=e,s="clip-clone"===t||"track-clone"===t;this.selection.generatedClips.forEach(e=>{e.setVoiceSpecification({...e.voiceSpecificationWithFallback,mode:t,voice_library_id:i,mimic_original_emotion:!s&&e.voiceSpecificationWithFallback.mimic_original_emotion})})},setMimicOriginalEmotion(e){this.selection.generatedClips.forEach(t=>{t.setVoiceSpecification({...t.voiceSpecificationWithFallback,mimic_original_emotion:e})})},setVoiceSimilarity(e){this.selection.generatedClips.forEach(t=>{t.setVoiceSpecification({...t.voiceSpecificationWithFallback,similarity_boost:e})})},setVoiceStability(e){this.selection.generatedClips.forEach(t=>{t.setVoiceSpecification({...t.voiceSpecificationWithFallback,stability:e})})},setVoiceStyle(e){this.selection.generatedClips.forEach(t=>{t.setVoiceSpecification({...t.voiceSpecificationWithFallback,style:e})})},resetVoiceSettings(){this.selection.generatedClips.forEach(e=>{e.setVoiceSpecification({...e.voiceSpecificationWithFallback,...ev})})},setStartPinned(e){this.selection.targetClips.forEach(t=>{t.setStartPinned(e)})},setEndPinned(e){this.selection.targetClips.forEach(t=>{t.setEndPinned(e)})},transcribe(){this.selection.sourceClips.forEach(e=>{if(e instanceof tt){var t;null===(t=e.utterance)||void 0===t||t.retranscribe.execute().then(()=>{var t;this.selection.store.history.commit(),null===(t=e.utterance)||void 0===t||t.targets.forEach(e=>{e.retranslate.execute().then(()=>{this.selection.store.history.commit({replace:!0})})})}).catch(e=>e4.error(e))}})},get isTranscribing(){return this.selection.sourceClips.some(e=>{var t;return e instanceof tt&&(null===(t=e.utterance)||void 0===t?void 0:t.retranscribe.isPending)})},generate(){let{dictation:e,strictTiming:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.selection.generatedClips.forEach(i=>{var s;null===(s=i.utterance)||void 0===s||s.generate.execute({dictation:e,strictTiming:t}).then(()=>{this.selection.store.history.commit()})})},download(){this.selection.clips.forEach(e=>{e.media&&e.toWav().then(t=>{let i=new Blob([t],{type:"audio/wav"});(0,e5.saveAs)(i,"clip-".concat(e.id,".wav"))})})},get isGenerating(){return this.selection.generatedClips.some(e=>{var t;return null===(t=e.utterance)||void 0===t?void 0:t.generate.isPending})},get canGenerate(){return!this.selection.generatedClips.some(e=>{var t;return null===(t=e.utterance)||void 0===t?void 0:t.generateUtteranceDisabled})}})),this.store=t,this.clipIds=e.clip_ids,(0,N.rC)(this,{clipIds:N.LO,add:N.aD,remove:N.aD,toggle:N.aD,set:N.aD,clear:N.aD,loadJSON:N.aD})}}let e6=(0,U.Z)("file:///app/src/app/(v1)/v1/dubbing/state/projects.ts");class e8{get isAudio(){return this.data.content_type.startsWith("audio")}constructor(e){(0,B._)(this,"data",void 0),(0,B._)(this,"video",void 0),(0,B._)(this,"loaded",void 0),this.data=e,this.loaded=!1,(0,N.rC)(this,{loaded:N.LO.ref}),this.video=document.createElement("video"),this.video.classList.add("h-full","w-full"),this.video.muted=!0,this.video.onloadedmetadata=()=>{this.loaded=!0},this.video.src=e.url}}class e7 extends(c=$()){setQueryClient(e){this.queryClient=e}invalidateDubQuery(){if(!this.queryClient)throw Error("setQueryClient must be called before invalidateDubQuery");this.queryClient.invalidateQueries({queryKey:(0,ec.Ni)(this.dubbingId)})}get timelineWidth(){if(!this.timelineElement)throw Error("Cannot get width of timeline element because it does not exist.");return this.timelineElement.clientWidth-ed(30)}setListeningMode(e){this.listeningMode=e}setSelectedLanguage(e){this.selectedLanaguage=e}setPronunciationDictionary(e){this.pronunciationDictionaries=[...this.pronunciationDictionaries,e]}removePronunciationDictionary(e){this.pronunciationDictionaries=this.pronunciationDictionaries.filter(t=>t.id!==e.id)}setMode(e){this.mode=new e(this)}setLoopRange(e){e&&(e.start=Math.max(e.start,0),e.end=Math.min(e.end,this.duration)),this.loopRange=e}get multiClipVoices(){return ex.getAll().filter(e=>e.projectId===this.id)}get activeTracks(){let e=[...this.sourceBlueprint.tracks];return this.sourceBlueprint.backgroundTrack&&e.push(this.sourceBlueprint.backgroundTrack),this.sourceBlueprint.foregroundTrack&&e.push(this.sourceBlueprint.foregroundTrack),this.sourceBlueprint.importedAudioTracks&&e.push(...this.sourceBlueprint.importedAudioTracks),this.activeTargetBlueprint&&e.push(...this.activeTargetBlueprint.tracks),e}get activeTracksHeight(){let e=0;return this.activeTracks.forEach(t=>{e+=t.height}),e}numWhitespaceTracks(){let e=0;return this.activeTracksHeight<12.5&&(e=Math.ceil((12.5-this.activeTracksHeight)/4)),Math.max(1,e)}setContextMenu(e){this.contextMenu=e}startTrim(e){this.activeTrim=e}stopTrim(){this.activeTrim=null}startStretch(e){this.activeStretch=e}stopStretch(){this.activeStretch=null}startDrag(){this.activeDrag={clipsAndTheirInitialStartTimes:this.selection.clips.map(e=>{var t;return{clip:e,initialStartTime:e.startTime,initialSpeakerId:null===(t=e.track)||void 0===t?void 0:t.speakerId}})}}stopDrag(){this.activeDrag=null}addVoiceoverTrack(){var e,t;let i=ey.create({id:(0,Q.Z)(),project_id:this.id,name:er.ag.t("New Voiceover Speaker")});(null==el.voices.value||(null===(e=el.voices.value)||void 0===e?void 0:e.length)<1)&&e6.error("Couldn't create track as voices haven't loaded yet. Please try again in a moment.");let s=null===(t=el.voices.value)||void 0===t?void 0:t[0].voice_id,a=eU.create({id:(0,Q.Z)(),project_id:this.id,blueprint_id:this.sourceBlueprint.id,speaker_id:i.id,voice_specification:{mode:"voice-library",voice_library_id:s,...eg}});return this.targetBlueprints.forEach(e=>{eG.create({id:(0,Q.Z)(),project_id:this.id,blueprint_id:e.id,speaker_id:i.id,voice_specification:{mode:"voice-library",voice_library_id:s,...eg}})}),a}addDubbedSpeakerTrack(e){let t=ez.getAll().find(t=>t.speakerId===e.id);if(null!=t){let e=e_.create({...t.speaker.toJSON(),id:(0,Q.Z)(),name:er.ag.t("Speaker")+" "+(this.speakers.length+1)}),i=ez.create({...t.toJSON(),speaker_id:e.id,id:(0,Q.Z)()});this.targetBlueprints.forEach(e=>{eX.create({id:(0,Q.Z)(),blueprint_id:e.id,speaker_id:i.speakerId,voice_specification:{mode:"clip-clone",voice_library_id:null,...ev}})}),e.recomputeVoice()}}addSfxTrack(){let e=ej.create({id:(0,Q.Z)(),project_id:this.id,name:er.ag.t("New SFX Track")});eJ.create({id:(0,Q.Z)(),project_id:this.id,blueprint_id:this.sourceBlueprint.id,speaker_id:e.id}),this.targetBlueprints.forEach(t=>{eH.create({id:(0,Q.Z)(),project_id:this.id,blueprint_id:t.id,speaker_id:e.id})})}importAudioClip(e,t){eq.create({id:(0,Q.Z)(),name:e,project_id:this.id,blueprint_id:this.sourceBlueprint.id}).addClipFromImportedMedia(e,t)}addTargetBlueprint(e){let t=e1.create({id:(0,Q.Z)(),project_id:this.id,language:e});return this.sourceBlueprint.tracks.forEach(e=>{e instanceof ez?eX.create({id:(0,Q.Z)(),blueprint_id:t.id,speaker_id:e.speakerId,voice_specification:{mode:"clip-clone",voice_library_id:null,...ev}}):e instanceof eU?eG.create({id:(0,Q.Z)(),blueprint_id:t.id,speaker_id:e.speakerId,voice_specification:e.voiceSpecification}):e instanceof eJ?eH.create({id:(0,Q.Z)(),blueprint_id:t.id,speaker_id:e.speakerId}):e6.error("Unexpected source track type")}),this.sourceBlueprint.utterances.forEach(i=>{if(i instanceof eT){let s=tl.create({id:(0,Q.Z)(),media:null,media_offset:i.clip.startTime,media_duration:i.clip.duration,trim:{start:0,end:1},volume:0,start_pinned:!0,end_pinned:!0,audio_stale:!0,voice_specification:null});eD.create({id:(0,Q.Z)(),blueprint_id:t.id,source_id:i.id,speaker_id:i.speakerId,text:"",language:e,clip_id:s.id})}else if(i instanceof eI){let s=tc.create({id:(0,Q.Z)(),media:null,media_offset:i.clip.startTime,media_duration:i.clip.duration,trim:{start:0,end:1},volume:0,start_pinned:!0,end_pinned:!0,audio_stale:!0,voice_specification:null});eB.create({id:(0,Q.Z)(),blueprint_id:t.id,source_id:i.id,speaker_id:i.speakerId,text:"",language:e,clip_id:s.id})}else if(i instanceof eV){let s=to.create({id:(0,Q.Z)(),media:i.clip.media,media_offset:i.clip.startTime,media_duration:i.clip.duration,trim:i.clip.trim,volume:0,start_pinned:!0,end_pinned:!0,audio_stale:!1});eO.create({id:(0,Q.Z)(),blueprint_id:t.id,source_id:i.id,speaker_id:i.speakerId,text:i.text,language:e,clip_id:s.id})}}),t}get sourceBlueprint(){return e0.getAll().find(e=>e.projectId===this.id)}get targetBlueprints(){return e1.getAll().filter(e=>e.projectId===this.id)}get activeTargetBlueprint(){return this.targetBlueprints.find(e=>e.language===this.selectedLanaguage)||null}get speakers(){return eA.getAll()}get duration(){return this.media.is_audio?Math.min(Math.max(...this.activeTracks.map(e=>e.endTimeOfLastClip))+(this.timelineElement?this.timelineWidth/this.pixelsPerSecond:0),this.maximumDurationOfProject):this.media.duration_secs}get maximumDurationOfProject(){return this.media.is_audio?Math.max(this.media.duration_secs,3600):this.media.duration_secs}get durationOfNewClipPlacement(){var e;return(null===(e=this.clipboard.data)||void 0===e?void 0:e.type)==l.Clip?this.clipboard.data.data.duration:this.defaultDurationOfNewClipPlacement}get defaultDurationOfNewClipPlacement(){return 40/this.pixelsPerSecond}get activeTrackForNewClipPlacement(){var e;return eM.getById(null===(e=this.placement)||void 0===e?void 0:e.trackId)}setNewClipPlacement(e){this.placement=e}placeNewClip(){var e;this.placement&&this.isNewClipPlacementValid&&(null===(e=this.clipboard.data)||void 0===e?void 0:e.type)==l.Clip?(this.activeTrackForNewClipPlacement.addClipByDuplicatingExisting(this.placement.startTime,this.clipboard.data.data),this.clipboard.setData(null)):this.placement&&this.isNewClipPlacementValid&&this.activeTrackForNewClipPlacement.addBlankClip(this.placement.startTime,this.durationOfNewClipPlacement)}get isNewClipPlacementValid(){var e;if(!this.placement)return!1;let t=this.placement.startTime,i=t+this.durationOfNewClipPlacement,s=eM.getById(this.placement.trackId);return!!(s&&((null===(e=this.clipboard.data)||void 0===e?void 0:e.type)!=l.Clip||s.isClipRightTypeForTrack(this.clipboard.data.data)))&&s.isRangeValidForPlacement(t,i).valid}get invalidPlacementReason(){var e;if(!this.placement)return null;let t=this.placement.startTime,i=t+this.durationOfNewClipPlacement,s=eM.getById(this.placement.trackId);return s?(null===(e=this.clipboard.data)||void 0===e?void 0:e.type)!=l.Clip||s.isClipRightTypeForTrack(this.clipboard.data.data)?s.isRangeValidForPlacement(t,i).reason:er.ag.t("This track is the wrong type for the clip you're trying to copy."):"Track not valid"}setTimelineElement(e){this.timelineElement=e,this.updateVisibleRange()}timeToPx(e){return e*this.pixelsPerSecond}pxToTime(e){return e/this.pixelsPerSecond}isAdditionalDubbedAudioStemComplete(e){return"dubbed"==e.status||"failed"==e.status||"imported"==e.status}get inprogressSpeakerStemImports(){return Object.values(this.additionalDubbedAudioStems).filter(e=>!e.dismissed)}mergeInTracksFromAnotherDub(e){(0,ec.hv)(this.dubbingId,e.id).then(t=>{t.ok?t.json().then(t=>{t.schema_version!==this.store.schemaVersion?e.error="Something went wrong, please try again.":(Object.values(t.speakers).forEach(t=>{e_.create({...t,project_id:this.id,name:"".concat(t.name," (").concat(e.name,")")})}),Object.values(t.source_tracks).forEach(e=>{let t=ez.create({...e,project_id:this.id,blueprint_id:this.sourceBlueprint.id});this.targetBlueprints.forEach(e=>{eX.create({id:(0,Q.Z)(),blueprint_id:e.id,speaker_id:t.speakerId,voice_specification:{mode:"clip-clone",voice_library_id:null,...ev}})})}),Object.values(t.source_clips).forEach(e=>{tt.create({...e,project_id:this.id}),this.targetBlueprints.forEach(e=>{})}),Object.values(t.source_utterances).forEach(e=>{let t=eT.create({...e,project_id:this.id,blueprint_id:this.sourceBlueprint.id});this.targetBlueprints.forEach(e=>{let i=tl.create({id:(0,Q.Z)(),media:null,media_offset:t.clip.startTime,media_duration:t.clip.duration,trim:{start:0,end:1},volume:0,start_pinned:!0,end_pinned:!0,audio_stale:!0,voice_specification:null});eD.create({id:(0,Q.Z)(),blueprint_id:e.id,source_id:t.id,speaker_id:t.speakerId,text:"",language:e.language,clip_id:i.id})})}),e.status="imported",e.dismissed=!0)}).catch(t=>{eo.toast.error("Failed to process extra speaker stem"),e.status="error",e.error="Something went wrong, please try again."}):(e.status="error",e.error="Something went wrong, please try again.")})}startPollingForAudioStemState(e){let t=this.additionalDubbedAudioStems[e];this.stopPollingForAudioStemState(e),this.checkStatusForAdditionalAudioStem(t),this.isAdditionalDubbedAudioStemComplete(t)||(this.pollingForAudioStemStateIntervalId[e]=setInterval(()=>this.checkStatusForAdditionalAudioStem(t),1e4))}stopPollingForAudioStemState(e){this.pollingForAudioStemStateIntervalId[e]&&(clearInterval(this.pollingForAudioStemStateIntervalId[e]),delete this.pollingForAudioStemStateIntervalId[e])}loadJSON(e){var t,i,s,a;this.dubbingId=e.dubbing_id,this.userId=e.user_id,this.media=e.media,this.previewMedia=e.preview_media,this.background=e.background,this.foreground=e.foreground,this.pronunciationDictionaries=null!==(i=null===(t=e.pronunciation_dictionaries)||void 0===t?void 0:t.map(e=>en.ij.fromAddDictionaryResponse(e)))&&void 0!==i?i:[],this.selectedLanaguage=null!==(s=e.selected_language)&&void 0!==s?s:null,this.selection.loadJSON(e.selection),this.additionalDubbedAudioStems=null!==(a=e.additional_dubbed_audio_stems)&&void 0!==a?a:{}}toJSON(){return{id:this.id,dubbing_id:this.dubbingId,user_id:this.userId,media:this.media,pronunciation_dictionaries:this.pronunciationDictionaries.map(e=>e.toAddDictionaryResponseModel()),preview_media:this.previewMedia,background:this.background,foreground:this.foreground,selected_language:this.selectedLanaguage,selection:this.selection.toJSON(),additional_dubbed_audio_stems:this.additionalDubbedAudioStems}}constructor(e){var t,i,s,a;super(e),(0,B._)(this,"dubbingId",void 0),(0,B._)(this,"userId",void 0),(0,B._)(this,"media",void 0),(0,B._)(this,"previewMedia",void 0),(0,B._)(this,"background",void 0),(0,B._)(this,"foreground",void 0),(0,B._)(this,"additionalDubbedAudioStems",void 0),(0,B._)(this,"activeUtterance",null),(0,B._)(this,"pixelsPerSecond",40),(0,B._)(this,"clock",new e2),(0,B._)(this,"mediaManager",void 0),(0,B._)(this,"selectedLanaguage",void 0),(0,B._)(this,"activeTrim",void 0),(0,B._)(this,"activeStretch",void 0),(0,B._)(this,"activeDrag",void 0),(0,B._)(this,"timelineElement",void 0),(0,B._)(this,"listeningMode",void 0),(0,B._)(this,"contextMenu",void 0),(0,B._)(this,"selection",void 0),(0,B._)(this,"clipboard",void 0),(0,B._)(this,"pronunciationDictionaries",void 0),(0,B._)(this,"mode",new G(this)),(0,B._)(this,"placement",void 0),(0,B._)(this,"modes",{AddMode:X,SelectMode:G,TrimMode:H}),(0,B._)(this,"loopRange",void 0),(0,B._)(this,"visibleRange",null),(0,B._)(this,"pollingForAudioStemStateIntervalId",{}),(0,B._)(this,"MIN_PIXELS_PER_SECOND",8),(0,B._)(this,"MAX_PIXELS_PER_SECOND",160),(0,B._)(this,"queryClient",null),(0,B._)(this,"updateVisibleRange",()=>{this.timelineElement&&(this.visibleRange={startTime:this.pxToTime(this.timelineElement.scrollLeft),endTime:this.pxToTime(this.timelineElement.scrollLeft+this.timelineWidth)})}),(0,B._)(this,"setPixelsPerSecond",e=>{this.pixelsPerSecond=M()(e,this.MIN_PIXELS_PER_SECOND,this.MAX_PIXELS_PER_SECOND),this.updateVisibleRange()}),(0,B._)(this,"createMultiClipVoice",new em(async e=>{let{name:t,clips:i}=e;i=i.filter(e=>!!e.media),await (0,ec.eG)({dubbing_id:this.dubbingId,clips:i.map(e=>e.toJSON())}).then(e=>{ex.create({id:(0,Q.Z)(),project_id:this.id,name:t,voice_id:e.voice_uid,clip_ids:i.map(e=>e.id),created_at:Date.now()}),this.store.history.commit()}),this.invalidateDubQuery()})),(0,B._)(this,"translateBlueprint",new em(e=>e.translateAll.execute())),(0,B._)(this,"checkStatusForAdditionalAudioStem",async e=>{this.isAdditionalDubbedAudioStemComplete(e)?("dubbed"==e.status&&this.mergeInTracksFromAnotherDub(e),this.stopPollingForAudioStemState(e.id)):((0,ec.A)({dubbing_id:this.dubbingId,nested_dubbing_id:e.id}).then(t=>{e.status=t.status,e.error=t.error}).catch(t=>{e.status="failed",e.error="Something went wrong, please try again."}),"dubbed"==e.status&&(this.mergeInTracksFromAnotherDub(e),this.stopPollingForAudioStemState(e.id)))}),this.dubbingId=e.dubbing_id,this.userId=e.user_id,this.media=e.media,this.previewMedia=e.preview_media,this.background=e.background,this.foreground=e.foreground,this.timelineElement=null,this.selectedLanaguage=null!==(i=e.selected_language)&&void 0!==i?i:null,this.additionalDubbedAudioStems=null!==(s=e.additional_dubbed_audio_stems)&&void 0!==s?s:{},this.activeTrim=null,this.activeDrag=null,this.contextMenu=null,this.queryClient=null,this.mediaManager=new e8(this.previewMedia),this.selection=new e3(e.selection,this.store),this.clipboard=new K(this),this.pronunciationDictionaries=null!==(a=null===(t=e.pronunciation_dictionaries)||void 0===t?void 0:t.map(e=>en.ij.fromAddDictionaryResponse(e)))&&void 0!==a?a:[],this.listeningMode="target",this.loopRange=null,this.clock.onTimeChange(()=>{let e=function(e,t,i){let s=0,a=e.length-1,r=null;for(;s<=a;){let n=Math.floor((s+a)/2),l=t(e[n]);if(l===i)return n;l<=i?(r=n,s=n+1):a=n-1}return r}(this.sourceBlueprint.utterances,e=>e.clip.startTime,this.clock.seconds);this.activeUtterance=null!==e?this.sourceBlueprint.utterances[e]:null}),this.clock.onSeek(()=>{this.mediaManager.video.currentTime=this.clock.seconds}),this.clock.onResume(()=>{this.mediaManager.video.play()}),this.clock.onPause(()=>{this.mediaManager.video.pause()}),this.clock.onTimeChange(()=>{this.clock.seconds>this.duration&&(this.clock.pause(),this.clock.seek(this.duration)),this.loopRange&&this.clock.playing&&(this.clock.seconds>this.loopRange.end||this.clock.seconds<this.loopRange.start)&&(this.clock.pause(),this.clock.seek(this.loopRange.start),this.clock.resume())}),(0,N.rC)(this,{pixelsPerSecond:N.LO.ref,activeUtterance:N.LO.ref,timelineElement:N.LO.ref,selectedLanaguage:N.LO.ref,activeDrag:N.LO.ref,activeTrim:N.LO.ref,activeStretch:N.LO.ref,listeningMode:N.LO.ref,contextMenu:N.LO.ref,visibleRange:N.LO.ref,mode:N.LO.ref,loopRange:N.LO.ref,additionalDubbedAudioStems:N.LO,pronunciationDictionaries:N.LO.ref,sourceBlueprint:N.Fl,targetBlueprints:N.Fl,activeTargetBlueprint:N.Fl,speakers:N.Fl,multiClipVoices:N.Fl,duration:(0,N.Fl)({keepAlive:!0}),maximumDurationOfProject:N.Fl,activeTracksHeight:N.Fl,setTimelineElement:N.aD,setSelectedLanguage:N.aD,addTargetBlueprint:N.aD,startTrim:N.aD,stopTrim:N.aD,startDrag:N.aD,stopDrag:N.aD,setPixelsPerSecond:N.aD,setListeningMode:N.aD,setContextMenu:N.aD,setLoopRange:N.aD,setMode:N.aD,updateVisibleRange:N.aD,addVoiceoverTrack:N.aD,placement:N.LO.ref,setNewClipPlacement:N.aD,isNewClipPlacementValid:N.Fl,invalidPlacementReason:N.Fl,inprogressSpeakerStemImports:N.Fl,startPollingForAudioStemState:N.aD,stopPollingForAudioStemState:N.aD}),(0,N.U5)(()=>{var e;return null===(e=this.selection.latest)||void 0===e?void 0:e.id},()=>{var e,t,i;this.selection.latest instanceof tt||this.selection.latest instanceof ts||this.selection.latest instanceof tr?this.activeUtterance=null!==(e=this.selection.latest.utterance)&&void 0!==e?e:null:this.selection.latest instanceof tn&&(this.activeUtterance=null!==(i=null===(t=this.selection.latest.utterance)||void 0===t?void 0:t.source)&&void 0!==i?i:null)}),(0,N.U5)(()=>this.pixelsPerSecond,()=>{var e;null===(e=this.timelineElement)||void 0===e||e.scrollTo({left:this.timeToPx(this.clock.seconds)-this.timelineWidth/2})})}}(0,B._)(e7,"collectionName","projects");let e9=(0,U.Z)("file:///app/src/app/(v1)/v1/dubbing/state/clips.ts");class te extends $(){get visible(){return!!this.project.visibleRange&&this.startTime<this.project.visibleRange.endTime+5&&this.endTime>this.project.visibleRange.startTime-5}applyClipboardData(e){}getClipboardData(e){return e===l.Clip?{type:l.Clip,data:this}:null}get media_with_fallback(){return this.media||{url:"data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAAAwAAAbAAqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV////////////////////////////////////////////AAAAAExhdmM1OC4xMwAAAAAAAAAAAAAAACQDkAAAAAAAAAGw9wrNaQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAAAAANIAAAAAExBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV/+MYxDsAAANIAAAAAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV/+MYxHYAAANIAAAAAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",duration_secs:10,content_type:"audio/mpeg"}}async toWav(){if(!this.media)throw Error("toWav not supported on clips without media");let e=this.trim.start*this.media.duration_secs,t=this.trim.end*this.media.duration_secs-e;return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=t||{};let i=e.numberOfChannels,s=e.sampleRate,a=t.float32?3:1;return function(e,t,i,s,a){let r=a/8,n=s*r,l=new ArrayBuffer(44+e.length*r),o=new DataView(l);return Z(o,0,"RIFF"),o.setUint32(4,36+e.length*r,!0),Z(o,8,"WAVE"),Z(o,12,"fmt "),o.setUint32(16,16,!0),o.setUint16(20,t,!0),o.setUint16(22,s,!0),o.setUint32(24,i,!0),o.setUint32(28,i*n,!0),o.setUint16(32,n,!0),o.setUint16(34,a,!0),Z(o,36,"data"),o.setUint32(40,e.length*r,!0),1===t?function(e,t,i){for(let s=0;s<i.length;s++,t+=2){let a=Math.max(-1,Math.min(1,i[s]));e.setInt16(t,a<0?32768*a:32767*a,!0)}}(o,44,e):function(e,t,i){for(let s=0;s<i.length;s++,t+=4)e.setFloat32(t,i[s],!0)}(o,44,e),l}(2===i?function(e,t){let i=e.length+t.length,s=new Float32Array(i),a=0,r=0;for(;a<i;)s[a++]=e[r],s[a++]=t[r],r++;return s}(e.getChannelData(0),e.getChannelData(1)):e.getChannelData(0),a,s,i,3===a?32:16)}((await z.B6(async i=>{let s=new z.J5().toDestination();await s.load(this.media.url),s.volume.setValueAtTime(this.volume,0),s.start(0,e,t)},t)).get())}get waveform(){if(!this.player.waveform)return null;{let e=this.project.pixelsPerSecond<25?4:this.project.pixelsPerSecond<35?2:1;return this.player.waveform.filter((t,i)=>i%e==0&&t.time+this.mediaOffset>this.startTime&&t.time+this.mediaOffset<this.endTime).map(e=>({time:e.time+this.mediaOffset-this.startTime,value:e.value}))}}get loading(){return this.player.loading}get duration(){return this.endTime-this.startTime}get speed(){return this.media_with_fallback.duration_secs/this.mediaDuration}get startTime(){return this.mediaOffset+this.trim.start*this.mediaDuration}get midTime(){return(this.startTime+this.endTime)/2}get endTime(){return this.mediaOffset+this.trim.end*this.mediaDuration}get isSelected(){return!!this.track&&this.track.blueprint.project.selection.has(this)}get index(){if(!this.track)throw Error("Cannot get index on a detached clip");return this.track.clips.findIndex(e=>e.id===this.id)}get trailingGap(){var e,t;if(!this.track)throw Error("Cannot get trailingGap on a detached clip");return(null!==(t=null===(e=this.next)||void 0===e?void 0:e.startTime)&&void 0!==t?t:this.track.blueprint.project.maximumDurationOfProject)-this.endTime}get leadingGap(){var e,t;if(!this.track)throw Error("Cannot get leadingGap on a detached clip");return this.startTime-(null!==(t=null===(e=this.prev)||void 0===e?void 0:e.endTime)&&void 0!==t?t:0)}get isTrimmed(){return 0!=this.trim.start||1!=this.trim.end}intersects(e){return this.startTime<e.endTime-1e-5&&this.endTime>e.startTime+1e-5}startIntersects(e){return this.startTime>e.startTime&&this.startTime<e.endTime}endIntersects(e){return this.endTime>e.startTime&&this.endTime<e.endTime}stdValueToSeconds(e){return e*this.mediaDuration}secondsToStdValue(e){return e/this.mediaDuration}setMedia(e){this.media=e}trimStartTo(e){var t,i;let{minDuration:s=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.track)throw Error("Cannot trim a detached clip");let a=Math.max(e,null!==(i=null===(t=this.prev)||void 0===t?void 0:t.endTime)&&void 0!==i?i:0,0);this.trim.start=M()(this.secondsToStdValue(a-this.mediaOffset),0,this.trim.end-this.secondsToStdValue(s))}trimEndTo(e){var t,i,s,a;let{minDuration:r=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.track)throw Error("Cannot trim a detached clip");let n=Math.min(e,null!==(a=null===(t=this.next)||void 0===t?void 0:t.startTime)&&void 0!==a?a:null===(i=this.track)||void 0===i?void 0:i.blueprint.project.maximumDurationOfProject,null===(s=this.track)||void 0===s?void 0:s.blueprint.project.maximumDurationOfProject);this.trim.end=M()(this.secondsToStdValue(n-this.mediaOffset),this.trim.start+this.secondsToStdValue(r),1)}stretchStartTo(e){var t,i;let{minDuration:s=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.track)throw Error("Cannot stretch a detached clip");let a=M()(e,null!==(i=null===(t=this.prev)||void 0===t?void 0:t.endTime)&&void 0!==i?i:0,this.endTime-s),r=this.endTime-a;this.mediaDuration,this.mediaDuration=r/(this.trim.end-this.trim.start),this.moveStartTo(e)}stretchEndTo(e){var t,i,s;let{minDuration:a=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.track)throw Error("Cannot stretch a detached clip");let r=M()(e,this.startTime+a,null!==(s=null===(t=this.next)||void 0===t?void 0:t.startTime)&&void 0!==s?s:null===(i=this.track)||void 0===i?void 0:i.blueprint.project.maximumDurationOfProject);this.mediaDuration;let n=r-this.startTime;this.mediaDuration=n/(this.trim.end-this.trim.start),this.moveStartTo(e-n)}moveStartTo(e){var t;if(!this.track)throw Error("Cannot move a detached clip");let i=M()(e-this.trim.start*this.mediaDuration,-this.trim.start*this.mediaDuration,(null===(t=this.track)||void 0===t?void 0:t.blueprint.project.maximumDurationOfProject)-this.duration),s=this.prev,a=this.next;this.mediaOffset=i,s&&this.startTime<s.endTime?this.mediaOffset=s.endTime-this.trim.start*this.mediaDuration:a&&this.endTime>a.startTime&&(this.mediaOffset=a.startTime-this.trim.start*this.mediaDuration-this.duration)}get canMergeNext(){var e,t;return this.next&&1e-4>Math.abs(this.next.startTime-this.endTime)&&(null===(e=this.next.media)||void 0===e?void 0:e.url)===(null===(t=this.media)||void 0===t?void 0:t.url)}mergeNext(){if(!this.next||!this.canMergeNext)return;let e=this.endTime+this.next.duration;this.next.delete(),this.trimEndTo(e)}setVolume(e){this.volume=e}get shouldPlay(){return!this.isDeleted&&this.track&&!this.track.isMuted}get isBeingDragged(){var e;return null===(e=this.project.activeDrag)||void 0===e?void 0:e.clipsAndTheirInitialStartTimes.some(e=>e.clip.id===this.id)}loadJSON(e){var t,i,s;super.loadJSON(e),this.media=e.media,this.mediaOffset=e.media_offset,this.mediaDuration=null!==(i=e.media_duration)&&void 0!==i?i:null===(t=this.media)||void 0===t?void 0:t.duration_secs,this.trim=e.trim,this.volume=null!==(s=e.volume)&&void 0!==s?s:0}toJSON(){return{...super.toJSON(),media:this.media,media_offset:this.mediaOffset,media_duration:this.mediaDuration,trim:this.trim,volume:this.volume}}constructor(e){super(e),(0,B._)(this,"clipTypeCanBeCopied",!1),(0,B._)(this,"clipTypeCanBeGeneratedUsingSTS",!1),(0,B._)(this,"clipTypeCanBeGenerated",!1),(0,B._)(this,"clipTypeCanBeDragged",!1),(0,B._)(this,"media",void 0),(0,B._)(this,"mediaOffset",void 0),(0,B._)(this,"mediaDuration",void 0),(0,B._)(this,"volume",void 0),(0,B._)(this,"trim",void 0),(0,B._)(this,"player",void 0),(0,B._)(this,"project",void 0),this.loadJSON(e),this.player=new ea(this.media_with_fallback.url),this.project=e7.getAll()[0],(0,N.rC)(this,{media:N.LO.ref,mediaOffset:N.LO.ref,mediaDuration:N.LO.ref,volume:N.LO.ref,trim:N.LO,loading:N.Fl,isSelected:N.Fl,isTrimmed:N.Fl,index:N.Fl,next:N.Fl,prev:N.Fl,waveform:(0,N.Fl)({keepAlive:!0}),visible:(0,N.Fl)({keepAlive:!0}),startTime:N.Fl,endTime:N.Fl,canMergeNext:N.Fl,isBeingDragged:N.Fl,setMedia:N.aD,trimStartTo:N.aD,trimEndTo:N.aD,stretchStartTo:N.aD,stretchEndTo:N.aD,moveStartTo:N.aD,split:N.aD,mergeNext:N.aD,setVolume:N.aD}),(0,N.U5)(()=>this.media_with_fallback.url,()=>{this.player.load(this.media_with_fallback.url)},{fireImmediately:!1}),(0,N.EH)(()=>{this.player._player.volume.setValueAtTime(this.volume,z.zO())}),(0,N.EH)(()=>{this.player.setSpeed(this.media_with_fallback.duration_secs/this.mediaDuration)})}}class tt extends te{cleanup(){for(let e of this.cleanupFunctions)e();this.cleanupFunctions=[],null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}get color(){var e;return(null===(e=this.utterance)||void 0===e?void 0:e.speaker.color)||"blue"}get next(){if(!this.track)throw Error("Cannot get index on a detached clip");return -1===this.index?null:this.track.clips[this.index+1]||null}get prev(){if(!this.track)throw Error("Cannot get index on a detached clip");return -1===this.index?null:this.track.clips[this.index-1]||null}get track(){var e,t;return null!==(t=null===(e=this.utterance)||void 0===e?void 0:e.track)&&void 0!==t?t:null}get utterance(){return eT.getAll().find(e=>e.clipId===this.id)}trimStartTo(e){var t,i;let{minDuration:s=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super.trimStartTo(e,{minDuration:s}),null===(t=this.utterance)||void 0===t||t.voice.setStale(!0),null===(i=this.utterance)||void 0===i||i.targets.forEach(e=>{e.clip.startPinned&&(e.clip.stretchStartTo(this.startTime,{minDuration:s}),e.clip.setAudioStale(!0))})}trimEndTo(e){var t,i;let{minDuration:s=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super.trimEndTo(e,{minDuration:s}),null===(t=this.utterance)||void 0===t||t.voice.setStale(!0),null===(i=this.utterance)||void 0===i||i.targets.forEach(e=>{e.clip.endPinned&&(e.clip.stretchEndTo(this.endTime,{minDuration:s}),e.clip.setAudioStale(!0))})}moveStartTo(e){var t,i;super.moveStartTo(e),null===(t=this.utterance)||void 0===t||t.voice.setStale(!0),null===(i=this.utterance)||void 0===i||i.targets.forEach(t=>{t.clip.startPinned&&(t.clip.moveStartTo(e),t.clip.setAudioStale(!0))})}split(e){if(!this.utterance)throw Error("Cannot split a detached clip");this.utterance.split(e)}mergeNext(){this.next&&this.canMergeNext&&this.utterance.merge(this.next.utterance)}delete(){var e;null===(e=this.utterance)||void 0===e||e.delete(),this.deletedAt=Date.now()}constructor(e){super(e),(0,B._)(this,"timeoutId",null),(0,B._)(this,"cleanupFunctions",[]),(0,N.rC)(this,{utterance:(0,N.Fl)({keepAlive:!0})}),this.timeoutId=setTimeout(()=>{var e;let t=null===(e=this.track)||void 0===e?void 0:e.blueprint.project.clock;if(!t)return;let i=t.onTick(()=>{this.shouldPlay&&this.player.loaded&&t.seconds>=this.startTime&&t.seconds<=this.endTime?"started"!==this.player.state&&this.player.start(t.seconds-this.mediaOffset,this.endTime-t.seconds):this.player.stop()}),s=t.onPause(()=>{this.player.stop()});this.cleanupFunctions.push(i,s)},0)}}(0,B._)(tt,"collectionName","source_clips");class ti extends te{get color(){var e;return(null===(e=this.utterance)||void 0===e?void 0:e.speaker.color)||"blue"}get track(){var e,t;return null!==(t=null===(e=this.utterance)||void 0===e?void 0:e.track)&&void 0!==t?t:null}get next(){if(!this.track)throw Error("Cannot get index on a detached clip");return -1===this.index?null:this.track.clips[this.index+1]||null}get prev(){if(!this.track)throw Error("Cannot get index on a detached clip");return -1===this.index?null:this.track.clips[this.index-1]||null}get voiceSpecificationWithFallback(){return this.voiceSpecification||this.track.voiceSpecification}applyClipboardData(e){if(e&&e.type===l.Voice){let t=R()(e.data);this.setVoiceSpecification(t)}}getClipboardData(e){return e===l.Voice?{type:l.Voice,data:this.voiceSpecification}:super.getClipboardData(e)}mergeNext(){super.mergeNext(),this.history=[]}cleanup(){for(let e of this.cleanupFunctions)e();this.cleanupFunctions=[],null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}setVoiceSpecification(e){if((null==e?void 0:e.mode)!="voice-library")throw e9.error("Invalid voice specification"),Error("Invalid voice specification");this.voiceSpecification=e,this.setAudioStale(!0)}setAudioStale(e){this.audioStale=e}split(e){this.history=[]}delete(){this.deletedAt=Date.now()}toHistoryClip(){return{id:this.id,media:this.media,media_duration:this.mediaDuration,media_offset:this.mediaOffset,generation_time:this.generationTime,trim:this.trim,voice_specification:this.voiceSpecification}}updateHistoryForCurrentClip(){let e=this.history.findIndex(e=>e.generation_time==this.generationTime);e<0||(this.history[e]=this.toHistoryClip())}revertToClipFromHistory(e){var t,i,s,a;if(this.updateHistoryForCurrentClip(),this.media=e.media,this.voiceSpecification=e.voice_specification,this.trim=e.trim,this.generationTime=e.generation_time,this.mediaDuration=e.media_duration,!this.track)throw Error("Cannot revert history on a detached clip");(this.endTime>(null===(t=this.track)||void 0===t?void 0:t.blueprint.project.maximumDurationOfProject)||this.next&&this.intersects(this.next))&&this.moveStartTo(null!==(a=null===(i=this.next)||void 0===i?void 0:i.startTime)&&void 0!==a?a:(null===(s=this.track)||void 0===s?void 0:s.blueprint.project.maximumDurationOfProject)-this.duration)}loadJSON(e){var t,i,s,a;super.loadJSON(e),this.audioStale=null!==(t=e.audio_stale)&&void 0!==t&&t,this.voiceSpecification=null!==(i=e.voice_specification)&&void 0!==i?i:null,this.history=null!==(s=e.history)&&void 0!==s?s:[],this.generationTime=null!==(a=e.generation_time)&&void 0!==a?a:(0,J.K9)()}toJSON(){return{...super.toJSON(),audio_stale:this.audioStale,voice_specification:this.voiceSpecification,history:this.history,generation_time:this.generationTime}}constructor(e){super(e),(0,B._)(this,"clipTypeCanBeGeneratedUsingSTS",!0),(0,B._)(this,"clipTypeCanBeGenerated",!0),(0,B._)(this,"clipTypeCanBeDragged",!0),(0,B._)(this,"timeoutId",null),(0,B._)(this,"cleanupFunctions",[]),(0,B._)(this,"audioStale",void 0),(0,B._)(this,"history",void 0),(0,B._)(this,"voiceSpecification",void 0),(0,B._)(this,"generationTime",void 0),this.loadJSON(e),(0,N.rC)(this,{audioStale:N.LO.ref,voiceSpecification:N.LO,utterance:(0,N.Fl)({keepAlive:!0}),setAudioStale:N.aD,setVoiceSpecification:N.aD}),this.timeoutId=setTimeout(()=>{var e;let t=null===(e=this.track)||void 0===e?void 0:e.blueprint.project.clock;if(!t)return;let i=t.onTick(()=>{this.shouldPlay&&this.player.loaded&&t.seconds>=this.startTime&&t.seconds<=this.endTime?"started"!==this.player.state&&this.player.start(t.seconds-this.mediaOffset,this.endTime-t.seconds):this.player.stop()}),s=t.onPause(()=>{this.player.stop()});this.cleanupFunctions.push(i,s)},0)}}class ts extends ti{cleanup(){for(let e of this._cleanupFunctions)e();this._cleanupFunctions=[],null!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null)}get activeVoiceId(){if(!this.utterance)throw Error("Cannot get activeVoiceId on a detached clip");if("track-clone"===this.voiceSpecificationWithFallback.mode||"clip-clone"===this.voiceSpecificationWithFallback.mode)throw e9.error("Invalid voice"),Error("Inalid Voice mode for source track");return this.voiceSpecificationWithFallback.voice_library_id}get color(){var e;return(null===(e=this.utterance)||void 0===e?void 0:e.speaker.color)||"blue"}get next(){if(!this.track)throw Error("Cannot get index on a detached clip");return -1===this.index?null:this.track.clips[this.index+1]||null}get prev(){if(!this.track)throw Error("Cannot get index on a detached clip");return -1===this.index?null:this.track.clips[this.index-1]||null}get track(){var e,t;return null!==(t=null===(e=this.utterance)||void 0===e?void 0:e.track)&&void 0!==t?t:null}get utterance(){return eI.getAll().find(e=>e.clipId===this.id)}trimStartTo(e){var t;let{minDuration:i=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super.trimStartTo(e,{minDuration:i}),null===(t=this.utterance)||void 0===t||t.targets.forEach(e=>{e.clip.startPinned&&(e.clip.stretchStartTo(this.startTime,{minDuration:i}),e.clip.setAudioStale(!0))})}trimEndTo(e){var t;let{minDuration:i=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super.trimEndTo(e,{minDuration:i}),null===(t=this.utterance)||void 0===t||t.targets.forEach(e=>{e.clip.endPinned&&(e.clip.stretchEndTo(this.endTime,{minDuration:i}),e.clip.setAudioStale(!0))})}moveStartTo(e){var t;super.moveStartTo(e),null===(t=this.utterance)||void 0===t||t.targets.forEach(t=>{t.clip.startPinned&&t.clip.moveStartTo(e)})}split(e){if(!this.utterance)throw Error("Cannot split a detached clip");this.utterance.split(e)}mergeNext(){this.next&&this.canMergeNext&&this.utterance.merge(this.next.utterance)}delete(){var e;null===(e=this.utterance)||void 0===e||e.delete(),this.deletedAt=Date.now()}constructor(e){super(e),(0,B._)(this,"_timeoutId",null),(0,B._)(this,"_cleanupFunctions",[]),(0,B._)(this,"clipTypeCanBeCopied",!0),this._timeoutId=setTimeout(()=>{var e;let t=null===(e=this.track)||void 0===e?void 0:e.blueprint.project.clock;if(!t)return;let i=t.onTick(()=>{this.shouldPlay&&this.player.loaded&&t.seconds>=this.startTime&&t.seconds<=this.endTime?"started"!==this.player.state&&this.player.start(t.seconds-this.mediaOffset,this.endTime-t.seconds):this.player.stop()}),s=t.onPause(()=>{this.player.stop()});this._cleanupFunctions.push(i,s)},0)}}(0,B._)(ts,"collectionName","narration_source_clips");class ta extends te{get color(){var e;return(null===(e=this.utterance)||void 0===e?void 0:e.speaker.color)||"blue"}get track(){var e,t;return null!==(t=null===(e=this.utterance)||void 0===e?void 0:e.track)&&void 0!==t?t:null}get next(){if(!this.track)throw Error("Cannot get index on a detached clip");return -1===this.index?null:this.track.clips[this.index+1]||null}get prev(){if(!this.track)throw Error("Cannot get index on a detached clip");return -1===this.index?null:this.track.clips[this.index-1]||null}mergeNext(){super.mergeNext(),this.history=[]}cleanup(){for(let e of this.cleanupFunctions)e();this.cleanupFunctions=[],null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}setAudioStale(e){this.audioStale=e}split(e){this.history=[]}delete(){this.deletedAt=Date.now()}toHistoryClip(){return{id:this.id,media:this.media,media_duration:this.mediaDuration,media_offset:this.mediaOffset,generation_time:this.generationTime,trim:this.trim}}updateHistoryForCurrentClip(){let e=this.history.findIndex(e=>e.generation_time==this.generationTime);e<0||(this.history[e]=this.toHistoryClip())}revertToClipFromHistory(e){var t,i,s,a;if(this.updateHistoryForCurrentClip(),this.media=e.media,this.trim=e.trim,this.generationTime=e.generation_time,this.mediaDuration=e.media_duration,!this.track)throw Error("Cannot revert history on a detached clip");(this.endTime>(null===(t=this.track)||void 0===t?void 0:t.blueprint.project.maximumDurationOfProject)||this.next&&this.intersects(this.next))&&this.moveStartTo(null!==(a=null===(i=this.next)||void 0===i?void 0:i.startTime)&&void 0!==a?a:(null===(s=this.track)||void 0===s?void 0:s.blueprint.project.maximumDurationOfProject)-this.duration)}loadJSON(e){var t,i,s;super.loadJSON(e),this.audioStale=null!==(t=e.audio_stale)&&void 0!==t&&t,this.history=null!==(i=e.history)&&void 0!==i?i:[],this.generationTime=null!==(s=e.generation_time)&&void 0!==s?s:(0,J.K9)()}toJSON(){return{...super.toJSON(),audio_stale:this.audioStale,history:this.history,generation_time:this.generationTime}}constructor(e){super(e),(0,B._)(this,"clipTypeCanBeGenerated",!0),(0,B._)(this,"clipTypeCanBeDragged",!0),(0,B._)(this,"timeoutId",null),(0,B._)(this,"cleanupFunctions",[]),(0,B._)(this,"audioStale",void 0),(0,B._)(this,"history",void 0),(0,B._)(this,"generationTime",void 0),this.loadJSON(e),(0,N.rC)(this,{audioStale:N.LO.ref,utterance:(0,N.Fl)({keepAlive:!0}),setAudioStale:N.aD}),this.timeoutId=setTimeout(()=>{var e;let t=null===(e=this.track)||void 0===e?void 0:e.blueprint.project.clock;if(!t)return;let i=t.onTick(()=>{this.shouldPlay&&this.player.loaded&&t.seconds>=this.startTime&&t.seconds<=this.endTime?"started"!==this.player.state&&this.player.start(t.seconds-this.mediaOffset,this.endTime-t.seconds):this.player.stop()}),s=t.onPause(()=>{this.player.stop()});this.cleanupFunctions.push(i,s)},0)}}class tr extends ta{cleanup(){for(let e of this.cleanupFunctions)e();this.cleanupFunctions=[],null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}get color(){var e;return(null===(e=this.utterance)||void 0===e?void 0:e.speaker.color)||"blue"}get next(){if(!this.track)throw Error("Cannot get index on a detached clip");return -1===this.index?null:this.track.clips[this.index+1]||null}get prev(){if(!this.track)throw Error("Cannot get index on a detached clip");return -1===this.index?null:this.track.clips[this.index-1]||null}get track(){var e,t;return null!==(t=null===(e=this.utterance)||void 0===e?void 0:e.track)&&void 0!==t?t:null}get utterance(){return eV.getAll().find(e=>e.clipId===this.id)}trimStartTo(e){var t;let{minDuration:i=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super.trimStartTo(e,{minDuration:i}),null===(t=this.utterance)||void 0===t||t.targets.forEach(e=>{e.clip.startPinned&&(e.clip.stretchStartTo(this.startTime,{minDuration:i}),e.clip.setAudioStale(!0))})}trimEndTo(e){var t;let{minDuration:i=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super.trimEndTo(e,{minDuration:i}),null===(t=this.utterance)||void 0===t||t.targets.forEach(e=>{e.clip.endPinned&&(e.clip.stretchEndTo(this.endTime,{minDuration:i}),e.clip.setAudioStale(!0))})}moveStartTo(e){var t;super.moveStartTo(e),null===(t=this.utterance)||void 0===t||t.targets.forEach(t=>{t.clip.startPinned&&t.clip.moveStartTo(e)})}split(e){if(!this.utterance)throw Error("Cannot split a detached clip");this.utterance.split(e)}mergeNext(){this.next&&this.canMergeNext&&this.utterance.merge(this.next.utterance)}delete(){var e;null===(e=this.utterance)||void 0===e||e.delete(),this.deletedAt=Date.now()}constructor(e){super(e),(0,B._)(this,"timeoutId",null),(0,B._)(this,"cleanupFunctions",[]),(0,B._)(this,"clipTypeCanBeCopied",!0),this.timeoutId=setTimeout(()=>{var e;let t=null===(e=this.track)||void 0===e?void 0:e.blueprint.project.clock;if(!t)return;let i=t.onTick(()=>{this.shouldPlay&&this.player.loaded&&t.seconds>=this.startTime&&t.seconds<=this.endTime?"started"!==this.player.state&&this.player.start(t.seconds-this.mediaOffset,this.endTime-t.seconds):this.player.stop()}),s=t.onPause(()=>{this.player.stop()});this.cleanupFunctions.push(i,s)},0)}}(0,B._)(tr,"collectionName","sfx_source_clips");class tn extends ti{get utterance(){return eE.getAll().find(e=>e.clipId===this.id)}get activeVoiceId(){if(!this.utterance)throw Error("Cannot get activeVoiceId on a detached clip");return this.voiceSpecificationWithFallback.voice_library_id}setVoiceSpecification(e){this.voiceSpecification=e,this.setAudioStale(!0)}setStartPinned(e){var t;this.startPinned=e,e&&(null===(t=this.utterance)||void 0===t?void 0:t.source.clip)&&this.stretchStartTo(this.utterance.source.clip.startTime,{minDuration:.5})}setEndPinned(e){var t;this.endPinned=e,e&&(null===(t=this.utterance)||void 0===t?void 0:t.source.clip)&&this.stretchEndTo(this.utterance.source.clip.endTime,{minDuration:.5})}loadJSON(e){var t,i;super.loadJSON(e),this.startPinned=null===(t=e.start_pinned)||void 0===t||t,this.endPinned=null===(i=e.end_pinned)||void 0===i||i}toJSON(){return{...super.toJSON(),start_pinned:this.startPinned,end_pinned:this.endPinned}}constructor(e){super(e),(0,B._)(this,"startPinned",void 0),(0,B._)(this,"endPinned",void 0),this.loadJSON(e),(0,N.rC)(this,{startPinned:N.LO.ref,endPinned:N.LO.ref,setStartPinned:N.aD,setEndPinned:N.aD})}}class tl extends tn{get activeVoiceId(){if(!this.utterance)throw Error("Cannot get activeVoiceId on a detached clip");return"track-clone"===this.voiceSpecificationWithFallback.mode?this.utterance.speaker.voice.id:"clip-clone"===this.voiceSpecificationWithFallback.mode?this.utterance.source.voice.id:this.voiceSpecificationWithFallback.voice_library_id}}(0,B._)(tl,"collectionName","target_clips");class to extends ta{get utterance(){return eO.getAll().find(e=>e.clipId===this.id)}setStartPinned(e){var t;this.startPinned=e,e&&(null===(t=this.utterance)||void 0===t?void 0:t.source.clip)&&this.stretchStartTo(this.utterance.source.clip.startTime,{minDuration:.5})}setEndPinned(e){var t;this.endPinned=e,e&&(null===(t=this.utterance)||void 0===t?void 0:t.source.clip)&&this.stretchEndTo(this.utterance.source.clip.endTime,{minDuration:.5})}loadJSON(e){var t,i;super.loadJSON(e),this.startPinned=null===(t=e.start_pinned)||void 0===t||t,this.endPinned=null===(i=e.end_pinned)||void 0===i||i}toJSON(){return{...super.toJSON(),start_pinned:this.startPinned,end_pinned:this.endPinned}}constructor(e){super(e),(0,B._)(this,"startPinned",void 0),(0,B._)(this,"endPinned",void 0),this.loadJSON(e),(0,N.rC)(this,{startPinned:N.LO.ref,endPinned:N.LO.ref,setStartPinned:N.aD,setEndPinned:N.aD})}}(0,B._)(to,"collectionName","sfx_target_clips");class tc extends tn{}(0,B._)(tc,"collectionName","narration_target_clips");class td extends te{cleanup(){for(let e of this.cleanupFunctions)e();this.cleanupFunctions=[],null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}get color(){return"blue"}get track(){return eK.getById(this.trackId)}get next(){if(!this.track)throw Error("Cannot get index on a detached clip");return -1===this.index?null:this.track.clips[this.index+1]||null}get prev(){if(!this.track)throw Error("Cannot get index on a detached clip");return -1===this.index?null:this.track.clips[this.index-1]||null}split(e){let t=this.endTime;this.trimEndTo(e);let i=this.clone();i.trimStartTo(e),i.trimEndTo(t)}delete(){this.deletedAt=Date.now()}loadJSON(e){super.loadJSON(e),this.trackId=e.track_id}toJSON(){return{...super.toJSON(),track_id:this.trackId}}constructor(e){super(e),(0,B._)(this,"timeoutId",null),(0,B._)(this,"cleanupFunctions",[]),(0,B._)(this,"trackId",void 0),this.loadJSON(e),(0,N.rC)(this,{}),this.timeoutId=setTimeout(()=>{var e;let t=null===(e=this.track)||void 0===e?void 0:e.blueprint.project.clock;if(!t)return;let i=t.onTick(()=>{this.shouldPlay&&this.player.loaded&&t.seconds>=this.startTime&&t.seconds<=this.endTime?"started"!==this.player.state&&this.player.start(t.seconds-this.mediaOffset,this.endTime-t.seconds):this.player.stop()}),s=t.onPause(()=>{this.player.stop()});this.cleanupFunctions.push(i,s)},0)}}(0,B._)(td,"collectionName","background_clips");class tu extends te{cleanup(){for(let e of this.cleanupFunctions)e();this.cleanupFunctions=[],null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}get color(){return"purple"}get track(){return eQ.getById(this.trackId)}get next(){if(!this.track)throw Error("Cannot get index on a detached clip");return -1===this.index?null:this.track.clips[this.index+1]||null}get prev(){if(!this.track)throw Error("Cannot get index on a detached clip");return -1===this.index?null:this.track.clips[this.index-1]||null}split(e){let t=this.endTime;this.trimEndTo(e);let i=this.clone();i.trimStartTo(e),i.trimEndTo(t)}delete(){this.deletedAt=Date.now()}loadJSON(e){super.loadJSON(e),this.trackId=e.track_id}toJSON(){return{...super.toJSON(),track_id:this.trackId}}constructor(e){super(e),(0,B._)(this,"timeoutId",null),(0,B._)(this,"cleanupFunctions",[]),(0,B._)(this,"trackId",void 0),this.loadJSON(e),(0,N.rC)(this,{}),this.timeoutId=setTimeout(()=>{var e;let t=null===(e=this.track)||void 0===e?void 0:e.blueprint.project.clock;if(!t)return;let i=t.onTick(()=>{this.shouldPlay&&this.player.loaded&&t.seconds>=this.startTime&&t.seconds<=this.endTime?"started"!==this.player.state&&this.player.start(t.seconds-this.mediaOffset,this.endTime-t.seconds):this.player.stop()}),s=t.onPause(()=>{this.player.stop()});this.cleanupFunctions.push(i,s)},0)}}(0,B._)(tu,"collectionName","foreground_clips");class th extends te{cleanup(){for(let e of this.cleanupFunctions)e();this.cleanupFunctions=[],null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}get color(){return"purple"}get track(){return eq.getById(this.trackId)}setTrackId(e){this.trackId=e}get next(){if(!this.track)throw Error("Cannot get index on a detached clip");return -1===this.index?null:this.track.clips[this.index+1]||null}get prev(){if(!this.track)throw Error("Cannot get index on a detached clip");return -1===this.index?null:this.track.clips[this.index-1]||null}split(e){let t=this.endTime;this.trimEndTo(e);let i=this.clone();i.trimStartTo(e),i.trimEndTo(t)}delete(){this.deletedAt=Date.now()}loadJSON(e){super.loadJSON(e),this.trackId=e.track_id,this.importedFilename=e.imported_file_name}toJSON(){return{...super.toJSON(),track_id:this.trackId,imported_file_name:this.importedFilename}}constructor(e){super(e),(0,B._)(this,"timeoutId",null),(0,B._)(this,"cleanupFunctions",[]),(0,B._)(this,"clipTypeCanBeCopied",!0),(0,B._)(this,"clipTypeCanBeDragged",!0),(0,B._)(this,"trackId",void 0),(0,B._)(this,"importedFilename",void 0),this.loadJSON(e),(0,N.rC)(this,{trackId:N.LO.ref}),this.timeoutId=setTimeout(()=>{var e;let t=null===(e=this.track)||void 0===e?void 0:e.blueprint.project.clock;if(!t)return;let i=t.onTick(()=>{this.shouldPlay&&this.player.loaded&&t.seconds>=this.startTime&&t.seconds<=this.endTime?"started"!==this.player.state&&this.player.start(t.seconds-this.mediaOffset,this.endTime-t.seconds):this.player.stop()}),s=t.onPause(()=>{this.player.stop()});this.cleanupFunctions.push(i,s)},0)}}(0,B._)(th,"collectionName","imported_audio_clips");var tp=i(88632),tm=i(65778),tv=i(5442),tg=i(12874),tf=i(3409),tx=i(80689),tb=i(83428),tA=i(71609),ty=i(50267),tj=i(4735),t_=i(23942),tk=i(26397);let tS=(0,U.Z)("file:///app/src/app/(v1)/v1/dubbing/AddPronunciationDictionaryDialog.tsx"),tw=(0,T.Pi)(e=>{var t;let{isOpen:i,onClose:s}=e,{i18n:a}=(0,g.mV)(),[r,n]=(0,E.useState)(null),l=a9(),o=async e=>{let t=e.item(0);if(!t){tS.error("Can't find input file");return}n(t),await (0,en.GU)({inputFile:t,name:t.name,onSuccess:e=>{l.setPronunciationDictionary(e)},onError:e=>{eo.toast.error(e)}}),n(null)},c=e=>async()=>{try{await (0,en.S9)(e)}catch(e){if(!(e instanceof Error)){tS.error("Unknown error type",e);return}eo.toast.error(e.message)}},d=e=>()=>{l.removePronunciationDictionary(e)};return(0,u.jsx)(t_.V,{open:i,size:"md",title:a.t("Add Pronunciation Dictionary"),content:(0,u.jsxs)("div",{className:"max-h-96 overflow-y-auto overflow-x-visible -mt-2 space-y-4",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)(tk.default,{className:"pb-2",children:(0,u.jsx)(g.cC,{id:"YjcvHH"})}),(0,u.jsx)(tk.default,{children:(0,u.jsx)(g.cC,{id:"YUcBL0",components:{0:(0,u.jsx)("b",{}),1:(0,u.jsx)("b",{})}})})]}),(null!==(t=l.pronunciationDictionaries)&&void 0!==t?t:[]).map(e=>(0,u.jsxs)("div",{className:"w-full flex justify-between items-center align-middle gap-2 px-1",children:[(0,u.jsx)(tk.default,{className:"italic",truncate:!0,children:e.name}),(0,u.jsxs)("div",{className:"space-x-2",children:[(0,u.jsxs)(tj.Button,{className:"rounded",size:"sm",onClick:c(e),children:[(0,u.jsx)(tx.Z,{className:"mr-2 h-4 w-4"}),(0,u.jsx)(g.cC,{id:"GS+Mus"})]}),(0,u.jsxs)(tj.Button,{className:"rounded",size:"sm",onClick:d(e),children:[(0,u.jsx)(tb.Z,{className:"mr-2 h-4 w-4"}),(0,u.jsx)(g.cC,{id:"t/YqKh"})]})]})]},e.id)),(0,u.jsx)(()=>(0,u.jsx)(ty.Z,{disabled:null!=r,accept:".txt,.pls,.xml,audio/x-scpls,text/plain,text/xml",onChange:o,fileSizeLimit:1572864,children:null===r?(0,u.jsxs)("div",{children:[(0,u.jsx)(tf.Z,{className:"mx-auto h-12 w-12 text-gray-500"}),(0,u.jsx)("div",{className:"flex text-sm text-gray-600",children:(0,u.jsx)(tk.default,{className:"relative cursor-pointer rounded-md font-medium text-gray-800 focus-within:outline-none",noBaseClass:!0,variant:"div",children:l.pronunciationDictionaries.length?(0,u.jsx)(g.cC,{id:"0iuPRN"}):(0,u.jsx)(g.cC,{id:"YLKvOz"})})}),(0,u.jsx)(tk.default,{className:"text-xs text-gray-500 text-center",noBaseClass:!0,variant:"p",children:(0,u.jsx)(g.cC,{id:"z2OgM9",values:{PLS_FILE_LIMIT_IN_MB:1.5}})})]}):(0,u.jsxs)(tA.m,{className:"mt-2",children:[(0,u.jsx)(tk.default,{className:"text-xs text-gray-500 text-center",noBaseClass:!0,variant:"p",children:(0,u.jsx)(g.cC,{id:"GxkJXS"})}),(0,u.jsx)(tA.K,{fileName:r.name,size:r.size})]})}),{})]}),closeModal:s,zIndex:"z-[200]"})}),tC=(0,E.createContext)(null),tN=e=>{let{children:t}=e,[i]=(0,E.useState)(()=>new et({schemaVersion:9,models:[e7,e$,eA,e_,ey,ej,e0,e1,eC,eP,eE,eN,eT,eI,eV,eD,eB,eO,eM,eR,eK,eQ,eq,ez,eU,eJ,eZ,eW,eX,eG,eH,te,ta,td,tu,th,tt,ti,ts,tr,tn,tl,tc,to,ex]}));return(0,u.jsx)(tC.Provider,{value:i,children:t})},tT=()=>{let e=(0,E.useContext)(tC);if(!e)throw Error("Cannot call useProjectStore outside of ProjectStoreProvider");return e},tI=(0,U.Z)("file:///app/src/app/(v1)/v1/dubbing/ImportScriptDialog.tsx"),tV=(0,T.Pi)(e=>{let{isOpen:t,onClose:i}=e,{i18n:s}=(0,g.mV)(),[a,r]=(0,E.useState)(null),n=a9(),l=tT(),o=async e=>{let t=e.item(0);if(null==t){tI.error("Can't find input file");return}r(t),(0,ec.Sc)(t).then(e=>{for(let t in e.lines_by_speaker){let i=n.addVoiceoverTrack();e.lines_by_speaker[t].forEach(e=>{var t;let s=i.addBlankClip(e.start_time_secs,e.end_time_secs-e.start_time_secs);null===(t=s.utterance)||void 0===t||t.setText(e.text),s.setAudioStale(!0)}),i.speaker.setName(t)}r(null),l.history.commit(),i()}).catch(e=>{eo.toast.error(e.detail.message),r(null)})};return(0,u.jsx)(t_.V,{open:t,size:"md",title:s.t("Import Script"),content:(0,u.jsxs)("div",{className:"max-h-64 overflow-y-auto overflow-x-visible -mt-2",children:[(0,u.jsx)(tk.default,{children:(0,u.jsx)(g.cC,{id:"KA+Pwp"})}),(0,u.jsx)("div",{className:"mt-6",children:(0,u.jsx)(ty.Z,{accept:"text/csv",onChange:o,fileSizeLimit:5e5,children:null===a?(0,u.jsxs)("div",{children:[(0,u.jsx)(tf.Z,{className:"mx-auto h-12 w-12 text-gray-500"}),(0,u.jsx)("div",{className:"flex text-sm text-gray-600",children:(0,u.jsx)(tk.default,{className:"relative cursor-pointer rounded-md font-medium text-gray-800 focus-within:outline-none",noBaseClass:!0,variant:"div",children:(0,u.jsx)(g.cC,{id:"PM0w6N"})})}),(0,u.jsx)(tk.default,{className:"text-xs text-gray-500 text-center",noBaseClass:!0,variant:"p",children:(0,u.jsx)(g.cC,{id:"tFwdDb",values:{0:500}})})]}):(0,u.jsxs)(tA.m,{className:"mt-2",children:[(0,u.jsx)(tk.default,{className:"text-xs text-gray-500 text-center",noBaseClass:!0,variant:"p",children:(0,u.jsx)(g.cC,{id:"GxkJXS"})}),(0,u.jsx)(tA.K,{fileName:a.name,size:a.size})]})})})]}),closeModal:i,zIndex:"z-[200]"})});var tP=i(20308),tE=i(79458),tO=i(39255),tD=i(99763),tB=i(87050),tF=i(63415),tM=i(85753);class tL{formatBase(e){let t=Math.floor(e/3600),i="";return t>0&&(i+="".concat(t.toString().padStart(2,"0"),":")),i+="".concat(Math.floor(e%3600/60).toString().padStart(2,"0"),":")+"".concat(Math.floor(e%60).toString().padStart(2,"0"))}}class tR extends tL{format(e){let t=this.formatBase(e);if(this.elapsedTime>0){let i=Math.floor((e-Math.floor(e))*this.frameCount/this.elapsedTime);return"".concat(t,":").concat(i.toString().padStart(2,"0"))}return t}parse(e){let t=e.split(":"),i=0,s=0;if(4===t.length){let[e,a,r,n]=t;i+=3600*parseInt(e,10)+60*parseInt(a,10)+parseInt(r,10),s=parseInt(n,10)}else if(3===t.length){let[e,a,r]=t;i+=60*parseInt(e,10)+parseInt(a,10),s=parseInt(r,10)}else if(2===t.length){let[e,a]=t;i+=parseInt(e,10),s=parseInt(a,10)}else if(1===t.length){let[e]=t;s=parseInt(e,10)}return i+s*this.calculateFrameRateFractionalSeconds()}validate(e,t){if(!/^[0-9:]*$/.test(e))return!1;let i=e.split(":");if(i.length>(t<3600?3:4))return!1;for(let e of i)if(e.length>2)return!1;return!0}calculateFrameRateFractionalSeconds(){return Math.ceil(this.elapsedTime/this.frameCount*1e3)/1e3}constructor(e,t){super(),(0,B._)(this,"frameCount",void 0),(0,B._)(this,"elapsedTime",void 0),this.frameCount=e,this.elapsedTime=t}}let tz=(0,U.Z)("file:///app/src/app/(v1)/v1/dubbing/Hotkeys.tsx"),tU=new P.Z({concurrency:4}),tJ=e=>{var t;let i=null===(t=e.data)||void 0===t?void 0:t.input.frame_rate;return null!=i&&null!=i.frame_count&&null!=i.elapsed_time?new tR(i.frame_count,i.elapsed_time):null},tZ={delete:{keys:"".concat(tB.s.Backspace,", ").concat(tB.s.Delete),eventName:"delete",description:er.ag.t("Delete clip selection"),handler:(e,t)=>{t.selection.multiclip.delete(),e.history.commit()}},undo:{keys:"".concat(tB.s.Meta,"+z, ").concat(tB.s.Control,"+z"),eventName:"undo",description:er.ag.t("Undo"),handler:(e,t)=>{t.translateBlueprint.isPending||e.history.undo()}},redo:{keys:"".concat(tB.s.Meta,"+").concat(tB.s.Shift,"+z, ").concat(tB.s.Control,"+").concat(tB.s.Shift,"+z, ").concat(tB.s.Control,"+y"),eventName:"redo",description:er.ag.t("Redo"),handler:(e,t)=>{t.translateBlueprint.isPending||e.history.redo()}},copy:{keys:"".concat(tB.s.Meta,"+c, ").concat(tB.s.Control,"+c"),eventName:"copy",description:er.ag.t("Copy"),handler:(e,t)=>{var i;(null===(i=t.selection.latest)||void 0===i?void 0:i.clipTypeCanBeCopied)&&t.clipboard.copy(l.Clip)}},paste:{keys:"".concat(tB.s.Meta,"+v, ").concat(tB.s.Control,"+v"),eventName:"paste",description:er.ag.t("Paste"),handler:(e,t)=>{t.clipboard.paste(),e.history.commit()}},selectMode:{keys:"s",eventName:"set_select_mode",description:er.ag.t("Set select mode"),handler:(e,t)=>{t.setMode(t.modes.SelectMode)}},trimMode:{keys:"t",eventName:"set_trim_mode",description:er.ag.t("Set trim mode"),handler:(e,t)=>{t.setMode(t.modes.TrimMode)}},generateClips:{keys:"g",eventName:"generate_clips",description:er.ag.t("Generate clips"),handler:(e,t)=>{if(t.selection){let i=t.selection.clips.filter(e=>e.clipTypeCanBeGenerated);tU.addAll(i.map(e=>async()=>{await (null==e?void 0:e.utterance.generate.execute().catch(()=>tz.warn("Failed to generate clip")))})).finally(()=>{e.history.commit()})}}},togglePlayPause:{keys:"space",eventName:"toggle_play_pause",description:er.ag.t("Toggle play/pause"),handler:(e,t,i,s)=>{s.preventDefault(),t.clock.playing?t.clock.pause():t.clock.resume()}},clearSelection:{keys:tB.s.Escape,eventName:"clear_selection_and_clipboard",description:er.ag.t("Clear selection and clipboard"),handler:(e,t)=>{var i;t.selection.clear(),(null===(i=t.clipboard.data)||void 0===i?void 0:i.type)==l.Clip&&t.clipboard.setData(null),e.history.commit()}},toggleListeningMode:{keys:"".concat(tB.s.Meta,"+/, ").concat(tB.s.Control,"+/"),eventName:"toggle_listening_mode",description:er.ag.t("Toggle listening mode"),handler:(e,t)=>{t.setListeningMode("source"===t.listeningMode?"target":"source")}},previousFrame:{keys:"[",eventName:"previous_frame",description:er.ag.t("Go to previous frame"),handler:(e,t,i)=>{let s=tJ(i);null!=s&&t.clock.seek(t.clock.seconds-s.calculateFrameRateFractionalSeconds())}},nextFrame:{keys:"]",eventName:"next_frame",description:er.ag.t("Go to next frame"),handler:(e,t,i)=>{let s=tJ(i);null!=s&&t.clock.seek(t.clock.seconds+s.calculateFrameRateFractionalSeconds())}},zoomIn:{keys:"".concat(tB.s.Shift,"+Equal, Plus"),eventName:"zoom_in",description:er.ag.t("Increase zoom level"),handler:(e,t,i,s)=>{t.setPixelsPerSecond(Math.min(t.MAX_PIXELS_PER_SECOND,t.pixelsPerSecond+2))}},zoomOut:{keys:"".concat(tB.s.Shift,"+Minus, Minus"),eventName:"zoom_out",description:er.ag.t("Decrease zoom level"),handler:(e,t,i,s)=>{t.setPixelsPerSecond(Math.max(t.MIN_PIXELS_PER_SECOND,t.pixelsPerSecond-2))}}};var tW=()=>{let e=tT(),t=a9(),i=(0,ec.LS)(t.dubbingId);return Object.values(tZ).forEach(s=>{let{keys:a,eventName:r,handler:n}=s;(0,tD.y1)(a,s=>{var l;(document.activeElement===document.body||(null===(l=document.activeElement)||void 0===l?void 0:l.id)==="dubbing-timeline")&&(s.preventDefault(),(0,tF.eN)(tM.B_.dub_shortcut_triggered,{name:r,shortcut:a}),n(e,t,i,s))})}),null};let tX={Meta:"Command"},tG=e=>e.split(", ").map(e=>e.split("+").map(e=>tX[e]||e).join("+")).join(", "),tH=(0,T.Pi)(e=>{let{isOpen:t,onClose:i}=e,{i18n:s}=(0,g.mV)();return(0,u.jsx)(t_.V,{open:t,size:"md",title:s.t("Keyboard shortcuts"),content:(0,u.jsx)("div",{className:"max-h-96 overflow-y-auto overflow-x-visible -mt-2 space-y-4",children:(0,u.jsx)("div",{className:"table w-full",children:(0,u.jsx)("div",{className:"table-row-group",children:Object.entries(tZ).map(e=>{let[t,{keys:i,description:s}]=e;return(0,u.jsxs)("div",{className:"table-row",children:[(0,u.jsx)("div",{className:"table-cell p-2 border-b",children:(0,u.jsx)(tk.default,{children:s})}),(0,u.jsx)("div",{className:"table-cell p-2 border-b",children:i.split(",").map(e=>(0,u.jsx)(tk.default,{color:"darkGray",className:"inline-block bg-gray-200 rounded px-2 py-1 mr-2 mb-1 leading-none",children:tG(e.trim())},e))})]},t)})})})}),closeModal:i,zIndex:"z-[200]"})}),tK=e=>{let{onClick:t,label:i,icon:s}=e;return(0,u.jsx)(tP.Xi,{className:"relative p-0",children:(0,u.jsxs)(tE.default,{variant:"link",size:"xl",onClick:t,className:"w-full flex whitespace-nowrap items-start gap-3 px-4 py-2 text-sm",children:[s," ",i]})})},tQ=e=>{let{accessibleLabel:t,icon:i,showIndicator:s}=e;return(0,u.jsx)(tP.$F,{asChild:!0,children:(0,u.jsxs)("button",{className:"flex items-center rounded-full text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:ring-offset-2 focus:ring-offset-gray-100",children:[(0,u.jsx)(tk.default,{className:"sr-only",noBaseClass:!0,children:t}),(0,u.jsxs)("div",{className:"flex items-center",children:[(0,u.jsx)("div",{className:"relative rounded-full overflow-hidden h-9 w-9 after:absolute after:w-full after:h-full after:block after:shadow-inner after:z-10 after:rounded-full after:top-0 after:left-0",children:i}),s&&(0,u.jsx)("div",{className:"absolute top-0 right-0 h-3 w-3 bg-blue-500 rounded-full"})]})]})})},tq=(0,E.forwardRef)((e,t)=>{let{title:i,children:s}=e;return(0,u.jsxs)(tP.AW,{ref:t,className:"absolute right-0 z-10 mt-2 w-72 origin-top-right rounded-md bg-background shadow-lg ring-1 ring-foreground ring-opacity-5 focus:outline-none divide-y",children:[(0,u.jsx)("div",{className:"px-4 py-3",children:(0,u.jsx)(tk.default,{className:"text-sm",noBaseClass:!0,variant:"p",children:i})}),s]})}),tY=(0,T.Pi)(e=>{let{voiceover:t=!1}=e,{i18n:i}=(0,g.mV)(),s=(0,tO.Rh)(),a=(0,tO.Rh)(),r=(0,tO.Rh)();return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(tV,{isOpen:s.isOpen,onClose:s.close}),(0,u.jsx)(tw,{isOpen:a.isOpen,onClose:a.close}),(0,u.jsx)(tH,{isOpen:r.isOpen,onClose:r.close}),(0,u.jsxs)(tP.h_,{children:[(0,u.jsx)("div",{className:"group block flex-shrink-0",children:(0,u.jsx)(tQ,{icon:(0,u.jsx)(tg.Z,{}),accessibleLabel:i.t("Open options")})}),(0,u.jsxs)(tq,{title:i.t("Advanced Options"),children:[t&&(0,u.jsx)(tK,{onClick:()=>s.open(),label:i.t("Import Script"),icon:(0,u.jsx)(tp.Z,{className:"w-5 h-5"})}),(0,u.jsx)(tK,{onClick:()=>a.open(),label:i.t("Add Pronunciation Dictionary"),icon:(0,u.jsx)(tm.Z,{className:"w-5 h-5 shrink-0"})}),(0,u.jsx)(tK,{onClick:()=>r.open(),label:i.t("Show keyboard shortcuts"),icon:(0,u.jsx)(tv.Z,{className:"w-5 h-5 shrink-0"})})]})]})]})});var t$=i(60358),t0=i(88462),t1=i(61624),t2=i(30485),t5=i(8120),t4=i(74346),t3=i(11521),t6=i(99348),t8=i(96162),t7=i(93532),t9=e=>{let t=(0,E.useRef)(Date.now()),i=(0,t7.I)(e);(0,E.useEffect)(()=>{let e=()=>{document.hidden?(t.current=Date.now(),i.current({type:"leave",lastSeen:t.current,idleTime:0})):i.current({type:"enter",lastSeen:t.current,idleTime:Date.now()-t.current})};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[])},ie=i(60189),it=i(13104),ii=i(89219),is=i(91105),ia=i(54752);let ir=(s=[{key:"",name:"Select"},...s=ia.bJ.map(e=>({key:e.languageCode,name:e.name}))],null!=el.models.value&&(null===(r=el.models.value)||void 0===r?void 0:r.find(e=>"eleven_vietnamese_fine_tuned_v2"==e.model_id))&&s.push({key:"vi",name:"Vietnamese"}),s),il=(0,T.Pi)(e=>{let{isOpen:t,onClose:i}=e,{i18n:s}=(0,g.mV)(),a=tT(),r=a9(),[n,l]=(0,E.useState)(ir[0].key);return(0,u.jsx)(ii.Vq,{open:t,children:(0,u.jsxs)(ii.cZ,{hideCloseButton:r.translateBlueprint.isPending,onCloseClicked:i,children:[(0,u.jsx)(ii.fK,{children:(0,u.jsx)(ii.$N,{children:(0,u.jsx)(g.cC,{id:"5sI7Th"})})}),(0,u.jsx)("div",{className:"pb-2 w-full",children:(0,u.jsxs)(is.Select,{value:n,onValueChange:l,disabled:r.translateBlueprint.isPending,children:[(0,u.jsx)(is.SelectTrigger,{children:(0,u.jsx)(is.SelectValue,{placeholder:s.t("Choose target language...")})}),(0,u.jsx)(is.SelectContent,{children:ir.map(e=>(0,u.jsx)(is.SelectItem,{value:e.key,children:e.name},e.key))})]})}),(0,u.jsx)(ii.cN,{children:(0,u.jsx)(tj.Button,{variant:"primary",onClick:()=>{let e=r.addTargetBlueprint(n);r.setSelectedLanguage(e.language),a.history.commit(),r.translateBlueprint.execute(e).finally(()=>{a.history.commit({replace:!0}),i()})},loading:r.translateBlueprint.isPending,disabled:!n||r.targetBlueprints.some(e=>e.language===n),children:r.translateBlueprint.isPending?s.t("Adding Language"):s.t("Add Language")})})]})})});var io=e=>{let{voiceover:t=!1,open:i}=e,{i18n:s}=(0,g.mV)();return(0,u.jsx)(ii.Vq,{open:i,children:(0,u.jsx)(ii.cZ,{className:"max-w-sm text-center focus-visible:outline-none",overlayClassname:"bg-gray-500 bg-opacity-75 transition-opacity opacity-100",hideCloseButton:!0,onCloseClicked:()=>null,children:(0,u.jsxs)(ii.fK,{children:[(0,u.jsx)(ii.$N,{children:(0,u.jsx)(tk.default,{variant:"subtitle2",weight:"medium",color:"darkGray",className:"text-center",children:(0,u.jsx)(g.cC,{id:"pwKXxk"})})}),(0,u.jsxs)(ii.Be,{className:"flex flex-col items-center space-y-4",children:[(0,u.jsx)(tk.default,{variant:"body2",className:"text-center",children:(0,u.jsx)(g.cC,{id:"lQH1GV",values:{0:t?s.t("Voiceover"):s.t("Dubbing")}})}),(0,u.jsx)(tj.Button,{asChild:!0,variant:"primary",size:"sm",children:(0,u.jsx)(I.default,{href:t?t$.VP.voiceoverStudio:t$.VP.dubbing,children:(0,u.jsx)(g.cC,{id:"DQWAGS"})})})]})]})})})},ic=i(34392),id=i(75657),iu=i(42324),ih=i(54163),ip=i(54389),im=i(58397);let iv=e=>"".concat(Math.floor(e/3600).toString().padStart(2,"0"),":").concat(Math.floor(e%3600/60).toString().padStart(2,"0"),":").concat(Math.floor(e%60).toString().padStart(2,"0"),",").concat(Math.round(e%1*1e3).toString().padStart(3,"0"));class ig{static parseSeconds(e){let[t,i,s]=e.split(":"),[a,r]=s.split(",");return 3600*Number(t)+60*Number(i)+Number(a)+Number(r)/1e3}static format(e){return e.map((e,t)=>{let i=iv(e.start),s=iv(e.end);return"".concat(t+1,"\n").concat(i," --> ").concat(s,"\n").concat(e.text,"\n")}).join("\n").trim()}static parse(e){return(e=e.trim()).split("\n\n").map(e=>{let t=e.split("\n"),i=t[1].split(" --> ");return{start:ig.parseSeconds(i[0]),end:ig.parseSeconds(i[1]),text:t.slice(2).join("\n")}}).sort((e,t)=>e.start-t.start)}format(){return ig.format(this.subtitles)}toDataUrl(){let e=new Blob([this.format()],{type:"text/plain;charset=utf-8"});return URL.createObjectURL(e)}constructor(e){(0,B._)(this,"subtitles",void 0),"string"==typeof e?this.subtitles=ig.parse(e):this.subtitles=[...e].sort((e,t)=>e.start-t.start)}}var ix=i(49298);let ib=(0,T.Pi)(e=>{let{render:t,dubId:i,onPreview:s}=e,{i18n:a}=(0,g.mV)();return(0,u.jsxs)("div",{className:"h-12 border-b border-slate-200 flex items-center gap-0 px-1",children:[(0,u.jsx)(tk.default,{className:"capitalize w-24",variant:"body2",children:""==t.key?a.t("Original"):(0,ia.pQ)(t.language)}),(0,u.jsx)(tk.default,{className:"uppercase w-24",variant:"body2",children:t.render_type}),t&&(0,u.jsx)(tk.default,{className:"w-36",variant:"body2",color:"blackAccent",children:(0,im.$m)(t.created_at_unix)}),t&&!t.media&&!t.error&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"flex-1"}),(0,u.jsx)("div",{className:"px-3.5 w-40 flex justify-end",children:(0,u.jsx)(t5.Z,{svgClassName:"h-4 w-4 text-gray-700 hover:text-gray-500 animate-spin",iconClassName:"h-4 w-4 fill-gray-700 group-active:fill-gray/80","aria-hidden":"true"})})]}),t&&!t.media&&t.error&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"flex-1"}),(0,u.jsx)(tk.default,{variant:"body2",color:"blackAccent",children:(0,u.jsx)(g.cC,{id:"7Bj3x9"})})]}),t&&t.media&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"flex-1"}),(0,u.jsxs)("div",{className:"w-40 flex justify-end gap-2",children:[(0,u.jsx)(tE.default,{size:"xs",variant:"white",onClick:()=>{s(),(0,tF.eN)(tM.B_.dub_view_clicked,{dubbing_id:i})},children:(0,u.jsx)(g.cC,{id:"jpctdh"})}),(0,u.jsx)(tE.default,{size:"xs",variant:"white",onClick:()=>{(0,ip.downloadFromBlobUrl)(t.media.url,t.media.src),(0,tF.eN)(tM.B_.dub_downloaded,{dubbing_id:i})},children:(0,u.jsx)(g.cC,{id:"mzI/c+"})})]})]}),!t&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"flex-1"}),(0,u.jsx)(tk.default,{color:"lightGray",className:"px-2",children:"-----"})]})]})}),iA=e=>{let t=[];return"video"===e&&t.push({key:"mp4",name:er.ag.t("MP4 (Video)")}),t.push({key:"aac",name:er.ag.t("AAC (Audio)")},{key:"mp3",name:er.ag.t("MP3 (Audio)")},{key:"wav",name:er.ag.t("WAV (Audio)")},{key:"tracks_zip",name:er.ag.t("Audio Tracks (Zip File)")},{key:"clips_zip",name:er.ag.t("Audio Clips (Zip File)")},{key:"aaf",name:er.ag.t("AAF (Timeline Data)")},{key:"srt",name:er.ag.t("SRT (Captions)")},{key:"csv",name:er.ag.t("CSV (Transcript)")}),t},iy=(0,T.Pi)(e=>{var t,i,s,a,r,n,l,o,c,d,h,p,m,v,f,b;let{isOpen:A,onClose:y,dubId:j}=e,{i18n:_}=(0,g.mV)(),k=a9(),S=(0,x.useQuery)((0,ec.Ni)(j),()=>(0,ec.HF)(k.dubbingId),{refetchInterval:()=>!!A&&2500}),w={renderDub:(0,ec.VH)()},C=(0,tO.Rh)({context:{render:null}}),N=k.selectedLanaguage,T=k.targetBlueprints.map(e=>({key:e.language,name:(0,ia.pQ)(e.language)})).concat({key:"",name:_.t("Original")}),I=iA(k.media.content_type.startsWith("audio")?"audio":"video"),[V,P]=(0,E.useState)(I[0]),O=[];k.sourceBlueprint.backgroundTrack&&O.push({id:k.sourceBlueprint.backgroundTrack.id,clips:k.sourceBlueprint.backgroundTrack.clips.map(e=>({id:e.id,media_offset:e.mediaOffset,media_duration:e.mediaDuration,trim:e.trim,media:e.media,volume:e.volume}))}),k.sourceBlueprint.foregroundTrack&&O.push({id:k.sourceBlueprint.foregroundTrack.id,clips:k.sourceBlueprint.foregroundTrack.clips.map(e=>({id:e.id,media_offset:e.mediaOffset,media_duration:e.mediaDuration,trim:e.trim,media:e.media,volume:e.volume}))}),O.push(...k.sourceBlueprint.importedAudioTracks.map(e=>({id:e.id,clips:e.clips.map(e=>({id:e.id,media_offset:e.mediaOffset,media_duration:e.mediaDuration,trim:e.trim,media:e.media,volume:e.volume}))}))),k.activeTargetBlueprint?O.push(...k.activeTargetBlueprint.tracks.map(e=>({id:e.id,clips:e.clips.map(e=>({id:e.id,media_offset:e.mediaOffset,media_duration:e.mediaDuration,trim:e.trim,media:e.media,volume:e.volume}))}))):O.push(...k.sourceBlueprint.tracks.map(e=>({id:e.id,clips:e.clips.map(e=>({id:e.id,media_offset:e.mediaOffset,media_duration:e.mediaDuration,trim:e.trim,media:e.media,volume:e.volume}))})));let D=()=>{let e=new ig((k.selectedLanaguage?k.activeTargetBlueprint:k.sourceBlueprint).utterances.map(e=>({text:e.text,start:e.clip.startTime,end:e.clip.endTime})).sort((e,t)=>e.start-t.start));(0,ip.downloadFromBlobUrl)(e.toDataUrl(),"".concat(k.selectedLanaguage?k.activeTargetBlueprint.language:"original","-srt-").concat(Date.now(),".srt"))},B=()=>{let e=k.selectedLanaguage?k.activeTargetBlueprint.utterances.map(e=>({text:e.text,start:e.clip.startTime,end:e.clip.endTime,speaker:e.speaker.name})).sort((e,t)=>e.start-t.start):[],t=k.sourceBlueprint.utterances.map(e=>({text:e.text,start:e.clip.startTime,end:e.clip.endTime,speaker:e.speaker.name})).sort((e,t)=>e.start-t.start);if(e.length>0&&e.length!==t.length){eo.toast.error(_.t("Number of translated clips does not match the number of original clips"));return}let i=[];for(let s=0;s<t.length;s++){let a=t[s],r=e[s];i.push({speaker:a.speaker,start_time:iv(a.start),end_time:iv(a.end),transcription:a.text,translation:null!=r?r.text:""})}let s=new ix.b(i);(0,ip.downloadFromBlobUrl)(s.toDataUrl(),"".concat(k.selectedLanaguage?k.activeTargetBlueprint.language:"original","-script-").concat(Date.now(),".csv"))};return(0,u.jsx)(t_.V,{open:A,size:"md",title:_.t("Export"),content:(0,u.jsxs)("div",{className:"max-h-56 overflow-y-auto overflow-x-visible -mt-2",children:[C.isOpen&&(0,u.jsx)(ic.E,{children:(0,u.jsxs)("div",{className:"absolute inset-0 z-10 bg-[rgb(237,242,245)] outline-none",onKeyDown:e=>{e.stopPropagation(),"Escape"===e.key&&(C.close(),e.stopPropagation())},children:[(0,u.jsx)(ih.Z,{src:null===(s=C.context)||void 0===s?void 0:null===(i=s.render)||void 0===i?void 0:null===(t=i.media)||void 0===t?void 0:t.url,contentType:null===(n=C.context)||void 0===n?void 0:null===(r=n.render)||void 0===r?void 0:null===(a=r.media)||void 0===a?void 0:a.content_type}),(0,u.jsx)(id.P,{pos:"absolute",top:4,right:4,onClick:C.close,size:"sm",rounded:"lg",backdropFilter:"blur(3px)",color:"gray.600",bg:"gray.100",_hover:{bg:"gray.200"}})]})}),S.isSuccess&&(0,u.jsxs)("div",{className:"flex-col overflow-y-scroll",children:[((null===(o=S.data)||void 0===o?void 0:null===(l=o.latest_snapshot)||void 0===l?void 0:l.renders)==null||0==Object.values(null===(d=S.data)||void 0===d?void 0:null===(c=d.latest_snapshot)||void 0===c?void 0:c.renders).length)&&(0,u.jsx)(tk.default,{className:"",variant:"body2",children:(0,u.jsx)(g.cC,{id:"vclegA"})}),!((null===(p=S.data)||void 0===p?void 0:null===(h=p.latest_snapshot)||void 0===h?void 0:h.renders)==null||0==Object.values(null===(v=S.data)||void 0===v?void 0:null===(m=v.latest_snapshot)||void 0===m?void 0:m.renders).length)&&Object.values(null===(b=S.data)||void 0===b?void 0:null===(f=b.latest_snapshot)||void 0===f?void 0:f.renders).sort((e,t)=>t.created_at_unix-e.created_at_unix).map((e,t)=>(0,u.jsx)(ib,{render:e,dubID:j,onPreview:()=>{C.open({render:e})}},t))]})]}),actions:(0,u.jsxs)("div",{className:"flex gap-3 items-center",children:[(0,u.jsx)(tk.default,{className:"w-max",children:(0,u.jsx)(g.cC,{id:"rb2EDV"})}),(0,u.jsx)(iu.Lt,{value:T.find(e=>e.key===(N||"")),options:T,onChange:e=>{k.setSelectedLanguage(e.key||null)}}),(0,u.jsx)(tk.default,{children:(0,u.jsx)(g.cC,{id:"ZXlQOF"})}),(0,u.jsx)(iu.Lt,{value:V,options:I,onChange:P,className:"w-36"}),(0,u.jsx)("div",{className:"h-5 w-[1px] bg-gray-200"}),(0,u.jsx)(tE.default,{variant:"primary",size:"md",className:"rounded-lg",onClick:()=>{if("srt"===V.key)D();else if("csv"===V.key)B();else{var e;w.renderDub.mutateAsync({dubbing_id:j,type:V.key,data:{dubbing_id:j,user_id:null===(e=t8.EA.value)||void 0===e?void 0:e.uid,language:k.selectedLanaguage||"Original",media:k.media,tracks:O}})}},children:(0,u.jsx)(g.cC,{id:"GS+Mus"})})]}),closeModal:y,zIndex:"z-[200]"})});var ij=i(70140),i_=e=>{let t,i,{alt:s,value:a,options:r,onChange:n,disabled:l=!1,className:o,stretch:c=!1,rounded:d="xl",variant:h="primary"}=e;return t="primary"===h?"bg-foreground text-background":"bg-background text-foreground",i="text-gray-500",(0,u.jsx)("div",{className:(0,ij.A)("border border-gray-100 p-1 bg-gray-50 max-w-full overflow-x-auto",c&&"w-full","xl"===d?"rounded-xl":"rounded-md",o),children:(0,u.jsxs)("div",{className:(0,ij.A)("flex items-start gap-x-1 text-center text-xs font-semibold leading-5",c?"w-full":"w-max"),children:[(0,u.jsx)("div",{className:"sr-only",children:s}),r.map(e=>(0,u.jsx)("button",{className:(0,ij.A)(null!==a&&e.value===a.value?t:i,"relative py-1 px-2.5 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-500 focus-visible:ring-offset-1","xl"===d?"rounded-lg":"rounded-md",l?"":"cursor-pointer",c&&"flex-1"),onClick:l?void 0:()=>{n(e)},children:(0,u.jsx)("span",{children:e.label})},e.value))]})})};let ik=(0,T.Pi)(()=>{let{i18n:e}=(0,g.mV)(),t=tT(),i=a9(),s=[{value:"",label:e.t("Original")},...i.targetBlueprints.map(e=>({value:e.language,label:(0,ia.pQ)(e.language)}))],a=s.find(e=>e.value===i.selectedLanaguage)||s[0];return(0,u.jsx)(i_,{options:s,value:a,onChange:e=>{i.setSelectedLanguage(e.value||null),t.history.commit()},alt:e.t("Select Language")})});var iS=e=>{let{className:t="backdrop-blur-[2px]",svgClassName:i="text-foreground"}=e;return(0,u.jsx)("div",{className:(0,ij.A)("absolute inset-0 bg-background/50 rounded-lg z-10 flex items-center justify-center",t),children:(0,u.jsx)(t5.Z,{svgClassName:(0,ij.A)("inline w-4 h-4 text-foreground animate-spin",i)})})},iw=i(46736),iC=i(55292),iN=i(78328),iT=i(50113),iI=i(65204),iV=i(30487);let iP=()=>{let e=(0,V.useRouter)(),{mutate:t,isLoading:i,data:s}=(0,iV.I3k)(),{mutate:a,isLoading:r,data:n}=(0,iV.olH)();return(0,E.useEffect)(()=>{(s||n)&&e.push("/app/productions/active")},[s,n]),{onSubmitTask:async e=>{t({body:{version_id:null},pathParams:{userId:"@me",taskId:e}})},onApproveTask:async(e,t,i)=>{a({body:{version_id:null,kind:"review",content:{status:i?"approve":"reject",comments:t}},queryParams:{submit:!0},pathParams:{userId:"@me",taskId:e}})},isSubmitting:i,isSubmittingReview:r}},iE={hidden:{opacity:0,scale:.97},visible:{opacity:1,scale:1}},iO=(0,T.Pi)(e=>{let{taskId:t,disabled:i,isReview:s}=e,{i18n:a}=(0,g.mV)(),[r,n]=(0,E.useState)(!1),[l,o]=(0,E.useState)(!1),[c,d]=(0,E.useState)(!1),[h,p]=(0,E.useState)(""),{onSubmitTask:m,onApproveTask:v,isSubmitting:f,isSubmittingReview:x}=iP(),A=[{title:a.t("Ready for review"),description:(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(g.cC,{id:"Il0Z50",components:{0:(0,u.jsx)(iT.Un,{href:t$.ZP.productionsTranscriptionReviewGuidelines,target:"_blank"})}})})}];return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(tj.Button,{variant:"primary",onClick:()=>n(!0),disabled:i,leftIcon:(0,u.jsx)(iC.Z,{className:"w-4 h-4"}),children:(0,u.jsx)(g.cC,{id:"hQRttt"})}),(0,u.jsx)(ii.Vq,{open:r,onOpenChange:e=>n(e),children:(0,u.jsxs)(ii.cZ,{className:(0,ie.cn)("max-h-none overflow-y-visible",s&&c&&"pb-1"),children:[(0,u.jsx)(ii.fK,{className:"space-y-0",children:(0,u.jsx)(ii.$N,{children:s?a.t("Review"):a.t("Submit dub for review")})}),(0,u.jsxs)(iw.M,{mode:"wait",initial:!1,children:[s&&!c&&(0,u.jsx)(b.E.div,{variants:iE,initial:"hidden",animate:"visible",exit:"hidden",className:"space-y-4",children:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(t3.x,{size:"md",weight:"semi-bold",color:"foreground",children:(0,u.jsx)(g.cC,{id:"9isN5k"})}),(0,u.jsx)(iI.g,{value:h,onChange:e=>p(e.target.value),placeholder:a.t("Leave some feedback for the producer if needed to understand your changes"),className:"h-[20vh] mt-2 w-full"})]})},"submit"),s&&c&&(0,u.jsxs)(b.E.div,{variants:iE,initial:"hidden",animate:"visible",exit:"hidden",className:"space-y-4 w-full",children:[(0,u.jsxs)("div",{className:"stack gap-2 w-full",children:[(0,u.jsxs)("div",{className:"hstack items-center justify-between w-full",children:[(0,u.jsx)(t3.x,{size:"md",weight:"semi-bold",color:"foreground",children:(0,u.jsx)(g.cC,{id:"BcKcB2"})}),(0,u.jsx)(t0.Z,{color:l?"green":"red",children:(0,u.jsx)(t3.x,{size:"sm",color:"foreground",children:l?a.t("Approved"):a.t("Rejected")})})]}),(0,u.jsx)(t3.x,{size:"sm",color:"subtle",className:"whitespace-pre-wrap",children:h})]}),(0,u.jsx)(t3.x,{size:"md",weight:"semi-bold",color:"foreground",children:(0,u.jsx)(g.cC,{id:"sW2b6Y"})}),(0,u.jsx)(iN.g,{checklist:A,onConfirm:()=>{v(t,h,l),n(!1)},onGoBack:()=>d(!1),disabled:f||x})]},"submit"),!s&&(0,u.jsx)(b.E.div,{variants:iE,initial:"hidden",animate:"visible",exit:"hidden",className:"space-y-4",children:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(t3.x,{size:"md",weight:"semi-bold",color:"foreground",children:(0,u.jsx)(g.cC,{id:"sW2b6Y"})}),(0,u.jsx)(iN.g,{checklist:A,onConfirm:()=>{m(t),n(!1)},disabled:f||x})]})},"submit")]}),s&&!c&&(0,u.jsxs)(ii.cN,{children:[(0,u.jsx)(tj.Button,{variant:"ghost",onClick:()=>n(!1),children:(0,u.jsx)(g.cC,{id:"dEgA5A"})}),(0,u.jsx)(tj.Button,{variant:"destructive",disabled:!h,onClick:()=>{d(!0),o(!1)},children:(0,u.jsx)(g.cC,{id:"1t/NnN"})}),(0,u.jsx)(tj.Button,{variant:"primary",disabled:!h,onClick:()=>{d(!0),o(!0)},children:(0,u.jsx)(g.cC,{id:"Z7ZXbT"})})]})]})})]})});var iD=i(72081);let iB=(0,T.Pi)(()=>{let{i18n:e}=(0,g.mV)(),t=a9(),i=(0,ec.LS)(t.dubbingId),s=(0,t8.UG)();if(!i.data||!s)return(0,u.jsx)("span",{children:"----"});let a=Math.floor(i.data.free_credits_left);return a<=0?(0,u.jsx)(u.Fragment,{}):(0,u.jsxs)("span",{className:"hstack gap-1",children:[(0,u.jsx)(g.cC,{id:"MXAaEm"})," ",a," ",(0,u.jsx)(iD.k,{className:"mt-[1px]",info:e.t("You can make edits to your dub without being charged, up to a maximum number of changes (regenerations and translations). After you exhaust the credits shown below, you can continue to edit using your regular credits.")})]})});var iF=i(79627),iM=i(61702),iL=i(38833),iR=e=>{let{onVideoClick:t,onDocumentationClick:i,showIndicator:s=!1}=e,{i18n:a}=(0,g.mV)();return(0,u.jsxs)(tP.h_,{children:[(0,u.jsx)("div",{className:"group block flex-shrink-0",children:(0,u.jsx)(tQ,{icon:(0,u.jsx)(iF.Z,{}),accessibleLabel:a.t("Open help"),showIndicator:s&&!open})}),(0,u.jsxs)(tq,{title:a.t("Learn more"),children:[(0,u.jsx)(tK,{onClick:t,label:(0,u.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,u.jsx)(g.cC,{id:"oXTe1d"}),s&&(0,u.jsx)("div",{className:"h-3 w-3 bg-blue-500 rounded-full"})]}),icon:(0,u.jsx)(iM.Z,{className:"w-5 h-5 shrink-0"})}),(0,u.jsx)(I.default,{href:"https://elevenlabs.io/docs/voiceover-studio/overview",target:"_blank",rel:"noreferrer",onClick:i,passHref:!0,children:(0,u.jsx)(tK,{label:a.t("Open documentation"),icon:(0,u.jsx)(iL.Z,{className:"w-5 h-5 shrink-0"})})})]})]})},iz=i(1018),iU=i(95646),iJ=i(63442);let iZ=(0,iU.fj)({});iJ.q.defaultProps={...iJ.q.defaultProps,minW:48};var iW=i(10443);let iX=(0,iU.fj)({baseStyle:{rounded:"md",fontFamily:"Hyperlegible",fontSize:"sm",bg:"rgb(49 43 65)"}});iW.u.defaultProps={...iW.u.defaultProps,placement:"top",hasArrow:!0};let iG=(0,iz.B1)({global:{body:{borderColor:"hsl(var(--border))"}},components:{Tooltip:iX,Menu:iZ},colors:{gray:{0:"#ffffff",50:"#fafafa",100:"#f4f4f5",200:"#e5e5e8",300:"#d6d6da",400:"#a6a6ae",500:"#787881",600:"#5b5b64",700:"#494950",800:"#323235",900:"#242426",950:"#1c1c1d",1e3:"#101011"}}});var iH=i(18023),iK=i(88833),iQ=i(86927),iq=i(70451),iY=i(85396),i$=i(4035),i0=i(53551),i1=i(61968),i2=i(74345),i5=i(98648),i4=i(24465),i3=i(72715),i6=i(77513),i8=i(65324),i7=i.n(i8),i9=i(82374),se=i(77150);let st=new se.r({isOpen:!1,context:void 0});function si(){let{i18n:e}=(0,g.mV)(),t=tT();return(0,u.jsx)(t_.V,{title:e.t("Clip History"),size:"xs",open:st.isOpen,closeModal:st.close,content:(0,u.jsx)("div",{className:"overflow-y-auto overflow-x-visible -mt-2",children:(0,u.jsx)("div",{className:"flex-col overflow-y-auto align-middle",children:st&&null!==st.context&&void 0!==st.context&&Object.values(st.context.history).sort((e,t)=>t.generation_time-e.generation_time).slice(0,10).map(i=>{var s,a,r,n;let l=i.generation_time==(null===(s=st.context)||void 0===s?void 0:s.generationTime),o=i.trim.end*i.media_duration-i.trim.start*i.media_duration<=(null===(a=st.context)||void 0===a?void 0:a.duration)+(null===(r=st.context)||void 0===r?void 0:r.trailingGap)+(null===(n=st.context)||void 0===n?void 0:n.leadingGap);return(0,u.jsxs)("div",{className:"flex justify-between pt-4 items-center mx-2 my-1",children:[(0,u.jsxs)(tk.default,{children:[(0,u.jsx)(g.cC,{id:"csCoda"})," ",(0,J.qp)(i.generation_time)]}),(0,u.jsx)(tE.default,{variant:"secondary",size:"sm",disabledReasonTooltip:o||l?null:{content:(0,u.jsx)(tk.default,{color:"white",children:(0,u.jsx)(g.cC,{id:"W/V6oT"})})},className:"rounded-sm w-24",onClick:()=>{var e;null===(e=st.context)||void 0===e||e.revertToClipFromHistory(i),t.history.commit(),st.close()},disabled:l||!o,children:l?e.t("Selected"):o?e.t("Select"):e.t("Too long")})]},i.id)})})})})}si.manager=st;var ss=(0,T.Pi)(si),sa=i(66198),sr=i(97751);let sn=e=>{let{className:t}=e;return(0,u.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",role:"img",width:"12",viewBox:"0 0 24 24",className:t,children:(0,u.jsx)("path",{d:"M3,5.13137l-1.31134e-07,3.55271e-15c-1.65685,7.24234e-08 -3,1.34315 -3,3c0,0 0,1.77636e-15 0,1.77636e-15v6l3.19744e-14,4.52987e-07c2.50178e-07,1.65685 1.34315,3 3,3h2.65l6.35,5v-22l-6.35,5Zm17,6l3.22943e-07,0.000513405c-0.00126608,-2.11713 -0.81346,-4.15334 -2.26965,-5.69014l4.49398e-08,4.72193e-08c-0.381076,-0.400406 -1.01459,-0.416077 -1.415,-0.0350001c-0.400406,0.381076 -0.416077,1.01459 -0.0350001,1.415l3.56262e-08,3.74132e-08c2.29841,2.4137 2.29841,6.2063 -7.12523e-08,8.62l2.29995e-08,-2.28117e-08c-0.392122,0.38892 -0.394718,1.02208 -0.00579837,1.4142c0.00192484,0.00194069 0.00385763,0.00387348 0.00579832,0.00579832l1.49479e-08,1.40058e-08c0.194393,0.182142 0.453427,0.279193 0.719647,0.269627l5.01314e-08,3.09438e-10c0.27566,0.00170152 0.539796,-0.110466 0.73,-0.31l2.80721e-07,-2.96224e-07c1.45628,-1.53671 2.2686,-3.57287 2.27,-5.69Zm-1.4,-10.8l3.78218e-08,2.83663e-08c-0.441828,-0.331371 -1.06863,-0.241828 -1.4,0.2c-0.331371,0.441828 -0.241828,1.06863 0.2,1.4c1.00526e-08,7.53946e-09 2.76447e-08,2.07335e-08 3.76973e-08,2.8273e-08l6.40586e-07,4.8044e-07c5.08102,3.81077 6.11076,11.019 2.3,16.1c-0.653824,0.871765 -1.42823,1.64618 -2.3,2.3l-7.79577e-08,5.84683e-08c-0.441828,0.331371 -0.531371,0.958172 -0.2,1.4l5.13133e-08,6.84178e-08c0.188854,0.251806 0.485243,0.4 0.8,0.4l-4.37114e-08,3.55271e-15c0.21637,9.45784e-09 0.426904,-0.0701779 0.6,-0.2l7.51993e-07,-5.63995e-07c5.96467,-4.47351 7.17351,-12.9353 2.7,-18.9c-0.767532,-1.02338 -1.67662,-1.93247 -2.7,-2.7Z",transform:"translate(-7.24234e-08, 0.868629)",fill:"currentColor"})})},sl=e=>{let{className:t}=e;return(0,u.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",role:"img",width:"12",viewBox:"0 0 24 24",className:t,children:(0,u.jsx)("path",{d:"M0.102122,9.10212v6l3.55271e-14,4.52987e-07c2.50178e-07,1.65685 1.34315,3 3,3h2.65l6.35,5v-5.38l-10.91,-10.91l-2.60839e-07,2.15336e-07c-0.683992,0.56467 -1.08305,1.40307 -1.09,2.29Zm21.38,11l2.57883e-07,-3.48565e-07c4.41117,-5.96232 3.16798,-14.3695 -2.78,-18.8l4.23752e-08,3.17814e-08c-0.441828,-0.331371 -1.06863,-0.241828 -1.4,0.2c-0.331371,0.441828 -0.241828,1.06863 0.2,1.4c1.29779e-08,9.7334e-09 1.62223e-08,1.21668e-08 2.92002e-08,2.19001e-08l6.32019e-07,4.69153e-07c4.96483,3.68544 6.11484,10.643 2.6,15.73l-1.6,-1.59l5.16025e-07,-6.88458e-07c2.41371,-3.22027 2.15172,-7.71217 -0.620001,-10.63l4.49398e-08,4.72193e-08c-0.381076,-0.400406 -1.01459,-0.416077 -1.415,-0.0350001c-0.400406,0.381076 -0.416077,1.01459 -0.0350001,1.415l9.88607e-08,1.03887e-07c2.02516,2.12812 2.29169,5.38058 0.64,7.81l-4.97,-4.91v-9.59l-5.37,4.22l-4.92,-4.93l6.9121e-08,6.91211e-08c-0.392122,-0.392122 -1.02788,-0.392122 -1.42,-1.38242e-07c-0.392122,0.392122 -0.392122,1.02788 -1.38242e-07,1.42c0,0 0,0 0,0l22,22l-3.12092e-08,-3.14662e-08c0.38892,0.392122 1.02208,0.394718 1.4142,0.00579839c0.00194069,-0.00192484 0.00387348,-0.00385763 0.00579832,-0.00579832l4.18882e-08,-4.15461e-08c0.392122,-0.38892 0.394718,-1.02208 0.00579824,-1.4142c-0.00192484,-0.00194069 -0.00385763,-0.00387348 -0.00579832,-0.00579832Z",transform:"translate(-0.102122, -0.102122)",fill:"currentColor"})})},so=e=>{let{className:t}=e;return(0,u.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"none",viewBox:"0 0 12 12",className:t,children:(0,u.jsx)("path",{fill:"#000",d:"M1.66 6L3.78 8.12l.707-.707L3.074 6l1.414-1.414-.707-.708L1.66 6zM6 9.5a.5.5 0 01-.5-.5V3a.5.5 0 111 0v6a.5.5 0 01-.5.5zM10.34 6L8.218 3.878l-.707.708L8.926 6 7.51 7.414l.707.707L10.34 6z"})})},sc=e=>(0,u.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",stroke:"currentColor",strokeWidth:"0",viewBox:"0 0 24 24",className:e.className,children:(0,u.jsx)("path",{fill:"currentColor",stroke:"none",d:"M8.976 12L4.733 7.757 3.32 9.172 6.147 12 3.32 14.828l1.414 1.415L8.976 12zM12 19a1 1 0 01-1-1V6a1 1 0 112 0v12a1 1 0 01-1 1zM15.024 12l4.243 4.243 1.414-1.415L17.853 12l2.828-2.828-1.414-1.415L15.024 12z"})});var sd=e=>{let{duration:t,children:i}=e,[s,a]=(0,E.useState)(!1);return(0,E.useEffect)(()=>{let e=setTimeout(()=>{a(!0)},t);return()=>{clearTimeout(e)}},[t]),(0,u.jsx)(u.Fragment,{children:s?i:null})};let su=(0,U.Z)("file:///app/src/app/(v1)/v1/dubbing/Clips.tsx"),sh=e=>{let{className:t}=e;return(0,u.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",stroke:"currentColor",strokeWidth:"0",viewBox:"0 0 15 15",className:t,children:(0,u.jsx)("path",{fill:"currentColor",fillRule:"evenodd",stroke:"none",d:"M1.903 7.297c0 3.044 2.207 5.118 4.686 5.547a.521.521 0 11-.178 1.027C3.5 13.367.861 10.913.861 7.297c0-1.537.699-2.745 1.515-3.663.585-.658 1.254-1.193 1.792-1.602H2.532a.5.5 0 010-1h3a.5.5 0 01.5.5v3a.5.5 0 01-1 0V2.686l-.001.002h0c-.572.43-1.27.957-1.875 1.638-.715.804-1.253 1.776-1.253 2.97zm11.108.406c0-3.012-2.16-5.073-4.607-5.533a.521.521 0 11.192-1.024c2.874.54 5.457 2.98 5.457 6.557 0 1.537-.699 2.744-1.515 3.663-.585.658-1.254 1.193-1.792 1.602h1.636a.5.5 0 110 1h-3a.5.5 0 01-.5-.5v-3a.5.5 0 111 0v1.845h.002c.571-.432 1.27-.958 1.874-1.64.715-.803 1.253-1.775 1.253-2.97z",clipRule:"evenodd"})})},sp=(0,T.Pi)(e=>{let{clip:t}=e,i=(0,E.useRef)(null),s=a9(),a="text-".concat(t.color,"-800");return((0,E.useEffect)(()=>{if(!t.waveform||!i.current)return;let e=i.current,{height:a,width:r}=e.getBoundingClientRect(),n=window.devicePixelRatio||1,l=16e3/n,o=Math.ceil(r/l);e.innerHTML="";for(let i=0;i<o;i++){let c=document.createElement("canvas");c.className="absolute top-0 left-0 h-full",e.appendChild(c);let d=c.getContext("2d");if(!d)continue;let u=i===o-1?r%l:l;c.style.width="".concat(u,"px"),c.style.left="".concat(i*l,"px"),c.width=u*n,c.height=a*n,d.scale(n,n),d.fillStyle="rgba(0, 0, 0, 0.66)",d.clearRect(0,0,c.width,c.height);let h=a/2,p=i*l,m=p+u;t.waveform.forEach(e=>{let t=s.timeToPx(e.time);if(t>=p&&t<m){let i=Math.max(e.value/100*a*.5,.5);d.fillRect(t-p,h-i,.5,2*i)}})}},[t.waveform,t.color,s]),t.waveform)?(0,u.jsxs)("div",{className:"absolute inset-0 flex items-center overflow-hidden pointer-events-none",children:[!t.media&&(0,u.jsx)(tk.default,{variant:"body3",className:"w-full text-center opacity-50 overflow-hidden min-w-max px-1.5",children:(0,u.jsx)("span",{className:a,children:(0,u.jsx)(g.cC,{id:"rmyR1L"})})}),t.media&&(0,u.jsx)("div",{ref:i,className:"absolute inset-0 w-full h-full"})]}):null}),sm=(0,T.Pi)(e=>{let{clip:t,onClick:i}=e,{i18n:s}=(0,g.mV)();tT();let a=a9();return a.clock.seconds>t.startTime+.3&&a.clock.seconds<t.endTime-.3?(0,u.jsx)(b.E.div,{style:{x:a.timeToPx(a.clock.seconds-t.startTime)},className:"absolute z-10 -top-1 pointer-events-none",initial:{opacity:0},animate:{opacity:1,transition:{delay:.1,duration:.05}},children:(0,u.jsx)(iW.u,{label:s.t("Split"),fontSize:"xs",children:(0,u.jsx)("div",{className:"translate-x-[calc(-50%-1px)] pointer-events-auto bg-slate-300 border border-slate-400 h-4 w-6 rounded-full text-slate-900 hover:brightness-90 flex items-center justify-center",onClick:i,onPointerDown:e=>e.stopPropagation(),children:(0,u.jsx)(so,{className:"h-4 w-6"})})})}):null}),sv=(0,T.Pi)(e=>{var t;let{clip:i}=e,{i18n:s}=(0,g.mV)(),a=tT(),r=a9(),n=r.timeToPx(i.duration),l=i.color;return i.visible?(0,u.jsxs)(b.E.div,{className:(0,ij.A)("flex absolute top-0.5 bottom-0.5 rounded-lg border items-center cursor-pointer",i.isSelected?"bg-".concat(l,"-300 border-").concat(l,"-400"):"bg-".concat(l,"-200 border-").concat(l,"-300")),style:{width:n,x:r.timeToPx(i.startTime),zIndex:i.track.clips.length-i.index},onPointerDown:e=>{2===e.button?r.selection.has(i)||r.selection.set(i):e.metaKey?r.selection.toggle(i):e.shiftKey?r.selection.latest&&r.selection.selectUntil(i):r.selection.set(i),a.history.commit()},onPointerUp:e=>{e.overClipId=i.id},onContextMenu:e=>{e.preventDefault(),e.stopPropagation(),r.contextMenu||r.setContextMenu({clip:i,position:{x:e.clientX,y:e.clientY}})},children:[!r.clock.playing&&(0,u.jsx)(sm,{clip:i,onClick:()=>{i.split(r.clock.seconds),a.history.commit()}}),i.loading&&(0,u.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,u.jsx)(t5.Z,{})}),(0,u.jsx)("div",{className:"overlay",style:{opacity:(null===(t=i.track)||void 0===t?void 0:t.isMuted)&&!i.isSelected?.5:1},children:(0,u.jsx)(sd,{duration:1500,children:(0,u.jsx)(sp,{clip:i})})}),(0,u.jsx)("div",{className:"absolute left-0 h-full",children:(0,u.jsx)(sA,{clip:i,project:r,store:a,width:n,color:l})}),(0,u.jsx)("div",{className:"absolute right-0 h-full",children:(0,u.jsx)(sb,{clip:i,project:r,store:a,width:n,color:l})}),i.canMergeNext&&(0,u.jsx)(iW.u,{label:s.t("Merge"),fontSize:"xs",children:(0,u.jsx)("div",{className:"absolute -right-3 translate-x-[1px] -top-1 bg-slate-300 border border-slate-400 h-4 w-6 rounded-full text-slate-900 hover:brightness-90 flex items-center justify-center",onClick:e=>{i.mergeNext(),a.history.commit()},onPointerDown:e=>e.stopPropagation(),children:(0,u.jsx)(sc,{className:"h-4 w-6"})})})]}):null}),sg=(0,T.Pi)(e=>{var t;let{clip:i}=e,{i18n:s}=(0,g.mV)(),a=tT(),r=a9(),n=r.timeToPx(i.duration),l=i.color;return(0,u.jsxs)(b.E.div,{className:(0,ij.A)("flex absolute top-0.5 bottom-0.5 rounded-lg border items-center cursor-pointer",i.isSelected?"bg-".concat(l,"-300 border-").concat(l,"-400"):"bg-".concat(l,"-200 border-").concat(l,"-300")),style:{width:n,x:r.timeToPx(i.startTime),zIndex:i.track.clips.length-i.index},onPointerDown:e=>{2===e.button?r.selection.has(i)||r.selection.set(i):e.metaKey?r.selection.toggle(i):e.shiftKey?r.selection.latest&&r.selection.selectUntil(i):r.selection.set(i),a.history.commit()},onPointerUp:e=>{e.overClipId=i.id},onContextMenu:e=>{e.preventDefault(),e.stopPropagation(),r.contextMenu||r.setContextMenu({clip:i,position:{x:e.clientX,y:e.clientY}})},children:[!r.clock.playing&&(0,u.jsx)(sm,{clip:i,onClick:()=>{i.split(r.clock.seconds),a.history.commit()}}),i.loading&&(0,u.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,u.jsx)(t5.Z,{})}),(0,u.jsx)("div",{className:"overlay",style:{opacity:(null===(t=i.track)||void 0===t?void 0:t.isMuted)&&!i.isSelected?.5:1},children:(0,u.jsx)(sd,{duration:1500,children:(0,u.jsx)(sp,{clip:i})})}),(0,u.jsx)("div",{className:"absolute left-0 h-full",children:(0,u.jsx)(sA,{clip:i,project:r,store:a,width:n,color:l})}),(0,u.jsx)("div",{className:"absolute right-0 h-full",children:(0,u.jsx)(sb,{clip:i,project:r,store:a,width:n,color:l})}),i.canMergeNext&&(0,u.jsx)(iW.u,{label:s.t("Merge"),fontSize:"xs",children:(0,u.jsx)("div",{className:"absolute -right-3 translate-x-[1px] -top-1 bg-slate-300 border border-slate-400 h-4 w-6 rounded-full text-slate-900 hover:brightness-90 flex items-center justify-center",onClick:e=>{i.mergeNext(),a.history.commit()},onPointerDown:e=>e.stopPropagation(),children:(0,u.jsx)(sc,{className:"h-4 w-6"})})})]})}),sf=(0,T.Pi)(e=>{var t,i,s,a;let{clip:r}=e,n=tT(),l=a9(),{i18n:o}=(0,g.mV)(),c=l.timeToPx(r.duration),d=r.color;return r.visible?(0,u.jsxs)(b.E.div,{className:(0,ij.A)("flex absolute top-0.5 bottom-0.5 rounded-lg border items-center cursor-pointer",r.isSelected?"bg-".concat(d,"-300 border-").concat(d,"-400"):"bg-".concat(d,"-200 border-").concat(d,"-300"),!r.isSelected&&(null===(t=r.track)||void 0===t?void 0:t.isMuted)&&"bg-opacity-40 border-opacity-40"),style:{width:c,x:l.timeToPx(r.startTime)},onPointerDown:e=>{2!==e.button||l.selection.has(r)||(l.selection.set(r),n.history.commit())},onPointerUp:e=>{if(e.overClipId=r.id,r.isBeingDragged){if(l.activeTrim||l.activeStretch)return;l.stopDrag(),n.history.commit();return}2!==e.button&&(e.metaKey?l.selection.toggle(r):e.shiftKey?l.selection.latest&&l.selection.selectUntil(r):l.selection.set(r),n.history.commit())},onPanStart:e=>{l.activeTrim||l.activeStretch||(l.selection.has(r)||(e.metaKey?l.selection.toggle(r):e.shiftKey?l.selection.latest&&l.selection.selectUntil(r):l.selection.set(r),n.history.commit()),l.startDrag())},onPan:(e,t)=>{if(!l.activeTrim&&!l.activeStretch&&l.activeDrag){var i;null===(i=l.activeDrag)||void 0===i||i.clipsAndTheirInitialStartTimes.forEach(e=>{let i=e.clip;i.clipTypeCanBeDragged&&i.moveStartTo(e.initialStartTime+l.pxToTime(t.offset.x))})}},onContextMenu:e=>{e.preventDefault(),e.stopPropagation(),l.contextMenu||l.setContextMenu({clip:r,position:{x:e.clientX,y:e.clientY}})},children:[r.loading&&(0,u.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,u.jsx)(t5.Z,{})}),(0,u.jsx)("div",{className:"overlay",style:{opacity:(null===(i=r.track)||void 0===i?void 0:i.isMuted)&&!r.isSelected?.5:1},children:(0,u.jsx)(sd,{duration:1500,children:(0,u.jsx)(sp,{clip:r})})}),r.isTrimmed&&c>55&&(0,u.jsx)("div",{className:"badge-xs backdrop-blur bg-gray-300/50 absolute bottom-1 right-4 mr-[2px] cursor-help",children:(0,u.jsx)(iu.Rl,{tooltip:o.t("This clip has been trimmed."),children:(0,u.jsx)(i4.Z,{className:"h-2.5 w-2.5"})})}),(0,u.jsxs)("div",{className:"absolute left-0 h-full",children:[l.mode instanceof l.modes.TrimMode&&(0,u.jsx)(sA,{clip:r,project:l,store:n,width:c,color:d}),!(l.mode instanceof l.modes.TrimMode)&&(0,u.jsx)(sw,{side:"left",onPanStart:e=>{l.startStretch({clip:r,side:"start",initialTime:r.startTime})},onPan:(e,t)=>{l.activeStretch&&"start"===l.activeStretch.side&&l.activeStretch.clip.stretchStartTo(l.activeStretch.initialTime+l.pxToTime(t.offset.x),{minDuration:.3})},onPanEnd:e=>{l.stopStretch(),n.history.commit()},className:(0,ij.A)(c>30?"visible":"invisible","rounded-l-[calc(0.5rem-1px)] bg-opacity-[0.85]",r.isSelected?"text-".concat(d,"-800 border-r border-").concat(d,"-400"):"text-".concat(d,"-700 border-r border-").concat(d,"-300"),(null===(s=r.track)||void 0===s?void 0:s.isMuted)&&!r.isSelected?"border-opacity-50 bg-".concat(d,"-100"):"border-opacity-100 bg-".concat(d,"-200"))})]}),(0,u.jsxs)("div",{className:"absolute right-0 h-full",children:[l.mode instanceof l.modes.TrimMode&&(0,u.jsx)(sb,{clip:r,project:l,store:n,width:c,color:d}),!(l.mode instanceof l.modes.TrimMode)&&(0,u.jsx)(sw,{side:"right",onPanStart:e=>{l.startStretch({clip:r,side:"end",initialTime:r.endTime})},onPan:(e,t)=>{l.activeStretch&&"end"===l.activeStretch.side&&l.activeStretch.clip.stretchEndTo(l.activeStretch.initialTime+l.pxToTime(t.offset.x),{minDuration:.3})},onPanEnd:e=>{l.stopStretch(),n.history.commit()},className:(0,ij.A)(c>30?"visible":"invisible","rounded-r-[calc(0.5rem-1px)] bg-opacity-[0.85]",r.isSelected?"text-".concat(d,"-800 border-l border-").concat(d,"-400"):"text-".concat(d,"-700 border-l border-").concat(d,"-300"),(null===(a=r.track)||void 0===a?void 0:a.isMuted)&&!r.isSelected?"border-opacity-50 bg-".concat(d,"-100"):"border-opacity-100 bg-".concat(d,"-200"))})]})]}):null}),sx=e=>{let{onPanStart:t,onPan:i,onPanEnd:s,className:a,disableInnerHandle:r=!1}=e;return(0,u.jsx)("div",{className:(0,ij.A)("relative w-3.5 h-full overflow-hidden",a),children:(0,u.jsx)(b.E.div,{className:"absolute inset-0 cursor-grab flex items-center justify-center",onPanStart:t,onPan:i,onPanEnd:s,children:!r&&(0,u.jsx)("div",{className:"h-6 w-1 bg-current rounded-full opacity-80"})})})},sb=(0,T.Pi)(e=>{var t;let{clip:i,project:s,store:a,width:r,color:n,onPanEnd:l=()=>{}}=e;return(0,u.jsx)(sx,{onPanStart:()=>{s.startTrim({clip:i,side:"end",initialTime:i.endTime})},onPan:(e,t)=>{s.activeTrim&&"end"===s.activeTrim.side&&s.activeTrim.clip.trimEndTo(s.activeTrim.initialTime+s.pxToTime(t.offset.x),{minDuration:.3})},onPanEnd:()=>{s.stopTrim(),a.history.commit(),l()},className:(0,ij.A)(r>30?"visible":"invisible","rounded-r-[calc(0.5rem-1px)] bg-opacity-[0.85]",i.isSelected?"text-".concat(n,"-500 border-l border-").concat(n,"-400"):"text-".concat(n,"-400 border-l border-").concat(n,"-300"),(null===(t=i.track)||void 0===t?void 0:t.isMuted)&&!i.isSelected?"border-opacity-50 bg-".concat(n,"-100"):"border-opacity-100 bg-".concat(n,"-200"))})}),sA=(0,T.Pi)(e=>{var t;let{clip:i,project:s,store:a,width:r,color:n,onPanEnd:l=()=>{}}=e;return(0,u.jsx)(sx,{onPanStart:()=>{s.startTrim({clip:i,side:"start",initialTime:i.startTime})},onPan:(e,t)=>{s.activeTrim&&"start"===s.activeTrim.side&&s.activeTrim.clip.trimStartTo(s.activeTrim.initialTime+s.pxToTime(t.offset.x),{minDuration:.3})},onPanEnd:()=>{s.stopTrim(),a.history.commit(),l()},className:(0,ij.A)(r>30?"visible":"invisible","rounded-l-[calc(0.5rem-1px)] bg-opacity-[0.85]",i.isSelected?"text-".concat(n,"-500 border-r border-").concat(n,"-400"):"text-".concat(n,"-400 border-r border-").concat(n,"-300"),(null===(t=i.track)||void 0===t?void 0:t.isMuted)&&!i.isSelected?"border-opacity-50 bg-".concat(n,"-100"):"border-opacity-100 bg-".concat(n,"-200"))})}),sy=(0,T.Pi)(e=>{var t,i,s,a,r;let{clip:n}=e,l=tT(),o=a9(),{i18n:c}=(0,g.mV)(),d=o.timeToPx(n.duration),h=n.utterance.speaker.color;return n.visible?(0,u.jsxs)(b.E.div,{className:(0,ij.A)("flex absolute top-0.5 bottom-0.5 rounded-lg border items-center cursor-pointer",n.isSelected?"bg-".concat(h,"-300 border-").concat(h,"-400"):"bg-".concat(h,"-200 border-").concat(h,"-300"),!n.isSelected&&(null===(t=n.track)||void 0===t?void 0:t.isMuted)&&"bg-opacity-40 border-opacity-40"),style:{width:d,x:o.timeToPx(n.startTime)},onPointerDown:e=>{2!==e.button||o.selection.has(n)||(o.selection.set(n),l.history.commit())},onPointerUp:e=>{if(e.overClipId=n.id,n.isBeingDragged){if(o.activeTrim||o.activeStretch)return;o.stopDrag(),l.history.commit();return}2!==e.button&&(e.metaKey?o.selection.toggle(n):e.shiftKey?o.selection.latest&&o.selection.selectUntil(n):o.selection.set(n),l.history.commit())},onPanStart:e=>{o.activeTrim||o.activeStretch||(o.selection.has(n)||(e.metaKey?o.selection.toggle(n):e.shiftKey?o.selection.latest&&o.selection.selectUntil(n):o.selection.set(n),l.history.commit()),o.startDrag())},onPan:(e,t)=>{if(!o.activeTrim&&!o.activeStretch&&o.activeDrag){var i;null===(i=o.activeDrag)||void 0===i||i.clipsAndTheirInitialStartTimes.forEach(e=>{let i=e.clip;(i instanceof tn||i instanceof to)&&(i.setStartPinned(!1),i.setEndPinned(!1)),i.clipTypeCanBeDragged&&i.moveStartTo(e.initialStartTime+o.pxToTime(t.offset.x))})}},onContextMenu:e=>{e.preventDefault(),e.stopPropagation(),o.contextMenu||o.setContextMenu({clip:n,position:{x:e.clientX,y:e.clientY}})},children:[(n instanceof ts||n instanceof tr)&&!o.clock.playing&&(0,u.jsx)(sm,{clip:n,onClick:()=>{n.split(o.clock.seconds),l.history.commit()}}),(null===(i=n.utterance)||void 0===i?void 0:i.generate.isPending)&&(0,u.jsx)(iS,{className:"backdrop-blur-[1.25px] bg-background/25",svgClassName:"text-".concat(h,"-500")}),n.loading&&(0,u.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,u.jsx)(t5.Z,{svgClassName:"inline w-4 h-4 text-".concat(h,"-500 animate-spin")})}),(0,u.jsx)("div",{className:"overlay",style:{opacity:(null===(s=n.track)||void 0===s?void 0:s.isMuted)&&!n.isSelected?.5:1},children:(0,u.jsx)(sd,{duration:1500,children:(0,u.jsx)(sp,{clip:n})})}),d>55&&(0,u.jsxs)("button",{onPointerDown:e=>e.stopPropagation(),onClick:e=>{var t;e.stopPropagation(),null===(t=n.utterance)||void 0===t||t.generate.execute().then(()=>{l.history.commit()})},className:"badge-btn-xs backdrop-blur bg-background/50 absolute top-1 right-4 mr-[2px]",children:[n.audioStale&&d>80&&(0,u.jsx)(tk.default,{variant:"body3",className:"pl-[2px]",children:(0,u.jsx)("span",{className:"text-".concat(h,"-800"),children:(0,u.jsx)(g.cC,{id:"6GbLgo"})})}),(0,u.jsx)(sh,{className:(0,ij.A)("h-2.5 w-2.5 scale-100","text-".concat(h,"-800"))})]}),n.isTrimmed&&d>55&&(0,u.jsx)("div",{className:"badge-xs backdrop-blur bg-gray-300/50 absolute bottom-1 right-4 mr-[2px] cursor-help",children:(0,u.jsx)(iu.Rl,{tooltip:c.t("This clip has been trimmed."),children:(0,u.jsx)(i4.Z,{className:"h-2.5 w-2.5"})})}),(0,u.jsxs)("div",{className:"absolute left-0 h-full",children:[o.mode instanceof o.modes.TrimMode&&(0,u.jsx)(sA,{clip:n,project:o,store:l,width:d,color:h}),!(o.mode instanceof o.modes.TrimMode)&&(0,u.jsx)(sw,{side:"left",onPanStart:e=>{o.startStretch({clip:n,side:"start",initialTime:n.startTime}),n instanceof tn&&n.setStartPinned(!1)},onPan:(e,t)=>{o.activeStretch&&"start"===o.activeStretch.side&&o.activeStretch.clip.stretchStartTo(o.activeStretch.initialTime+o.pxToTime(t.offset.x),{minDuration:.3})},onPanEnd:e=>{n.setAudioStale(!0),o.stopStretch(),l.history.commit()},className:(0,ij.A)(d>30?"visible":"invisible","rounded-l-[calc(0.5rem-1px)] bg-opacity-[0.85]",n.isSelected?"text-".concat(h,"-800 border-r border-").concat(h,"-400"):"text-".concat(h,"-700 border-r border-").concat(h,"-300"),(null===(a=n.track)||void 0===a?void 0:a.isMuted)&&!n.isSelected?"border-opacity-50 bg-".concat(h,"-100"):"border-opacity-100 bg-".concat(h,"-200"))})]}),(0,u.jsxs)("div",{className:"absolute right-0 h-full",children:[o.mode instanceof o.modes.TrimMode&&(0,u.jsx)(sb,{clip:n,project:o,store:l,width:d,color:h}),!(o.mode instanceof o.modes.TrimMode)&&(0,u.jsx)(sw,{side:"right",onPanStart:e=>{o.startStretch({clip:n,side:"end",initialTime:n.endTime}),n instanceof tn&&n.setEndPinned(!1)},onPan:(e,t)=>{o.activeStretch&&"end"===o.activeStretch.side&&o.activeStretch.clip.stretchEndTo(o.activeStretch.initialTime+o.pxToTime(t.offset.x),{minDuration:.3})},onPanEnd:e=>{n.setAudioStale(!0),o.stopStretch(),l.history.commit()},className:(0,ij.A)(d>30?"visible":"invisible","rounded-r-[calc(0.5rem-1px)] bg-opacity-[0.85]",n.isSelected?"text-".concat(h,"-800 border-l border-").concat(h,"-400"):"text-".concat(h,"-700 border-l border-").concat(h,"-300"),(null===(r=n.track)||void 0===r?void 0:r.isMuted)&&!n.isSelected?"border-opacity-50 bg-".concat(h,"-100"):"border-opacity-100 bg-".concat(h,"-200"))})]})]}):null}),sj=(0,T.Pi)(e=>{var t,i;let{clip:s}=e,a=tT(),r=a9(),{i18n:n}=(0,g.mV)(),l=r.timeToPx(s.duration),o=s.utterance.speaker.color;return s.visible?(0,u.jsxs)(b.E.div,{className:(0,ij.A)("flex absolute top-0.5 bottom-0.5 rounded-lg border items-center cursor-pointer",s.isSelected?"bg-".concat(o,"-300 border-").concat(o,"-400"):"bg-".concat(o,"-200 border-").concat(o,"-300"),!s.isSelected&&(null===(t=s.track)||void 0===t?void 0:t.isMuted)&&"bg-opacity-40 border-opacity-40"),style:{width:l,x:r.timeToPx(s.startTime),zIndex:s.track.clips.length-s.index},onPointerDown:e=>{2===e.button?r.selection.has(s)||r.selection.set(s):e.metaKey?r.selection.toggle(s):e.shiftKey?r.selection.latest&&r.selection.selectUntil(s):r.selection.set(s),a.history.commit()},onPointerUp:e=>{e.overClipId=s.id},onPanStart:e=>{r.activeTrim||r.activeStretch||r.startDrag()},onContextMenu:e=>{e.preventDefault(),e.stopPropagation(),r.contextMenu||r.setContextMenu({clip:s,position:{x:e.clientX,y:e.clientY}})},children:[!r.clock.playing&&(0,u.jsx)(sm,{clip:s,onClick:()=>{var e,t,i;s.split(r.clock.seconds),a.history.commit(),null===(e=s.utterance)||void 0===e||e.retranscribe.execute().then(()=>{var e;a.history.commit({replace:!0}),null===(e=s.utterance)||void 0===e||e.targets.forEach(e=>{var t;(null===(t=r.activeTargetBlueprint)||void 0===t?void 0:t.id)!=e.blueprintId&&e.retranslate.execute().then(()=>{a.history.commit({replace:!0})})})}),null==s||null===(i=s.next)||void 0===i||null===(t=i.utterance)||void 0===t||t.retranscribe.execute().then(()=>{var e,t;a.history.commit({replace:!0}),null==s||null===(t=s.next)||void 0===t||null===(e=t.utterance)||void 0===e||e.targets.forEach(e=>{var t;(null===(t=r.activeTargetBlueprint)||void 0===t?void 0:t.id)!=e.blueprintId&&e.retranslate.execute().then(()=>{a.history.commit({replace:!0})})})})}}),s.loading&&(0,u.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,u.jsx)(t5.Z,{})}),(0,u.jsx)("div",{className:"overlay",style:{opacity:(null===(i=s.track)||void 0===i?void 0:i.isMuted)&&!s.isSelected?.5:1},children:(0,u.jsx)(sd,{duration:1500,children:(0,u.jsx)(sp,{clip:s})})}),(0,u.jsx)("div",{className:"absolute left-0 h-full",children:(0,u.jsx)(sA,{clip:s,project:r,store:a,width:l,color:o,onPanEnd:()=>{s.track.clips.length<=3&&s.utterance.speaker.voice.setStale(!0)}})}),(0,u.jsx)("div",{className:"absolute right-0 h-full",children:(0,u.jsx)(sb,{clip:s,project:r,store:a,width:l,color:o,onPanEnd:()=>{s.track.clips.length<=3&&s.utterance.speaker.voice.setStale(!0)}})}),s.canMergeNext&&(0,u.jsx)(iW.u,{label:n.t("Merge"),fontSize:"xs",children:(0,u.jsx)("div",{className:"absolute -right-3 translate-x-[1px] -top-1 bg-slate-300 border border-slate-400 h-4 w-6 rounded-full text-slate-900 hover:brightness-90 flex items-center justify-center",onClick:e=>{if(s.next){var t;s.mergeNext(),a.history.commit(),null===(t=s.utterance)||void 0===t||t.retranscribe.execute().then(()=>{var e;a.history.commit({replace:!0}),null===(e=s.utterance)||void 0===e||e.targets.forEach(e=>{e.retranslate.execute().then(()=>{a.history.commit({replace:!0})})})}).catch(e=>su.error(e))}},onPointerDown:e=>e.stopPropagation(),children:(0,u.jsx)(sc,{className:"h-4 w-6"})})})]}):null}),s_=(0,T.Pi)(e=>{let{clip:t}=e;return t instanceof ts||t instanceof tr?(0,u.jsx)(sy,{clip:t}):(0,u.jsx)(sj,{clip:t})});function sk(e){let{className:t}=e;return(0,u.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",stroke:"currentColor",strokeWidth:"0",viewBox:"0 0 24 24",className:t,children:(0,u.jsx)("path",{stroke:"none",d:"M4 6h2v12H4zm4 7h8.586l-4.293 4.293 1.414 1.414L20.414 12l-6.707-6.707-1.414 1.414L16.586 11H8z"})})}function sS(e){let{className:t}=e;return(0,u.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",stroke:"currentColor",strokeWidth:"0",viewBox:"0 0 24 24",className:t,children:(0,u.jsx)("path",{stroke:"none",d:"M18 6h2v12h-2zm-2 5H7.414l4.293-4.293-1.414-1.414L3.586 12l6.707 6.707 1.414-1.414L7.414 13H16z"})})}let sw=e=>{let{onPanStart:t,onPan:i,onPanEnd:s,side:a,className:r}=e;return(0,u.jsx)("div",{className:(0,ij.A)("relative w-3.5 h-full",r),children:(0,u.jsx)(b.E.div,{className:"absolute inset-0 cursor-grab flex items-center justify-center",onPanStart:t,onPan:i,onPanEnd:s,children:"left"===a?(0,u.jsx)(sS,{className:"w-4/5"}):(0,u.jsx)(sk,{className:"w-4/5"})})})},sC=(0,T.Pi)(e=>{let{clip:t}=e;return(0,u.jsx)(sy,{clip:t})}),sN=(0,T.Pi)(e=>{var t,i,s,a,r,n,o,c,d;let{track:h}=e,p=a9(),{i18n:m}=(0,g.mV)();if(!(p.mode instanceof p.modes.AddMode)&&(null===(t=p.clipboard.data)||void 0===t?void 0:t.type)!=l.Clip&&!(null===(i=p.activeTrackForNewClipPlacement)||void 0===i?void 0:i.canAddNewClipsInAllEditorModes))return null;let v=p.timeToPx(p.durationOfNewClipPlacement),f=[null===(s=p.activeTrackForNewClipPlacement)||void 0===s?void 0:s.id];return p.activeTrackForNewClipPlacement instanceof eR&&f.push(null===(c=p.activeTargetBlueprint)||void 0===c?void 0:null===(n=c.getTrackBySpeakerId(null===(o=p.activeTrackForNewClipPlacement)||void 0===o?void 0:o.speakerId))||void 0===n?void 0:n.id),(0,u.jsx)(iw.M,{children:(p.mode instanceof p.modes.AddMode||(null===(a=p.clipboard.data)||void 0===a?void 0:a.type)==l.Clip||p.activeTrackForNewClipPlacement.canAddNewClipsInAllEditorModes&&(p.isNewClipPlacementValid||p.invalidPlacementReason==eL))&&f.includes(h.id)&&(0,u.jsx)(b.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.12},className:(0,ij.A)("center absolute top-0.5 bottom-0.5 rounded-lg border items-center pointer-events-auto",p.isNewClipPlacementValid?"bg-emerald-100 border-emerald-200 cursor-pointer":"bg-red-100 border-red-200 cursor-default"),style:{width:v,x:p.timeToPx(p.placement.startTime),zIndex:200},children:!p.isNewClipPlacementValid&&(null===(r=p.activeTrackForNewClipPlacement)||void 0===r?void 0:r.id)===h.id&&(0,u.jsx)(iD.k,{className:"text-red-400",info:null!==(d=p.invalidPlacementReason)&&void 0!==d?d:m.t("Invalid placement")})},"new-clip")})}),sT=new se.r({isOpen:!1});function sI(){let{i18n:e}=(0,g.mV)(),t=a9(),[i,s]=(0,E.useState)(""),a=t.multiClipVoices.some(e=>e.name===i);return(0,E.useEffect)(()=>{sT.isOpen&&s("")},[sT.isOpen]),(0,u.jsx)(t_.V,{title:e.t("Create a Voice"),size:"sm",open:sT.isOpen,closeModal:sT.close,content:(0,u.jsx)("div",{children:(0,u.jsx)(iu.UP,{label:e.t("Descriptive Voice Name"),type:"text",placeholder:e.t("Adam (excited, phone call, muffled)"),errorText:a?e.t("Name already taken"):"",value:i,onChange:e=>{s(e.target.value)},maxLength:50})}),actions:(0,u.jsx)(tE.default,{disabled:!i||a,variant:"primary",size:"md",onClick:()=>{t.createMultiClipVoice.execute({name:i,clips:t.selection.clips}).then(()=>{s(""),sT.close(),eo.toast.success(e.t("Voice created successfully. You may now assign it to a clip or track."))}).catch(()=>{eo.toast.error(e.t("Unable to create voice."))})},loading:t.createMultiClipVoice.isPending,children:(0,u.jsx)(g.cC,{id:"hYgDIe"})})})}sI.manager=sT;var sV=(0,T.Pi)(sI);let sP=()=>{let e=a9(),t=e=>{for(let t of(e.speaker instanceof e_&&e.speaker.voice.setStale(!0),e.clips.filter(t=>{var i,s;return t instanceof tl&&((null===(i=t.voiceSpecification)||void 0===i?void 0:i.mode)?(null===(s=t.voiceSpecification)||void 0===s?void 0:s.mode)==="track-clone":"track-clone"===e.voiceSpecification.mode)})))t.setAudioStale(!0)},i=t=>e.targetBlueprints.map(e=>e.getTrackBySpeakerId(t)).filter(e=>void 0!==e);return e=>{let s=new Set;for(let a of e.clipsAndTheirInitialStartTimes){let{clip:e,initialSpeakerId:r}=a,n=e.track.speakerId;if(n&&r&&n!==r&&(e instanceof tt||e instanceof ts)){for(let e of[n,r])if(!s.has(e)){for(let s of i(e).filter(e=>e instanceof eW))s.clips.length<=3&&t(s);s.add(e)}}}}};class sE extends tL{format(e){return this.formatBase(e)}parse(e){let t=e.split(":").map(e=>parseInt(e,10)),i=0;if(3===t.length){let[e,s,a]=t;i+=3600*e+60*s+a}else if(2===t.length){let[e,s]=t;i+=60*e+s}else if(1===t.length){let[e]=t;i+=e}return i}validate(e,t){if(!/^[0-9:]*$/.test(e))return!1;let i=e.split(":");if(i.length>(t<3600?2:3))return!1;for(let e of i)if(e.length>2)return!1;return!0}}class sO extends tL{format(e){let t=this.formatBase(e),i=Math.round(e%1*1e3);return"".concat(t,":").concat(i.toString().padStart(3,"0"))}parse(e){let t=e.split(":"),i=0,s=0;if(4===t.length){let[e,a,r,n]=t;i+=3600*parseInt(e,10)+60*parseInt(a,10)+parseInt(r,10),s=parseInt(n,10)}else if(3===t.length){let[e,a,r]=t;i+=60*parseInt(e,10)+parseInt(a,10),s=parseInt(r,10)}else if(2===t.length){let[e,a]=t;i+=parseInt(e,10),s=parseInt(a,10)}else if(1===t.length){let[e]=t;s=parseInt(e,10)}return i+s/1e3}validate(e,t){if(!/^[0-9:]*$/.test(e))return!1;let i=e.split(":");if(i.length>(t<3600?3:4))return!1;for(let e=0;e<i.length;e++)if(e<i.length-1){if(i[e].length>2)return!1}else if(i[e].length>3)return!1;return!0}}(n=d||(d={}))[n.seconds=0]="seconds",n[n.milliseconds=1]="milliseconds",n[n.frames=2]="frames";let sD=(0,T.Pi)(()=>{var e;let{i18n:t}=(0,g.mV)(),i=a9(),s=(0,E.useRef)(null),[a,r]=(0,E.useState)(0),[n,l]=(0,E.useState)(!1),[o,c]=(0,E.useState)(""),d=(0,E.useMemo)(()=>new sE,[]),h=(0,E.useMemo)(()=>new sO,[]),p=null===(e=(0,ec.LS)(i.dubbingId).data)||void 0===e?void 0:e.input.frame_rate,m=null!=p&&null!=p.frame_count&&null!=p.elapsed_time,v=(0,E.useMemo)(()=>m?new tR(p.frame_count,p.elapsed_time):null,[m,p]),f=(0,E.useMemo)(()=>{let e=new Set([0,1]);return m&&e.add(2),Array.from(e)},[m]),x=f[a],b=e=>0===x?d.parse(e):1===x?h.parse(e):2===x?null==v?void 0:v.parse(e):void 0,A=(0,E.useMemo)(()=>{switch(x){case 2:return m?null==v?void 0:v.format(i.clock.seconds):null;case 1:return h.format(i.clock.seconds);default:return d.format(i.clock.seconds)}},[x,i.clock.seconds,m,v,h,d]);return(0,u.jsxs)("div",{className:"flex flex-row space-x-1 items-center",children:[(0,u.jsx)("div",{children:n?(0,u.jsx)("input",{ref:s,type:"text",value:o.length>0?o:null!=A?A:"",onKeyDown:e=>{if("Enter"===e.key){var t;null===(t=s.current)||void 0===t||t.blur()}},onChange:e=>{let t=e.target.value,s=!1;if(0===x)s=d.validate(t,i.duration);else if(1===x)s=h.validate(t,i.duration);else if(2===x){var a;s=null!==(a=null==v?void 0:v.validate(t,i.duration))&&void 0!==a&&a}s&&c(t)},onBlur:()=>{let e=b(o);null==e||Number.isNaN(e)||i.clock.seek(e),l(!1),c("")},autoFocus:!0,className:(0,ie.cn)("focus:outline-none focus:border-gray-500 focus:ring-gray-500 focus:ring-1 text-gray-700 rounded bg-transparent m-0 p-0 border-none"),style:{fontFamily:"monospace",width:null!=A?"".concat(11*A.length,"px"):"5rem"}}):(0,u.jsx)(tk.default,{variant:"body1",onClick:()=>{i.clock.pause(),l(e=>!e)},style:{fontFamily:"monospace"},className:"ring-1 ring-transparent border border-transparent rounded mr-0.5 mt-[1px]",children:A})}),(0,u.jsx)(tE.default,{size:"xs",variant:"white",className:"relative gap-1 shadow-none px-0 w-6 h-6 rounded-lg focus:ring-0 focus:ring-offset-0",onClick:()=>{r(e=>(e+1)%f.length)},tooltip:{content:2===x?t.t("Time with FPS"):1===x?t.t("Time in milliseconds"):t.t("Time in seconds")},children:2===x?"f":1===x?"ms":"s"})]})});var sB=i(93589),sF=i(55476),sM=i(32507),sL=i(12567),sR=i(20807),sz=i(96474),sU=i(84192);let sJ=(0,U.Z)("file:///app/src/app/(v1)/v1/dubbing/ImportAudioDialog.tsx"),sZ=(0,T.Pi)(e=>{let{isOpen:t,onClose:i}=e,{i18n:s}=(0,g.mV)(),[a,r]=(0,E.useState)(null),[n,l]=(0,E.useState)("static"),[o,c]=(0,E.useState)("true"===localStorage.getItem("disableVoiceCloning")),[d,h]=(0,E.useState)(0),[p,m]=(0,E.useState)(!1),v=a9();(0,E.useEffect)(()=>{localStorage.setItem("disableVoiceCloning",o.toString())},[o]);let f=async()=>{if(null==a){sJ.error("Can't find input file");return}m(!0);let e=new Audio(URL.createObjectURL(a));e.onloadedmetadata=function(){e.duration>v.maximumDurationOfProject?(eo.toast.error(s.t("Audio file is too long to fit in your current studio.")),m(!1)):"static"==n?(0,ec.ln)({audio:a,dubbing_id:v.dubbingId}).then(e=>{v.importAudioClip(a.name,e),v.invalidateDubQuery(),i()}).catch(e=>{eo.toast.error(e.detail.message)}).finally(()=>{m(!1),r(null)}):(0,ec.XQ)({audio:a,dubbing_id:v.dubbingId,num_speakers:d}).then(e=>{v.additionalDubbedAudioStems[e.dubbing_id]={name:a.name,id:e.dubbing_id,status:s.t("Starting")},i()}).catch(e=>{eo.toast.error(e.detail.message)}).finally(()=>{m(!1),r(null)})}},x=(0,sM.dl)("dubbing_studio_can_import_speaker_stems");return(0,u.jsx)(t_.V,{open:t,size:"md",title:s.t("Import Audio File"),content:(0,u.jsxs)("div",{className:"max-h-100 overflow-y-auto overflow-x-visible -mt-2 mx-4",children:[(0,u.jsx)("div",{className:"my-4 ",children:(0,u.jsxs)(sU.RadioCards,{value:n,onValueChange:e=>l(e),children:[(0,u.jsxs)(sU.RadioCard,{value:"static",children:[(0,u.jsx)(sR.X,{children:(0,u.jsx)(g.cC,{id:"JRjR+m"})}),(0,u.jsx)(t3.x,{children:(0,u.jsx)(g.cC,{id:"9t9Noz"})})]}),x&&(0,u.jsxs)(sU.RadioCard,{value:"speakers",children:[(0,u.jsx)(sR.X,{children:(0,u.jsx)(g.cC,{id:"t+saQg"})}),(0,u.jsx)(t3.x,{children:(0,u.jsx)(g.cC,{id:"IUgzr3"})})]})]})}),"speakers"==n&&(0,u.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,u.jsxs)("div",{className:"flex items-center justify-between",children:[(0,u.jsx)(sz.Label,{children:(0,u.jsx)(g.cC,{id:"KnIzxX"})}),(0,u.jsxs)(is.Select,{value:d.toString(),onValueChange:e=>{h(parseInt(e))},children:[(0,u.jsx)(is.SelectTrigger,{className:"w-32",children:(0,u.jsx)(is.SelectValue,{placeholder:s.t("Select number of speakers")})}),(0,u.jsxs)(is.SelectContent,{className:"z-[400]",children:[(0,u.jsx)(is.SelectItem,{value:"0",children:s.t("Auto-detect")}),(0,u.jsx)(is.SelectItem,{value:"1",children:"1"}),(0,u.jsx)(is.SelectItem,{value:"2",children:"2"}),(0,u.jsx)(is.SelectItem,{value:"3",children:"3"}),(0,u.jsx)(is.SelectItem,{value:"4",children:"4"}),(0,u.jsx)(is.SelectItem,{value:"5",children:"5"}),(0,u.jsx)(is.SelectItem,{value:"6",children:"6"}),(0,u.jsx)(is.SelectItem,{value:"7",children:"7"}),(0,u.jsx)(is.SelectItem,{value:"8",children:"8"}),(0,u.jsx)(is.SelectItem,{value:"9",children:"9"})]})]})]}),(0,u.jsxs)("div",{className:"flex items-center justify-between",children:[(0,u.jsx)(sz.Label,{htmlFor:"disableVoiceCloning",children:(0,u.jsx)(g.cC,{id:"44ZJGc"})}),(0,u.jsx)(sL.X,{checked:o,onCheckedChange:e=>c(e)})]})]}),(0,u.jsx)("div",{className:"mt-6 mb-4",children:(0,u.jsx)(ty.Z,{accept:"audio/aac, audio/x-aac, audio/x-aiff, audio/ogg, audio/mpeg, audio/mp3, audio/mpeg3, audio/x-mpeg-3, audio/opus, audio/wav, audio/x-wav, audio/webm, audio/flac, audio/x-flac, audio/mp4",onChange:e=>r(e[0]),fileSizeLimit:524288e3,disabled:p,children:null===a?(0,u.jsxs)("div",{children:[(0,u.jsx)(tf.Z,{className:"mx-auto h-12 w-12 text-gray-500"}),(0,u.jsx)("div",{className:"flex text-sm text-gray-600",children:(0,u.jsx)(tk.default,{className:"relative cursor-pointer rounded-md font-medium text-gray-800 focus-within:outline-none",noBaseClass:!0,variant:"div",children:(0,u.jsx)(g.cC,{id:"I0UTvY"})})}),(0,u.jsx)(tk.default,{className:"text-xs text-gray-500 text-center",noBaseClass:!0,variant:"p",children:(0,u.jsx)(g.cC,{id:"C40h/D",values:{audioFileLimitInMB:500}})})]}):(0,u.jsxs)(tA.m,{className:"mt-2",children:[(0,u.jsx)(tk.default,{className:"text-xs text-gray-500 text-center",noBaseClass:!0,variant:"p",children:(0,u.jsx)(g.cC,{id:"GxkJXS"})}),(0,u.jsx)(tA.K,{fileName:a.name,size:a.size})]})})}),(0,u.jsx)("div",{className:"flex mt-6 justify-end m-2",children:(0,u.jsx)(tj.Button,{disabled:null==a,onClick:f,loading:p,children:(0,u.jsx)(g.cC,{id:"ONWvwQ"})})})]}),closeModal:i,zIndex:"z-[200]"})});var sW=i(55205),sX=i(66046),sG=i.n(sX),sH=i(6970),sK=i.n(sH),sQ=i(26090),sq=e=>{let{isOpen:t,onClose:i}=e,{i18n:s}=(0,g.mV)(),a=(0,E.useRef)(null),r=a9(),n=sK()(r.speakers.filter(e=>e instanceof e_).map(e=>e.media),"src").filter(e=>null!=e),l=sG()(r.speakers.filter(e=>e instanceof e_),e=>{var t;return null===(t=e.media)||void 0===t?void 0:t.src}),o=n.map(e=>{let t=l[e.src].map(e=>e.name);return{...e,name:s._(er.ag._({id:"9Fgt7R",values:{0:t.join(", ")}}))}}),[c,d]=(0,E.useState)(""),h=()=>{d(""),i()};return(0,u.jsx)(ii.Vq,{open:t,onOpenChange:h,children:(0,u.jsxs)(ii.cZ,{onOpenAutoFocus:e=>{var t;e.preventDefault(),null===(t=a.current)||void 0===t||t.focus()},onCloseClicked:h,children:[(0,u.jsxs)(ii.fK,{children:[(0,u.jsx)(ii.$N,{children:(0,u.jsx)(g.cC,{id:"/yS2/0"})}),(0,u.jsx)(ii.Be,{children:(0,u.jsx)(g.cC,{id:"S7X9IB"})})]}),(0,u.jsxs)("div",{className:"flex flex-row space-x-2 pb-2 w-full",children:[(0,u.jsxs)(is.Select,{value:c,onValueChange:d,children:[(0,u.jsx)(is.SelectTrigger,{className:"w-0 flex-1",children:(0,u.jsx)(is.SelectValue,{placeholder:s.t("Choose track...")})}),(0,u.jsx)(is.SelectContent,{className:"max-w-md",children:o.map(e=>(0,u.jsx)(is.SelectItem,{value:e.src,children:e.name},e.src))})]}),(0,u.jsx)(tj.Button,{variant:"outline",className:"w-32",onClick:()=>{let e=o.find(e=>e.src===c);if(null!=e)try{(0,sQ.GM)(e.url,{id:e.url,autoStart:!0,fileName:null==e?void 0:e.name,name:e.name,type:"other",isFirstRequest:!0,player:{title:null==e?void 0:e.name,description:null==e?void 0:e.url}})}catch(e){throw(0,eo.toast)(s.t("We are sorry, something went wrong.")+"\n"+(e.message||"")),e}},disabled:""===c,leftIcon:(0,u.jsx)(iY.Z,{className:"shrink-0 w-4 h-4"}),children:(0,u.jsx)(g.cC,{id:"T91vKp"})})]}),(0,u.jsxs)(ii.cN,{children:[(0,u.jsx)(tj.Button,{size:"md",className:"inline-flex",onClick:h,children:(0,u.jsx)(g.cC,{id:"dEgA5A"})}),(0,u.jsx)(tj.Button,{ref:a,variant:"primary",size:"md",className:"inline-flex",onClick:()=>{r.addDubbedSpeakerTrack(l[c][0]),i()},disabled:!c,children:(0,u.jsx)(g.cC,{id:"BDC232"})})]})]})})};function sY(e){let{value:t,onChange:i,options:s}=e;return(0,u.jsx)("div",{className:"flex gap-3",children:s.map(e=>{let s=e.value===t;return(0,u.jsxs)("div",{className:"flex gap-1.5 cursor-pointer",onClick:()=>{i(e.value)},children:[(0,u.jsx)("div",{className:(0,ij.A)("w-5 h-5 rounded-full border border-slate-200 flex items-center justify-center",s?"bg-foreground text-slate-100":"bg-slate-100 text-foreground"),children:s?e.selectedIcon:e.unselectedIcon}),(0,u.jsx)(tk.default,{color:s?"black":"blackAccent",children:e.label})]},e.value)})})}var s$=i(8020),s0=i(29815);let s1="dub_specific",s2=()=>[{voice_id:"clip-clone",name:"Clip Clone",info:"A cloned voice for this speaker, generated seperately for each clip from the relevant subregion of source audio.",category:s1},{voice_id:"track-clone",name:"Track Clone",info:"A single cloned voice generated using all source audio of this speaker.",category:s1}],s5=()=>ex.getAll().map(e=>({voice_id:e.voiceId,name:e.name,info:"",category:s1})).sort((e,t)=>e.name.localeCompare(t.name)),s4=e=>{let{dubbingId:t}=e,{i18n:i}=(0,g.mV)(),[s,a]=(0,E.useState)(),[r,n]=(0,E.useState)(!1);return{fetch:async e=>{a({userVoices:[],libraryVoices:[]}),n(!0);try{let i=await (0,ec.zc)(t,e);a({userVoices:i.user_voices,libraryVoices:i.library_voices})}catch(e){eo.toast.error(i.t("Failed to retrieve similar voices, try again later."))}n(!1)},similarVoices:s,isLoading:r}},s3=(0,T.Pi)(e=>{var t;let{open:i,onClose:s,track:a,showDubbingVoices:r=!1}=e,{i18n:n}=(0,g.mV)(),l=tT(),o=a9(),c=(0,sM.dl)("similar_voices_threshold_for_dubbing"),{fetch:d,similarVoices:h,isLoading:p}=s4({dubbingId:o.dubbingId}),m=s2(),v=s5(),f=(0,iV.qt5)({pathParams:{voiceId:null!==(t=a.voiceSpecification.voice_library_id)&&void 0!==t?t:""}},{enabled:"voice-library"===a.voiceSpecification.mode&&void 0!==a.voiceSpecification.voice_library_id,refetchOnWindowFocus:!1}),x=(0,E.useMemo)(()=>{if("clip-clone"===a.voiceSpecification.mode)return m.find(e=>"clip-clone"===e.voice_id);if("track-clone"===a.voiceSpecification.mode)return m.find(e=>"track-clone"===e.voice_id);if("voice-library"===a.voiceSpecification.mode&&a.voiceSpecification.voice_library_id){let e=v.find(e=>e.voice_id===a.voiceSpecification.voice_library_id)||null;return f.data?{voice_id:f.data.voice_id,name:f.data.name,info:f.data.description,category:f.data.category}:e}return null},[a.voiceSpecification.mode,a.voiceSpecification.voice_library_id,f.data,v]),b=(0,E.useMemo)(()=>{var e;return[...null!==(e=el.models.value)&&void 0!==e?e:[]].filter(e=>e.can_do_text_to_speech).filter(e=>!e.model_id.startsWith("eleven_v3")).sort((e,t)=>e.name.toLowerCase().localeCompare(t.name.toLowerCase()))},[el.models.value]);return(0,u.jsx)(ii.Vq,{open:i,onOpenChange:s,children:(0,u.jsxs)(ii.cZ,{className:"max-w-sm",overlayClassname:"bg-gray-500 bg-opacity-75 transition-opacity opacity-100",onCloseClicked:s,children:[(0,u.jsxs)(ii.fK,{children:[(0,u.jsx)(ii.$N,{children:(0,u.jsx)(tk.default,{variant:"subtitle2",weight:"medium",color:"darkGray",className:"flex items-center",children:(0,u.jsx)(g.cC,{id:"S4u/CI"})})}),(0,u.jsx)(ii.Be,{children:(0,u.jsx)(tk.default,{variant:"body2",children:(0,u.jsx)(g.cC,{id:"6MTD77"})})})]}),(0,u.jsx)("div",{className:"flex flex-col gap-4 min-w-0",children:(0,u.jsx)("div",{className:"stack gap-2.5",children:(0,u.jsxs)("div",{className:(0,ij.A)("stack gap-2.5"),children:[(0,u.jsxs)("div",{className:"hstack gap-2 justify-between items-center",children:[(0,u.jsx)(tk.default,{className:"w-28",children:(0,u.jsx)(g.cC,{id:"KAXSwC"})}),(0,u.jsx)("div",{className:"w-full overflow-hidden min-w-0",children:(0,u.jsx)(s$.Q,{formStylingSize:"sm",autoFocus:!1,addExtraOptions:(e,t)=>[...r?m:[],...e,...v].filter(e=>e.name.toLowerCase().includes(t.toLowerCase())),suggestedOptionGroups:c?[{id:"library_voices_most_similar",label:n.t("Voice Library - Most Similar"),options:(null==h?void 0:h.libraryVoices)||[],isLoading:p,limit:3},{id:"your_voices_most_similar",label:n.t("Your Voices - Most Similar"),options:(null==h?void 0:h.userVoices)||[],isLoading:p,limit:3}]:void 0,onOpen:()=>{a.speaker instanceof e_&&c&&d(a.speaker.voice.id)},value:x,onValueChange:e=>{a.voiceSpecification&&("clip-clone"===e.voice_id?a.setVoiceSpecification({...a.voiceSpecification,mode:"clip-clone"}):"track-clone"===e.voice_id?a.setVoiceSpecification({...a.voiceSpecification,mode:"track-clone"}):a.setVoiceSpecification({...a.voiceSpecification,voice_library_id:e.voice_id,mode:"voice-library"}),l.history.commit())},side:"top",align:"start"})})]}),(0,u.jsxs)("div",{className:"hstack justify-between items-center",children:[(0,u.jsx)(tk.default,{className:"w-28 mr-2",children:(0,u.jsx)(g.cC,{id:"scu3wk"})}),(0,u.jsxs)(is.Select,{value:a.voiceSpecification.model_id||"default",onValueChange:e=>{a.setVoiceSpecification({...a.voiceSpecification,model_id:"default"===e?null:e}),l.history.commit()},children:[(0,u.jsx)(is.SelectTrigger,{className:"rounded text-sm font-medium py-2 px-1 pl-2 focus:ring-0 min-w-0",children:(0,u.jsx)(is.SelectValue,{})}),(0,u.jsxs)(is.SelectContent,{children:[(0,u.jsx)(is.SelectItem,{value:"default",children:(0,u.jsx)(g.cC,{id:"0kg57f"})}),b.map(e=>(0,u.jsx)(is.SelectItem,{value:e.model_id,children:e.name},e.model_id))]})]})]}),(0,u.jsxs)("div",{className:"hstack items-center gap-2",children:[(0,u.jsx)(tk.default,{className:"w-28",children:(0,u.jsx)(g.cC,{id:"/sL+/p"})}),(0,u.jsx)(iu.iR,{size:"md",value:a.voiceSpecification.stability,onChange:e=>{a.voiceSpecification&&a.setVoiceSpecification({...a.voiceSpecification,stability:e})},onAfterChange:()=>{l.history.commit()},enableThumbTooltip:!0})]}),(0,u.jsxs)("div",{className:"hstack items-center gap-2",children:[(0,u.jsx)(tk.default,{className:"w-28",children:(0,u.jsx)(g.cC,{id:"/eJX8N"})}),(0,u.jsx)(iu.iR,{size:"md",value:a.voiceSpecification.similarity_boost,onChange:e=>{a.voiceSpecification&&a.setVoiceSpecification({...a.voiceSpecification,similarity_boost:e})},onAfterChange:()=>{l.history.commit()},enableThumbTooltip:!0})]}),(0,u.jsxs)("div",{className:"hstack items-center gap-2",children:[(0,u.jsx)(tk.default,{className:"w-28",children:(0,u.jsx)(g.cC,{id:"1CalO6"})}),(0,u.jsx)(iu.iR,{size:"md",value:a.voiceSpecification.style,onChange:e=>{a.voiceSpecification&&a.setVoiceSpecification({...a.voiceSpecification,style:e})},onAfterChange:()=>{l.history.commit()},enableThumbTooltip:!0})]}),(0,u.jsx)(tE.default,{size:"xs",variant:"white",className:"h-7",onClick:()=>{a.voiceSpecification&&(a.setVoiceSpecification({...a.voiceSpecification,...a.defaultVoiceSpecification}),l.history.commit())},children:(0,u.jsx)(g.cC,{id:"kd3dyR"})})]})})})]})})}),s6=(0,T.Pi)(e=>{let{open:t,onClose:i}=e,{i18n:s}=(0,g.mV)(),a=a9(),r=tT(),n=a.selection.latest;return(0,u.jsx)(ii.Vq,{open:t,onOpenChange:i,children:(0,u.jsxs)(ii.cZ,{className:"max-w-sm",overlayClassname:"bg-gray-500 bg-opacity-75 transition-opacity opacity-100",onCloseClicked:i,children:[(0,u.jsxs)(ii.fK,{children:[(0,u.jsx)(ii.$N,{children:(0,u.jsx)(tk.default,{variant:"subtitle2",weight:"medium",color:"darkGray",className:"flex items-center",children:(0,u.jsx)(g.cC,{id:"xkJkmL"})})}),(0,u.jsx)(ii.Be,{children:(0,u.jsx)(tk.default,{variant:"body2",children:(0,u.jsx)(g.cC,{id:"ZXBP8B",values:{0:a.selection.clips.length}})})})]}),(0,u.jsx)("div",{className:"flex flex-col gap-4",children:(0,u.jsxs)("div",{className:"stack gap-2.5",children:[(0,u.jsxs)("div",{className:"hstack items-center gap-2",children:[(0,u.jsx)(tk.default,{className:"w-28",children:(0,u.jsx)(g.cC,{id:"/sL+/p"})}),(0,u.jsx)(iu.iR,{size:"md",value:n.voiceSpecificationWithFallback.stability,onChange:e=>{a.selection.multiclip.setVoiceStability(e)},onAfterChange:()=>{r.history.commit()},enableThumbTooltip:!0,disabled:!n.voiceSpecification})]}),(0,u.jsxs)("div",{className:"hstack items-center gap-2",children:[(0,u.jsx)(tk.default,{className:"w-28",children:(0,u.jsx)(g.cC,{id:"/eJX8N"})}),(0,u.jsx)(iu.iR,{size:"md",value:n.voiceSpecificationWithFallback.similarity_boost,onChange:e=>{a.selection.multiclip.setVoiceSimilarity(e)},onAfterChange:()=>{r.history.commit()},enableThumbTooltip:!0,disabled:!n.voiceSpecification})]}),(0,u.jsxs)("div",{className:"hstack items-center gap-2",children:[(0,u.jsx)(tk.default,{className:"w-28",children:(0,u.jsx)(g.cC,{id:"1CalO6"})}),(0,u.jsx)(iu.iR,{size:"md",value:n.voiceSpecificationWithFallback.style,onChange:e=>{a.selection.multiclip.setVoiceStyle(e)},onAfterChange:()=>{r.history.commit()},enableThumbTooltip:!0,disabled:!n.voiceSpecification})]}),(0,u.jsx)(tE.default,{size:"xs",variant:"white",className:"h-7",onClick:()=>{a.selection.multiclip.resetVoiceSettings(),r.history.commit()},disabled:!n.voiceSpecification,children:(0,u.jsx)(g.cC,{id:"kd3dyR"})})]})})]})})}),s8=(0,T.Pi)(()=>{var e,t,i;let{i18n:s}=(0,g.mV)(),a=tT(),r=a9(),n=(0,sM.dl)("similar_voices_threshold_for_dubbing"),l={trackVoiceSettings:(0,tO.Rh)(),clipVoiceSettings:(0,tO.Rh)()},o=r.selection.latest,{fetch:c,similarVoices:d,isLoading:h}=s4({dubbingId:r.dubbingId}),p=!o.voiceSpecification,m=s2(),v=s5(),f=(0,iV.qt5)({pathParams:{voiceId:null!==(i=o.voiceSpecificationWithFallback.voice_library_id)&&void 0!==i?i:""}},{enabled:"voice-library"===o.voiceSpecificationWithFallback.mode&&void 0!==o.voiceSpecificationWithFallback.voice_library_id,refetchOnWindowFocus:!1}),x=o instanceof tl,b=(0,E.useMemo)(()=>{if("clip-clone"===o.voiceSpecificationWithFallback.mode)return m.find(e=>"clip-clone"===e.voice_id);if("track-clone"===o.voiceSpecificationWithFallback.mode)return m.find(e=>"track-clone"===e.voice_id);if("voice-library"===o.voiceSpecificationWithFallback.mode&&o.voiceSpecificationWithFallback.voice_library_id){let e=v.find(e=>e.voice_id===o.voiceSpecificationWithFallback.voice_library_id)||null;return f.data?{voice_id:f.data.voice_id,name:f.data.name,info:f.data.description,category:f.data.category}:e}return null},[o.voiceSpecificationWithFallback.mode,o.voiceSpecificationWithFallback.voice_library_id,f.data,v]),A=(0,E.useMemo)(()=>{var e;return[...null!==(e=el.models.value)&&void 0!==e?e:[]].filter(e=>e.can_do_text_to_speech).filter(e=>!e.model_id.startsWith("eleven_v3")).sort((e,t)=>e.name.toLowerCase().localeCompare(t.name.toLowerCase()))},[el.models.value]),y=(null==b?void 0:b.voice_id)==="clip-clone"||(null==b?void 0:b.voice_id)==="track-clone";return(0,u.jsxs)("div",{className:"stack gap-2.5",children:[(0,u.jsx)(s3,{track:o.track,open:l.trackVoiceSettings.isOpen,onClose:l.trackVoiceSettings.close}),(0,u.jsx)(s6,{open:l.clipVoiceSettings.isOpen,onClose:l.clipVoiceSettings.close}),(0,u.jsxs)("div",{className:"flex flex-row items-center justify-between",children:[(0,u.jsx)(tk.default,{children:(0,u.jsx)(g.cC,{id:"fnjjLH",components:{0:(0,u.jsx)(tE.default,{size:"xs",variant:"link",className:"inline-flex underline text-gray-800",onClick:l.trackVoiceSettings.open})}})}),(0,u.jsx)(s0.r,{className:"scale-75 origin-right",checked:!o.voiceSpecification,onCheckedChange:e=>{r.selection.multiclip.setInheritVoiceSettings(e),a.history.commit()}})]}),(0,u.jsxs)("div",{className:(0,ij.A)("stack gap-2.5",p&&"opacity-50"),children:[(0,u.jsxs)("div",{className:"hstack justify-between items-center",children:[(0,u.jsx)(tk.default,{className:"shrink-0 mr-3",children:(0,u.jsx)(g.cC,{id:"KAXSwC"})}),(0,u.jsx)("div",{className:"w-full overflow-hidden",children:(0,u.jsx)(s$.Q,{formStylingSize:"sm",addExtraOptions:(e,t)=>[...x?m:[],...e,...v].filter(e=>e.name.toLowerCase().includes(t.toLowerCase())),suggestedOptionGroups:n?[{id:"library_voices_most_similar",label:s.t("Voice Library - Most Similar"),options:(null==d?void 0:d.libraryVoices)||[],isLoading:h,limit:3},{id:"your_voices_most_similar",label:s.t("Your Voices - Most Similar"),options:(null==d?void 0:d.userVoices)||[],isLoading:h,limit:3}]:void 0,onOpen:()=>{n&&c(o.activeVoiceId)},value:b,onValueChange:e=>{"clip-clone"===e.voice_id?r.selection.multiclip.setVoiceMode({mode:"clip-clone"}):"track-clone"===e.voice_id?r.selection.multiclip.setVoiceMode({mode:"track-clone"}):r.selection.multiclip.setVoiceMode({voice_library_id:e.voice_id,mode:"voice-library"}),a.history.commit()},side:"top",align:"start",disabled:p})})]}),(0,u.jsxs)("div",{className:"hstack justify-between items-center",children:[(0,u.jsx)(tk.default,{className:"shrink-0 mr-2",children:(0,u.jsx)(g.cC,{id:"scu3wk"})}),(0,u.jsxs)(is.Select,{disabled:p,value:(null===(e=o.voiceSpecificationWithFallback)||void 0===e?void 0:e.model_id)||"default",onValueChange:e=>{r.selection.multiclip.setModel("default"===e?null:e),a.history.commit()},children:[(0,u.jsx)(is.SelectTrigger,{className:"rounded text-sm py-2 px-1 pl-2 focus:ring-0 min-w-0 font-medium",children:(0,u.jsx)(is.SelectValue,{})}),(0,u.jsxs)(is.SelectContent,{children:[(0,u.jsx)(is.SelectItem,{value:"default",children:(0,u.jsx)(g.cC,{id:"0kg57f"})}),A.map(e=>(0,u.jsx)(is.SelectItem,{value:e.model_id,children:e.name},e.model_id))]})]})]}),(0,u.jsxs)("div",{className:"hstack items-center justify-between",children:[(0,u.jsx)(tk.default,{children:(0,u.jsx)(g.cC,{id:"MXhbIM"})}),(0,u.jsx)(tE.default,{onClick:()=>{l.clipVoiceSettings.open()},variant:"white",size:"xs",className:"px-0 w-5 h-5",title:s.t("Configure Voice"),disabled:p,children:(0,u.jsx)(sF.Z,{className:"w-3 h-3"})})]}),o instanceof tl&&(0,u.jsxs)("div",{className:"hstack justify-between",children:[(0,u.jsx)("label",{htmlFor:"mimicOriginalEmotion",className:(0,ij.A)(y&&!p&&"opacity-50","text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 shrink-0"),children:(0,u.jsx)(tk.default,{children:(0,u.jsx)(g.cC,{id:"NcKvnu"})})}),(0,u.jsx)(sL.X,{id:"mimicOriginalEmotion",disabled:p||y,onCheckedChange:e=>{r.selection.multiclip.setMimicOriginalEmotion(!!e),a.history.commit()},checked:!!(null===(t=o.voiceSpecification)||void 0===t?void 0:t.mimic_original_emotion),size:"sm"})]})]})]})}),s7=e=>{let{track:t}=e,i=tT();return(0,u.jsxs)(iK.v,{placement:"bottom-start",children:[(0,u.jsx)(iQ.j,{children:(0,u.jsx)(sB.Z,{className:"h-3 w-3"})}),(0,u.jsx)(iJ.q,{py:.5,minW:44,children:(0,u.jsx)(iq.s,{onClick:()=>{t.speaker.delete(),i.history.commit()},children:(0,u.jsx)(tk.default,{children:(0,u.jsx)(g.cC,{id:"qibZLj"})})})})]})},s9=e=>{let{track:t}=e,i=tT();return(0,u.jsxs)(iK.v,{placement:"bottom-start",children:[(0,u.jsx)(iQ.j,{children:(0,u.jsx)(sB.Z,{className:"h-3 w-3"})}),(0,u.jsx)(iJ.q,{py:.5,minW:44,children:(0,u.jsx)(iq.s,{onClick:()=>{t.speaker.delete(),i.history.commit()},children:(0,u.jsx)(tk.default,{children:(0,u.jsx)(g.cC,{id:"qibZLj"})})})})]})},ae=e=>{let{track:t}=e,i=tT();return(0,u.jsxs)(iK.v,{placement:"bottom-start",children:[(0,u.jsx)(iQ.j,{children:(0,u.jsx)(sB.Z,{className:"h-3 w-3"})}),(0,u.jsx)(iJ.q,{py:.5,minW:44,children:(0,u.jsx)(iq.s,{onClick:()=>{t.delete(),i.history.commit()},children:(0,u.jsx)(tk.default,{children:(0,u.jsx)(g.cC,{id:"0mPUcN"})})})})]})},at=(0,T.Pi)(e=>{var t;let{track:i}=e;tT();let s=a9();return(0,u.jsx)("div",{className:"relative border-b last:border-b-transparent border-slate-200",style:{height:i.height+"rem"},onPointerEnter:()=>{s.activeDrag&&s.activeDrag.clipsAndTheirInitialStartTimes.forEach(e=>{if(i.isClipRightTypeForTrack(e.clip)){var t;null===(t=e.clip.utterance)||void 0===t||t.setSpeakerId(i.speakerId)}})},children:(0,u.jsx)(ai,{track:i,children:(0,u.jsxs)("div",{className:s.mode instanceof s.modes.AddMode||(null===(t=s.clipboard.data)||void 0===t?void 0:t.type)==l.Clip?"pointer-events-none":"pointer-events-auto",children:[i.clips.map(e=>(0,u.jsx)(s_,{clip:e},e.id)),(0,u.jsx)(sN,{track:i})]})})})}),ai=(0,T.Pi)(e=>{let{track:t,children:i}=e,s=tT(),a=a9();return(0,u.jsx)("div",{className:"absolute w-full h-full",onPointerMove:e=>{var i;(a.mode instanceof a.modes.AddMode||(null===(i=a.clipboard.data)||void 0===i?void 0:i.type)==l.Clip||t.canAddNewClipsInAllEditorModes||a.timelineElement)&&a.setNewClipPlacement({startTime:a.pxToTime(a.timelineElement.scrollLeft+e.clientX-ed(aj))-a.durationOfNewClipPlacement/2,trackId:t.id})},onPointerDown:()=>{var e;(a.mode instanceof a.modes.AddMode||(null===(e=a.clipboard.data)||void 0===e?void 0:e.type)==l.Clip||t.canAddNewClipsInAllEditorModes)&&a.isNewClipPlacementValid&&(a.placeNewClip(),a.setMode(G),s.history.commit())},onPointerLeave:()=>{(a.mode instanceof a.modes.AddMode||t.canAddNewClipsInAllEditorModes)&&a.setNewClipPlacement(null)},children:i})}),as=(0,T.Pi)(e=>{let{track:t}=e;tT();let i=a9();return(0,u.jsx)("div",{className:"relative border-b border-slate-200",style:{height:t.height+"rem"},children:(0,u.jsx)(ai,{track:t,children:(0,u.jsxs)("div",{className:i.mode instanceof i.modes.AddMode?"pointer-events-none":"pointer-events-auto",children:[t.clips.map(e=>(0,u.jsx)(sv,{clip:e},e.id)),(0,u.jsx)(sN,{track:t})]})})})}),aa=(0,T.Pi)(e=>{var t;let{track:i}=e,s=a9();return(0,u.jsx)("div",{className:"relative border-b border-slate-200",style:{height:i.height+"rem"},onPointerEnter:()=>{if(s.activeDrag){var e;null===(e=s.activeDrag)||void 0===e||e.clipsAndTheirInitialStartTimes.forEach(e=>{e.clip instanceof tt&&(i.addBlankClip(e.clip.startTime,e.clip.duration),e.clip.delete(),s.stopDrag())})}},children:(0,u.jsx)(ai,{track:i,children:(0,u.jsxs)("div",{className:s.mode instanceof s.modes.AddMode||(null===(t=s.clipboard.data)||void 0===t?void 0:t.type)==l.Clip?"pointer-events-none":"pointer-events-auto",children:[i.clips.map(e=>(0,u.jsx)(sg,{clip:e},e.id)),(0,u.jsx)(sN,{track:i})]})})})}),ar=(0,T.Pi)(e=>{var t;let{track:i}=e,s=a9();return(0,u.jsx)("div",{className:"relative border-b border-slate-200",style:{height:i.height+"rem"},onPointerEnter:()=>{s.activeDrag&&s.activeDrag.clipsAndTheirInitialStartTimes.forEach(e=>{e.clip instanceof th&&e.clip.setTrackId(i.id)})},children:(0,u.jsx)(ai,{track:i,children:(0,u.jsxs)("div",{className:(null===(t=s.clipboard.data)||void 0===t?void 0:t.type)==l.Clip?"pointer-events-none":"pointer-events-auto",children:[i.clips.map(e=>(0,u.jsx)(sf,{clip:e},e.id)),(0,u.jsx)(sN,{track:i})]})})})}),an=(0,T.Pi)(e=>{let{stem:t}=e,i=a9();return(0,E.useEffect)(()=>(i.startPollingForAudioStemState(t.id),()=>{i.stopPollingForAudioStemState(t.id)}),[]),(0,u.jsx)("div",{className:"flex h-16 border-b last:border-b-transparent border-slate-200 items-center ",children:(0,u.jsx)("div",{className:"sticky left-[250px] w-[calc(100vw-500px)]",children:(0,u.jsxs)("div",{className:"flex gap-3 justify-center w-full ",children:[(0,u.jsx)(tk.default,{className:"self-center",children:(0,u.jsx)(g.cC,{id:"cZMTFc",values:{0:t.name}})}),"failed"===t.status?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(iu.Rl,{tooltip:t.error,children:(0,u.jsx)(t0.Z,{color:"failed"==t.status?"red":"gray",children:t.status})}),(0,u.jsx)(tE.default,{size:"xs",variant:"secondary",onClick:()=>t.dismissed=!0,children:(0,u.jsx)(g.cC,{id:"1QfxQT"})})]}):(0,u.jsx)(t0.Z,{color:"gray",children:t.status})]})})})}),al=(0,T.Pi)(e=>{var t;let{track:i}=e,s=a9();return(0,u.jsx)("div",{className:"relative border-b last:border-b-transparent border-slate-200",style:{height:i.height+"rem"},children:(0,u.jsxs)("div",{className:s.mode instanceof s.modes.AddMode||(null===(t=s.clipboard.data)||void 0===t?void 0:t.type)==l.Clip?"pointer-events-none":"pointer-events-auto",children:[i.clips.map(e=>(0,u.jsx)(sC,{clip:e},e.id)),(0,u.jsx)(sN,{track:i})]})})}),ao=e=>{let{label:t,onClick:i,tooltip:s}=e,a=a9();return(0,u.jsxs)(tE.default,{size:"md",variant:"white",className:(0,ij.A)("relative gap-1 shadow-none px-2 rounded-xl my-3 justify-center"),tooltip:null!=s?{content:s}:null,onClick:()=>{a.clock.pause(),i()},children:[(0,u.jsx)(i3.Z,{className:"h-5 w-5"}),(0,u.jsx)(tk.default,{children:t})]})},ac=(0,T.Pi)(()=>{let{i18n:e}=(0,g.mV)(),t=(0,tO.Rh)(),i=(0,tO.Rh)(),s=a9(),a=s.speakers.filter(e=>e instanceof e_);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(sZ,{isOpen:t.isOpen,onClose:t.close}),(0,u.jsx)(sq,{isOpen:i.isOpen,onClose:i.close}),(0,u.jsx)("div",{className:"flex h-16 border-b last:border-b-transparent border-slate-200",children:(0,u.jsx)("div",{className:"sticky left-[250px] w-[calc(100vw-500px)]",children:(0,u.jsxs)("div",{className:"flex gap-3 justify-center w-full",children:[a.length>0&&(0,u.jsx)(ao,{label:e.t("Add Dubbed Speaker Track"),onClick:async()=>{new Set(a.map(e=>{var t;return null===(t=e.media)||void 0===t?void 0:t.src})).size>1?i.open():s.addDubbedSpeakerTrack(a[0])}}),(0,u.jsx)(ao,{label:e.t("Add Voiceover Track"),tooltip:e.t("Add a new voiceover track. A voiceover track allows you to add clips that are generated using our Text-to-Speech models."),onClick:()=>{s.addVoiceoverTrack()}}),(0,u.jsx)(ao,{label:e.t("Add SFX Track"),tooltip:e.t("Add a new sfx track. A sfx track allows you to add clips that are generated using our Sound Effect models."),onClick:()=>{s.addSfxTrack()}}),(0,u.jsx)(ao,{label:e.t("Upload Audio"),tooltip:e.t("Upload audio to use in the studio."),onClick:()=>t.open()})]})})})]})}),ad=e=>{let{checked:t,onCheckedChange:i,className:s}=e,{i18n:a}=(0,g.mV)();return(0,u.jsx)(tE.default,{size:"xs",className:(0,ie.cn)("h-5 w-5 px-0",s),variant:t?"primary":"white",onClick:()=>i(!t),title:t?a.t("Disable Solo"):a.t("Solo Track"),ariaLabel:t?a.t("Disable Solo"):a.t("Solo Track"),children:(0,u.jsx)(sW.VW,{className:t?"text-background":"text-foreground"})})},au=(0,T.Pi)(e=>{let{track:t}=e;return tT(),(0,u.jsxs)("div",{className:"track-label w-60 border-r border-slate-200 flex items-center justify-between px-4 border-b bg-background",style:{height:t.height+"rem"},children:[(0,u.jsx)("div",{className:(0,ij.A)(t.isMuted&&"opacity-40"),children:(0,u.jsx)(tk.default,{color:"black",children:(0,u.jsx)(g.cC,{id:"GtJbUa"})})}),(0,u.jsx)(ad,{checked:t.isSoloed,onCheckedChange:e=>t.setSoloed(e),className:"mr-5"})]})}),ah=(0,T.Pi)(e=>{let{track:t}=e,{i18n:i}=(0,g.mV)();return(0,u.jsxs)("div",{className:"track-label w-60 border-r border-slate-200 flex items-center justify-between px-4 border-b last:border-b-transparent bg-background",style:{height:t.height+"rem"},children:[(0,u.jsxs)("div",{className:(0,ij.A)("hstack gap-1",t.isMuted&&"opacity-40"),children:[(0,u.jsx)(tk.default,{color:"black",children:(0,u.jsx)(g.cC,{id:"GRlybe"})}),(0,u.jsx)(iD.k,{className:"mt-[1px]",info:i.t('The foreground track is used to preserve elements of the original audio such as laughs, sound effects, and singing. Use "Add Clip" mode to add clips to the foreground track.')})]}),(0,u.jsx)(ad,{checked:t.isSoloed,onCheckedChange:e=>t.setSoloed(e),className:"mr-5"})]})}),ap=(0,T.Pi)(e=>{let{track:t}=e,i=tT();return(0,u.jsxs)("div",{className:"track-label w-60 border-r border-slate-200 flex items-center justify-between px-4 border-b last:border-b-transparent bg-background",style:{height:t.height+"rem"},children:[(0,u.jsxs)("div",{className:(0,ij.A)("gap-1",t.isMuted&&"opacity-40"),children:[(0,u.jsx)(t1.Z,{defaultValue:t.name,onChange:e=>{t.setName(e),i.history.commit()}},t.name),(0,u.jsx)(tk.default,{variant:"body3",className:"capitalize",children:(0,u.jsx)(g.cC,{id:"kwYBaE"})})]}),(0,u.jsxs)("div",{className:"hstack gap-2",children:[(0,u.jsx)(ad,{checked:t.isSoloed,onCheckedChange:e=>t.setSoloed(e)}),(0,u.jsx)(ae,{track:t})]})]})}),am=(0,T.Pi)(e=>{let{track:t}=e;return t instanceof ez?(0,u.jsx)(av,{track:t}):t instanceof eU?(0,u.jsx)(ag,{track:t}):t instanceof eJ?(0,u.jsx)(ax,{track:t}):void 0}),av=(0,T.Pi)(e=>{let{track:t}=e,i=tT();return(0,u.jsxs)("div",{className:"track-label w-60 border-r border-slate-200 flex items-center justify-between px-4 border-b last:border-b-transparent bg-background",style:{height:t.height+"rem"},children:[(0,u.jsxs)("div",{className:(0,ij.A)(t.isMuted&&"opacity-40"),children:[(0,u.jsx)(t1.Z,{defaultValue:t.speaker.name,onChange:e=>{t.speaker.setName(e),i.history.commit()}},t.speaker.name),(0,u.jsx)(tk.default,{variant:"body3",children:(0,u.jsx)(g.cC,{id:"HxF6Fk"})})]}),(0,u.jsxs)("div",{className:"hstack gap-2",children:[(0,u.jsx)(ad,{checked:t.isSoloed,onCheckedChange:e=>t.setSoloed(e)}),(0,u.jsx)(s7,{track:t})]})]})}),ag=(0,T.Pi)(e=>{let{track:t}=e,{i18n:i}=(0,g.mV)(),s=tT(),a={voiceSettings:(0,tO.Rh)()};return(0,u.jsxs)("div",{className:"track-label w-60 border-r border-slate-200 flex items-center justify-between px-4 border-b last:border-b-transparent bg-background",style:{height:t.height+"rem"},children:[(0,u.jsx)(s3,{track:t,open:a.voiceSettings.isOpen,onClose:a.voiceSettings.close}),(0,u.jsxs)("div",{className:(0,ij.A)(t.isMuted&&"opacity-40"),children:[(0,u.jsx)(t1.Z,{defaultValue:t.speaker.name,onChange:e=>{t.speaker.setName(e),s.history.commit()}},t.speaker.name),(0,u.jsx)(tk.default,{variant:"body3",className:"capitalize",children:(0,u.jsx)(g.cC,{id:"6h/Hoz"})})]}),(0,u.jsxs)("div",{className:"flex items-center gap-2",children:[(0,u.jsx)(tE.default,{onClick:()=>{a.voiceSettings.open()},variant:"white",size:"xs",className:"px-0 w-5 h-5",title:i.t("Configure Voice"),children:(0,u.jsx)(sF.Z,{className:"w-3 h-3"})}),(0,u.jsx)(ad,{checked:t.isSoloed,onCheckedChange:e=>t.setSoloed(e)}),(0,u.jsx)(s7,{track:t})]})]})}),af=(0,T.Pi)(e=>{let{track:t}=e;return t instanceof eW?(0,u.jsx)(ab,{track:t}):(0,u.jsx)(ax,{track:t})}),ax=(0,T.Pi)(e=>{let{track:t}=e,i=tT();return(0,u.jsxs)("div",{className:"track-label w-60 border-r border-slate-200 flex items-center justify-between px-4 border-b last:border-b-transparent bg-background",style:{height:t.height+"rem"},children:[(0,u.jsxs)("div",{className:(0,ij.A)(t.isMuted&&"opacity-40"),children:[(0,u.jsx)(t1.Z,{defaultValue:t.speaker.name,onChange:e=>{t.speaker.setName(e),i.history.commit()}},t.speaker.name),(0,u.jsx)(tk.default,{variant:"body3",className:"capitalize",children:(0,u.jsx)(g.cC,{id:"oSAlJD",values:{0:(0,ia.pQ)(t.blueprint.language)}})})]}),(0,u.jsxs)("div",{className:"flex items-center gap-2",children:[(0,u.jsx)(ad,{checked:t.isSoloed,onCheckedChange:e=>t.setSoloed(e)}),(0,u.jsx)(s9,{track:t})]})]})}),ab=(0,T.Pi)(e=>{let{track:t}=e,{i18n:i}=(0,g.mV)(),s=tT(),a={voiceSettings:(0,tO.Rh)()};return(0,u.jsxs)("div",{className:"track-label w-60 border-r border-slate-200 flex items-center justify-between px-4 border-b last:border-b-transparent bg-background",style:{height:t.height+"rem"},children:[(0,u.jsx)(s3,{track:t,open:a.voiceSettings.isOpen,onClose:a.voiceSettings.close,showDubbingVoices:t instanceof eX}),(0,u.jsxs)("div",{className:(0,ij.A)(t.isMuted&&"opacity-40"),children:[(0,u.jsx)(t1.Z,{defaultValue:t.speaker.name,onChange:e=>{t.speaker.setName(e),s.history.commit()}},t.speaker.name),(0,u.jsx)(tk.default,{variant:"body3",className:"capitalize",children:(0,ia.pQ)(t.blueprint.language)})]}),(0,u.jsxs)("div",{className:"flex items-center gap-2",children:[(0,u.jsx)(tE.default,{onClick:()=>{a.voiceSettings.open()},variant:"white",size:"xs",className:"px-0 w-5 h-5",title:i.t("Configure Voice"),children:(0,u.jsx)(sF.Z,{className:"w-3 h-3"})}),(0,u.jsx)(ad,{checked:t.isSoloed,onCheckedChange:e=>t.setSoloed(e)}),(0,u.jsx)(s9,{track:t})]})]})}),aA=(0,T.Pi)(()=>(0,u.jsx)("div",{className:"track-label w-60 border-r border-slate-200 flex items-center px-4 h-16 border-b last:border-b-transparent bg-background"})),ay=(0,T.Pi)(()=>{let{i18n:e}=(0,g.mV)(),t=a9();return(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{className:"h-8 border-b border-r border-slate-200 sticky top-0 z-10 bg-background bg-opacity-90 px-4 flex pt-0.5",children:t.activeTargetBlueprint&&(0,u.jsx)(sY,{options:[{value:"source",label:e.t("Original"),selectedIcon:(0,u.jsx)(sn,{className:"w-1/2 h-1/2"}),unselectedIcon:(0,u.jsx)(sl,{className:"w-1/2 h-1/2"})},{value:"target",label:(0,ia.pQ)(t.selectedLanaguage||""),selectedIcon:(0,u.jsx)(sn,{className:"w-1/2 h-1/2"}),unselectedIcon:(0,u.jsx)(sl,{className:"w-1/2 h-1/2"})}],value:t.listeningMode,onChange:e=>t.setListeningMode(e)})}),t.sourceBlueprint.backgroundTrack&&(0,u.jsx)(au,{track:t.sourceBlueprint.backgroundTrack},t.sourceBlueprint.backgroundTrack.id),t.sourceBlueprint.foregroundTrack&&(0,u.jsx)(ah,{track:t.sourceBlueprint.foregroundTrack},t.sourceBlueprint.foregroundTrack.id),t.sourceBlueprint.importedAudioTracks&&t.sourceBlueprint.importedAudioTracks.map(e=>(0,u.jsx)(ap,{track:e},e.id)),t.speakers.map(e=>(0,u.jsxs)(E.Fragment,{children:[(0,u.jsx)(am,{track:t.sourceBlueprint.getTrackBySpeakerId(e.id)}),t.activeTargetBlueprint&&(0,u.jsx)(af,{track:t.activeTargetBlueprint.getTrackBySpeakerId(e.id)})]},e.id)),t.inprogressSpeakerStemImports.map(e=>(0,u.jsx)(aA,{},e.id)),(0,u.jsx)(aA,{},-1)]})}),aj=15,a_=(0,T.Pi)(e=>{let{height:t}=e,i=a9(),s=(0,i6.c)(i.timeToPx(i.clock.seconds));return(0,E.useEffect)(()=>i.clock.onTimeChange(()=>{s.set(i.timeToPx(i.clock.seconds))}),[i.clock]),(0,E.useEffect)(()=>{s.set(i.timeToPx(i.clock.seconds))},[i.pixelsPerSecond]),(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(b.E.div,{style:{x:s,height:t},className:"absolute top-[calc(100%-1rem)] flex flex-col items-center z-10",children:[(0,u.jsx)(iY.Z,{className:"rotate-90 h-4 w-4 absolute top-0"}),(0,u.jsx)(b.E.div,{className:"absolute w-[1px] top-2 bottom-0 bg-foreground"})]})})}),ak=(0,T.Pi)(()=>{let e=a9(),t=(0,E.useRef)();return e.loopRange?(0,u.jsxs)("div",{className:"hstack justify-between items-center absolute bg-blue-400/30 h-3.5 bottom-[1px] rounded-md pointer-events-auto overflow-hidden",style:{left:e.timeToPx(e.loopRange.start),width:e.timeToPx(e.loopRange.end-e.loopRange.start)},children:[(0,u.jsx)(sx,{className:"rounded-l-[inherit] bg-blue-300 min-w-[0.5rem] z-10",onPanStart:i=>{t.current=e.loopRange},onPan:(i,s)=>{let a=t.current.start+e.pxToTime(s.offset.x);t.current.end-a<1&&(a=t.current.end-1),e.setLoopRange({start:a,end:t.current.end})},onPanEnd:()=>{t.current=null},disableInnerHandle:!0}),(0,u.jsx)("button",{onPointerDown:e=>{e.stopPropagation()},onClick:t=>{t.stopPropagation(),e.setLoopRange(null)},className:"absolute left-1/2 -translate-x-1/2 badge-btn-xs backdrop-blur bg-background/50 h-2.5",children:(0,u.jsx)(i0.Z,{className:"h-2.5 w-2.5"})}),(0,u.jsx)(sx,{className:"rounded-r-[inherit] bg-blue-300 min-w-[1rem] z-10",onPanStart:i=>{t.current=e.loopRange},onPan:(i,s)=>{let a=t.current.end+e.pxToTime(s.offset.x);a-t.current.start<1&&(a=t.current.start+1),e.setLoopRange({start:t.current.start,end:a})},onPanEnd:()=>{t.current=null},disableInnerHandle:!0})]}):null}),aS=(0,E.memo)((0,T.Pi)(()=>{let e=a9(),t=(0,E.useRef)(null),i=(0,E.useRef)(),s=e.pixelsPerSecond<62?5:1,a=s<1?.1:.5,r=e.duration,n=(0,E.useRef)(null),l=(0,E.useRef)(null),o=(0,E.useMemo)(()=>new sE,[]);return(0,u.jsxs)(b.E.div,{ref:t,className:"flex h-8 select-none cursor-pointer sticky top-0 bg-background z-[999] border-b border-slate-200",onPointerDown:s=>{i.current=e.clock.playing,e.clock.pause();let a=s.clientX-t.current.getBoundingClientRect().x,r=e.pxToTime(a);e.clock.seek(r),s.metaKey&&(n.current=r)},onPointerUp:t=>{l.current&&(clearTimeout(l.current),l.current=null),i.current&&e.clock.resume()},onPan:i=>{let s=i.clientX-t.current.getBoundingClientRect().x,a=e.pxToTime(s);e.clock.seek(a),n.current&&(a>n.current?e.setLoopRange({start:n.current,end:a}):e.setLoopRange({start:a,end:n.current}))},onPanEnd:t=>{n.current=null,i.current&&e.clock.resume()},children:[(0,u.jsx)("div",{className:"w-max flex overflow-x-hidden items-end",style:{maxWidth:e.timeToPx(r)},children:i7()(0,r,a).map(t=>(0,u.jsx)("div",{style:{width:e.pixelsPerSecond*a,minWidth:e.pixelsPerSecond*a},children:(0,u.jsxs)("div",{className:"w-fit flex flex-col items-center -translate-x-1/2",children:[(0,u.jsx)(tk.default,{className:(0,ij.A)("w-fit",t%s==0&&"text-foreground",t%s!=0&&"text-gray-400"),children:t%s==0&&o.format(t)}),(0,u.jsx)("div",{className:(0,ie.cn)("w-[0.5px]",t%s==0?"bg-foreground":"bg-gray-300",t%s==0?"h-2":"h-1")})]})},"ruler-timing-"+t))}),(0,u.jsx)(ak,{}),(0,u.jsx)(a_,{height:e.activeTracksHeight+4+4*e.inprogressSpeakerStemImports.length+1+"rem"})]})})),aw=(0,T.Pi)(()=>{let{i18n:e}=(0,g.mV)(),t=a9();return(0,u.jsxs)("div",{className:"flex gap-2.5 h-full items-center -mt-0.5",children:[(0,u.jsx)(tk.default,{variant:"body2",children:(0,u.jsx)(g.cC,{id:"ACjxWW"})}),(0,u.jsx)(iu.iR,{value:t.pixelsPerSecond,onChange:e=>t.setPixelsPerSecond(e),min:t.MIN_PIXELS_PER_SECOND,max:t.MAX_PIXELS_PER_SECOND,step:2,size:"md",className:"w-full"})]})}),aC=(0,T.Pi)(()=>{let{i18n:e}=(0,g.mV)(),t=a9(),[i,s]=(0,E.useState)(!1);return(0,tO.yU)({current:t.timelineElement},e=>{s(e.contentRect.height/ed(1)<=2)}),(0,u.jsxs)("div",{className:"flex justify-between items-end pt-3.5 pb-3.5 px-3.5",children:[(0,u.jsx)("div",{className:"w-48",children:(0,u.jsx)(tE.default,{size:"xs",variant:"white",className:"rounded-xl focus:ring-0 focus:shadow-none focus:ring-offset-0",tooltip:{content:i?e.t("Expand"):e.t("Collapse")},onClick:()=>{null!=t.timelineElement&&(t.timelineElement.style.height=(i?15:2)+"rem")},children:i?(0,u.jsx)(i1.Z,{className:"h-4 w-4"}):(0,u.jsx)(i2.Z,{className:"h-4 w-4"})})}),!t.clock.playing&&(0,u.jsx)(iY.Z,{onClick:()=>{z.BL().then(()=>{t.clock.resume(),t.mediaManager.video.play()})},className:"h-8 w-8 cursor-pointer"}),t.clock.playing&&(0,u.jsx)(i$.Z,{onClick:()=>t.clock.pause(),className:"h-8 w-8 cursor-pointer"}),(0,u.jsxs)("div",{className:"w-48 flex gap-4 justify-end items-center",children:[(0,u.jsx)(sD,{}),(0,u.jsxs)("div",{className:"w-fit flex",children:[(0,u.jsx)(tE.default,{size:"xs",variant:t.mode instanceof t.modes.SelectMode?"primary":"white",className:(0,ij.A)("relative gap-1 shadow-none px-0 w-8 h-8 rounded-r-none rounded-l-xl",t.mode instanceof t.modes.SelectMode&&"z-10"),tooltip:{content:e.t("Select")},onClick:()=>t.setMode(t.modes.SelectMode),children:(0,u.jsx)(i5.Z,{className:"h-4 w-4"})}),(0,u.jsx)(tE.default,{size:"xs",variant:t.mode instanceof t.modes.TrimMode?"primary":"white",className:(0,ij.A)("relative gap-1 shadow-none px-0 w-8 h-8 rounded-l-none rounded-r-none",t.mode instanceof t.modes.TrimMode&&"z-10"),tooltip:{content:e.t("Trim")},onClick:()=>t.setMode(t.modes.TrimMode),children:(0,u.jsx)(i4.Z,{className:"h-5 w-5"})}),(0,u.jsx)(tE.default,{size:"xs",variant:t.mode instanceof t.modes.AddMode?"primary":"white",className:(0,ij.A)("relative gap-1 shadow-none px-0 w-8 h-8 rounded-l-none rounded-r-xl",t.mode instanceof t.modes.AddMode&&"z-10"),tooltip:{content:e.t("Add Clip")},onClick:()=>t.setMode(t.modes.AddMode),children:(0,u.jsx)(i3.Z,{className:"h-5 w-5"})})]})]})]})}),aN=(0,T.Pi)(e=>{var t,i,s,a,r;let{i18n:n}=(0,g.mV)(),o=tT(),c=a9(),d=[{id:"loop-clip",handler:()=>{c.setLoopRange({start:c.selection.latest.startTime,end:c.selection.latest.endTime})},label:n.t("Loop Clip")}];c.selection.allOfType(tt)&&d.push({id:"transcribe-audio",handler:()=>{c.selection.multiclip.transcribe()},label:n.t("Transcribe Audio")}),(null===(t=c.selection.latest)||void 0===t?void 0:t.clipTypeCanBeCopied)&&d.push({id:"copy-clip",handler:()=>{c.clipboard.copy(l.Clip)},label:n.t("Copy Clip")}),c.selection.allOfType(tn,to)&&d.push({id:"pin-start",handler:()=>{c.selection.multiclip.setStartPinned(!0),o.history.commit()},label:n.t("Pin Start")},{id:"pin-end",handler:()=>{c.selection.multiclip.setEndPinned(!0),o.history.commit()},label:n.t("Pin End")}),c.selection.allOfType(tl)&&d.push({id:"align-with-original",handler:()=>{c.selection.clips.forEach(e=>{if(e.utterance){let t=e.utterance.source.clip;e.moveStartTo(t.startTime),e.stretchEndTo(t.endTime)}}),o.history.commit()},label:n.t("Align with original clip")}),c.selection.allOfType(ti,ta)&&c.selection.multiclip.canGenerate&&d.push({id:"generate-audio",handler:()=>{c.selection.multiclip.generate({strictTiming:!0})},label:n.t("Generate Audio (Fixed Duration)")},{id:"generate-audio-without-timing",handler:()=>{c.selection.multiclip.generate({strictTiming:!1})},label:n.t("Generate Audio (Dynamic Duration)")}),c.selection.latest instanceof ti&&d.push({id:"copy-voice-settings",handler:()=>{c.clipboard.copy(l.Voice)},label:n.t("Copy Voice Settings")}),(c.selection.latest instanceof ta||c.selection.latest instanceof ti)&&d.push({id:"view-clip-history",handler:()=>{ss.manager.open(c.selection.latest)},label:n.t("Clip History")}),c.selection.allOfType(ti,ta)&&c.selection.clips.some(e=>e.audioStale)&&d.push({id:"mark-clip-as-not-stale",handler:()=>{c.selection.clips.forEach(e=>{e.setAudioStale(!1)})},label:n.t("Mark as not stale")}),c.clipboard.data&&c.selection.allOfType(ti)&&d.push({id:"paste-voice-settings",handler:()=>{c.clipboard.paste(),o.history.commit()},label:n.t("Paste Voice Settings")}),d.push({id:"create-multiclip-voice",handler:()=>{sV.manager.open()},label:n.t("Create Voice from Selection")},{id:"Download Audio",handler:()=>{c.selection.multiclip.download()},label:n.t("Download Audio")},{id:"delete",handler:()=>{c.selection.multiclip.delete(),o.history.commit()},label:n.t("Delete")});let[h,p]=(0,E.useState)(0),m=d[h];return(0,u.jsxs)(iH.h,{children:[(0,u.jsx)(sV,{}),(0,u.jsx)(ss,{}),(0,u.jsxs)(iK.v,{isOpen:!!c.contextMenu,onClose:()=>{c.setContextMenu(null)},strategy:"fixed",placement:"bottom-start",children:[(0,u.jsx)(iQ.j,{className:"fixed w-0 h-0 invisible",style:{left:null!==(a=null===(i=c.contextMenu)||void 0===i?void 0:i.position.x)&&void 0!==a?a:0,top:null!==(r=null===(s=c.contextMenu)||void 0===s?void 0:s.position.y)&&void 0!==r?r:0}}),(0,u.jsx)(iJ.q,{py:.5,onKeyDownCapture:e=>{"Enter"===e.key&&(e.stopPropagation(),e.preventDefault(),m.handler(),c.setContextMenu(null)),"ArrowUp"===e.key?(e.stopPropagation(),p(e=>{let t=e-1;return t<0&&(t=d.length-1),t})):"ArrowDown"===e.key&&(e.stopPropagation(),p(e=>{let t=e+1;return t>d.length-1&&(t=0),t}))},children:d.map((e,t)=>(0,u.jsx)(iq.s,{bg:h===t?"gray.100":"transparent",onPointerOver:()=>{p(t)},onClick:()=>{m.handler(),c.setContextMenu(null)},children:(0,u.jsx)(tk.default,{children:e.label})},e.id))})]},String(!!c.contextMenu))]})}),aT=(0,T.Pi)(()=>{let e=a9(),t=(0,E.useRef)(0);return(0,u.jsx)(b.E.div,{className:"absolute h-3 -top-1.5 w-full select-none group cursor-row-resize flex items-center",onPanStart:i=>{var s,a;null===(s=(a=i.target).setPointerCapture)||void 0===s||s.call(a,i.pointerId),e.timelineElement&&(t.current=e.timelineElement.clientHeight)},onDoubleClick:t=>{e.timelineElement&&(e.timelineElement.style.height="15rem")},onPan:(i,s)=>{let a=ed(4);e.timelineElement&&(e.timelineElement.style.height=4*Math.floor((t.current-s.offset.y)/a)+2+"rem")},onPanEnd:e=>{var t,i;null===(t=(i=e.target).releasePointerCapture)||void 0===t||t.call(i,e.pointerId)},children:(0,u.jsx)(b.E.div,{className:"h-[2px] w-full bg-foreground/80 opacity-0 group-hover:opacity-100 transition-opacity delay-75"})})}),aI=e=>{let{label:t,children:i,border:s=!0,className:a}=e;return(0,u.jsxs)("div",{className:(0,ij.A)("stack gap-[0.4375rem] p-4",s&&"border-b border-gray-50",a),children:[t&&(0,u.jsx)(tk.default,{variant:"body2",color:"blackAccent",children:t}),(0,u.jsx)("div",{children:i})]})},aV=(0,T.Pi)(()=>{var e;let{i18n:t}=(0,g.mV)(),[i,s]=(0,E.useState)(),a=tT(),r=a9(),n=sP();return(0,E.useEffect)(()=>{s(void 0)},[r.selection.latest]),(0,i9.OR)("pointerup",()=>{r.activeDrag&&(n(r.activeDrag),r.stopDrag(),a.history.commit())}),(0,i9.OR)("wheel",e=>{if(e.altKey){e.preventDefault();let t=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY>0?"down":"up":e.deltaX>0?"right":"left";return"up"===t||"left"===t?r.setPixelsPerSecond(r.pixelsPerSecond+1):r.setPixelsPerSecond(r.pixelsPerSecond-1),!1}},void 0,{passive:!1}),(0,u.jsxs)("div",{className:"relative z-[5] border-b",children:[(0,u.jsx)(aT,{}),(0,u.jsx)(aN,{}),(0,u.jsx)(aC,{}),(0,u.jsxs)(b.E.div,{ref:e=>{r.setTimelineElement(e)},id:"dubbing-timeline",className:"relative flex overflow-auto focus:ring-0 focus:outline-none",style:{maxHeight:"min(60vh, ".concat(r.activeTracksHeight+4+4*r.inprogressSpeakerStemImports.length+2+"rem",")"),height:"15rem"},onScroll:()=>{r.updateVisibleRange()},children:[(0,u.jsx)("div",{className:"w-60 sticky left-0 z-[1000]",children:(0,u.jsx)(ay,{})}),(0,u.jsx)("div",{className:"flex flex-col flex-1 h-full relative",children:(0,u.jsxs)("div",{className:"w-full",children:[(0,u.jsx)(aS,{}),(0,u.jsxs)("div",{className:"bg-slate-50",onPointerUp:e=>{e.overClipId||(r.selection.clear(),a.history.commit())},children:[r.sourceBlueprint.backgroundTrack&&(0,u.jsx)(as,{track:r.sourceBlueprint.backgroundTrack},r.sourceBlueprint.backgroundTrack.id),r.sourceBlueprint.foregroundTrack&&(0,u.jsx)(aa,{track:r.sourceBlueprint.foregroundTrack},r.sourceBlueprint.foregroundTrack.id),r.sourceBlueprint.importedAudioTracks&&r.sourceBlueprint.importedAudioTracks.map(e=>(0,u.jsx)(ar,{track:e},e.id)),r.speakers.map(e=>(0,u.jsxs)(E.Fragment,{children:[(0,u.jsx)(at,{track:r.sourceBlueprint.getTrackBySpeakerId(e.id)}),r.activeTargetBlueprint&&(0,u.jsx)(al,{track:r.activeTargetBlueprint.getTrackBySpeakerId(e.id)})]},e.id)),r.inprogressSpeakerStemImports.map(e=>(0,u.jsx)(an,{stem:e},e.id)),(0,u.jsx)(ac,{},-1)]})]})}),(0,u.jsxs)("div",{className:"flex flex-col sticky right-0 top-0 z-[1000] self-stretch border-l border-slate-200",children:[(0,u.jsx)("div",{className:"h-8 border-b border-slate-200 sticky top-0 bg-background bg-opacity-90 px-4",children:(0,u.jsx)(aw,{})}),(0,u.jsx)("div",{className:"relative flex-1 w-60 bg-background",children:(0,u.jsxs)("div",{className:"stack overlay overflow-y-auto",children:[r.selection.isEmpty&&(0,u.jsx)(aI,{border:!1,children:(0,u.jsx)(tk.default,{color:"blackAccent",children:(0,u.jsx)(g.cC,{id:"jJEB8u"})})}),!r.selection.isEmpty&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(aI,{label:1===r.selection.clips.length?t._(er.ag._({id:"kxqZwN",values:{0:r.selection.clips.length}})):t._(er.ag._({id:"o0hCdK",values:{0:r.selection.clips.length}})),children:(0,u.jsxs)("div",{className:"stack gap-2",children:[(0,u.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,u.jsx)(tk.default,{className:"w-28",children:(0,u.jsx)(g.cC,{id:"/cF7Rs"})}),(0,u.jsx)(iu.iR,{size:"md",value:r.selection.latest.volume,onChange:e=>r.selection.multiclip.setVolume(e),onAfterChange:()=>a.history.commit(),min:-30,max:5,step:.1,enableThumbTooltip:!0,thumbTooltipFormatter:e=>(e<0?"":"+")+e.toFixed(1)+"db"})]}),r.selection.allOfType(ti)&&(0,u.jsx)(tE.default,{size:"xs",variant:"white",className:"w-full h-6",onClick:()=>{sV.manager.open()},children:(0,u.jsx)(g.cC,{id:"lbD4j2"})})]})}),r.selection.allOfType(tn,ts)&&(0,u.jsx)(aI,{label:t.t("Voice Settings"),children:(0,u.jsx)(s8,{})}),1===r.selection.clips.length&&(null===(e=r.selection.latest)||void 0===e?void 0:e.clipTypeCanBeGeneratedUsingSTS)&&(0,u.jsxs)(aI,{label:t.t("Dictation"),children:[i&&(0,u.jsx)(sa.Z,{file:i,onDelete:()=>s(void 0),showFileMetadata:!1,title:t.t("STS Prompt:")}),!i&&(0,u.jsx)(sr.A,{setFile:s,maxDurationSecs:r.selection.latest.trailingGap+r.selection.latest.duration,showMaxDuration:!0,showToastOnMaxDuration:!1})]}),(0,u.jsx)("div",{className:"flex-1"}),!r.selection.isEmpty&&r.selection.allOfType(tt)&&(0,u.jsxs)(aI,{border:!1,className:"sticky bottom-0 z-10",children:[(0,u.jsx)("div",{className:"overlay -top-14 bg-gradient-to-b from-transparent to-[#fff] pointer-events-none"}),(0,u.jsx)(tE.default,{size:"xs",variant:"white",className:"relative w-full h-6 disabled:!opacity-100 disabled:backdrop-blur-sm disabled:text-opacity-50",onClick:()=>{r.selection.multiclip.transcribe()},loading:r.selection.multiclip.isTranscribing,children:(0,u.jsx)(g.cC,{id:"Sfuiwf"})})]}),r.selection.allOfType(tl,ts,ta,tc)&&(0,u.jsxs)(aI,{border:!1,className:"sticky bottom-0 z-10 pt-0",children:[(0,u.jsx)("div",{className:"overlay -top-14 bg-gradient-to-b from-transparent to-[#fff] pointer-events-none"}),(0,u.jsx)(tE.default,{size:"xs",variant:"white",className:"relative w-full h-6 disabled:!opacity-100 disabled:backdrop-blur-sm disabled:text-opacity-50",onClick:()=>{r.selection.multiclip.generate({dictation:i})},loading:r.selection.multiclip.isGenerating,disabled:!r.selection.multiclip.canGenerate,children:(0,u.jsx)(g.cC,{id:"z42gzB",values:{0:i?t.t("(STS)"):""}})})]})]})]})})]})]})]})});var aP=i(43702),aE=i(16130);let aO=(0,T.Pi)(e=>{var t,i,s,a,r;let{utterance:n,fullWidth:l=!1}=e,{i18n:o}=(0,g.mV)(),c=tT(),d=a9(),h=(0,E.useRef)(null),p=(0,E.useRef)(null),m=(0,E.useRef)(null),v=(0,E.useRef)(""),f=(null===(t=d.activeUtterance)||void 0===t?void 0:t.id)===n.id;(0,E.useEffect)(()=>{if(f){var e;null===(e=h.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"center"}),n.shouldFocusIfTextEmpty&&f&&""==n.text&&setTimeout(()=>{var e;return null===(e=p.current)||void 0===e?void 0:e.focus()},50)}},[f]);let x=(0,E.useCallback)(_()(()=>c.history.commit(),500),[]);return(0,u.jsx)(aE.Z,{ref:h,onClick:()=>{var e;d.clock.seek(n.clip.startTime),null===(e=d.timelineElement)||void 0===e||e.scrollTo({left:d.timeToPx(n.clip.startTime)-d.timelineWidth/2,behavior:"smooth"})},className:"w-full h-[175px]",children:(0,u.jsxs)("div",{className:(0,ij.A)("relative stack h-full z-[4] bg-background border border-slate-200 rounded-xl p-3 cursor-pointer group",f&&"ring-2 ring-gray-800 ring-offset-2"),children:[(0,u.jsxs)("div",{className:"flex gap-1.5 items-center mb-1",children:[(0,u.jsx)("div",{className:"h-4 w-4 shrink-0 rounded-full bg-".concat(n.speaker.color,"-300")}),(0,u.jsx)(tk.default,{className:"mt-0.5 w-0 flex-1",truncate:!0,children:n.speaker.name})]}),(0,u.jsxs)("div",{className:"flex-1 flex gap-1.5",children:[(0,u.jsxs)("div",{className:"flex-1 flex flex-col w-full min-h-full",children:[(0,u.jsxs)("div",{className:"relative flex-1",children:[n instanceof eT&&n.retranscribe.isPending&&(0,u.jsx)(iS,{className:"backdrop-blur-[2px] inset-[1px] rounded-b-none"}),(0,u.jsx)("textarea",{ref:p,className:(0,ie.cn)("relative focus:z-10 min-h-full rounded-t-lg w-full block bg-slate-50 border-slate-200 focus:border-gray-500 focus:ring-gray-500 font-serif resize-none",!l&&"w-[22rem]"),value:n.text,onKeyDown:e=>{if(e.shiftKey&&e.metaKey&&"z"===e.key)e.preventDefault(),c.history.redo();else if(e.metaKey&&"z"===e.key)e.preventDefault(),c.history.undo();else if("Enter"===e.key&&(e.preventDefault(),n.isUtteranceTypeGenerated&&!n.generateUtteranceDisabled)){var t;n.generate.execute().then(()=>{c.history.commit()}),null===(t=p.current)||void 0===t||t.blur()}},onChange:e=>{"historyUndo"!==e.nativeEvent.inputType&&"historyRedo"!==e.nativeEvent.inputType&&(n.setText(e.currentTarget.value),x())},onClick:()=>{d.selection.set(n.clip),c.history.commit()},autoFocus:n.shouldFocusIfTextEmpty&&f&&""==n.text,onFocus:()=>{v.current=n.text},onBlur:()=>{v.current!==n.text&&n.targets.forEach(e=>{e.retranslate.execute().then(()=>{c.history.commit({replace:!0})})})}},n.id)]}),(0,u.jsx)(tE.default,{variant:"white",size:"xs",className:(0,ij.A)("w-full px-2 relative focus:z-10 rounded-b-lg rounded-t-none border-t-transparent !ring-offset-0 transition-opacity shadow-none"),loading:n instanceof eT&&n.retranscribe.isPending||n.isUtteranceTypeGenerated&&n.generate.isPending,disabled:n.isUtteranceTypeGenerated&&n.generateUtteranceDisabled,onClick:e=>{e.stopPropagation(),n instanceof eT?n.retranscribe.execute().then(()=>{c.history.commit(),n.targets.forEach(e=>{e.retranslate.execute().then(()=>{c.history.commit({replace:!0})})})}):n.isUtteranceTypeGenerated&&n.generate.execute().then(()=>{c.history.commit()})},children:n instanceof eT?o.t("Transcribe Audio"):o.t("Generate Audio")})]}),n.activeTarget&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(iW.u,{label:o.t("Translate"),fontSize:"sm",children:(0,u.jsx)("div",{className:"self-center",children:(0,u.jsxs)(tE.default,{size:"xs","aria-label":o.t("Translate"),className:(0,ij.A)("relative  h-5 px-1 self-center rounded-xl shadow-none group-hover:bg-background hover:!bg-gray-50 group-hover:border-gray-100",(null===(i=n.activeTarget)||void 0===i?void 0:i.retranslate.isPending)?"border-gray-100 bg-background":"border-transparent bg-[transparent]"),variant:"white",onClick:e=>{var t;e.stopPropagation(),null===(t=n.activeTarget)||void 0===t||t.retranslate.execute().then(()=>{c.history.commit()})},disabled:n.activeTarget.retranslate.isPending,children:[(null===(s=n.activeTarget)||void 0===s?void 0:s.retranslate.isPending)&&(0,u.jsx)(iS,{svgClassName:"!h-3 !w-3"}),(0,u.jsx)(aP.Z,{className:"w-5 h-5 text-gray-400"})]})})}),(0,u.jsxs)("div",{className:"flex-1 flex flex-col w-full min-h-full",children:[(0,u.jsxs)("div",{className:"relative flex-1",children:[n.activeTarget.retranslate.isPending&&(0,u.jsx)(iS,{className:"backdrop-blur-[2px] inset-[1px] rounded-b-none"}),(0,u.jsx)("textarea",{ref:m,className:(0,ie.cn)("relative focus:z-10 min-h-full rounded-t-lg w-full block bg-slate-50 border-slate-200 focus:border-gray-500 focus:ring-gray-500 font-serif resize-none",!l&&"w-[22rem]"),value:n.activeTarget.text,onKeyDown:e=>{if(e.shiftKey&&e.metaKey&&"z"===e.key)e.preventDefault(),c.history.redo();else if(e.metaKey&&"z"===e.key)e.preventDefault(),c.history.undo();else if("Enter"===e.key){var t,i,s;e.preventDefault(),(null===(t=n.activeTarget)||void 0===t?void 0:t.generateUtteranceDisabled)||(null===(i=n.activeTarget)||void 0===i||i.generate.execute().then(()=>{c.history.commit()}),null===(s=m.current)||void 0===s||s.blur())}},onChange:e=>{var t,i;null===(t=n.activeTarget)||void 0===t||t.clip.setAudioStale(!0),null===(i=n.activeTarget)||void 0===i||i.setText(e.currentTarget.value),x()},onClick:()=>{var e;(null===(e=n.activeTarget)||void 0===e?void 0:e.clip)&&(d.selection.set(n.activeTarget.clip),c.history.commit())},autoFocus:!1},n.activeTarget.id)]}),(0,u.jsx)(tE.default,{variant:"white",size:"xs",className:(0,ij.A)("w-full h-7 px-2 relative focus:z-10 rounded-b-lg rounded-t-none border-t-transparent !ring-offset-0 transition-opacity shadow-none"),onClick:e=>{var t;e.stopPropagation(),null===(t=n.activeTarget)||void 0===t||t.generate.execute().then(()=>{c.history.commit()})},loading:null===(a=n.activeTarget)||void 0===a?void 0:a.generate.isPending,disabled:null===(r=n.activeTarget)||void 0===r?void 0:r.generateUtteranceDisabled,children:(0,u.jsx)(g.cC,{id:"NUPvtn"})})]})]})]})]})})}),aD=(0,T.Pi)(e=>{let{fullWidth:t=!1}=e,i=a9();return(0,u.jsx)("div",{className:"flex flex-col gap-3 items-center",children:i.sourceBlueprint.utterances.map(e=>(0,u.jsx)(aO,{fullWidth:t,utterance:e},e.id))})});var aB=i(61478),aF=i(66214),aM=i(62593),aL=i(90373),aR=i(79736),az=i(82699),aU=i(87813),aJ=i(19803),aZ=i(71780),aW=i(13851),aX=i(53301),aG=i(77095),aH=i(71037);let aK=[{src:"/app_assets/_next/static/media/1.1781ce1f.png",height:122,width:122,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAb1BMVEVoFiucSIiLJkKtSneNHiuuICOxX6BfGjW7bqt+Gil0GCt0KkxjH0CUOmVwOlmGPGyaHSaxa6udLECvX5SAMkitV5eiPmu0c7OrMkG6PVDNJB66VILFIiDOMzyFSX6FNVvGLjiXUYKmWId0Q3aoOFbq0afpAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAR0lEQVR4nBXIxRGAMAAEwEuIGzHcpf8aGfa5IKQTIg0Kre+bpiQFS2kepyXBGRb5vBVIaMbX84aE0ZG/F9xf2e8IwdZ6tM8HdbQDl6wvUXQAAAAASUVORK5CYII=",blurWidth:8,blurHeight:8},{src:"/app_assets/_next/static/media/2.eeb61f9c.png",height:122,width:122,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAOVBMVEXz8/Xt7vC1uMGnq7UKECHZ2+D3+Pn8/P0TGSoaIDMzOElrcYFYXW3FyM9GTF3Q0tmJjJl9gYzd3+N9SMrUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAPUlEQVR4nB3LRxLAIAzAQGEMLpSU/z82Q3TdEdW6cUp5azEKmtOfRkfdPWa90AjPIQ3dI+5De5VFB8T49w83EgF9FWhkWAAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:8},{src:"/app_assets/_next/static/media/3.b1e98427.png",height:122,width:122,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAJ1BMVEXn6Obh4uHa2tnR0tG7u7qlpaSQkY97e3nFxcTLzMuys7Kbm5qFhYTq3FsdAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAN0lEQVR4nCWKwQ0AIQzDAqQJbdl/3hPHy7JlABhzbf7MzXpeEZfJkF5o+x6M4wPMLNkCxmKr4wMlgAE44p+f9QAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:8},{src:"/app_assets/_next/static/media/4.1d28e348.png",height:122,width:122,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAJ1BMVEUmJidGR0hcXFxxcXJ9fn5mZmeRkZJSUVM6OjuHh4g1NTagoaExMTKoVnQ6AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAOUlEQVR4nBXEyRHAQAgDMBtzs/3Xm4kegt/k5RyUmhxPhJu7wmFRUphAY1iVoblFkngN9m4DwPv7ADBWAS2cVrVAAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8},{src:"/app_assets/_next/static/media/5.bc792eb7.png",height:122,width:122,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAM1BMVEVCQUB3dnksKyzk5OVvbm9hYGJLSko2NTZXVljT1diPkJSHhoiDgYDFx8q8wMSio6QYFxderi1pAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAOklEQVR4nAXBiQGAIAwAsevfAor7T2vCzMKjlHm9vEt5VqrHDrr4eglIor0F5jYSIdh4nuZgtvNk1Q83igGG3ADz4wAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:8},{src:"/app_assets/_next/static/media/6.fa5eac6b.png",height:122,width:122,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAMFBMVEVQUFBXV1cZGRmbm5teXl5paWlBQUEsLCyrq6sHBwc0NDS8vLzIyMhzc3OVlZXg4OBSIhXdAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAN0lEQVR4nAXBhwHAMAjAMLMhq/9/W4kqN1WEfuSUQC04lqDLQRy2JaMpjAYRAdfFzluX3f15WP8o/wFM9uCRxAAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:8},{src:"/app_assets/_next/static/media/7.02c21675.png",height:122,width:122,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAANlBMVEV+fn5ra2uPj48jIyNLS0sPDw8tLS0DAwOxsbFVVVWenp51dXU6OjpdXV3CwsKEhITZ2dmlpaVdTPpiAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAPklEQVR4nBXKRxLAIAwAsbUxLpRA/v/ZTHQWqppXGKzlS6I3Ml8xk0NEeF06czKtm8LZXv+JcCoH5EM9Y7cPO84Bt7OeCQUAAAAASUVORK5CYII=",blurWidth:8,blurHeight:8},{src:"/app_assets/_next/static/media/8.4b721bf1.png",height:122,width:122,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAPFBMVEXx8fFeXl6bm5tnZ2fU1NTp6ekpKSkTExP09PTFxcV6enofHx+Kioru7u7h4eG7u7swMDCwsLArKysvLy95hoE9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAPUlEQVR4nAXBhwHAIAzAMAcyGaXj/18rkWxILqxK1erQ+lijiXCHv/OLwGP69Aia9DVWF6we1asOiW5y2w8/tgHV9vrqawAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:8},{src:"/app_assets/_next/static/media/9.51c660c6.png",height:122,width:122,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAGFBMVEVOSEA6NS5FQDkwKyRbVk9UT0lpY1t3cWjEjjiYAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAMUlEQVR4nBXFsRHAQAzDMFKy/ftvnAsaAPHe/QVIqZxtgdZsYRJ3xAR1kVuzg7yBmQ8TpQCSQOeTqwAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:8},{src:"/app_assets/_next/static/media/10.6e0b7ce4.png",height:122,width:122,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAABlBMVEX29vbx8fFxzqTcAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAJUlEQVR4nGNgYGBkgAJkBiOIAyLADAgLhCA0iMHICOKBISMDIwADCQAbLp0j1QAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:8},{src:"/app_assets/_next/static/media/11.ba5c341d.png",height:122,width:122,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAKlBMVEX////KysrPz8/GxcW7urvS0tL09PRxcHGfn5/u7u6xsLFIRkeVlZXU1NTQ1z6ZAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAMklEQVR4nC3IxxEAIAwEsbV9ZOi/XYbw0wjCo9cycCKZasHtavLVeVoiPwVqV6LpXMobIKUA1561G+8AAAAASUVORK5CYII=",blurWidth:8,blurHeight:8},{src:"/app_assets/_next/static/media/12.f1973275.png",height:122,width:122,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAABlBMVEXz8/P8/Pwd+tuOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAEUlEQVR4nGNgZGRgZAAByhgAA9wAGeW/oXUAAAAASUVORK5CYII=",blurWidth:8,blurHeight:8},{src:"/app_assets/_next/static/media/13.10234baf.png",height:122,width:122,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAABlBMVEUUEBEjICAhhKLpAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAGklEQVR4nGNgAANGRgiNxmAEQQgDixpGJBEAAtcAFYkAIhoAAAAASUVORK5CYII=",blurWidth:8,blurHeight:8},{src:"/app_assets/_next/static/media/14.052e3b7f.png",height:122,width:122,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAElBMVEUjHyBGQ0NZV1ixsbENCQoxLS7aKkzcAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAFElEQVR4nGNgYWBgYGBkYmagjAEAC3AAUTIkYkoAAAAASUVORK5CYII=",blurWidth:8,blurHeight:8},{src:"/app_assets/_next/static/media/15.6bf24b52.png",height:122,width:122,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAABlBMVEUWEhMYFBV5IqWsAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIklEQVR4nGNgYGBkYGBkZGQAAUYGKAMkhIsBUwxhgBEjIwADRQAYNBh6HwAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:8},{src:"/app_assets/_next/static/media/16.71c3385f.png",height:122,width:122,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAGFBMVEUoJCU2NDW5ublAPT5xcHGRkJFxcHCSkZKLklelAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAJUlEQVR4nD3LsQEAIAzDMBdC+P9jBtJqF7QdnO+yAlmyJSomjQcVxgCBl1QtSwAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:8},{src:"/app_assets/_next/static/media/17.9a0f99b8.png",height:122,width:122,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAABlBMVEUYFBUUEBGDGJbZAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAHklEQVR4nGNgZGRgYGBkAJFgAsyAcdAZjIwgjE0KAALMABK6cOP7AAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8},{src:"/app_assets/_next/static/media/18.9e61db82.png",height:122,width:122,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAD1BMVEXu7u7o6OjX19fj4+P5+flbavq7AAAACXBIWXMAAAsTAAALEwEAmpwYAAAALElEQVR4nE3KsRHAQBDCQAHXf80efeSIHYCDAEaW6KxdLNrWamK/Sb3zabgPC/0AU5M11PkAAAAASUVORK5CYII=",blurWidth:8,blurHeight:8},{src:"/app_assets/_next/static/media/19.6b8182f3.png",height:122,width:122,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAALVBMVEVkYV9RTk3FvbnPxsNrZ2VbV1avqKR0cG69tbJDQUCOiIaWkI46ODiBe3mclpJ9O5eBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAOklEQVR4nBXJyQ0AMQwDsZFs5872X+4iPwIEsneAzB2xKKo3u6Xgc4TXw4jwFqKN8ap07XsmpQPS/AElyAEh5+JkKQAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:8}],aQ=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:19,i=0;for(let t=0;t<e.length;t++)i+=e.charCodeAt(t);return aK[i%t]},aq=(0,T.Pi)(()=>{var e,t,i,s,a,r;return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(aW.f,{}),(0,u.jsxs)(tP.h_,{children:[(0,u.jsx)("div",{className:"group block flex-shrink-0",children:(0,u.jsx)(tP.$F,{asChild:!0,children:(0,u.jsxs)("button",{onClick:aZ._f,"data-testid":"user-menu-button",className:"flex items-center rounded-full text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 focus:ring-offset-gray-100",children:[(0,u.jsx)(tk.default,{className:"sr-only",noBaseClass:!0,children:(0,u.jsx)(g.cC,{id:"aR3Jrq"})}),(0,u.jsx)("div",{className:"flex items-center",children:(0,u.jsx)("div",{className:"relative rounded-full overflow-hidden h-9 w-9 after:absolute after:w-full after:h-full after:block after:shadow-inner after:z-10 after:rounded-full after:top-0 after:left-0",children:(0,u.jsx)(aJ.default,{loading:"lazy",src:(null===(e=t8.EA.value)||void 0===e?void 0:e.photoURL)||aQ(null!==(r=null===(t=t8.EA.value)||void 0===t?void 0:t.email)&&void 0!==r?r:""),referrerPolicy:"no-referrer",alt:"",layout:"fill",objectFit:"cover"})})})]})})}),(0,u.jsxs)(tP.AW,{className:"absolute right-0 z-10 mt-2 w-56 origin-top-right rounded-md bg-background shadow-lg ring-1 ring-foreground ring-opacity-5 focus:outline-none divide-y",children:[(0,u.jsxs)("div",{className:"px-4 py-3",children:[(0,u.jsx)(tk.default,{className:"text-sm",noBaseClass:!0,variant:"p",children:(0,u.jsx)(g.cC,{id:"zU+Ro7"})}),(0,u.jsx)("p",{className:"truncate text-sm font-medium text-gray-900",children:(null===(i=t8.EA.value)||void 0===i?void 0:i.displayName)||(null===(s=t8.EA.value)||void 0===s?void 0:s.email)})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(tP.Xi,{className:"p-0",children:(0,u.jsxs)(aH.a,{href:t$.VP.settings,className:"w-full flex items-center gap-3 px-4 py-2 text-sm",children:[(0,u.jsx)(aB.Z,{className:"w-5 h-5"})," ",(0,u.jsx)(g.cC,{id:"vERlcd"})]})}),!(0,aG.k4)(null===el.workspaceData||void 0===el.workspaceData?void 0:null===(a=el.workspaceData.value)||void 0===a?void 0:a.subscription.tier)&&(0,u.jsx)(tP.Xi,{className:"p-0",children:(0,u.jsxs)(tE.default,{size:"xl",variant:"link",onClick:()=>el.dialogOpen.value="referAFriend",className:"w-full flex items-center gap-3 px-4 py-2 text-sm",children:[(0,u.jsx)(aF.Z,{className:"w-5 h-5"})," ",(0,u.jsx)(g.cC,{id:"VY1Bxy"})]})}),(0,u.jsx)(tP.Xi,{className:"p-0",children:(0,u.jsxs)(aH.a,{"data-testid":"user-menu-payouts-link",href:t$.VP.payouts,className:"flex items-center gap-3 w-full px-4 py-2 text-left text-sm",children:[(0,u.jsx)(aM.Z,{className:"w-5 h-5"})," ",(0,u.jsx)(g.cC,{id:"C+ylwF"})]})}),el.canAccessWorkspaceSettings.value&&(0,u.jsx)(tP.Xi,{className:"p-0",children:(0,u.jsxs)(aH.a,{href:t$.VP.workspaceSettings,className:"flex items-center gap-3 px-4 py-2 text-sm",children:[(0,u.jsx)(aL.Z,{className:"w-5 h-5"})," ",(0,u.jsx)(g.cC,{id:"ULrZpD"})]})}),el.canAccessWorkspaceSettings.value&&(0,u.jsx)(tP.Xi,{className:"p-0",children:(0,u.jsxs)(aH.a,{"data-testid":"user-menu-subscription-link",href:t$.VP.subscription,className:"flex items-center gap-3 w-full px-4 py-2 text-left text-sm",children:[(0,u.jsx)(aR.Z,{className:"w-5 h-5"})," ",(0,u.jsx)(g.cC,{id:"WVzGc2"})]})}),(0,t6.d)().featureConfig.usage_metrics_enabled&&(0,u.jsx)(tP.Xi,{className:"p-0",children:(0,u.jsxs)(aH.a,{"data-testid":"user-menu-usage-link",href:t$.VP.usage,className:"flex items-center gap-3 w-full px-4 py-2 text-left text-sm",children:[(0,u.jsx)(az.Z,{className:"w-5 h-5"})," ",(0,u.jsx)(g.cC,{id:"21hsGI"})]})}),(0,u.jsx)(tP.Xi,{className:"p-0",children:(0,u.jsxs)(aH.a,{href:"/",type:"submit",onClick:()=>{(0,aX.M)()},className:"flex items-center gap-3 w-full px-4 py-2 text-left text-sm",children:[(0,u.jsx)(aU.Z,{className:"w-5 h-5 "})," ",(0,u.jsx)(g.cC,{id:"fcWrnU"})]})})]})]})]})]})});var aY=i(24296),a$=i(50339);let a0=(0,T.Pi)(e=>{let{onMagnify:t}=e,i=a9(),s=(0,E.useRef)(null);if((0,E.useEffect)(()=>{i.mediaManager.loaded&&s.current&&s.current.appendChild(i.mediaManager.video)},[i.mediaManager.loaded]),!i.mediaManager.loaded||i.mediaManager.isAudio)return null;let a=i.mediaManager.video.videoWidth/i.mediaManager.video.videoHeight*180;return(0,u.jsxs)(a$.s,{default:{x:window.innerWidth-a-40,y:40,width:a,height:180},lockAspectRatio:!0,className:"bg-background z-[10] rounded-xl shadow-2xl overflow-hidden",children:[(0,u.jsx)(tE.default,{className:"absolute z-[20] left-2 top-2",variant:"primary",shape:"circle",size:"sm",onClick:t,children:(0,u.jsx)(aY.Z,{className:"h-6 w-6 font-bold"})}),(0,u.jsx)("div",{className:"h-full w-full",ref:s})]})});var a1=i(42537),a2=i(52272),a5=e=>{let{isOpen:t,isFirstOpen:i,onPlay:s,onEnded:a,onClose:r}=e,{i18n:n}=(0,g.mV)();return(0,u.jsx)(t_.V,{open:t,size:"3xl",title:i?n.t("Welcome to Voiceover Studio!"):n.t("How to use Voiceover Studio"),content:(0,u.jsxs)("div",{className:"flex flex-col gap-4 items-center",children:[(0,u.jsx)(a2.ZP,{onPlay:s,onEnded:a,videoUrl:"https://storage.googleapis.com/eleven-public-cdn/video/voiceover-studio/vo-guide-v1.mp4"}),i&&(0,u.jsxs)(tE.default,{variant:"primary",size:"md",onClick:r,className:"rounded-lg w-fit px-8",children:[(0,u.jsx)(g.cC,{id:"ZDIydz"})," ",(0,u.jsx)(a1.Z,{className:"inline-flex w-4 h-4 ml-2"})]})]}),closeModal:r,zIndex:"z-[200]"})};let a4=(0,U.Z)("file:///app/src/app/(v1)/v1/dubbing/Studio.tsx"),a3="xi:vo-studio-instructions-dialog-video-played",a6="xi:vo-studio-instructions-dialog-first-time-dismissed",a8=(0,E.createContext)(null),a7=e=>{let{project:t,children:i}=e,s=(0,f.useQueryClient)();return t.setQueryClient(s),(0,u.jsx)(a8.Provider,{value:t,children:i})},a9=()=>{let e=(0,E.useContext)(a8);if(!e)throw Error("Cannot call useProject outside of ProjectProvider");return e},re=()=>{var e;let t=a9(),i={dub:(0,ec.LS)(t.dubbingId)},s={updateDubMetadata:(0,ec.n5)()};return(0,u.jsxs)("div",{className:"h-5",children:[i.dub.isLoading&&(0,u.jsx)(iS,{className:""}),i.dub.isSuccess&&(0,u.jsx)(t1.Z,{defaultValue:null===(e=i.dub.data)||void 0===e?void 0:e.name,onChange:e=>{s.updateDubMetadata.mutate({dubbing_id:t.dubbingId,name:e})},maxWidth:"100%"})]})},rt={hidden:{scale:.5,opacity:0,y:-20},visible:{opacity:1,y:0,scale:.75}},ri={hidden:{scale:.5,opacity:0,y:-25},visible:{scale:1,opacity:1,y:0}},rs=new P.Z({concurrency:4}),ra=(0,T.Pi)(()=>{var e,t;let i=tT(),s=a9(),[a,r]=(0,E.useState)(!1),n=(null===(e=s.activeTargetBlueprint)||void 0===e?void 0:e.utterances.map(e=>e.clip).filter(e=>e.audioStale))||[],l=(null===(t=s.sourceBlueprint)||void 0===t?void 0:t.utterances.map(e=>e.clip).filter(e=>e instanceof ti&&e.audioStale))||[],o=n.concat(l);return(0,u.jsx)(tE.default,{variant:"white",size:"sm",disabled:0===o.length,onClick:()=>{r(!0),rs.addAll(o.map(e=>async()=>{var t;await (null===(t=e.utterance)||void 0===t?void 0:t.generate.execute().catch(()=>a4.warn("Failed to generate clip")))})).finally(()=>{i.history.commit(),r(!1)})},className:"rounded-lg !text-sm hidden md:inline-flex",loading:a,children:(0,u.jsx)(g.cC,{id:"ldaquf"})})}),rr=(0,T.Pi)(e=>{let{transcriptRef:t}=e,i=(0,E.useRef)(0);return(0,u.jsxs)(b.E.div,{onPointerDown:e=>{var t,i;null===(t=(i=e.target).setPointerCapture)||void 0===t||t.call(i,e.pointerId)},onPanStart:()=>{if(t.current){let e=t.current.getBoundingClientRect();i.current=e.left}},onPan:e=>{if(t.current){let s=e.clientX-i.current;t.current.style.width="".concat(s,"px")}},onPointerUp:e=>{var t,i;null===(t=(i=e.target).releasePointerCapture)||void 0===t||t.call(i,e.pointerId)},className:"flex cursor-col-resize items-center flex-col grow-0 shrink-0 h-full select-none w-3 group",children:[(0,u.jsx)("div",{className:"pt-16"}),(0,u.jsx)(b.E.div,{className:"h-full w-0.5 my-8 rounded-full transition-opacity delay-75 bg-slate-300 group-hover:bg-foreground/80"})]})}),rn=()=>{var e,t,i,s,a,r,n;let l="projectTabId",o=a9(),c={updateDubMetadata:(0,ec.n5)()},d=(0,x.useQuery)((0,ec.Ni)(o.dubbingId),()=>(0,ec.HF)(o.dubbingId),{refetchInterval:5e3}),u=it.n.get(l);if(!u){let e=(0,D.k$)();it.n.set(l,e),u=e}let h=Math.floor(Date.now()/1e3)-(null===(e=d.data)||void 0===e?void 0:e.last_viewer_saved_at_unix)>10,p=!(null===(t=d.data)||void 0===t?void 0:t.last_viewer_user_id)||!(null===(i=d.data)||void 0===i?void 0:i.last_viewer_tab_id)||!(null===(s=d.data)||void 0===s?void 0:s.last_viewer_saved_at_unix)||(null===(a=d.data)||void 0===a?void 0:a.last_viewer_user_id)===t8.EA.value.uid&&(null===(r=d.data)||void 0===r?void 0:r.last_viewer_tab_id)===u||h,m=(0,E.useRef)(null);return(0,E.useEffect)(()=>(p?m.current=setInterval(()=>{c.updateDubMetadata.mutate({dubbing_id:o.dubbingId,last_viewer_tab_id:u,last_viewer_user_id:t8.EA.value.uid})},5e3):m.current&&(clearInterval(m.current),m.current=null),()=>{m.current&&(clearInterval(m.current),m.current=null)}),[p,c.updateDubMetadata,o.dubbingId,null===(n=t8.EA.value)||void 0===n?void 0:n.uid]),p},rl=(0,T.Pi)(e=>{let{dubId:t,voiceover:i=!1,taskId:s,isReview:a=!1}=e,{i18n:r}=(0,g.mV)(),n=tT(),l=a9(),o=(0,V.useSearchParams)(),c=(0,tO.Rh)(),d=(0,tO.Rh)(),p=(0,tO.Rh)(),f=(0,E.useRef)(null),x=(0,A.v)({container:f}),[j,k]=(0,E.useState)(!1),T=rn(),P=eh(),[D,B]=(0,E.useState)(!1),[F,M]=(0,E.useState)("saved");(0,tO.PI)("saved"!==F&&T),(0,h.Y)(()=>{(0,tF.eN)(tM.B_.dub_fps_reported,P.getStats()),P.reset()},6e4),(0,y.W)(x.scrollY,"change",e=>{e>16?k(!0):k(!1)});let L=(0,E.useMemo)(()=>_()(async e=>{let{dubbing_id:t,editor_data:i}=e;(await (0,ec.xF)({dubbing_id:t,editor_data:i})).ok?M("saved"):M("failed")},3e3),[]);(0,E.useEffect)(()=>{(0,N.EH)(()=>{M("saving"),L({dubbing_id:t,editor_data:JSON.parse(JSON.stringify(n.toJSON()))})})},[n,t]),(0,E.useEffect)(()=>()=>l.clock.pause(),[l]),(0,E.useEffect)(()=>{var e,t,s,a,r,d,u;if(!i)return()=>{};let h=null!==(e=null==o?void 0:o.get("from_synthesis"))&&void 0!==e?e:"",p={};try{p=JSON.parse(decodeURIComponent(h))}catch(e){return a4.error(e),()=>{}}let[m]=l.sourceBlueprint.utterances;if(1===l.sourceBlueprint.utterances.length&&!S()(p)&&null!=m&&m.text.length<1){let e={model_id:p.model_id,mode:"voice-library",stability:null===(t=p.settings)||void 0===t?void 0:t.stability,similarity_boost:null===(s=p.settings)||void 0===s?void 0:s.similarity_boost,style:null===(a=p.settings)||void 0===a?void 0:a.style,use_speaker_boost:null===(r=p.settings)||void 0===r?void 0:r.use_speaker_boost};(null===(d=el.voices.value)||void 0===d?void 0:d.some(e=>e.voice_id===p.voice_id))?e.voice_library_id=p.voice_id:e.voice_library_id=null===(u=el.voices.value)||void 0===u?void 0:u[0].voice_id,m.track.setVoiceSpecification(e),m.setText(p.text),n.history.commit(),it.I.get(a6)||(B(!0),c.open(),(0,tF.eN)(tM.B_.voiceover_studio_instructions_video,{action:"open_dialog",has_speech_synthesis_prefill:!0}))}},[]);let R=async()=>{it.I.set(a6,!0),c.close(),(0,tF.eN)(tM.B_.voiceover_studio_instructions_video,{action:"close_dialog"})},[z,U]=(0,E.useState)(!1),[J,Z]=(0,E.useState)(!1),W=(0,E.useCallback)(e=>{if(l.mediaManager.loaded&&null!=e&&!l.mediaManager.isAudio)return e.appendChild(l.mediaManager.video),U(!0),e},[l.mediaManager.loaded,J]);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(io,{open:!T,voiceover:i}),(0,u.jsxs)("div",{className:"relative h-screen flex flex-col overflow-hidden",children:[(0,t6.d)().featureConfig.fps_stats_enabled&&(0,u.jsx)(O.Z,{}),(0,u.jsx)("div",{className:"flex absolute items-center w-fit max-w-[50%] justify-center top-0 z-10 left-1/2 transform -translate-x-1/2 pt-6",children:(0,u.jsxs)(b.E.div,{className:"w-fit mb-7 font-bold text-foreground",initial:!1,variants:ri,animate:j?"hidden":"visible",transition:{type:"spring",mass:.06,damping:3,stiffness:100},children:[(0,u.jsx)(re,{}),(0,u.jsx)("div",{className:"w-[calc(100%-8px)] border-b border-foreground/25 mx-auto mt-[-1px] border-dotted"})]})}),(0,u.jsxs)("div",{className:"flex absolute bg-slate-100 flex-row justify-between pr-4 py-2 items-center w-full bg-transparent",children:[(0,u.jsx)(b.E.div,{initial:!1,variants:rt,className:"z-10 shrink-0",animate:z&&!J&&j?"hidden":"visible",transition:{type:"spring",mass:.06,damping:3,stiffness:100},children:(0,u.jsxs)(I.default,{href:i?t$.VP.voiceoverStudio:t$.VP.dubbing,children:[(0,u.jsx)("div",{className:"w-32 mb-1",children:(0,u.jsx)(t2.Z,{})}),(0,u.jsxs)("div",{className:"flex",children:[(0,u.jsx)(tk.default,{variant:"h6",className:"shrink-0",children:i?r.t("Voiceover Studio"):r.t("Dubbing")}),(0,u.jsx)(t0.Z,{size:"sm",color:i?"blue":"emerald",className:"mx-1 shrink-0",children:(0,u.jsx)(g.cC,{id:"J/hVSQ",values:{0:i?r.t("Beta"):r.t("New!")}})})]})]})}),(0,u.jsxs)("div",{className:"z-10 flex flex-row gap-2 mx-1 items-center",children:[(0,u.jsx)("div",{className:"flex flex-row gap-1 items-center",children:"saving"===F?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(t3.x,{size:"sm",color:"subtle",children:(0,u.jsx)(g.cC,{id:"ei40g+"})}),(0,u.jsx)(t5.Z,{iconClassName:"h-2 w-2 text-gray-700"})]}):"failed"===F?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(t3.x,{size:"sm",color:"subtle",children:(0,u.jsx)(g.cC,{id:"tSQokD"})}),(0,u.jsx)(t4.Z,{className:"text-background bg-red-500 rounded-full p-[1px]",children:(0,u.jsx)(w.Z,{})})]}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(t3.x,{size:"sm",color:"subtle",children:(0,u.jsx)(g.cC,{id:"nJ5/A6"})}),(0,u.jsx)(t4.Z,{children:(0,u.jsx)(C.Z,{})})]})}),s&&(0,u.jsx)(iO,{taskId:s,disabled:"saving"===F,isReview:a}),!s&&(0,u.jsx)(tY,{voiceover:i}),i&&(0,u.jsx)(iR,{onDocumentationClick:()=>{(0,tF.eN)(tM.B_.voiceover_studio_instructions_video,{action:"click_documentation_link"})},onVideoClick:()=>{(0,tF.eN)(tM.B_.voiceover_studio_instructions_video,{action:"open_dialog"}),c.open()},showIndicator:!it.I.get(a3)&&D}),!s&&(0,u.jsx)(aq,{})]})]}),i&&(0,u.jsx)(a5,{isFirstOpen:!it.I.get(a6)&&D,onPlay:()=>{it.I.set(a3,!0),(0,tF.eN)(tM.B_.voiceover_studio_instructions_video,{action:"play_video"})},onEnded:()=>{(0,tF.eN)(tM.B_.voiceover_studio_instructions_video,{action:"finished_video"})},isOpen:c.isOpen,onClose:R}),(0,u.jsx)(iy,{isOpen:d.isOpen,onClose:d.close,dubId:t}),(0,u.jsx)(il,{isOpen:p.isOpen,onClose:p.close}),(0,u.jsx)(tW,{}),J&&(0,u.jsx)(a0,{onMagnify:()=>Z(!1)}),(0,u.jsxs)("div",{className:"bg-slate-100 relative flex min-h-0 grow border-b border-slate-200 items-center flex-row px-4 h-full",children:[(0,u.jsx)("div",{className:(0,ie.cn)("overflow-y-auto grow shrink-0 min-h-0 h-full pt-14",z&&!J&&"pr-2 min-w-[30%] w-[40%] max-w-[80%]"),ref:f,children:(0,u.jsx)("div",{className:(0,ie.cn)("bg-slate-100 border-slate-200 pb-4 p-2 m-auto w-fit",z&&!J&&"w-full"),children:(0,u.jsx)(aD,{fullWidth:z&&!J})})}),z&&!J&&(0,u.jsx)(rr,{transcriptRef:f}),(0,u.jsx)("div",{className:(0,ie.cn)("sticky top-0 w-full min-h-0 h-full p-1 pt-16",(z&&J||!z)&&"hidden"),children:(0,u.jsx)("div",{className:"relative h-full w-auto bg-foreground rounded-xl overflow-hidden",children:(0,u.jsx)("div",{className:"absolute rounded-xl w-auto h-full mx-auto left-0 right-0",ref:W,children:(0,u.jsx)(tE.default,{onClick:()=>Z(!0),className:"absolute z-10 left-2 top-2",shape:"circle",size:"sm",variant:"primary",children:(0,u.jsx)(m.Z,{className:"h-6 w-6 font-bold"})})})})})]}),(0,u.jsx)(aV,{}),(0,u.jsxs)("div",{className:"flex justify-center items-center my-4",children:[(0,u.jsx)(tk.default,{className:"absolute left-4",variant:"body2",color:"gray",children:(0,u.jsx)(iB,{})}),(0,u.jsxs)("div",{className:"relative flex gap-2.5",children:[(0,u.jsx)(ik,{}),(0,u.jsx)(tE.default,{onClick:p.open,size:"md",variant:"white",className:"rounded-xl px-3","aria-label":r.t("Add language"),children:(0,u.jsx)(v.Z,{className:"h-4 w-4"})})]}),(0,u.jsxs)("div",{className:"hstack gap-3 !absolute right-4",children:[(0,u.jsx)(ra,{}),(0,u.jsx)(tE.default,{size:"sm",variant:"primary",className:"rounded-lg",onClick:d.open,children:(0,u.jsx)(g.cC,{id:"GS+Mus"})})]})]})]})]})}),ro=(0,T.Pi)(e=>{let{dubId:t,voiceover:i=!1,taskId:s,isReview:a=!1}=e,r=tT();t8.EA.value.uid;let[n,l]=(0,E.useState)(!1),[o,c]=(0,E.useState)(!1);(0,E.useEffect)(()=>{let e=0;!function i(){(0,ec.g_)(t).then(t=>{if(t.ok)return t.json();t.json().then(t=>{a4.log(t),"dub_has_no_snapshots"===t.detail.status&&e<30?(c(!0),e+=1,setTimeout(i,1e3)):(l(!0),c(!1))})}).then(e=>{e.schema_version!==r.schemaVersion?l(!0):r.history.activeItem||(r.loadJSON(e),r.history.commit()),c(!1)})}()},[r,t]);let d=e7.getAll()[0];return n?(0,u.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,u.jsx)(tk.default,{variant:"body1",children:(0,u.jsx)(g.cC,{id:"ZWDk6E"})})}):o?(0,u.jsxs)("div",{className:"absolute inset-0 flex items-center justify-center",children:[(0,u.jsx)(tk.default,{variant:"body1",children:(0,u.jsx)(g.cC,{id:"yuLKM+"})}),(0,u.jsx)(t5.Z,{})]}):d?(0,u.jsx)(a7,{project:d,children:(0,u.jsx)(rl,{dubId:t,voiceover:i,taskId:s,isReview:a})}):(0,u.jsx)(iS,{svgClassName:"h-5 w-5"})});var rc=(0,T.Pi)(e=>{let{dubId:t,voiceover:i=!1,taskId:s,isReview:a=!1}=e,[r,n]=(0,E.useState)(0);return t9(e=>{let{type:t,idleTime:i}=e;"enter"===t&&i>3e5&&n(e=>e+1)}),(0,u.jsx)(p.ChakraProvider,{theme:iG,children:(0,u.jsx)(tN,{children:(0,u.jsx)(ro,{dubId:t,voiceover:i,taskId:s,isReview:a})},r)})})},11931:function(e,t,i){i.d(t,{$K:function(){return S},A:function(){return A},HF:function(){return m},Iu:function(){return P},KR:function(){return V},LS:function(){return g},M4:function(){return N},Ni:function(){return v},Sc:function(){return k},VH:function(){return _},XQ:function(){return I},Zr:function(){return u},bL:function(){return C},eG:function(){return E},gW:function(){return w},g_:function(){return f},hv:function(){return x},ln:function(){return T},n5:function(){return p},uv:function(){return y},xF:function(){return b},zc:function(){return O}});var s=i(55673),a=i(97918),r=i(6036),n=i(9506),l=i(84106),o=i(99520),c=i(87069),d=i(96162);let u=function(e){let{retrieveDubsWhereTargetLanguageIsNull:t=!1,excludeFailedDubs:i=!1,listen:s=!0,listenerLimit:a,onSnapshotListener:l,pageSize:u}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=()=>{let t=(0,r.hJ)(d.db,o.Yy,e,o.Lj),s=(0,r.IO)(t);return i&&(s=(0,r.IO)(s,(0,r.ar)("status","in",["dubbed","dubbing"]))),(0,r.IO)(s,(0,r.Xo)("creation_date_unix","desc"))},p=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=h();null!=u&&(e&&(i=(0,r.IO)(i,(0,r.TQ)(e))),i=(0,r.IO)(i,(0,r.b9)(u)));let s=await (0,r.PL)(i);return{dubs:s.docs.map(e=>new c.nv(e.data(),e.id)).filter(e=>t?null==e.input.target_language_code:null!=e.input.target_language_code),lastDoc:null!=u?s.docs[s.docs.length-1]:null,hasMore:null!=u&&s.docs.length===u}};return(0,n.useEffect)(()=>{if(!s||!e)return;let t=h();null!=a&&(t=(0,r.IO)(t,(0,r.b9)(a)));let i=(0,r.cf)(t,e=>null==l?void 0:l(e));return()=>i()},[]),{fetchDubs:p}},h=async e=>{let{dubbing_id:t,...i}=e,s=await (0,d.hP)();return(await fetch("".concat(d.LB,"/v1/dubbing/").concat(t,"/metadata"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify(i)})).json()},p=()=>(0,s.useMutation)(h),m=async e=>{let t=await (0,d.hP)(),i=await fetch("".concat(d.LB,"/v1/dubbing/").concat(e,"/internal-metadata"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}});if(!i.ok)throw Error("Failed to fetch dubbing data");return await i.json()},v=e=>["dubs",e],g=e=>(0,a.useQuery)(v(e),()=>m(e)),f=async e=>{let t=await (0,d.hP)();return fetch("".concat(d.LB,"/v1/dubbing/").concat(e,"/editor/latest"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}})},x=async(e,t)=>{let i=await (0,d.hP)();return fetch("".concat(d.LB,"/v1/dubbing/").concat(e,"/").concat(t,"/editor/latest"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(i)}})},b=async e=>{let t=await (0,d.hP)(),i=await fetch("".concat(d.LB,"/v1/dubbing/").concat(e.dubbing_id,"/editor"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(e.editor_data)});return i.ok||l.toast.error("Failed to save project data."),i},A=async e=>{let t=await (0,d.hP)(),i=await fetch("".concat(d.LB,"/v1/dubbing/").concat(e.dubbing_id,"/").concat(e.nested_dubbing_id),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}});if(!i.ok)throw l.toast.error("Failed to get dub metadata."),i;return i.json()},y=async e=>{let t=await (0,d.hP)(),i=await fetch("".concat(d.LB,"/v1/dubbing/").concat(e,"/duplicate"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}});return i.ok||l.toast.error("Failed to duplicate dub."),i.json()},j=async e=>{let t=await (0,d.hP)();return(await fetch("".concat(d.LB,"/v1/dubbing/").concat(e.dubbing_id,"/render"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({render_type:e.type,data:e.data})})).json()},_=()=>(0,s.useMutation)({mutationFn:e=>j(e)}),k=async e=>{let t=await (0,d.hP)(),i=new FormData;i.append("script_file",e);let s=await fetch("".concat(d.LB,"/v1/voiceover-studio/parse-script"),{method:"POST",body:i,headers:{Authorization:"Bearer ".concat(t)}}),a=await s.json();return s.ok?Promise.resolve(a):Promise.reject(a)},S=async e=>{let{dubbing_id:t,...i}=e,s=await (0,d.hP)(),a=await fetch("".concat(d.LB,"/v1/dubbing/").concat(t,"/dub-using-tts-and-sts"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify(i)}),r=await a.json();return a.ok?Promise.resolve(r):Promise.reject(r)},w=async e=>{let{dubbing_id:t,...i}=e,s=await (0,d.hP)(),a=await fetch("".concat(d.LB,"/v1/dubbing/").concat(t,"/dub"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify(i)}),r=await a.json();return a.ok?Promise.resolve(r):Promise.reject(r)},C=async e=>{let{dubbing_id:t,...i}=e,s=await (0,d.hP)(),a=await fetch("".concat(d.LB,"/v1/dubbing/").concat(t,"/sfx"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({...i})}),r=await a.json();return a.ok?Promise.resolve(r):Promise.reject(r)},N=async e=>{let t=await (0,d.hP)(),i=new FormData;return i.append("audio",e.audio),i.append("language",e.language),i.append("voice_uid",e.voice_uid),i.append("voice_settings",JSON.stringify(e.voice_settings).toString()),(await fetch("".concat(d.LB,"/v1/dubbing/").concat(e.dubbing_id,"/dub-using-sts"),{method:"POST",headers:{Authorization:"Bearer ".concat(t)},body:i}).then(e=>e.ok?Promise.resolve(e):Promise.reject(e))).json()},T=async e=>{let t=await (0,d.hP)(),i=new FormData;return i.append("audio",e.audio),(await fetch("".concat(d.LB,"/v1/dubbing/").concat(e.dubbing_id,"/import-audio"),{method:"POST",headers:{Authorization:"Bearer ".concat(t)},body:i}).then(e=>e.ok?Promise.resolve(e):Promise.reject(e))).json()},I=async e=>{let t=await (0,d.hP)(),i=new FormData;return i.append("audio",e.audio),void 0!==e.num_speakers&&i.append("num_speakers",e.num_speakers.toString()),void 0!==e.disable_voice_cloning&&i.append("disable_voice_cloning",e.disable_voice_cloning.toString()),(await fetch("".concat(d.LB,"/v1/dubbing/").concat(e.dubbing_id,"/import-audio-speaker-stem"),{method:"POST",headers:{Authorization:"Bearer ".concat(t)},body:i}).then(e=>e.ok?Promise.resolve(e):Promise.reject(e))).json()},V=async e=>{let{dubbing_id:t,...i}=e,s=await (0,d.hP)();return(await fetch("".concat(d.LB,"/v1/dubbing/").concat(t,"/transcribe"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify(i)}).then(e=>e.ok?Promise.resolve(e):Promise.reject(e))).json()},P=async e=>{let{dubbing_id:t,...i}=e,s=await (0,d.hP)();return(await fetch("".concat(d.LB,"/v1/dubbing/").concat(t,"/translate"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify(i)}).then(e=>e.ok?Promise.resolve(e):Promise.reject(e))).json()},E=async e=>{let{dubbing_id:t,...i}=e,s=await (0,d.hP)();return(await fetch("".concat(d.LB,"/v1/dubbing/").concat(t,"/create-voice"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify(i)}).then(e=>e.ok?Promise.resolve(e):Promise.reject(e))).json()},O=async(e,t)=>{let i=await (0,d.hP)(),s=await fetch("".concat(d.LB,"/v1/dubbing/").concat(e,"/voices/").concat(t,"/similar"),{method:"GET",headers:{Authorization:"Bearer ".concat(i)}});if(200===s.status)return await s.json();throw Error("Error occured while fetching similar voices, status_code ".concat(s.status))}},49298:function(e,t,i){i.d(t,{b:function(){return r}});var s=i(17024);let a=["speaker","start_time","end_time","transcription","translation"];class r{toCSV(){return[a.join(","),...this.data.map(e=>a.map(t=>'"'.concat(String(e[t]).replace(/"/g,'""'),'"')).join(","))].join("\n")}toDataUrl(){let e=new Blob([this.toCSV()],{type:"text/csv;charset=utf-8;"});return URL.createObjectURL(e)}constructor(e){(0,s._)(this,"data",void 0),this.data=e}}},77150:function(e,t,i){i.d(t,{r:function(){return r}});var s=i(17024),a=i(5479);class r{constructor({isOpen:e=!1,context:t}){(0,s._)(this,"isOpen",void 0),(0,s._)(this,"context",void 0),(0,s._)(this,"open",e=>{this.isOpen=!0,this.context=e}),(0,s._)(this,"close",()=>{this.isOpen=!1}),this.isOpen=e,this.context=t,(0,a.rC)(this,{isOpen:a.LO.ref,context:a.LO.ref,open:a.aD,close:a.aD})}}},71609:function(e,t,i){i.d(t,{K:function(){return o},m:function(){return c}});var s=i(68088),a=i(26397),r=i(70140),n=i(58397);let l=e=>{let{fileName:t,size:i,actions:l=null,className:o}=e;return(0,s.jsxs)("div",{className:(0,r.A)("flex items-center space-x-4",o),children:[(0,s.jsxs)("div",{className:"min-w-0 flex flex-1 align-center",children:[(0,s.jsx)(a.default,{weight:"medium",variant:"body2",className:"truncate",children:t}),i&&(0,s.jsx)(a.default,{className:"ml-2 inline-block flex-shrink-0 rounded-full bg-gray-100 px-2 py-0.5",variant:"body3",children:(0,n.KS)(i)})]}),l&&(0,s.jsx)("a",{className:"gap-4 pr-4 cursor-pointer relative inline-flex w-0 flex-1 items-center justify-end rounded-br-lg border border-transparent",children:l})]})},o=e=>{let{fileName:t,size:i,className:a,actions:n=null}=e;return(0,s.jsx)("li",{className:(0,r.A)("py-2",a),children:(0,s.jsx)(l,{fileName:t,size:i,actions:n})})},c=e=>{let{children:t,className:i,style:a}=e;return(0,s.jsx)("ul",{role:"list",className:(0,r.A)("divide-y divide-gray-200",i),style:a,children:t})}},61624:function(e,t,i){var s=i(68088),a=i(11152),r=i(6991),n=i(9506),l=i(60189),o=i(70140);let c=(0,n.forwardRef)((e,t)=>{let{defaultValue:i,onChange:c,onClick:d,isDisabled:u,isEditing:h,onEditingChange:p,maxWidth:m="16ch",className:v,textClassName:g="text-sm font-sans",inputClassName:f="text-sm font-sans",textContainerClassName:x,showPencilIcon:b=!0}=e,{i18n:A}=(0,r.mV)(),y=(0,n.useRef)(null),j=(0,n.useRef)(null),[_,k]=(0,n.useState)(!1),[S,w]=(0,n.useState)(i);void 0===h&&(h=_),(0,n.useEffect)(()=>{if(h){var e;null===(e=j.current)||void 0===e||e.focus()}},[h]);let C=()=>{var e;null===(e=j.current)||void 0===e||e.focus(),k(!0),null==p||p(!0)};return(0,n.useImperativeHandle)(t,()=>({clickThroughDisabled:()=>{C()}})),(0,s.jsxs)("div",{ref:y,className:(0,o.A)("relative group w-fit",u?"cursor-auto":"cursor-text",v),style:{maxWidth:m},onClick:e=>{u||(C(),null==d||d(e))},children:[(0,s.jsxs)("div",{className:(0,l.cn)("relative w-fit",x),children:[(0,s.jsx)("p",{className:(0,l.cn)("leading-5 w-fit truncate whitespace-pre",h?"invisible":"visible",g),style:{maxWidth:m},children:S||A.t("Untitled")}),!h&&b&&(0,s.jsx)(a.Z,{className:"absolute invisible group-hover:visible right-0 pl-0.5 top-[1px] w-4 h-4 translate-x-full cursor-pointer"})]}),h&&(0,s.jsx)("input",{ref:j,onBlur:e=>{k(!1),null==p||p(!1),null==c||c(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&e.currentTarget.blur(),"Escape"===e.key&&(w(i),k(!1),null==p||p(!1))},placeholder:A.t("Untitled"),value:S,onChange:e=>{w(e.target.value)},className:(0,l.cn)("absolute -mx-[7px] inset-y-0 min-w-0 appearance-none w-full box-content px-1.5 py-0 rounded-md focus:outline-none border-gray-alpha-300 focus:border-gray-alpha-400 focus:ring-gray-alpha-400 focus:ring-1 bg-transparent",f)})]})});t.Z=c},30485:function(e,t,i){var s=i(68088);i(9506),t.Z=e=>{let{onClick:t}=e;return(0,s.jsx)("div",{style:{display:"flex"},onClick:t,className:"cursor-pointer",children:(0,s.jsxs)("svg",{className:"icon icon--logo",fill:"dark",height:"22",viewBox:"0 0 171 22",width:"171",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("path",{d:"M61.171 5.42424H56.7863L62.0844 21.6364H66.804L72.1022 5.42424H67.7175L64.3998 17.6364L61.171 5.42424Z",fill:"currentColor"}),(0,s.jsx)("path",{d:"M0 0H4.53691V21.6364H0V0Z",fill:"currentColor"}),(0,s.jsx)("path",{d:"M9.01292 0H13.5498V21.6364H9.01292V0Z",fill:"currentColor"}),(0,s.jsx)("path",{d:"M18.0252 0H31.4533V3.60606H22.5622V8.75758H30.8443V12.3636H22.5622V18.0303H31.4533V21.6364H18.0252V0Z",fill:"currentColor"}),(0,s.jsx)("path",{d:"M34.2235 0H38.5169V21.6364H34.2235V0Z",fill:"currentColor"}),(0,s.jsx)("path",{d:"M41.105 13.5152C41.105 7.60606 44.0586 5.06061 48.6564 5.06061C53.2542 5.06061 55.8728 7.57576 55.8728 13.5758V14.5455H45.3375C45.4897 18.0606 46.5554 19.2424 48.5955 19.2424C50.2093 19.2424 51.2141 18.303 51.3968 16.6667H55.6901C55.4161 20.2424 52.4321 22 48.5955 22C43.7237 22 41.105 19.4242 41.105 13.5152ZM51.6404 11.7273C51.4273 8.75758 50.392 7.78788 48.5955 7.78788C46.799 7.78788 45.6724 8.78788 45.3679 11.7273H51.6404Z",fill:"currentColor"}),(0,s.jsx)("path",{d:"M72.9243 13.5152C72.9243 7.60606 75.8779 5.06061 80.4757 5.06061C85.0735 5.06061 87.6921 7.57576 87.6921 13.5758V14.5455H77.1567C77.309 18.0606 78.3747 19.2424 80.4148 19.2424C82.0286 19.2424 83.0334 18.303 83.2161 16.6667H87.5094C87.2354 20.2424 84.2514 22 80.4148 22C75.5429 22 72.9243 19.4242 72.9243 13.5152ZM83.4597 11.7273C83.2465 8.75758 82.2113 7.78788 80.4148 7.78788C78.6183 7.78788 77.4917 8.78788 77.1872 11.7273H83.4597Z",fill:"currentColor"}),(0,s.jsx)("path",{d:"M108.031 0H112.568V18.0303H121.094V21.6364H108.031V0Z",fill:"currentColor"}),(0,s.jsx)("path",{clipRule:"evenodd",d:"M122.16 13.5152C122.16 7.33333 125.022 5.06061 128.706 5.06061C130.533 5.06061 132.208 6.09091 132.878 7.18182V5.42424H137.262V21.6364H133V19.7273C132.36 21 130.564 22 128.584 22C124.687 22 122.16 19.5152 122.16 13.5152ZM129.833 8.24242C131.964 8.24242 133.121 9.84848 133.121 13.5152C133.121 17.1818 131.964 18.8182 129.833 18.8182C127.701 18.8182 126.483 17.1818 126.483 13.5152C126.483 9.84848 127.701 8.24242 129.833 8.24242Z",fill:"currentColor",fillRule:"evenodd"}),(0,s.jsx)("path",{clipRule:"evenodd",d:"M144.844 19.7273V21.6364H140.581V0H144.875V7.18182C145.605 6.06061 147.311 5.06061 149.138 5.06061C152.731 5.06061 155.593 7.33333 155.593 13.5152C155.593 19.697 152.791 22 149.046 22C147.067 22 145.453 21 144.844 19.7273ZM147.92 8.27273C150.051 8.27273 151.269 9.84848 151.269 13.5152C151.269 17.1818 150.051 18.8182 147.92 18.8182C145.788 18.8182 144.631 17.1818 144.631 13.5152C144.631 9.84848 145.788 8.27273 147.92 8.27273Z",fill:"currentColor",fillRule:"evenodd"}),(0,s.jsx)("path",{d:"M157.359 16.8182H161.652C161.713 18.5152 162.627 19.3333 164.24 19.3333C165.854 19.3333 166.768 18.6061 166.768 17.3333C166.768 16.1818 166.067 15.7576 164.545 15.3939L163.235 15.0606C159.521 14.1212 157.663 13.1212 157.663 10.0606C157.663 7 160.526 5.06061 164.179 5.06061C167.833 5.06061 170.604 6.48485 170.726 9.84848H166.433C166.341 8.36364 165.428 7.72727 164.119 7.72727C162.809 7.72727 161.896 8.36364 161.896 9.57576C161.896 10.697 162.627 11.1212 163.905 11.4242L165.245 11.7576C168.777 12.6364 171 13.5152 171 16.7879C171 20.0606 168.077 22 164.119 22C159.825 22 157.45 20.3939 157.359 16.8182Z",fill:"currentColor"}),(0,s.jsx)("path",{d:"M94.6345 12.0909C94.6345 9.54545 95.8524 8.15152 97.7403 8.15152C99.2932 8.15152 100.176 9.12121 100.176 11.2121V21.6364H104.47V10.5455C104.47 6.78788 102.338 5.06061 99.2323 5.06061C97.1313 5.06061 95.3957 6.12121 94.6345 7.51515V5.42424H90.2803V21.6364H94.6345V12.0909Z",fill:"currentColor"})]})})}},30469:function(e,t,i){i.d(t,{B:function(){return A},OnlyForAdmin:function(){return g},OnlyForLoggedIn:function(){return x},OnlyForLoggedOut:function(){return f},Z:function(){return b}});var s=i(68088),a=i(81999),r=i(23431),n=i(9506),l=i(71443),o=i(1851),c=i(60358),d=i(99348),u=i(96162),h=i(53832),p=i(78190),m=i(58815),v=i(732);let g=(0,a.Pi)(e=>{let{redirectOthersTo:t,children:i}=e,s=(0,r.useRouter)();return((0,n.useEffect)(()=>{"local"!==(0,d.d)().envType&&u.EA.value&&!(0,u.X0)()&&s.push(t)},[u.EA.value]),"local"===(0,d.d)().envType||(0,u.X0)())?i:null}),f=(0,a.Pi)(e=>{let{redirectOthersTo:t,forceRenderChildren:i=!1,children:s}=e,a=(0,p.B8)(t),l=(0,r.useRouter)(),c=(0,n.useRef)(null);return((0,n.useEffect)(()=>{var e;null===c.current&&(!0===o.isLoggedIn.value&&(null===(e=u.EA.value)||void 0===e?void 0:e.emailVerified)&&l.push(a),c.current=o.isLoggedIn.value)},[o.isLoggedIn.value]),(0,n.useEffect)(()=>{let e=e=>{e.origin===window.location.origin&&e.data===m.c&&window.location.reload()};return null===h.Sv||void 0===h.Sv||h.Sv.addEventListener("message",e),()=>{null===h.Sv||void 0===h.Sv||h.Sv.removeEventListener("message",e)}},[a,l]),i&&(!1===o.isLoggedIn.value||!1===c.current))?s:null}),x=(0,a.Pi)(e=>{let{redirectOthersTo:t,children:i}=e,s=(0,r.useRouter)(),a=(0,n.useRef)(null);(0,v.k)();let l=()=>encodeURIComponent("".concat(window.location.pathname).concat(window.location.search));return((0,n.useEffect)(()=>{null===a.current&&(!1===o.isLoggedIn.value&&(t?s.push(t):s.push("".concat(c.ZP.signIn,"?redirect=").concat(l()))),a.current=o.isLoggedIn.value)},[o.isLoggedIn.value]),(0,n.useEffect)(()=>{let e=e=>{e.origin===window.location.origin&&e.data===h.ED&&(window.location.href="".concat(c.ZP.signIn,"?redirect=").concat(l()))};return null===h.Sv||void 0===h.Sv||h.Sv.addEventListener("message",e),()=>{null===h.Sv||void 0===h.Sv||h.Sv.removeEventListener("message",e)}},[]),!0===o.isLoggedIn.value)?i:null}),b=(0,a.Pi)(e=>{let{loggedIn:t,loggedOut:i,children:a}=e;return(0,v.k)(),(0,s.jsx)(s.Fragment,{children:o.isLoggedIn.value?t:a||i})}),A=(0,a.Pi)(e=>{let{redirectOthersTo:t,children:i,message:s}=e,a=(0,r.useRouter)();return((0,n.useEffect)(()=>{!1===o.isWorkspaceAdmin.value&&(l.Am.error(s),a.replace(t))},[o.isWorkspaceAdmin.value]),!0===o.isWorkspaceAdmin.value)?i:null})},50267:function(e,t,i){i.d(t,{Z:function(){return o}});var s=i(68088),a=i(6991),r=i(9506),n=i(23636),l=i(70140);function o(e){let{accept:t,onChange:i,children:o,errorText:c=null,multiple:d=!1,className:u,disabled:h=!1,fileSizeLimit:p}=e,{i18n:m}=(0,a.mV)(),[v,g]=(0,r.useState)(!1),f=(0,r.useRef)(null);function x(e){if(void 0!==p){let t=0;for(let i=0;i<e.length;i++)t+=e[i].size;if(t>p){(0,n.default)(m.t("Files are too big."));return}}i(e)}return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("label",{htmlFor:"file-upload",className:(0,l.A)("flex justify-center rounded-md border-gray-300 border-2 px-6 pt-5 pb-6",!h&&"cursor-pointer hover:border-gray-500 border-dashed",v&&"border-gray-500 bg-gray-50",u),onDragEnter:h?void 0:e=>g(!0),onDragLeave:h?void 0:e=>g(!1),onDragOver:h?void 0:e=>e.preventDefault(),onDrop:h?void 0:e=>{e.preventDefault(),g(!1),null!==e.dataTransfer&&x(e.dataTransfer.files)},onClick:h?void 0:()=>{null!==f.current&&f.current.click()},children:o}),(0,s.jsx)("input",{ref:f,name:"file-upload",type:"file",className:"sr-only",accept:h?void 0:t,multiple:d,onChange:h?void 0:e=>{x(e.target.files)}}),c&&(0,s.jsx)("div",{className:"mt-1 text-sm text-red-600",children:c})]})}},52272:function(e,t,i){i.d(t,{Qd:function(){return o},Yy:function(){return l}});var s=i(68088),a=i(6991),r=i(88238),n=i(76628);let l=e=>/^(https?:\/\/)?(www\.)?tiktok\.com\/@[\w.-]+\/video\/\d+$/.test(e);function o(e){try{let t=new URL(e);return"youtube.com"===t.hostname||"www.youtube.com"===t.hostname||"youtu.be"===t.hostname}catch(e){return!1}}let c=e=>{let t=e.match(/\/video\/(\d+)/);if(!t)return(0,s.jsx)(n.Z,{severity:"error",children:(0,s.jsx)(a.cC,{id:"TLmYa8"})});let i=t[1];return(0,s.jsx)("div",{className:"w-full flex justify-center items-center h-[500px]",children:(0,s.jsx)("iframe",{width:"100%",height:"300",src:"https://www.tiktok.com/embed/".concat(i),frameBorder:"0",title:"TikTok Embed"})})},d=e=>{let t=document.createElement("script");return t.src="https://platform.twitter.com/widgets.js",t.async=!0,document.body.appendChild(t),(0,s.jsx)("blockquote",{className:"twitter-tweet",children:(0,s.jsx)("a",{href:e})})};t.ZP=e=>{let{videoUrl:t,...i}=e;return l(t)?c(t):!function(e){try{let t=new URL(e);return"twitter.com"===t.hostname||"x.com"===t.hostname||t.hostname.endsWith(".twitter.com")||t.hostname.endsWith(".x.com")}catch(e){return!1}}(t)?(0,s.jsx)(r.Z,{...i,url:t,width:"100%",height:"100%",controls:!0,poster:""}):d(t)}},54163:function(e,t,i){var s=i(68088),a=i(35467),r=i(7504),n=i(91976),l=i(17457),o=i(40534),c=i(9506),d=i(8120),u=i(26397);function h(){return(0,s.jsx)(a.J,{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"currentColor",stroke:"currentColor",strokeWidth:"0",viewBox:"0 0 256 256",opacity:.5,children:(0,s.jsx)("path",{stroke:"none",d:"M152 180a40.55 40.55 0 01-20 34.91 8 8 0 01-8-13.82 24.49 24.49 0 000-42.18 8 8 0 018-13.82A40.55 40.55 0 01152 180zm-52.94-51.39a8 8 0 00-8.72 1.73L68.69 152H48a8 8 0 00-8 8v40a8 8 0 008 8h20.69l21.65 21.66A8 8 0 00104 224v-88a8 8 0 00-4.94-7.39zM216 88v128a16 16 0 01-16 16h-32a8 8 0 010-16h32V96h-48a8 8 0 01-8-8V40H56v80a8 8 0 01-16 0V40a16 16 0 0116-16h96a8 8 0 015.66 2.34l56 56A8 8 0 01216 88zm-56-8h28.69L160 51.31z"})})}let p=(0,o.E)(r.xu),m=(0,n.chakra)("video"),v=(0,n.chakra)("audio");t.Z=e=>{let{src:t,contentType:i,onLoad:a}=e,[n,o]=(0,c.useState)(!1),[g,f]=(0,c.useState)(!1),[x,b]=(0,c.useState)(!1),A=x&&n;(0,c.useEffect)(()=>{A&&(null==a||a())},[A]);let y=i.includes("audio")?v:m;return(0,s.jsxs)(r.xu,{pos:"relative",w:"100%",h:"100%",overflow:"hidden",children:[!A&&!g&&(0,s.jsx)(l.M,{pos:"absolute",inset:0,children:(0,s.jsx)(d.Z,{svgClassName:"h-4 w-4 text-gray-700 hover:text-gray-500 animate-spin",iconClassName:"h-4 w-4 fill-gray-700 group-active:fill-gray/80","aria-hidden":"true"})}),g&&(0,s.jsx)(l.M,{pos:"absolute",inset:0,children:(0,s.jsx)(u.default,{children:"Preview unavailable."})}),(0,s.jsxs)(p,{initial:{opacity:0},animate:{opacity:A?1:0,transition:{duration:.42}},w:"100%",h:"100%",children:[i.includes("audio")&&(0,s.jsx)(l.M,{pos:"absolute",inset:0,className:"!bg-[#edf2f5]",children:(0,s.jsx)(h,{})}),n&&(0,s.jsx)(y,{pos:"absolute",inset:0,w:"100%",h:"100%",objectFit:"cover",filter:"blur(16px)",transform:"scale(1.22)",opacity:1,backgroundColor:"transparent",onLoadedMetadata:()=>{b(!0)},children:(0,s.jsx)("source",{src:t})}),(0,s.jsx)(y,{w:"100%",h:"100%",objectFit:"contain",controls:!0,pos:"relative",backgroundColor:"transparent",onLoadedMetadata:()=>{o(!0),null==a||a()},onError:()=>{f(!0)},children:(0,s.jsx)("source",{src:t})})]})]})}},58815:function(e,t,i){i.d(t,{c:function(){return s.cA},o:function(){return a}});var s=i(53832);let a=()=>{null===s.Sv||void 0===s.Sv||s.Sv.postMessage(s.cA)}},732:function(e,t,i){i.d(t,{h:function(){return p},k:function(){return m}});var s=i(23431),a=i(9506),r=i(30487),n=i(1851),l=i(60358),o=i(84106),c=i(99348);let d=(0,i(21113).Z)("file:///app/src/utils/useOnboarding.ts"),u="xi:is_onboarding_completed",h=e=>e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():e,p=async e=>{localStorage.setItem(u,"true");try{await (0,r.JNS)({body:{first_name:h(null==e?void 0:e.firstName),role:e.role,subrole:e.subrole,timezone:null==e?void 0:e.timezone,source:null==e?void 0:e.source,usecases:null==e?void 0:e.usecases,theme:null==e?void 0:e.theme,birthday_unix:Math.floor(new Date(null==e?void 0:e.birthdate).getTime()/1e3)}})}catch(e){o.toast.error("Could not save your preferences, please try again."),d.error(e)}},m=()=>{let e=(0,s.useRouter)(),t=(0,s.usePathname)(),i="local"!==(0,c.d)().envType;(0,a.useEffect)(()=>{var s;!n.isLoggedIn.value||!n.userData.value||(null==t?void 0:t.includes(l.VP.onboarding))||!i||(null===(s=n.userData.value)||void 0===s?void 0:s.is_onboarding_completed)||localStorage.getItem(u)||((0,o.toast)("You must complete onboarding to continue using ElevenLabs"),e.push(l.VP.onboarding))},[t,n.isLoggedIn.value,i,n.userData.value])}}}]);