!function(){"use strict";function t(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}function e(t){var e,i,s,n;if(t.labels&&t.labels.length)return null==(e=t.labels[0].textContent)?void 0:e.trim();const r=t.closest("label");if(r)return(r.textContent||"").trim();if(t.id){const e=document.querySelector(`label[for="${t.id}"]`);if(e)return null==(i=e.textContent)?void 0:i.trim()}const o=t.previousElementSibling;if(o&&"LABEL"===o.tagName)return null==(s=o.textContent)?void 0:s.trim();const a=t.parentElement;if(a){const t=["label","form-label","control-label","field-label"];for(const e of t){const t=a.querySelector("."+e);if(t)return null==(n=t.textContent)?void 0:n.trim()}}}function i(i){if("submit"===i.type||"button"===i.type||"reset"===i.type||("checkbox"===i.type||"radio"===i.type)&&!i.checked||!i.value||function(t){if("password"===t.type||"hidden"===t.type)return!0;if(t.name){const e=t.name.toLowerCase();if(x.some((t=>e.includes(t))))return!0}if(t.id){const e=t.id.toLowerCase();if(x.some((t=>e.includes(t))))return!0}const i=e(t);if(i){const t=i.toLowerCase();if(x.some((e=>t.includes(e))))return!0}return!1}(i))return null;const s=e(i);return{id:i.id||t().slice(0,8),name:i.name||void 0,type:i.type,tagName:i.tagName,value:i.value,label:s}}function s(t){const e=t.type||t.name;return"page_view"===e||"session_start"===e||"session_end"===e?1:"form_submit"===e||"form_abandon"===e||"click"===e||"session_update"===e?2:"track"===e||"string"==typeof e?3:"identify"===e?4:3}function n(){const t="undefined"!=typeof document?document.getElementById("__radar__"):null;return t?(e=t.dataset.settings,JSON.parse(e||"{}")):{};var e}var r,o,a,h,c,l,u,d,m,f=Object.defineProperty,p=(t,e,i)=>((t,e,i)=>e in t?f(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i)(t,"symbol"!=typeof e?e+"":e,i);const w=t=>Math.round(t/1e3);r=Object.defineProperty,o=(t,e,i)=>e in t?r(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,a=(t,e,i)=>o(t,"symbol"!=typeof e?e+"":e,i);class g{constructor(t){a(this,"debug",!1),a(this,"errorEndpoint"),this.debug=!!t.debug,this.errorEndpoint=t.apiEndpoint+"/errors"}report(t){try{const e=new XMLHttpRequest;e.open("POST",this.errorEndpoint,!0),e.setRequestHeader("Content-Type","application/json"),e.send(JSON.stringify({error:t.message,stack:t.stack,timestamp:(new Date).toISOString(),source:"radar-tracker",userAgent:navigator.userAgent,url:window.location.href}))}catch{}}log(...t){this.debug&&console.log("[Radar]",...t)}warn(...t){this.debug&&console.warn("[Radar]",...t)}error(t,...e){this.debug&&console.error("[Radar]",t,...e),this.report(t)}}let y;const v=(...t)=>null==y?void 0:y.warn(...t),b=(t,...e)=>null==y?void 0:y.error(t,...e);class T{constructor(){p(this,"events",{}),p(this,"middleware",[])}on(t,e){const i=this.events[t];i?i.push(e):this.events[t]=[e]}off(t,e){const i=this.events[t];i&&(this.events[t]=i.filter((t=>t!==e)))}use(t){this.middleware.push(t)}removeMiddleware(t){this.middleware=this.middleware.filter((e=>e!==t))}emit(t,...e){for(const n of this.middleware)try{if(!n(t,...e))return}catch(s){b(s,"Error in event middleware")}const i=this.events[t];i&&i.forEach((t=>{try{t(...e)}catch(s){b(s,"Error in event handler")}}))}}const S={},k=(t="")=>{const e=btoa(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?t.replace(/^[^@]+@/,""):"");return!S[e]&&(S[e]=!0,e)},x=["password","credit","card","ccn","cvv","secret","token","ssn","social","auth","private","security","pin"],D=["email","name","firstName","lastName","phone","company","organization","title","username"];class E extends T{constructor(){super(),p(this,"activeFormInteractions",new Map),p(this,"submittedForms",new Set),p(this,"eventHandlersInstalled",!1),p(this,"sensitiveFields",[...x]),p(this,"formIdMap",new WeakMap),p(this,"handleFormFieldFocus",(t=>{const e=t.target;if(!this.isFormField(e))return;const i=this.getParentForm(e);if(!i)return;const s=this.getFormId(i);if(!this.activeFormInteractions.has(s)){const t="FORM"===i.tagName?i:null;this.activeFormInteractions.set(s,{formId:s,formName:(null==t?void 0:t.getAttribute("name"))||(null==t?void 0:t.id)||void 0,action:(null==t?void 0:t.action)||void 0,method:(null==t?void 0:t.method)||void 0,startTime:Date.now(),lastInteraction:Date.now(),fields:{}}),this.emit("form_start",{formId:s})}const n=this.activeFormInteractions.get(s);n&&(n.lastInteraction=Date.now())})),p(this,"handleFormFieldInput",(t=>{const e=t.target;if(!this.isFormField(e))return;const i=this.getParentForm(e);if(!i)return;const s=this.getFormId(i),n=this.activeFormInteractions.get(s);n&&(n.lastInteraction=Date.now())})),p(this,"handleFormFieldChange",(t=>{const e=t.target;if(!this.isFormField(e))return;const i=this.getParentForm(e);if(!i)return;const s=this.getFormId(i),n=this.activeFormInteractions.get(s);n&&(this.updateFormFieldData(n,i),this.emit("form_update",{formId:s,formName:n.formName,timeSpent:w(Date.now()-n.startTime)}))})),p(this,"handleFormSubmit",(t=>{const e=t.target,i=this.getFormId(e);this.submittedForms.add(i);let s=this.activeFormInteractions.get(i);s?(s.submitted=!0,s.lastInteraction=Date.now()):(s={formId:i,formName:e.getAttribute("name")||e.id||void 0,action:e.action,method:e.method,startTime:Date.now(),lastInteraction:Date.now(),fields:{},submitted:!0},this.activeFormInteractions.set(i,s)),this.updateFormFieldData(s,e);const n=w(Date.now()-s.startTime),r=function(t){var e,i;const s={};for(const[,n]of Object.entries(t)){const t=(null==(e=n.name)?void 0:e.toLowerCase())||"",r=n.id.toLowerCase(),o=(null==(i=n.label)?void 0:i.toLowerCase())||"";let a=null;if(("email"===n.type||t.includes("email")||r.includes("email")||o.includes("email"))&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.value))s.email=n.value;else{for(const e of D){const i=e.toLowerCase();if(t.includes(i)||r.includes(i)||o.includes(i)){a=e;break}}a&&(s[a]=n.value)}}return s}(s.fields);this.emit("form_submit",{formId:i,formName:s.formName,action:s.action,method:s.method,timeSpent:n,fields:s.fields,traits:r})})),p(this,"handlePageUnload",(()=>{for(const[t,e]of this.activeFormInteractions.entries()){if(e.submitted||this.submittedForms.has(t))continue;const i=w(Date.now()-e.startTime),s=w(Date.now()-e.lastInteraction);this.emit("form_abandon",{formId:t,formName:e.formName,timeSpent:i,timeSinceLastInteraction:s,fieldCount:Object.keys(e.fields).length,fields:e.fields})}}))}startTracking(){this.eventHandlersInstalled||typeof window>"u"||(document.addEventListener("focusin",this.handleFormFieldFocus),document.addEventListener("input",this.handleFormFieldInput),document.addEventListener("change",this.handleFormFieldChange),document.addEventListener("submit",this.handleFormSubmit,!0),window.addEventListener("beforeunload",this.handlePageUnload),this.patchFormSubmitMethod(),this.eventHandlersInstalled=!0)}stopTracking(){!this.eventHandlersInstalled||typeof window>"u"||(document.removeEventListener("focusin",this.handleFormFieldFocus),document.removeEventListener("input",this.handleFormFieldInput),document.removeEventListener("change",this.handleFormFieldChange),document.removeEventListener("submit",this.handleFormSubmit,!0),window.removeEventListener("beforeunload",this.handlePageUnload),this.unpatchFormSubmitMethod(),this.eventHandlersInstalled=!1)}addSensitiveFields(t){this.sensitiveFields.push(...t)}patchFormSubmitMethod(){if(typeof window>"u")return;const t=HTMLFormElement.prototype.submit;HTMLFormElement.prototype.submit=function(){const e=new Event("submit",{bubbles:!0,cancelable:!0});this.dispatchEvent(e),t.call(this)}}unpatchFormSubmitMethod(){typeof window>"u"||!this.eventHandlersInstalled||(HTMLFormElement.prototype.submit=function(){this.requestSubmit()})}updateFormFieldData(t,e){let s;s="FORM"===e.tagName?Array.from(e.elements):Array.from(e.querySelectorAll("input, select, textarea"));for(const n of s){if(!this.isFormField(n))continue;const e=i(n),s=k((null==e?void 0:e.value)||"");if(s&&this.emit("snid",s),e){const i=e.name||e.id||e.label||"field_"+Object.keys(t.fields).length;t.fields[i]=e}}}getParentForm(t){const e=t.closest("form");return null!==e?e:t.closest('section, article, main, div[class*="form"], div[id*="form"]')||document.body}isFormField(t){return"INPUT"===t.tagName||"SELECT"===t.tagName||"TEXTAREA"===t.tagName}getFormId(e){if("FORM"===e.tagName){const t=e;if(t.id)return t.id;const i=t.getAttribute("name");if(i)return i}if(this.formIdMap.has(e))return this.formIdMap.get(e);const i=`${"FORM"===e.tagName?"form":"container"}_${e.id||e.className||"standalone"}_${t().slice(0,8)}`;return this.formIdMap.set(e,i),i}}class _ extends T{constructor(){super(),p(this,"eventHandlersInstalled",!1),p(this,"privacySettings",{trackAllClicks:!1,collectPositionData:!0,collectModifierData:!0}),p(this,"trackDownloadClick",(t=>{var e,i;const s=RegExp("[^/]*.(pdf|doc|docx|xls|xlsx|ppt|pptx|key|txt|dmg|exe|zip)$"),n=null==(i=null==(e=null==t?void 0:t.properties)?void 0:e.href)?void 0:i.match(s);n&&this.emit("download",{eventName:"download",properties:{...t.properties,fileName:n[0]}})})),p(this,"handleClick",(t=>{const e=t.target,i=this.findClickableElement(e)||(this.privacySettings.trackAllClicks?e:null);if(!i)return;const s=this.extractElementData(i,e,t),n=this.formatTrackingEvent(s);this.emit("click_event",n)}))}startTracking(){this.eventHandlersInstalled||typeof window>"u"||(document.addEventListener("click",this.handleClick,!0),this.eventHandlersInstalled=!0,this.on("click_event",this.trackDownloadClick))}stopTracking(){!this.eventHandlersInstalled||typeof window>"u"||(document.removeEventListener("click",this.handleClick,!0),this.eventHandlersInstalled=!1)}updatePrivacySettings(t){this.privacySettings={...this.privacySettings,...t}}findClickableElement(t){if(this.isClickableElement(t))return t;let e=t.parentElement;for(;e;){if(this.isClickableElement(e))return e;e=e.parentElement}return null}isClickableElement(t){const e=t.tagName.toLowerCase();if(["a","button"].includes(e))return!0;if("input"===e){const e=t.getAttribute("type");if("button"===e||"submit"===e)return!0}return!("button"!==t.getAttribute("role")&&!t.hasAttribute("onclick")&&!t.hasAttribute("data-track-event"))}extractElementData(t,e,i){var s;const n=t.tagName,r=t.id||"",o=Array.from(t.classList).join(" "),a=t.getAttribute("href")||"",h=(null==(s=t.textContent)?void 0:s.trim())||"";let c=t.getAttribute("data-track-event");c||(c="BUTTON"===n?"Button Clicked":"A"===n?"Link Clicked":"button"===t.getAttribute("role")||"INPUT"===n&&"button"===t.getAttribute("type")?"Button Clicked":"Element Clicked");let l=n.toLowerCase();"INPUT"===n&&(l=`${n.toLowerCase()}[${t.getAttribute("type")||""}]`);const u=this.getDataAttributes(t),d=this.getDomPath(t),m=t.parentElement,f=m?{id:m.id||void 0,classes:m.className||void 0,tag:m.tagName.toLowerCase()}:{};let p,w;if(this.privacySettings.collectPositionData){const e=t.getBoundingClientRect();p={x:e.left+window.scrollX,y:e.top+window.scrollY,viewport:{x:e.left,y:e.top},elementSize:{width:e.width,height:e.height}}}return this.privacySettings.collectModifierData&&(w={ctrl:i.ctrlKey,alt:i.altKey,shift:i.shiftKey,meta:i.metaKey}),{eventName:c,elementId:r,elementType:l,elementTag:n,elementText:h,classes:o,href:a,attributes:u,elementPath:d,parentInfo:f,position:p,clickType:i.button,modifiers:w,isVisible:this.isElementVisible(t)}}getDataAttributes(t){const e={};for(const i of Array.from(t.attributes))i.name.startsWith("data-")&&"data-track-event"!==i.name&&(e[i.name.slice(5).replace(/-([a-z])/g,((t,e)=>e.toUpperCase()))]=i.value);return e}getDomPath(t){const e=[];let i=t;for(;i&&"HTML"!==i.tagName;){let t=i.tagName.toLowerCase();if(i.id)t+="#"+i.id;else if(i.className&&"string"==typeof i.className){const e=i.className.split(" ");e.length>0&&e[0]&&(t+="."+e[0])}e.unshift(t),i=i.parentElement}return e.join(" > ")}isElementVisible(t){const e=window.getComputedStyle(t);return!("none"===e.display||"hidden"===e.visibility||"0"===e.opacity||0===t.offsetWidth||0===t.offsetHeight)}formatTrackingEvent(t){const e={elementPath:t.elementPath};return Object.assign(e,t.attributes),"BUTTON"===t.elementTag||t.elementType.includes("button")||t.elementType.includes("submit")?{eventName:"Button Clicked",properties:{...e,buttonId:t.elementId,buttonType:t.elementType,buttonText:t.elementText,elementPath:t.elementPath}}:"A"===t.elementTag?{eventName:"Link Clicked",properties:{...e,linkId:t.elementId,linkText:t.elementText,href:t.href,elementPath:t.elementPath}}:{eventName:"Element Clicked",properties:{...e,elementId:t.elementId,elementType:t.elementType,elementText:t.elementText,elementPath:t.elementPath}}}}class I{constructor(t={}){p(this,"isActive",!1),p(this,"isPageVisible",!0),p(this,"lastActivityTime",Date.now()),p(this,"activeStartTime",null),p(this,"accumulatedTime",0),p(this,"activityCheckInterval",null),p(this,"inactivityThreshold",6e4),p(this,"segments",[]),t.inactivityThreshold&&(this.inactivityThreshold=t.inactivityThreshold),this.lastActivityTime=Date.now(),this.isActive=!0,"u">typeof window&&(this.setupVisibilityListener(),this.setupActivityListeners(),this.checkActivity(),this.isPageVisible="visible"===document.visibilityState)}setupVisibilityListener(){"u">typeof document&&document.addEventListener("visibilitychange",(()=>{this.isPageVisible="visible"===document.visibilityState,this.updateTracking()}))}setupActivityListeners(){"u">typeof window&&["mousedown","mousemove","keypress","scroll","touchstart"].forEach((t=>{window.addEventListener(t,(()=>{this.recordActivity()}))}))}recordActivity(){this.lastActivityTime=Date.now(),this.isActive=!0,this.updateTracking()}checkActivity(){this.activityCheckInterval=window.setInterval((()=>{Date.now()-this.lastActivityTime>this.inactivityThreshold&&this.isActive&&(this.isActive=!1,this.updateTracking())}),100)}updateTracking(){const t=this.isPageVisible&&this.isActive;if(t&&null===this.activeStartTime)this.activeStartTime=Date.now();else if(!t&&null!==this.activeStartTime){const t=Date.now(),e=t-this.activeStartTime;this.accumulatedTime+=e,this.segments.push({start:this.activeStartTime,end:t,location:window.location.href}),this.activeStartTime=null}}getEngagementTime(){let t=this.accumulatedTime;return null!==this.activeStartTime&&(t+=Date.now()-this.activeStartTime),w(t)}getEngagementSegments(){const t=[...this.segments];return null!==this.activeStartTime&&t.push({start:this.activeStartTime,end:Date.now(),location:window.location.href}),t}reset(){this.accumulatedTime=0,this.activeStartTime=null,this.segments=[],this.lastActivityTime=Date.now(),this.isActive=!0}simulateActivity(){this.lastActivityTime=Date.now(),this.isActive=!0,this.updateTracking()}simulateVisibilityChange(t){this.isPageVisible=t,this.updateTracking()}simulateInactivity(){this.isActive=!1,this.updateTracking()}destroy(){this.activityCheckInterval&&(clearInterval(this.activityCheckInterval),this.activityCheckInterval=null),null!==this.activeStartTime&&(this.isActive=!1,this.updateTracking())}}class C{constructor(t="snitcher_",e=1048576){p(this,"prefix"),p(this,"quotaLimit"),this.prefix=t,this.quotaLimit=e}set(t,e,i={},s){if(s&&!this.hasConsent(s))return!1;const n=this.prefix+t,r="string"==typeof e?e:JSON.stringify(e);try{if("cookie"===i.storage)return this.setCookie(n,r,i);if(this.checkQuota(r.length))return localStorage.setItem(n,r),i.expires&&this.setExpiration(n,i.expires),i.cookie&&this.setCookie(n,r,i),!0;this.enforceQuotaLimit(r.length);try{return localStorage.setItem(n,r),!0}catch{if(i.cookie)return this.setCookie(n,r,i)}}catch{if(!1!==i.cookie)return this.setCookie(n,r,i)}return!1}get(t,e={},i){if(i&&!this.hasConsent(i))return null;const s=this.prefix+t;try{if(this.hasExpired(s))return this.remove(t),null;if("cookie"!==e.storage){const t=localStorage.getItem(s);if(null!==t)try{return this.safeParse(t)}catch{return t}}if(!1!==e.cookie){const t=this.getCookie(s);if(t)try{return this.safeParse(t)}catch{return t}}}catch(n){v("Failed to get item from storage: "+t,n)}return null}remove(t,e={},i){if(i&&!this.hasConsent(i))return!1;const s=this.prefix+t;let n=!1;try{"cookie"!==e.storage&&(localStorage.removeItem(s),localStorage.removeItem(s+"_expires"),n=!0),!1!==e.cookie&&(this.removeCookie(s,e),n=!0)}catch(r){return v("Failed to remove item from storage: "+t,r),!1}return n}exists(t,e={},i){return null!==this.get(t,e,i)}clear(){try{for(let e=localStorage.length-1;e>=0;e--){const t=localStorage.key(e);t&&t.startsWith(this.prefix)&&localStorage.removeItem(t)}const t=document.cookie.split(";");for(let e=0;e<t.length;e++){const i=t[e].trim().split("=")[0];i&&i.startsWith(this.prefix)&&(document.cookie=i+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/;")}return!0}catch(t){return v("Failed to clear storage",t),!1}}getSize(){let t=0;try{for(let e=0;e<localStorage.length;e++){const i=localStorage.key(e);if(i&&i.startsWith(this.prefix)){const e=localStorage.getItem(i)||"";t+=i.length+e.length}}}catch(e){v("Failed to calculate storage size",e)}return t}hasConsent(t){const e=`${this.prefix}consent_${t}`;return"false"!==localStorage.getItem(e)}setConsent(t,e){const i=`${this.prefix}consent_${t}`;localStorage.setItem(i,e.toString())}checkQuota(t){return this.getSize()+t<=this.quotaLimit}enforceQuotaLimit(t){if(this.getSize()+t>this.quotaLimit){const e=[];for(let t=0;t<localStorage.length;t++){const i=localStorage.key(t);if(i&&i.startsWith(this.prefix)&&!i.endsWith("_expires")){const t=i+"_expires",s=+localStorage.getItem(t)||Date.now()+864e5;e.push({key:i,expires:s})}}e.sort(((t,e)=>t.expires-e.expires));let i=this.getSize();for(const s of e){const e=s.key.substring(this.prefix.length),n=(localStorage.getItem(s.key)||"").length+s.key.length;if(this.remove(e),i-=n,i+t<=this.quotaLimit)break}}}setExpiration(t,e){const i=e instanceof Date?e.getTime():"number"==typeof e?Date.now()+e:Date.now()+864e5;localStorage.setItem(t+"_expires",i.toString())}hasExpired(t){const e=t+"_expires",i=localStorage.getItem(e);if(!i)return!1;const s=+i;return Date.now()>s}setCookie(t,e,i={}){try{const s=i.expires instanceof Date?i.expires:"number"==typeof i.expires?new Date(Date.now()+i.expires):new Date(Date.now()+864e5),n=i.path||"/",r=i.domain||this.getTopLevelDomain(),o=i.sameSite||"Lax",a=i.secure||"https:"===window.location.protocol;let h=`${t}=${encodeURIComponent(e)}; path=${n}; expires=${s.toUTCString()}`;return r&&(h+="; domain="+r),o&&(h+="; SameSite="+o),a&&(h+="; Secure"),document.cookie=h,!0}catch(s){return v("Failed to set cookie: "+t,s),!1}}getCookie(t){var e;const i=null==(e=null==document?void 0:document.cookie)?void 0:e.match(`(^|;)\\s*${t}\\s*=\\s*([^;]+)`);return i?decodeURIComponent(i[2]):null}removeCookie(t,e={}){try{const i=e.path||"/",s=e.domain||this.getTopLevelDomain();let n=`${t}=; path=${i}; expires=Thu, 01 Jan 1970 00:00:00 GMT`;return s&&(n+="; domain="+s),document.cookie=n,!0}catch(i){return v("Failed to remove cookie: "+t,i),!1}}safeParse(t){return JSON.parse(t,((t,e)=>e))}getTopLevelDomain(){const t=window.location.hostname;if(/^(\d{1,3}\.){3}\d{1,3}$/.test(t)||"localhost"===t)return t;const e=t.split(".");if(1>=e.length)return t;for(let i=0;i<e.length-1;i++){const t=e.slice(i).join("."),s="__test_tld_"+Date.now();if(document.cookie=`${s}=1; domain=.${t}; path=/; expires=Fri, 31 Dec 9999 23:59:59 GMT`,-1!==document.cookie.indexOf(s))return document.cookie=`${s}=; domain=.${t}; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT`,t}return t}}h=(t=>(t.ESSENTIAL="essential",t.FUNCTIONAL="functional",t.ANALYTICS="analytics",t.MARKETING="marketing",t))(h||{});class O{constructor(t){p(this,"SESSION_KEY","session"),p(this,"SESSION_TIMEOUT",18e5),p(this,"currentSession",null),p(this,"focusTimer"),p(this,"storage"),this.storage=t||new C("snitcher_"),this.focusTimer=new I}getTimeout(){return this.SESSION_TIMEOUT}getSession(){return this.currentSession||(this.currentSession=this.loadSession()),this.hasSessionExpired(this.currentSession)&&(this.currentSession=this.createSession()),this.currentSession}extendSession(){const t=this.getSession();t.lastActivity=(new Date).toISOString(),this.focusTimer.simulateActivity(),t.engagementTime=this.getEngagementTime(),t.engagementSegments=this.getEngagementSegments(),this.saveSession(t)}endSession(){this.currentSession&&(this.currentSession.engagementTime=this.getEngagementTime(),this.currentSession.engagementSegments=this.getEngagementSegments(),this.saveSession(this.currentSession)),this.focusTimer.destroy(),this.storage.remove(this.SESSION_KEY),this.currentSession=null,this.focusTimer=new I}getSessionDuration(){const t=this.getSession();return w(Date.now()-Date.parse(t.startedAt))}getEngagementTime(){return this.focusTimer.getEngagementTime()}getEngagementSegments(){return this.focusTimer.getEngagementSegments()}createSession(){const e=(new Date).toISOString();this.focusTimer.reset();const i={id:t(),startedAt:e,lastActivity:e,engagementTime:0,engagementSegments:[]};return this.saveSession(i),i}loadSession(){return this.storage.get(this.SESSION_KEY,{},h.FUNCTIONAL)}saveSession(t){this.storage.set(this.SESSION_KEY,t,{expires:2*this.SESSION_TIMEOUT},h.FUNCTIONAL)}hasSessionExpired(t){return!t||Date.now()-Date.parse(t.lastActivity)>this.SESSION_TIMEOUT}}class F{constructor(t){p(this,"DEVICE_KEY","device_id"),p(this,"TRAITS_KEY","user_traits"),p(this,"storage"),this.storage=t||new C("snitcher_")}getDeviceId(){let e=this.storage.get(this.DEVICE_KEY,{cookie:!0},h.ESSENTIAL);return e||(e=t(),this.setDeviceId(e)),e}setDeviceId(t){this.storage.set(this.DEVICE_KEY,t,{cookie:!0,expires:31536e6},h.ESSENTIAL)}getTraits(){return this.storage.get(this.TRAITS_KEY,{},h.ANALYTICS)||{}}setTraits(t){const e={...this.getTraits(),...t};this.storage.set(this.TRAITS_KEY,e,{expires:31536e6},h.ANALYTICS)}getUser(){const t=this.getTraits();return{deviceId:this.getDeviceId(),traits:t,email:t.email}}reset(){this.storage.remove(this.DEVICE_KEY,{cookie:!0}),this.storage.remove(this.TRAITS_KEY)}}const P=t=>t.split("#")[0],A="u">typeof window&&"navigation"in window&&window.navigation?window.navigation:null;class N extends T{constructor(){super(),p(this,"lastUrl",""),p(this,"unloaded",!1),p(this,"handlePageChange",(()=>{const t=P(window.location.href);t!==this.lastUrl&&(this.emit("page.exit",{url:this.lastUrl}),this.lastUrl=t,this.unloaded=!1,this.emit("page.enter",{url:t}))})),p(this,"handlePageExit",(()=>{this.unloaded||(this.unloaded=!0,this.emit("page.exit",{url:this.lastUrl}))})),p(this,"handleVisibilityChange",(()=>{"visible"===document.visibilityState&&this.handlePageChange()})),"u">typeof window&&(this.lastUrl=P(window.location.href))}start(){if(typeof window>"u")return;const t=performance.getEntriesByType("navigation");t.length>0&&"reload"===t[0].type&&this.emit("page.reload",{url:this.lastUrl}),this.emit("page.enter",{url:this.lastUrl}),A?this.setupNavigationAPI(A):(this.patchHistoryMethods(),window.addEventListener("popstate",this.handlePageChange)),["beforeunload","pagehide"].forEach((t=>{window.addEventListener(t,this.handlePageExit,{once:!0})})),document.addEventListener("visibilitychange",this.handleVisibilityChange)}patchHistoryMethods(){["pushState","replaceState"].forEach((t=>{var e;const i=history;if(null!=(e=i[t])&&e.t)return;const s=i[t],n=(...t)=>{s.apply(history,t),this.handlePageChange()};n.t=!0,n.i=s,i[t]=n}))}setupNavigationAPI(t){t.addEventListener("currententrychange",(()=>{this.handlePageChange()}))}}c=(t=>(t.SESSION_START="session_start",t.SESSION_UPDATE="session_update",t.SESSION_END="session_end",t.IDENTIFY="identify",t.PAGE_VIEW="page_view",t.FORM_SUBMIT="form_submit",t.FORM_ABANDON="form_abandon",t.CLICK="click",t.TRACK="track",t))(c||{});class L extends T{constructor(){super(),p(this,"focusTimer"),p(this,"pageViewId"),p(this,"timestamp"),p(this,"nav"),p(this,"stored"),this.focusTimer=new I,this.pageViewId=t(),this.timestamp=(new Date).toISOString(),this.nav=new N,this.stored=this.getInitialPageData(),this.nav.on("page.enter",(()=>{this.pageViewId=t(),this.focusTimer=new I,this.trackCurrentPage("enter")})),this.nav.on("page.exit",(()=>{this.trackCurrentPage("exit")}))}getInitialPageData(){return typeof window>"u"?{url:"",title:"",referrer:"",pageViewId:this.pageViewId}:{url:window.location.href,title:document.title,referrer:document.referrer,pageViewId:this.pageViewId}}startTracking(){this.nav.start()}getPage(t=!1){return t&&(this.stored=this.getInitialPageData()),this.stored}getPageEngagementParams(t){const e="enter"===t?0:w(Date.now()-Date.parse(this.timestamp)),i="enter"===t?0:this.focusTimer.getEngagementTime(),s="enter"===t?[]:this.focusTimer.getEngagementSegments();return{stage:t,pageViewId:this.pageViewId,timestamp:this.timestamp,totalTimeOnPage:e,totalFocusTimeOnPage:i,pageEngagementSegments:s}}trackCurrentPage(t){const e={...this.getPage("enter"===t),...this.getPageEngagementParams(t)};this.emit(c.PAGE_VIEW,e)}}class M extends Error{constructor(t){super("Service temporarily unavailable"),p(this,"nextAttemptTime"),this.name="CircuitBreakerOpenError",this.nextAttemptTime=t}getWaitTime(){return Math.max(0,this.nextAttemptTime-Date.now())}}class ${constructor(t={}){p(this,"state","CLOSED"),p(this,"failureCount",0),p(this,"successCount",0),p(this,"lastFailureTime",null),p(this,"nextAttemptTime",null),p(this,"config"),this.config={failureThreshold:5,timeoutMs:6e4,successThreshold:3,monitoringWindowMs:12e4,...t}}async execute(t){if(!this.canExecute())return Promise.reject(new M(this.nextAttemptTime||Date.now()+this.config.timeoutMs));try{const e=await t();return this.onSuccess(),e}catch(e){return this.onFailure(),Promise.reject(e)}}canExecute(){const t=Date.now();switch(this.lastFailureTime&&t-this.lastFailureTime>this.config.monitoringWindowMs&&this.reset(),this.state){case"CLOSED":case"HALF_OPEN":return!0;case"OPEN":return!(!this.nextAttemptTime||t<this.nextAttemptTime||(this.moveToHalfOpen(),0));default:return!1}}onSuccess(){"HALF_OPEN"===this.state?(this.successCount++,this.successCount>=this.config.successThreshold&&this.moveToClosed()):"CLOSED"===this.state&&(this.failureCount=0)}onFailure(){this.failureCount++,this.lastFailureTime=Date.now(),"CLOSED"===this.state?this.failureCount>=this.config.failureThreshold&&this.moveToOpen():"HALF_OPEN"===this.state&&this.moveToOpen()}moveToOpen(){this.state="OPEN",this.successCount=0,this.nextAttemptTime=Date.now()+this.config.timeoutMs}moveToHalfOpen(){this.state="HALF_OPEN",this.successCount=0,this.nextAttemptTime=null}moveToClosed(){this.state="CLOSED",this.failureCount=0,this.successCount=0,this.lastFailureTime=null,this.nextAttemptTime=null}reset(){this.moveToClosed()}getStats(){return{state:this.state,failureCount:this.failureCount,successCount:this.successCount,lastFailureTime:this.lastFailureTime,nextAttemptTime:this.nextAttemptTime}}forceState(t){this.state=t,"OPEN"===t&&(this.nextAttemptTime=Date.now()+this.config.timeoutMs)}}class R{constructor(t,e={},i={}){p(this,"baseUrl"),p(this,"defaultOptions"),p(this,"circuitBreaker"),this.baseUrl=t.endsWith("/")?t:t+"/",this.defaultOptions={headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:3e4,retries:1,compress:!0,baseDelay:1e3,maxDelay:3e4,jitter:!0,circuitBreaker:!0,...e},this.circuitBreaker=new $(i)}async send(t,e,i={}){const s=this.getFullUrl(t),n=this.mergeOptions(i);return n.circuitBreaker?this.circuitBreaker.execute((()=>this.sendRequest(s,e,n))):this.sendRequest(s,e,n)}async sendRequest(t,e,i){const s=i.compress?this.compressData(e):JSON.stringify(e),n=new AbortController,r=setTimeout((()=>{n.abort()}),i.timeout);try{const e=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:s,signal:n.signal});if(!e.ok)throw Error(`HTTP error ${e.status+""}: ${e.statusText}`);return e}catch(o){if(i.retries&&i.retries>0)return this.retryRequest(t,e,{...i,retries:i.retries-1},i.retries);throw o}finally{clearTimeout(r)}}beacon(t,e){const i=this.getFullUrl(t),s=new Blob([JSON.stringify(e)],{type:"application/json"});if("function"==typeof navigator.sendBeacon)return navigator.sendBeacon(i,s);try{const t=new XMLHttpRequest;return t.open("POST",i,!1),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify(e)),!0}catch{return!1}}async fetchJson(t,e={}){const i=this.getFullUrl(t),s=this.mergeOptions(e);return s.circuitBreaker?this.circuitBreaker.execute((()=>this.fetchJsonRequest(i,s))):this.fetchJsonRequest(i,s)}async fetchJsonRequest(t,e){const i=new AbortController,s=setTimeout((()=>{i.abort()}),e.timeout);try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json"},signal:i.signal});if(!e.ok)throw Error(`HTTP error ${e.status+""}: ${e.statusText}`);return await e.json()}finally{clearTimeout(s)}}async retryRequest(t,e,i,s){const n=s-(i.retries||0),r=this.calculateBackoffDelay(n,i);return await new Promise((t=>setTimeout(t,r))),this.sendRequest(t,e,i)}calculateBackoffDelay(t,e){const i=e.baseDelay||this.defaultOptions.baseDelay||1e3,s=e.maxDelay||this.defaultOptions.maxDelay||3e4,n=void 0!==e.jitter?e.jitter:this.defaultOptions.jitter,r=Math.min(i*Math.pow(2,t-1),s);if(n){const t=.25*r,e=2*(Math.random()-.5)*t;return Math.max(0,r+e)}return r}getFullUrl(t){return t.startsWith("http")?t:`${this.baseUrl}${t}`}mergeOptions(t){return{...this.defaultOptions,...t,headers:{...this.defaultOptions.headers,...t.headers}}}compressData(t){return JSON.stringify(t)}getCircuitBreakerStats(){return this.circuitBreaker.getStats()}forceCircuitBreakerState(t){this.circuitBreaker.forceState(t)}}l=(t=>(t[t.CRITICAL=1]="CRITICAL",t[t.HIGH=2]="HIGH",t[t.MEDIUM=3]="MEDIUM",t[t.LOW=4]="LOW",t))(l||{});class j{constructor(t={}){p(this,"items",[]),p(this,"config"),this.config={maxSize:100,maxAge:36e5,priorityLimits:{1:30,2:25,3:25,4:20},...t}}enqueue(t){const e={...t,timestamp:Date.now()};this.cleanupOldItems(),this.items.push(e),this.items.sort(((t,e)=>t.priority-e.priority)),this.enforceSizeLimits()}dequeue(t=1){return this.items.splice(0,t)}peek(t=1){return this.items.slice(0,t)}getByPriority(t){return this.items.filter((e=>e.priority===t))}clear(){this.items=[]}size(){return this.items.length}isEmpty(){return 0===this.items.length}getStats(){const t={1:0,2:0,3:0,4:0};let e=null,i=null;for(const s of this.items)t[s.priority]++,(null===e||s.timestamp<e)&&(e=s.timestamp),(null===i||s.timestamp>i)&&(i=s.timestamp);return{totalItems:this.items.length,priorityBreakdown:t,oldestItem:e,newestItem:i}}cleanupOldItems(){const t=Date.now()-this.config.maxAge;this.items=this.items.filter((e=>e.timestamp>=t))}enforceSizeLimits(){this.enforcePriorityLimits(),this.items.length>this.config.maxSize&&(this.items=this.items.slice(0,this.config.maxSize))}enforcePriorityLimits(){var t;const e=new Map;for(const s of this.items)e.has(s.priority)||e.set(s.priority,[]),null==(t=e.get(s.priority))||t.push(s);const i=[];for(const[s,n]of e){const t=this.config.priorityLimits[s];n.sort(((t,e)=>e.timestamp-t.timestamp)),i.push(...n.slice(0,t))}this.items=i.sort(((t,e)=>t.priority-e.priority))}}const q="1.8.0",B={maxSize:200,maxAge:18e5,priorityLimits:{[l.CRITICAL]:70,[l.HIGH]:50,[l.MEDIUM]:30,[l.LOW]:20}};class H{constructor(t,e){p(this,"queue",[]),p(this,"priorityQueue"),p(this,"flushTimeout",null),p(this,"exiting",!1),p(this,"failureMode",!1),p(this,"options"),p(this,"httpClient"),p(this,"config"),this.config=t,this.httpClient=e,this.options={apiEndpoint:t.apiEndpoint,usePriorityQueue:!0,priorityQueue:B,...t.transport},this.priorityQueue=new j(this.options.priorityQueue),this.setupExitHandler()}enqueue(t){const e=t.type||t.name;if(this.options.blockedEvents.includes(e))return;const i={...t,timestamp:(new Date).toISOString()};if(this.exiting)this.sendImmediate([i]);else if(this.failureMode&&this.options.usePriorityQueue){const e=s(t);this.priorityQueue.enqueue({id:t.id,data:i,priority:e})}else this.queue.push(i),this.queue.length<this.options.batchSize?this.flushTimeout||(this.flushTimeout=window.setTimeout((()=>{this.flush()}),this.options.flushInterval)):this.flush()}flush(){if(this.flushTimeout&&(clearTimeout(this.flushTimeout),this.flushTimeout=null),this.failureMode&&this.options.usePriorityQueue)return void this.flushPriorityQueue();if(0===this.queue.length)return;const t=[...this.queue];this.queue=[],this.sendBatch(t).catch((e=>{this.config.debug&&v("Failed to send batch, retrying...",e.message),this.handleSendFailure(t,e)}))}flushPriorityQueue(){if(this.priorityQueue.isEmpty())return;const t=this.priorityQueue.dequeue(this.options.batchSize),e=t.map((t=>t.data));this.sendBatch(e).catch((e=>{this.config.debug&&v("Failed to send priority batch, retrying...",e.message),this.handlePriorityQueueFailure(t)}))}async sendBatch(t){if(0!==t.length){if(this.exiting&&this.options.useBeacon)return void this.sendBeacon(t);try{await this.httpClient.send("tracker/event",this.toPayload(t)),this.failureMode&&this.exitFailureMode()}catch(e){throw this.config.debug&&v("Batch send failed:",e),e}}}sendImmediate(t){0!==t.length&&(this.options.useBeacon?this.httpClient.beacon("tracker/event",this.toPayload(t,!0)):this.httpClient.send("tracker/event",this.toPayload(t)).catch((t=>{this.config.debug&&v("Failed to send immediate data:",t.message)})))}sendBeacon(t){return this.httpClient.beacon("tracker/event",this.toPayload(t,!0))}setupExitHandler(){if("u">=typeof window)try{window.addEventListener("beforeunload",(()=>{this.exiting=!0,this.flush()}),{capture:!0})}catch(t){v("Could not set up beforeunload handler:",t)}}handleSendFailure(t,e){e instanceof M?(this.enterFailureMode(),this.options.usePriorityQueue?this.moveItemsToPriorityQueue(t):this.queue=[...t,...this.queue]):this.queue=[...t,...this.queue],this.flushTimeout||(this.flushTimeout=window.setTimeout((()=>this.flush()),this.options.flushInterval))}handlePriorityQueueFailure(t){for(const e of t)e.retryCount=(e.retryCount||0)+1,3>e.retryCount&&this.priorityQueue.enqueue(e);this.flushTimeout||(this.flushTimeout=window.setTimeout((()=>this.flush()),2*this.options.flushInterval))}enterFailureMode(){this.failureMode||(this.failureMode=!0,this.config.debug&&v("Entering failure mode - using priority queue"),this.options.usePriorityQueue&&(this.moveItemsToPriorityQueue(this.queue),this.queue=[]))}exitFailureMode(){if(!this.failureMode)return;this.failureMode=!1,this.config.debug&&((...t)=>{null==y||y.log(...t)})("Exiting failure mode - returning to normal queue");const t=this.priorityQueue.dequeue(this.priorityQueue.size());this.queue=t.map((t=>t.data))}moveItemsToPriorityQueue(t){for(const e of t){const t=s(e);this.priorityQueue.enqueue({id:e.id,data:e,priority:t})}}getStats(){return{failureMode:this.failureMode,normalQueueSize:this.queue.length,priorityQueueStats:this.priorityQueue.getStats(),isExiting:this.exiting}}getPriorityQueueStats(){return this.priorityQueue.getStats()}forceFailureMode(t){t?this.enterFailureMode():this.exitFailureMode()}clearQueues(){this.queue=[],this.priorityQueue.clear()}toPayload(t,e=!1){return{batch:t,metadata:{itemCount:t.length,sentAt:(new Date).toISOString(),isBeacon:e,version:q,workspaceId:this.config.profileId,userAgent:"u">typeof navigator?navigator.userAgent:""}}}}class U extends T{constructor(t,e){var i,s,n;super(),p(this,"anonymousId"),p(this,"spotterUrl"),p(this,"sessionStorageKey","spotter_data"),p(this,"legacyCallback"),p(this,"ga"),this.anonymousId=e,this.spotterUrl=`${t.apiEndpoint}/bp/${t.profileId}/organisation`,this.ga=null==(i=null==t?void 0:t.integrations)?void 0:i.ga,null!=(s=null==window?void 0:window.SpotterSettings)&&s.callback&&(this.legacyCallback=null==(n=null==window?void 0:window.SpotterSettings)?void 0:n.callback)}storeIdentificationData(t){sessionStorage.setItem(this.sessionStorageKey,JSON.stringify(t))}retrieveIdentificationDataFromSession(){const t=sessionStorage.getItem(this.sessionStorageKey);return t?JSON.parse(t):null}async getSpotterData(){const t=this.retrieveIdentificationDataFromSession();if(t)return t;try{const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({anonymous_id:this.anonymousId,url:window.location.href})},e=await fetch(this.spotterUrl,t);if(e.ok){const t=await e.json();return this.storeIdentificationData(t),t}console.log("spotter returend an error",e.status)}catch(e){console.info("Failure to retrieve spotter data",e)}}mapToLegacySuccess(t){const e=t.data,i=Array.isArray(e.profiles)?e.profiles.reduce(((t,e)=>(t[e.name]=e,t)),{}):e.profiles;return{ip:"",domain:e.website,type:"business",company:{id:e.uuid,name:e.name,domain:e.website,industry:"",founded_year:0,employee_range:e.size,location:`${e.address.city}, ${e.address.country}`,description:"",emails:[e.email],phones:[e.phone],geo:{...e.address,street_name:e.address.street,state_code:null,country_code:null,gps:{lat:e.address.latitude,lon:e.address.longitude}},profiles:i}}}mapToLegacyFailure(){return{type:"isp"}}mapToLegacyDataset(t){return t.success?this.mapToLegacySuccess(t):this.mapToLegacyFailure()}invokeLegacyCallback(t){if(!this.legacyCallback)return;const e=this.mapToLegacyDataset(t);this.legacyCallback(e)}syncGa4Properties(t){if(!this.ga||!Array.isArray(this.ga.connections)||!t.success)return;const e={};for(const i of this.ga.connections){if(e[i.measurementId])return;const s=this.getMappedDimensions(i.mappings,t);this.sendGa4UserProperties(i.measurementId,s),e[i.measurementId]=!0}}getMappedDimensions(t,e){const i=this.mapToLegacyDataset(e);return Array.isArray(t)&&i?t.reduce(((t,e)=>{const{attribute:s,dimension:n,fallbackValue:r}=e,o=s.split(".").reduce(((t,e)=>(null==t?void 0:t[e])??null),i);return t[n]=o||r,t}),{}):{}}sendGa4UserProperties(t,e){window.dataLayer=window.dataLayer||[];const i=window.gtag||((...t)=>window.dataLayer.push(t));i("set","user_properties",e),i("event","Spotter Enriched",{...e,user_poperties:{...e},event_category:"Spotter",non_interaction:!0,send_to:t})}async tryLegacyFlow(){if(this.legacyCallback)return this.identify()}async identify(){const t=await this.getSpotterData();if(t)return this.invokeLegacyCallback(t),this.syncGa4Properties(t),t}}class J extends T{constructor(t){if(super(),p(this,"version",q),p(this,"initialized",!1),p(this,"__queuedCommands",[]),p(this,"userStore",new F),p(this,"sessionManager",new O),p(this,"formTracker",new E),p(this,"clickTracker",new _),p(this,"pageTracker"),p(this,"transport"),p(this,"heartbeatInterval",null),p(this,"spotter"),p(this,"httpClient"),p(this,"settings"),this.settings=t,!t.apiEndpoint)throw Error("apiEndpoint URL is required when initializing tracker");var e;this.settings.apiEndpoint=(e=t.apiEndpoint).includes("http")||e.includes("localhost")?e:"https://"+e,(t=>{y=new g(t)})({debug:t.debug,apiEndpoint:t.apiEndpoint}),this.settings.namespace=t.namespace,this.httpClient=new R(this.settings.apiEndpoint),this.transport=new H(this.settings,this.httpClient),this.pageTracker=new L,this.spotter=new U(this.settings,this.userStore.getDeviceId()),this.spotter.tryLegacyFlow()}init(){var t;this.initialized||(this.initialized=!0,"u">typeof window&&(null==(t=this.o)?void 0:t.length)>0&&(function(t,e){for(const[i,...s]of e)"function"==typeof t[i]?setTimeout((()=>{try{t[i](...s)}catch(e){b(e,"Error executing queued operation")}}),0):v("Unknown method called from queue: "+i)}(this,this.o),this.o=[]),this.settings.features.pageTracking&&this.startPageTracking(),this.settings.features.sessionTracking&&this.startSessionTracking(),this.startFormTracking(this.settings.features.formTracking),this.startclickTracking({...this.settings.features}),this.emit("initialized",{version:this.version}))}getSpotterIdentification(){return this.spotter.identify()}startPageTracking(){this.pageTracker.on(c.PAGE_VIEW,(t=>{this.h(c.PAGE_VIEW,t,{id:t.pageViewId,timestamp:t.timestamp}),this.emit(c.PAGE_VIEW,t)})),this.pageTracker.startTracking()}startFormTracking(t=!1){this.formTracker.startTracking(),this.formTracker.on("form_start",(t=>{this.emit("form_start",t)})),this.formTracker.on("form_submit",(e=>{t&&(this.h(c.FORM_SUBMIT,e),e.traits&&Object.keys(e.traits).length>0&&this.identify(e.traits)),this.emit("form_submit",e)})),this.formTracker.on("form_abandon",(e=>{t&&this.h(c.FORM_ABANDON,e),this.emit("form_abandon",e)})),this.formTracker.on("snid",(t=>{const e=this.getSession();this.h(c.SESSION_UPDATE,{session:e,snid:t})}))}startclickTracking({clickTracking:t,downloadTracking:e}){!t&&!e||(this.clickTracker.startTracking(),t&&this.clickTracker.on("click_event",(t=>{this.track(t.eventName,t.properties),this.emit("click_event",t)})),e&&this.clickTracker.on("download",(t=>{this.track(t.eventName,t.properties),this.emit("download",t)})))}startSessionTracking(){const t=this.getSession();1e3>Date.now()-Date.parse(t.startedAt)&&(this.h(c.SESSION_START,{session:t}),this.emit("session_start",t)),"u">typeof window&&!this.heartbeatInterval&&(this.heartbeatInterval=window.setInterval((()=>{this.sessionManager.extendSession();const t=this.getSession();this.h(c.SESSION_UPDATE,{session:t}),this.emit("session_update",t)}),3e5)),"u">typeof window&&window.addEventListener("beforeunload",(()=>{this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null);const t={session:this.getSession(),duration:this.sessionManager.getSessionDuration(),engagement:{totalTime:this.sessionManager.getSessionDuration(),activeTime:this.sessionManager.getEngagementTime(),segments:this.sessionManager.getEngagementSegments()}};this.h(c.SESSION_END,t),this.emit("session_end",t)}))}track(t,e={}){this.l(t,e,c.TRACK)}l(e,i={},s,n){this.sessionManager.extendSession();const r=this.getSession(),o={id:(null==n?void 0:n.id)||t(),type:s,properties:i,timestamp:(null==n?void 0:n.timestamp)||(new Date).toISOString(),page:this.pageTracker.getPage(),user:this.userStore.getUser(),session:r,...s===c.TRACK?{name:e}:{}};this.emit(s,o),this.transport.enqueue(o)}h(t,e={},i){this.l("",e,t,i)}getSession(){return this.sessionManager.getSession()}resetSession(){const t=this.getSession();this.sessionManager.endSession();const e={session:t,duration:w(Date.now()-Date.parse(t.startedAt)),engagement:{totalTime:w(Date.now()-Date.parse(t.startedAt)),activeTime:this.sessionManager.getEngagementTime(),segments:this.sessionManager.getEngagementSegments()}};this.h(c.SESSION_END,e),this.emit("session_end",e);const i=this.getSession();this.h(c.SESSION_START,{session:i}),this.emit("session_start",i)}identify(t){this.userStore.setTraits(t),this.h(c.IDENTIFY,{user:this.userStore.getUser()}),this.emit("identify",t)}flush(){this.transport.flush()}error(t){const e="string"==typeof t?Error(t):t;this.emit("error",e)}}u=Object.defineProperty,d=(t,e,i)=>e in t?u(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,m=(t,e,i)=>d(t,"symbol"!=typeof e?e+"":e,i);const z={namespace:"Radar",profileId:"",cdn:"https://cdn.snitcher.com",apiEndpoint:"https://radar.snitcher.com",debug:!1,features:{downloadTracking:!1,pageTracking:!0,formTracking:!1,clickTracking:!1,sessionTracking:!1,errorCapture:!1},transport:{batchSize:10,flushInterval:3e3,useBeacon:!0,blockedEvents:[]},integrations:{}};class Q{constructor(t){m(this,"debug",!1),m(this,"errorEndpoint"),this.debug=!!t.debug,this.errorEndpoint=t.apiEndpoint+"/errors"}report(t){try{const e=new XMLHttpRequest;e.open("POST",this.errorEndpoint,!0),e.setRequestHeader("Content-Type","application/json"),e.send(JSON.stringify({error:t.message,stack:t.stack,timestamp:(new Date).toISOString(),source:"radar-tracker",userAgent:navigator.userAgent,url:window.location.href}))}catch{}}log(...t){this.debug&&console.log("[Radar]",...t)}warn(...t){this.debug&&console.warn("[Radar]",...t)}error(t,...e){this.debug&&console.error("[Radar]",t,...e),this.report(t)}}let V;const G=(t,...e)=>null==V?void 0:V.error(t,...e);!async function(){try{const e=n(),i=e.apiEndpoint||z.apiEndpoint,s=e.debug||z.debug;if(V=new Q({apiEndpoint:i,debug:s}),"undefined"==typeof window)throw Error("Not in a browser context");const{compatible:r,missing:o}=function(){const t={fetch:"fetch"in window,localStorage:"localStorage"in window,JSON:"JSON"in window,Promise:"Promise"in window,setTimeout:"setTimeout"in window},e=Object.entries(t).filter((([,t])=>!t)).map((([t])=>t));return{compatible:0===e.length,missing:e}}();if(!r)throw Error("Browser compatibility check failed, missing: "+o);const a=await async function(){const t=n(),e=t.apiEndpoint||z.apiEndpoint,i=await async function(t,e,i){try{const s=await fetch(`${t}/bp/${e}/settings`,{method:"GET",headers:{"Content-Type":"application/json","x-tracking-script-version":i}});if(!s.ok)throw Error(`HTTP ${s.status}: ${s.statusText}`);const{data:n}=await s.json();if((t=>{if(!t||"object"!=typeof t)return!1;const e=t;return!(e.profileId&&"string"!=typeof e.profileId||e.apiEndpoint&&"string"!=typeof e.apiEndpoint||e.cdn&&"string"!=typeof e.cdn||e.namespace&&"string"!=typeof e.namespace)})(n.settings))return n.settings;throw Error(`[Radar] Invalid Runtime config received for ${e}: ${JSON.stringify(n)}`)}catch{return}}(e,t.profileId,q),s=(t=>{let e=z;return t.forEach((t=>{e={...e,...t,features:{...e.features,...t.features},transport:{...e.transport,...t.transport},integrations:{...e.integrations,...t.integrations}}})),e})([...i?[i]:[],t]);var r;return s.apiEndpoint=(r=s.apiEndpoint).includes("http")||r.includes("localhost")?r:"https://"+r,function(t){const e=[];if(t.apiEndpoint||e.push("apiEndpoint is required"),t.profileId||e.push("profileId is required"),t.namespace||e.push("namespace is required"),t.apiEndpoint&&!function(t){try{return new URL(t),!0}catch{return!1}}(t.apiEndpoint)&&e.push("apiEndpoint must be a valid URL"),e.length>0)throw Error("Radar configuration errors: "+e.join(", "))}(s),s}(),h=a.namespace,c=window[h];let l;try{l=function(t){if(!t.apiEndpoint)throw Error("apiEndpoint URL is required when creating a tracker");const e=new J(t),i=t.namespace||"Radar";if("u">typeof window&&window[i]&&Array.isArray(window[i])){const t=window[i].slice();window[i]=e,t.length>0&&(e.o=t)}return e}(a)}catch(t){throw function(t,e){t&&Array.isArray(t)&&(window[e]=t)}(c,h),t}c&&Array.isArray(c)&&(l.o=c.filter((t=>Array.isArray(t)))),window[h]=l,l.init(),l.on&&l.on("error",(t=>{G(t)}))}catch(e){G(e)}}()}();
