(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9916],{28137:(e,t,n)=>{"use strict";n.d(t,{F:()=>c});var a=n(98518),s=n(1761),i=n(27062),r=n(7620),l=n(34116);let o="payment-verification-reminder-dismissed";function c(){let{activeOrganization:e}=(0,s.YL)(),t=(0,a.st)(),[n,c]=(0,r.useState)(!1),{value:d}=(0,i.fS)("show_3ds_modal"),{data:u}=(0,l.PI)(d);return(0,r.useEffect)(()=>{var n;let a=localStorage.getItem(o);if(a){let e=new Date(a).getTime();if(new Date().getTime()-e<864e5)return void c(!1)}let s=d&&null!=(n=null==u?void 0:u.requires_3ds_verification)&&n;c(s),s&&t.track({event_key:"payment_modal_open",organization_id:null==e?void 0:e.uuid,modal_type:"3ds_verification_required"})},[d,u,t,e]),{shouldShowModal:n,dismissReminder:(0,r.useCallback)(()=>{let n=new Date().toISOString();localStorage.setItem(o,n),c(!1),t.track({event_key:"payment_modal_open",organization_id:null==e?void 0:e.uuid,action:"3ds_verification_dismissed",dismissed_at:n})},[t,e])}}},55947:(e,t,n)=>{"use strict";n.d(t,{T:()=>v});var a=n(54568),s=n(98518),i=n(1761),r=n(51121),l=n(78730),o=n(86030),c=n(37076),d=n(87606),u=n(7620),m=n(62971),f=n(34116),g=n(28137);function v(){let[e,t]=(0,u.useState)(!1),n=(0,s.st)(),{activeOrganization:v}=(0,i.YL)(),{addError:p,addSuccess:x}=(0,r.Y)(),_=(0,l.ib)(),h=(0,d.useQueryClient)(),{shouldShowModal:y,dismissReminder:j}=(0,g.F)(),b=(0,f.Si)({onSuccess:async e=>{try{let t=await _;if(!t)throw Error("Stripe failed to initialize");let s=await t.handleNextAction({clientSecret:e.clientSecret});if(s.error)throw Error(s.error.message||"PAYMENT_VERIFICATION_FAILED");await h.invalidateQueries({queryKey:["check-3ds-required",null==v?void 0:v.uuid]}),x((0,a.jsx)(m.A,{defaultMessage:"Payment method verified successfully",id:"vRXoCh/o7W"})),n.track({event_key:"payment_modal_open",organization_id:null==v?void 0:v.uuid,action:"verify_3ds_success"})}catch(e){p(e instanceof Error&&"PAYMENT_VERIFICATION_FAILED"===e.message?(0,a.jsx)(m.A,{defaultMessage:"Payment verification failed",id:"9RpX03Q2ky"}):e instanceof Error?e.message:(0,a.jsx)(m.A,{defaultMessage:"Payment verification failed. Please try again.",id:"0kXa3Rf5bZ"})),n.track({event_key:"payment_modal_open",organization_id:null==v?void 0:v.uuid,action:"verify_3ds_error",error_message:e instanceof Error?e.message:"Unknown error"})}finally{t(!1)}},onError:e=>{t(!1),p((0,a.jsx)(m.A,{defaultMessage:"Failed to start verification process. Please try again.",id:"3dT/r8rV5S"})),n.track({event_key:"payment_modal_open",organization_id:null==v?void 0:v.uuid,action:"verify_3ds_api_error",error_message:e.message})}}),k=()=>{j()};return y?(0,a.jsx)(c.aF,{isOpen:y,onClose:k,modalSize:"md",hasCloseButton:!0,title:(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)(o.E,{color:"secondary",size:"lg",children:(0,a.jsx)(m.A,{defaultMessage:"Action Required",id:"jWgFDt2Ifa"})})}),children:(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("h2",{className:"text-3xl font-medium text-text-100 mb-3",children:(0,a.jsx)(m.A,{defaultMessage:"Verify your payment method",id:"epYApo9bIj"})}),(0,a.jsx)("p",{className:"text-text-200 mb-6",children:(0,a.jsx)(m.A,{defaultMessage:"To comply with European security regulations, we need to verify your payment method using a quick one-time security process. This ensures your subscription remains active and secure.",id:"K0hDpiUx0B"})}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 mt-6",children:[(0,a.jsx)(c.yl,{onClick:()=>{t(!0),n.track({event_key:"payment_modal_open",organization_id:null==v?void 0:v.uuid,action:"verify_3ds_start"});let e=window.location.href;b.mutate({return_url:e})},loading:e,className:"w-full",children:(0,a.jsx)(m.A,{defaultMessage:"Verify now",id:"t28SE7zKVA"})}),(0,a.jsx)(c.yl,{variant:"secondary",onClick:k,className:"w-full",children:(0,a.jsx)(m.A,{defaultMessage:"Remind me later",id:"c4hRLOnYpQ"})})]})]})}):null}},68708:(e,t,n)=>{Promise.resolve().then(n.bind(n,78055))},78055:(e,t,n)=>{"use strict";n.d(t,{ChatClientPage:()=>P});var a=n(54568),s=n(7726),i=n(91961),r=n(95675),l=n(56273),o=n(1761),c=n(53248);function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;if(e.length<=t)return e;let n=Math.ceil(t/2);return"".concat(e.substring(0,n),"\n\n  [...]\n\n  ").concat(e.substring(e.length-n))}var u=n(7620),m=n(46760),f=n(70011),g=n(19303),v=n(2341),p=n(62942),x=n(90119),_=n(92947),h=n(89116),y=n(26553),j=n(2188),b=n(99187),k=n(51017),w=n(98518),S=n(28871),N=n(8027),A=n(11515),C=n(41417),E=n(37076),M=n(98411),I=n(62971),z=n(94748),O=n(83133),T=n(67532);function F(e){let{isModalOpen:t,currentTool:n,currentToolInput:s,currentServer:i,handleDeny:r,handleAllow:l,handleAlwaysAllow:o}=e,{isExpanded:c,setIsExpanded:d,snappyTransition:u}=(0,T.a)(!1);if(n)return(0,a.jsxs)(E.aF,{isOpen:t,onClose:()=>r(),autoCloseOnFocusOut:!1,closeOnEscapeKeydown:!1,modalSize:"lg",title:(0,a.jsx)(I.A,{defaultMessage:"Claude would like to use an external integration",id:"UubrzH+Qzc"}),children:[(0,a.jsx)("div",{className:"mt-4"}),(0,a.jsx)(z.sH,{isStreaming:!1,isExpanded:c,setIsExpanded:d,isFirstBlockOfMessage:!0,isLastBlockOfMessage:!0,text:(0,a.jsx)(M.fI,{className:"!py-0",children:(0,a.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,a.jsx)(A.d,{url:null==i?void 0:i.url,fallbackSvg:(0,a.jsx)(N.B,{letter:n.serverName,size:40}),size:40}),(0,a.jsxs)("div",{className:"flex flex-col py-1",children:[(0,a.jsx)("div",{className:"text-sm text-text-400 font-mono",children:n.name}),(0,a.jsx)("span",{className:"font-medium text-[0.9rem] pt-1",children:n.serverName})]})]})}),className:"!h-auto",children:(0,a.jsx)(z.NG,{isExpanded:c,snappyTransition:u,isScrollable:!0,children:(0,a.jsx)(O.L,{input:s?JSON.parse(s):""})})}),(0,a.jsxs)("div",{className:"flex flex-col p-4 gap-4 bg-bg-300 my-4 rounded-lg border-0.5 border-border-300",children:[(0,a.jsx)("p",{className:"font-medium",children:(0,a.jsx)(I.A,{defaultMessage:"Review each action carefully before approving",id:"IaQzFuy2mt"})}),(0,a.jsx)("p",{children:(0,a.jsx)(I.A,{defaultMessage:"Claude cannot guarantee the security or privacy practices of third-party integrations.",id:"3gyayAmXQv"})})]}),(0,a.jsx)(E.vW,{className:"flex justify-between",children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[o&&(0,a.jsx)(C.$,{onClick:o,children:(0,a.jsx)(I.A,{defaultMessage:"Allow always",id:"F8zkKBCp6U"})}),(0,a.jsx)(C.$,{onClick:l,autoFocus:!0,children:(0,a.jsx)(I.A,{defaultMessage:"Allow once",id:"O2tb5KUxpc"})})]}),(0,a.jsx)(C.$,{onClick:r,variant:"outline",children:(0,a.jsx)(I.A,{defaultMessage:"Decline",id:"pvtgR26QWY"})})]})})]})}function U(e){var t,n;let{conversation:i,conversationUUID:r,isLoadingHarmony:l,chatInputDefaultMessage:h}=e,{currentPath:y,data:j,isLoading:N,isPlaceholderData:A}=(0,s.Bq)(r,{suppressError:!0}),{changeDisplayedConversationPath:C}=(0,g.G)(),{onInvokeTool:E,isModalOpen:M,currentTool:I,currentToolInput:z,currentServer:O,handleAllow:T,handleDeny:U,handleAlwaysAllow:D}=function(e){let{conversationUUID:t}=e,{mcpTools:n,servers:a}=(0,_.gt)(),s=(0,k.M)(),{track:i}=(0,w.st)(),[r,l]=(0,u.useState)(!1),[o,c]=(0,u.useState)(null),[d,m]=(0,u.useState)(null),[f,g]=(0,u.useState)(null),[v,p]=(0,u.useState)(null),x=(0,_.Ib)(),{toggleMcpToolAlwaysApproved:h}=(0,_.es)(),{getApprovalSetting:y}=(0,_.BN)(),{alwaysAllowEnabled:j}=y(null==o?void 0:o.serverName,o),b=(0,u.useRef)(x);(0,u.useEffect)(()=>{b.current=x},[x]);let N=(0,u.useCallback)(async(e,t,i,r,o)=>{var d,u;let f=t.includes(":"),v=n.find(e=>(f?"".concat(e.serverName,":").concat(e.name):e.name)===t),x=(null==(d=a.find(e=>{let{name:t}=e;return t===(null==v?void 0:v.serverName)}))?void 0:d.uuid)||"local";if(!v||!x)return s(e,t,i,r,o);let{approvalSetting:h}=y(v.serverName,v);if("never"===h)return s(e,t,i,r,o);if("dolphin"===t){let n=(u=(0,S.p)(r))&&"object"==typeof u?"actions"in u&&Array.isArray(u.actions)?u.actions.map(e=>({type:e.action,state:"pending",coordinate:"coordinate"in e?e.coordinate:void 0,start_coordinate:"start_coordinate"in e?e.start_coordinate:void 0,text:"text"in e?e.text:void 0,scroll_direction:"scroll_direction"in e?e.scroll_direction:void 0,scroll_amount:"scroll_amount"in e?e.scroll_amount:void 0,duration:"duration"in e?e.duration:void 0})):"action"in u?[{type:u.action,state:"pending",coordinate:"coordinate"in u?u.coordinate:void 0,start_coordinate:"start_coordinate"in u?u.start_coordinate:void 0,text:"text"in u?u.text:void 0,scroll_direction:"scroll_direction"in u?u.scroll_direction:void 0,scroll_amount:"scroll_amount"in u?u.scroll_amount:void 0,duration:"duration"in u?u.duration:void 0}]:[]:[];if(1===n.length&&"screenshot"===n[0].type)return s(e,t,i,r,o);if(n.length>0)return new Promise(e=>{m(x),c(v),g(i),p(r),e()})}return b.current.includes((0,_.Hj)(x,v))?s(e,t,i,r,o):new Promise(e=>{m(x),c(v),g(i),p(r),l(!0),e()})},[a,s,n,y]),A=(0,u.useCallback)(()=>{l(!1),o&&null!==f&&null!==v&&s(t,"".concat(o.serverName,":").concat(o.name),f,v)},[t,o,f,v,s]),C=(0,u.useCallback)(()=>{if(l(!1),o&&null!==f&&null!==v){var e;s(t,"".concat(o.serverName,":").concat(o.name),f,v,{overriddenResult:{content:[{type:"text",text:"The user has chosen to disallow the tool call."}],is_error:!0}}),i({event_key:"mcp.tools.called",result:"disallowed",argument_count:Object.keys(null!=(e=(0,S.p)(v))?e:{}).length})}},[t,o,f,v,s,i]),E=(0,u.useCallback)(()=>{j&&(o&&d&&h(d,o,!0),l(!1),o&&null!==f&&null!==v&&s(t,"".concat(o.serverName,":").concat(o.name),f,v))},[d,t,o,f,v,s,h,j]);return{onInvokeTool:N,isModalOpen:r,currentTool:o,currentServer:a.find(e=>e.uuid===d),currentToolInput:v,handleAllow:A,handleDeny:C,handleAlwaysAllow:j?E:void 0}}({conversationUUID:r}),R=(0,k.n)(null==j?void 0:j.settings,null==i?void 0:i.project_uuid),[P,L]=(0,u.useState)(),B=(0,u.useCallback)(e=>{L(e)},[L]),q=(0,f.Gw)(r,E,R),Y=(0,f.SL)(r,E,R,P),{mutate:Q}=(0,s.lj)(r),K=q.isStreaming||Y.isStreaming,V=q.runStream;!function(e,t){let[n,a]=(0,u.useState)(!1),{activeOrganization:i}=(0,o.YL)(),r=(0,m.A)(),l=e?e.uuid:"",{mutate:f}=(0,s.HI)(l),{mutate:g,error:v}=(0,s.OZ)(l),p=(0,u.useRef)(!1);(0,u.useEffect)(()=>{var t;if(!v||(null==e?void 0:e.name))return;let n=(null==e||null==(t=e.chat_messages)?void 0:t[0])?(0,c.C)(e.chat_messages[0]):"";if(n){if(p.current)return;let e=n.slice(0,30),t=n.length>30?"...":"";p.current=!0,f({name:"".concat(e).concat(t)})}},[v,e,f]),(0,u.useEffect)(()=>{if(t||n||(null==e?void 0:e.name))return;let s=null==e?void 0:e.chat_messages;if(!s||s.length<2||0===(0,c.C)(s[1]).length)return;let r=["Message 1:",d((0,c.C)(s[0])),"Message 2:",d((0,c.C)(s[1]))].join("\n\n");i&&(a(!0),g({message_content:r,recent_titles:[]}))},[t,n,e,i,g,r])}(j,K),function(e){let{conversationUUID:t,isStreaming:n}=e,[a,s]=(0,u.useState)(n),{mcpClients:i}=(0,_.gt)(),r=i.dolphin,l=(0,x.V)(),o=!!r&&l;(0,u.useEffect)(()=>{o&&(!n&&a?(s(!1),r.notification({method:"notifications/progress",params:{progress:1,total:1,progressToken:"streaming"}})):!a&&n&&(r.notification({method:"notifications/progress",params:{progress:0,total:1,progressToken:"streaming"}}),s(!0)))},[t,o,n,a,r])}({conversationUUID:r,isStreaming:K});let H=(0,u.useCallback)(async(e,t)=>{var n,a;await V({prompt:t,attachments:e.attachments,files:null!=(a=e.files_v2)?a:e.files,syncSources:e.sync_sources,parent_message_uuid:e.parent_message_uuid,personalized_style:P,compass_mode:null==(n=e.metadata)?void 0:n.compass_mode})},[V,P]),W=(0,u.useCallback)((e,t)=>{C(r,e,t,e=>Q({current_leaf_message_uuid:e}))},[C,r,Q]);return j||N||A||(0,p.notFound)(),(0,a.jsxs)(v.N,{settings:(null==j?void 0:j.settings)||{},children:[(0,a.jsx)(b.v,{isStreaming:K,chatInputDefaultMessage:h,conversationTitle:i?"".concat(i.name," - Claude"):"Claude",conversationUUID:r,isLoading:N||!!l,messages:y,name:null!=(n=null!=(t=null==j?void 0:j.name)?t:null==i?void 0:i.name)?n:"Untitled Chat",onSend:q.runStream,onRetry:Y.runStream,projectUuid:null==j?void 0:j.project_uuid,changeDisplayedConversationPath:W,editMessage:H,setPersonalizedStyleCallback:B,onToolAllow:T}),(0,a.jsx)(F,{isModalOpen:M,currentTool:I,currentToolInput:z,currentServer:O,handleDeny:U,handleAllow:T,handleAlwaysAllow:D})]})}function D(e){let{data:t}=(0,s.Bq)(e.conversationUUID,{suppressError:!0}),n=(null==t?void 0:t.project_uuid)||"",{userHasHarmony:i,projectHasHarmony:r}=(0,y.r)(n),[l,o]=(0,u.useState)(!!(i&&r)),c=(0,u.useCallback)(()=>o(!1),[]);return(0,a.jsx)(j.A,{projectUuid:n,onLoad:c,children:(0,a.jsx)(h.w,{children:(0,a.jsx)(U,{...e,isLoadingHarmony:l})})})}var R=n(55947);function P(e){var t;let{uuid:n,q:o}=e,{data:c}=(0,s.Bq)(n);return(0,i.K7)(null!=(t=null==c?void 0:c.name)?t:""),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.u,{conversationUUID:n,children:(0,a.jsx)(r._,{conversationUUID:n,children:(0,a.jsx)(D,{conversation:c,conversationUUID:n,chatInputDefaultMessage:o})})}),(0,a.jsx)(R.T,{})]})}},86030:(e,t,n)=>{"use strict";n.d(t,{E:()=>i});var a=n(54568),s=n(32987);let i=e=>{let{color:t="default",size:n="default",children:i,className:r,uppercase:l}=e;return(0,a.jsx)("div",{className:(0,s.$)("inline-flex items-center align-middle leading-none","default"===t&&"bg-gradient-to-bl  from-bg-500/30  to-bg-500/70 text-text-300","flat"===t&&"bg-bg-500/40 text-text-200","secondary"===t&&"bg-accent-secondary-900/40 text-accent-secondary-200","pro"===t&&"bg-gradient-to-bl  from-accent-pro-200  to-accent-pro-100  text-oncolor-100","main"===t&&"bg-gradient-to-bl  from-accent-main-200/70  to-accent-main-100  text-oncolor-100","default"===n&&"h-5 px-1.5 rounded-md text-[0.625rem]","sm"===n&&"h-4 px-1 rounded text-[0.625rem]","lg"===n&&"h-6 px-2 rounded-lg text-xs",l&&"uppercase tracking-[0.015rem]",r),children:i})}}},e=>{var t=t=>e(e.s=t);e.O(0,[1658,3602,7401,3473,7598,4676,6760,2846,7261,5006,1036,5015,5278,7773,427,7463,3243,5647,2715,9304,6631,7754,5273,5210,1773,8864,4767,6569,8222,9413,6138,7351,1623,9427,3070,6383,1922,3875,966,45,2859,6648,9005,1761,7263,8958,1772,28,11,7383,7300,2947,8715,1653,4665,813,498,3408,8982,3996,7124,9187,587,842,3915,7358],()=>t(68708)),_N_E=e.O()}]);